(()=>{var O=Object.create;var S=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,P=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var z=(r,e,t)=>e in r?S(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,N=(r,e)=>{for(var t in e||(e={}))E.call(e,t)&&z(r,t,e[t]);if(j)for(var t of j(e))M.call(e,t)&&z(r,t,e[t]);return r};var R=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var q=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of V(e))!E.call(r,a)&&a!==t&&S(r,a,{get:()=>e[a],enumerable:!(s=I(e,a))||s.enumerable});return r};var K=(r,e,t)=>(t=r!=null?O(P(r)):{},q(e||!r||!r.__esModule?S(t,"default",{value:r,enumerable:!0}):t,r));var F=R((exports,module)=>{frappe.provide("frappe.treeview_settings");frappe.provide("frappe.views.trees");window.cur_tree=null;frappe.views.TreeFactory=class extends frappe.views.Factory{make(e){frappe.model.with_doctype(e[1],function(){var t={doctype:e[1],meta:frappe.get_meta(e[1])};if(!frappe.treeview_settings[e[1]]&&!frappe.meta.get_docfield(e[1],"is_group"))return frappe.msgprint(__("Tree view is not available for {0}",[e[1]])),!1;$.extend(t,frappe.treeview_settings[e[1]]||{}),frappe.views.trees[t.doctype]=new frappe.views.TreeView(t)})}on_show(){let e=frappe.get_route(),t=frappe.views.trees[e[1]];t&&t.make_tree()}get view_name(){return"Tree"}};frappe.views.TreeView=class{constructor(r){var e=this;this.opts={},this.opts.get_tree_root=!0,this.opts.show_expand_all=!0,$.extend(this.opts,r),this.doctype=r.doctype,this.args={doctype:e.doctype},this.page_name=frappe.get_route_str(),this.get_tree_nodes=e.opts.get_tree_nodes||"frappe.desk.treeview.get_children",this.get_permissions(),this.make_page(),this.make_filters(),this.root_value=null,e.opts.get_tree_root&&this.get_root(),this.onload(),this.opts.do_not_setup_menu||this.set_menu_item(),this.set_primary_action()}get_permissions(){this.can_read=frappe.model.can_read(this.doctype),this.can_create=frappe.boot.user.can_create.indexOf(this.doctype)!==-1||frappe.boot.user.in_create.indexOf(this.doctype)!==-1,this.can_write=frappe.model.can_write(this.doctype),this.can_delete=frappe.model.can_delete(this.doctype)}make_page(){var r=this;if(!this.opts||!this.opts.do_not_make_page?(this.parent=frappe.container.add_page(this.page_name),frappe.ui.make_app_page({parent:this.parent,single_column:!0}),this.page=this.parent.page,frappe.container.change_to(this.page_name),frappe.breadcrumbs.add(r.opts.breadcrumb||locals.DocType[r.doctype].module,r.doctype),this.set_title(),this.page.main.css({"min-height":"300px"}),this.page.main.addClass("frappe-card")):(this.page=this.opts.page,$(this.page[0]).addClass("frappe-card")),this.opts.show_expand_all&&(this.page.add_inner_button(__("Collapse All"),function(){r.tree.load_children(r.tree.root_node,!1)}),this.page.add_inner_button(__("Expand All"),function(){r.tree.load_children(r.tree.root_node,!0)})),this.opts.view_template){var e=$('<div class="row"><div>').appendTo(this.page.main);this.body=$('<div class="col-sm-6 col-xs-12"></div>').appendTo(e),this.node_view=$('<div class="col-sm-6 hidden-xs"></div>').appendTo(e)}else this.body=this.page.main}set_title(){this.page.set_title(this.opts.title||__("{0} Tree",[__(this.doctype)]))}onload(){var r=this;this.opts.onload&&this.opts.onload(r)}make_filters(){var r=this;frappe.treeview_settings.filters=[],$.each(this.opts.filters||[],function(e,t){frappe.route_options&&frappe.route_options[t.fieldname]&&(t.default=frappe.route_options[t.fieldname]),t.disable_onchange||(t.change=function(){t.onchange&&t.onchange();var s=this.get_value();r.args[t.fieldname]=s,s?r.root_label=s:r.root_label=r.opts.root_label,r.set_title(),r.make_tree()}),r.page.add_field(t),t.default&&$("[data-fieldname='"+t.fieldname+"']").trigger("change")})}get_root(){var r=this;frappe.call({method:r.get_tree_nodes,args:r.args,callback:function(e){e.message&&(e.message.length>1?(r.root_label=r.doctype,r.root_value=""):(r.root_label=e.message[0].value,r.root_value=r.root_label),r.make_tree())}})}make_tree(){$(this.parent).find(".tree").remove();var r=this.args[this.opts.root_label]||this.root_label||this.opts.root_label,e=this.root_value;e==null&&(e=r),this.tree=new frappe.ui.Tree({parent:this.body,label:r,root_value:e,expandable:!0,args:this.args,method:this.get_tree_nodes,toolbar:this.get_toolbar(),get_label:this.opts.get_label,on_render:this.opts.onrender,on_get_node:this.opts.on_get_node,on_click:t=>{this.select_node(t)}}),cur_tree=this.tree,cur_tree.view_name="Tree",this.post_render()}rebuild_tree(){let r=this;frappe.call({method:"frappe.utils.nestedset.rebuild_tree",args:{doctype:r.doctype},callback:function(e){e.exc||r.make_tree()}})}post_render(){var r=this;r.opts.post_render&&r.opts.post_render(r)}select_node(r){var e=this;this.opts.click&&this.opts.click(r),this.opts.view_template&&(this.node_view.empty(),$(frappe.render_template(e.opts.view_template,{data:r.data,doctype:e.doctype})).appendTo(this.node_view))}get_toolbar(){var r=this,e=[{label:__(r.can_write?"Edit":"Details"),condition:function(t){return!t.is_root&&r.can_read},click:function(t){frappe.set_route("Form",r.doctype,t.label)}},{label:__("Add Child"),condition:function(t){return r.can_create&&t.expandable&&!t.hide_add},click:function(t){r.new_node()},btnClass:"hidden-xs"},{label:__("Rename"),condition:function(t){let s=!0;return r.doctype&&frappe.get_meta(r.doctype)&&(frappe.get_meta(r.doctype).allow_rename||(s=!1)),!t.is_root&&r.can_write&&s},click:function(t){frappe.model.rename_doc(r.doctype,t.label,function(s){t.$tree_link.find("a").text(s),t.label=s,r.tree.refresh()})},btnClass:"hidden-xs"},{label:__("Delete"),condition:function(t){return!t.is_root&&r.can_delete},click:function(t){frappe.model.delete_doc(r.doctype,t.label,function(){t.parent.remove()})},btnClass:"hidden-xs"}];return this.opts.toolbar&&this.opts.extend_toolbar?(e=e.filter(t=>!r.opts.toolbar.find(s=>s.label==t.label)),e.concat(this.opts.toolbar)):this.opts.toolbar&&!this.opts.extend_toolbar?this.opts.toolbar:e}new_node(){var r=this,e=r.tree.get_selected_node();if(!(e&&e.expandable)){frappe.msgprint(__("Select a group node first."));return}this.prepare_fields();var t=new frappe.ui.Dialog({title:__("New {0}",[__(r.doctype)]),fields:r.fields}),s=$.extend({},r.args);s["parent_"+r.doctype.toLowerCase().replace(/ /g,"_")]=r.args.parent,t.set_value("is_group",0),t.set_values(s),t.set_primary_action(__("Create New"),function(){var a=this,l=t.get_values();if(!!l)return l.parent=e.label,l.doctype=r.doctype,e.is_root?l.is_root=e.is_root:l.is_root=!1,t.hide(),frappe.dom.freeze(__("Creating {0}",[r.doctype])),$.extend(s,l),frappe.call({method:r.opts.add_tree_node||"frappe.desk.treeview.add_node",args:s,callback:function(n){n.exc||r.tree.load_children(e)},always:function(){frappe.dom.unfreeze()}})}),t.show()}prepare_fields(){var r=this;this.fields=[{fieldtype:"Check",fieldname:"is_group",label:__("Group Node"),description:__("Further nodes can be only created under 'Group' type nodes")}],this.opts.fields&&(this.fields=this.opts.fields),this.ignore_fields=this.opts.ignore_fields||[];var e=$.map(r.opts.meta.fields,function(s){return s.reqd||s.bold&&!s.read_only&&!!s.is_virtual?s:null}),t=this.fields.map(function(s){return s.fieldname});e.map(function(s){$.inArray(s.fieldname,r.ignore_fields)===-1&&$.inArray(s.fieldname,t)===-1&&r.fields.push(s)})}print_tree(){if(!frappe.model.can_print(this.doctype))return frappe.msgprint(__("You are not allowed to print this report")),!1;var r=$(".tree:visible").html(),e=this;frappe.ui.get_print_settings(!1,function(t){var s=__(e.docname||e.doctype);frappe.render_tree({title:s,tree:r,print_settings:t}),frappe.call({method:"frappe.core.doctype.access_log.access_log.make_access_log",args:{doctype:e.doctype,report_name:e.page_name,page:r,method:"Print"}})})}set_primary_action(){var r=this;!this.opts.disable_add_node&&this.can_create&&r.page.set_primary_action(__("New"),function(){r.new_node()},"add")}set_menu_item(){var me=this;this.menu_items=[{label:__("View List"),action:function(){frappe.set_route("List",me.doctype)}},{label:__("Print"),action:function(){me.print_tree()}},{label:__("Refresh"),action:function(){me.make_tree()}}],frappe.user.has_role("System Manager")&&frappe.meta.has_field(me.doctype,"lft")&&frappe.meta.has_field(me.doctype,"rgt")&&this.menu_items.push({label:__("Rebuild Tree"),action:function(){me.rebuild_tree()}}),me.opts.menu_items&&me.menu_items.push.apply(me.menu_items,me.opts.menu_items),$.each(me.menu_items,function(i,menu_item){var has_perm=!0;menu_item.condition&&(has_perm=eval(menu_item.condition)),has_perm&&me.page.add_menu_item(menu_item.label,menu_item.action)})}}});frappe.templates.listing=`<div class="frappe-list">
	<div class="list-filters" style="display: none;">
	</div>

	<div style="margin-bottom:9px" class="list-toolbar-wrapper hide">
		<div class="list-toolbar btn-group" style="display:inline-block; margin-right: 10px;">
		</div>
	</div>
    <div style="clear:both"></div>
	<div class="no-result text-center" style="display: none;">
		{%= no_result_message %}
	</div>
	<div class="result">
		<div class="list-headers"></div>
        <div class="list-loading text-center">
        	{%= frappe.messages.get_waiting_message(__("Loading") + "..." ) %}
        </div>
		<div class="result-list"></div>
	</div>
	<div class="list-paging-area">
		<div class="row">
			<div class="col-xs-6">
				<div class="btn-group btn-group-paging">
					<button type="button" class="btn btn-default btn-sm btn-info" data-value="20">20</button>
					<button type="button" class="btn btn-default btn-sm" data-value="100">100</button>
					<button type="button" class="btn btn-default btn-sm" data-value="500">500</button>
				</div>
			</div>
			<div class="col-xs-6 text-right">
				<button class="btn btn-default btn-more btn-sm">{%= _more %}...</button>
			</div>
		</div>
	</div>
</div>
`;frappe.has_indicator=function(r){return frappe.model.is_submittable(r)||(frappe.listview_settings[r]||{}).get_indicator||frappe.workflow.get_state_fieldname(r)||frappe.meta.has_field(r,"enabled")||frappe.meta.has_field(r,"disabled")?!0:!!(frappe.meta.has_field(r,"status")&&frappe.get_meta(r).states.length)};frappe.get_indicator=function(r,e,t){if(r.__unsaved)return[__("Not Saved"),"orange"];e||(e=r.doctype);let s=frappe.get_meta(e);var a=frappe.workflow.workflows[e],l=a?a.override_status:!0,n=frappe.listview_settings[e]||{},o=frappe.model.is_submittable(e);let _=frappe.workflow.get_state_fieldname(e),p=(frappe.workflow.avoid_status_override[e]||[]).includes(r[_]);if(_&&(!l||t)&&!p){var d=r[_];if(d){let h="";return locals["Workflow State"][d]&&locals["Workflow State"][d].style&&(h={Success:"green",Warning:"orange",Danger:"red",Primary:"blue",Inverse:"black",Info:"light-blue"}[locals["Workflow State"][d].style]),h||(h="gray"),[__(d),h,_+",=,"+d]}}if(o&&r.docstatus==0&&!n.has_indicator_for_draft)return[__("Draft"),"red","docstatus,=,0"];if(o&&r.docstatus==2&&!n.has_indicator_for_cancelled)return[__("Cancelled"),"red","docstatus,=,2"];if(r.status&&s&&s.states&&s.states.find(h=>h.title===r.status)){let h=s.states.find(u=>u.title===r.status),b=frappe.scrub(h.color,"-");return[__(r.status),b,"status,=,"+r.status]}if(n.get_indicator){var c=n.get_indicator(r);if(c)return c}if(o&&r.docstatus==1)return[__("Submitted"),"blue","docstatus,=,1"];if(r.status)return[__(r.status),frappe.utils.guess_colour(r.status)];if(frappe.meta.has_field(e,"enabled"))return r.enabled?[__("Enabled"),"blue","enabled,=,1"]:[__("Disabled"),"grey","enabled,=,0"];if(frappe.meta.has_field(e,"disabled"))return r.disabled?[__("Disabled"),"grey","disabled,=,1"]:[__("Enabled"),"blue","disabled,=,0"]};frappe.ui.Filter=class{constructor(r){$.extend(this,r),(this.value===null||this.value===void 0)&&(this.value=""),this.utils=frappe.ui.filter_utils,this.set_conditions(),this.set_conditions_from_config(),this.make()}set_conditions(){this.conditions=[["=",__("Equals")],["!=",__("Not Equals")],["like",__("Like")],["not like",__("Not Like")],["in",__("In")],["not in",__("Not In")],["is",__("Is")],[">",">"],["<","<"],[">=",">="],["<=","<="],["Between",__("Between")],["Timespan",__("Timespan")]],this.nested_set_conditions=[["descendants of",__("Descendants Of")],["descendants of (inclusive)",__("Descendants Of (inclusive)")],["not descendants of",__("Not Descendants Of")],["ancestors of",__("Ancestors Of")],["not ancestors of",__("Not Ancestors Of")]],this.conditions.push(...this.nested_set_conditions),this.invalid_condition_map={Date:["like","not like"],Datetime:["like","not like","in","not in","=","!="],Data:["Between","Timespan"],Select:["like","not like","Between","Timespan"],Link:["Between","Timespan",">","<",">=","<="],Currency:["Between","Timespan"],Color:["Between","Timespan"],Check:this.conditions.map(r=>r[0]).filter(r=>r!=="="),Code:["Between","Timespan",">","<",">=","<=","in","not in"],"HTML Editor":["Between","Timespan",">","<",">=","<=","in","not in"],"Markdown Editor":["Between","Timespan",">","<",">=","<=","in","not in"],Password:["Between","Timespan",">","<",">=","<=","in","not in"],Rating:["like","not like","Between","in","not in","Timespan"],Float:["like","not like","Between","in","not in","Timespan"]}}set_conditions_from_config(){if(frappe.boot.additional_filters_config){this.filters_config=frappe.boot.additional_filters_config;for(let r of Object.keys(this.filters_config)){let e=this.filters_config[r];this.conditions.push([r,__(e.label)]);for(let t of Object.keys(this.invalid_condition_map))e.valid_for_fieldtypes.includes(t)||this.invalid_condition_map[t].push(r)}}}make(){this.filter_edit_area=$(frappe.render_template("edit_filter",{conditions:this.conditions})),this.parent&&this.filter_edit_area.appendTo(this.parent.find(".filter-edit-area")),this.make_select(),this.set_events(),this.setup()}make_select(){this.fieldselect=new frappe.ui.FieldSelect({parent:this.filter_edit_area.find(".fieldname-select-area"),doctype:this.parent_doctype,parent_doctype:this._parent_doctype,filter_fields:this.filter_fields,input_class:"input-xs",select:(r,e)=>{this.set_field(r,e)}}),this.fieldname&&this.fieldselect.set_value(this.doctype,this.fieldname)}set_events(){this.filter_edit_area.find(".remove-filter").on("click",()=>{this.remove(),this.on_change()}),this.filter_edit_area.find(".condition").change(()=>{if(!this.field)return;let r=this.get_condition(),e=null;["in","like","not in","not like"].includes(r)?(e="Data",this.add_condition_help(r)):this.filter_edit_area.find(".filter-description").empty(),["Select","MultiSelect"].includes(this.field.df.fieldtype)&&["in","not in"].includes(r)&&(e="MultiSelect"),this.set_field(this.field.df.parent,this.field.df.fieldname,e,r)})}setup(){let r=this.fieldname||"name";return this.set_values(this.doctype,r,this.condition,this.value)}setup_state(r){let e=Promise.resolve();r?this.filter_edit_area.addClass("new-filter"):e=this.update_filter_tag(),this.hidden&&e.then(()=>this.$filter_tag.hide())}freeze(){this.update_filter_tag()}update_filter_tag(){return this._filter_value_set?this._filter_value_set.then(()=>{this.$filter_tag?this.set_filter_button_text():this.make_tag(),this.filter_edit_area.hide()}):Promise.resolve()}remove(){this.filter_edit_area.remove(),this.field=null}set_values(r,e,t,s){if(this.set_field(r,e)!==!1)return this.field.df.original_type==="Check"&&(s=s==1?"Yes":"No"),t&&this.set_condition(t,!0),this._filter_value_set=Promise.resolve(),["in","not in"].includes(t)&&Array.isArray(s)&&(s=s.join(",")),Array.isArray(s)?this._filter_value_set=this.field.set_value(s):(s!==void 0||s!==null)&&(this._filter_value_set=this.field.set_value((s+"").trim())),this._filter_value_set}set_field(r,e,t,s){let a={};if(this.field)for(let _ in this.field.df)a[_]=this.field.df[_];let l=(this.fieldselect.fields_by_name[r]||{})[e];if(!l)return console.warn(`Field ${e} is not selectable.`),this.remove(),!1;let n=copy_dict(l);n.read_only=0,n.hidden=0,n.is_filter=!0,delete n.hidden_due_to_dependency;let o=s||this.utils.get_default_condition(n);if(this.set_condition(o),this.utils.set_fieldtype(n,t,this.get_condition()),!(this.field&&a.fieldname==e&&n.fieldtype==a.fieldtype&&n.parent==a.parent&&n.options==a.options))if(this.fieldselect.selected_doctype=r,this.fieldselect.selected_fieldname=e,this.filters_config&&this.filters_config[s]&&this.filters_config[s].valid_for_fieldtypes.includes(n.fieldtype)){let _={};if(this.filters_config[s].depends_on){let d=this.filters_config[s].depends_on,c=this.filter_list.get_filter_value(e);_[d]=c}let p=d=>{n.fieldtype=d.fieldtype,n.options=d.options,n.fieldname=e,this.make_field(n,a.fieldtype)};if(this.filters_config[s].data){let d=this.filters_config[s].data;p(d)}else frappe.xcall(this.filters_config[s].get_field,_).then(d=>{this.filters_config[s].data=d,p(d)})}else this.make_field(n,a.fieldtype)}make_field(r,e){let t=this.field?this.field.get_value():null;this.hide_invalid_conditions(r.fieldtype,r.original_type),this.toggle_nested_set_conditions(r);let s=this.filter_edit_area.find(".filter-field").empty().get(0);r.input_class="input-xs";let a=frappe.ui.form.make_control({df:r,parent:s,only_input:!0});a.refresh(),this.field=a,t&&a.fieldtype===e&&this.field.set_value(t),this.bind_filter_field_events()}bind_filter_field_events(){this.field.$input.on("focusout",()=>this.on_change()),$(this.field.wrapper).find(":input").keydown(r=>{r.which==13&&this.field.df.fieldtype!=="MultiSelect"&&this.on_change()})}get_value(){return[this.fieldselect.selected_doctype,this.field.df.fieldname,this.get_condition(),this.get_selected_value(),this.hidden]}get_selected_value(){return this.utils.get_selected_value(this.field,this.get_condition())}get_selected_label(){return this.utils.get_selected_label(this.field)}get_condition(){return this.filter_edit_area.find(".condition").val()}set_condition(r,e=!1){let t=this.filter_edit_area.find(".condition");t.val(r),e&&t.change()}add_condition_help(r){let e=["in","not in"].includes(r)?__("values separated by commas"):__("use % as wildcard");this.filter_edit_area.find(".filter-description").html(e)}make_tag(){!this.field||(this.$filter_tag=this.get_filter_tag_element().insertAfter(this.parent.find(".active-tag-filters .clear-filters")),this.set_filter_button_text(),this.bind_tag())}bind_tag(){this.$filter_tag.find(".remove-filter").on("click",this.remove.bind(this));let r=this.$filter_tag.find(".toggle-filter");r.on("click",()=>{r.closest(".tag-filters-area").find(".filter-edit-area").show(),this.filter_edit_area.toggle()})}set_filter_button_text(){this.$filter_tag.find(".toggle-filter").html(this.get_filter_button_text())}get_filter_button_text(){let r=this.utils.get_formatted_value(this.field,this.get_selected_label()||this.get_selected_value());return`${__(this.field.df.label)} ${__(this.get_condition())} ${__(r)}`}get_filter_tag_element(){return $(`<div class="filter-tag btn-group">
			<button class="btn btn-default btn-xs toggle-filter"
				title="${__("Edit Filter")}">
			</button>
			<button class="btn btn-default btn-xs remove-filter"
				title="${__("Remove Filter")}">
				${frappe.utils.icon("close")}
			</button>
		</div>`)}hide_invalid_conditions(r,e){let t=this.invalid_condition_map[e]||this.invalid_condition_map[r]||[];for(let s of this.conditions)this.filter_edit_area.find(`.condition option[value="${s[0]}"]`).toggle(!t.includes(s[0]))}toggle_nested_set_conditions(r){let e=r.fieldtype==="Link"&&frappe.boot.nested_set_doctypes.includes(r.options);this.nested_set_conditions.forEach(t=>{this.filter_edit_area.find(`.condition option[value="${t[0]}"]`).toggle(e)})}};frappe.ui.filter_utils={get_formatted_value(r,e){return r.df.fieldname==="docstatus"?e={0:"Draft",1:"Submitted",2:"Cancelled"}[e]||e:r.df.original_type==="Check"&&(e={0:"No",1:"Yes"}[cint(e)]),frappe.format(e,r.df,{only_value:1})},get_selected_value(r,e){if(!r)return;let t=r.get_value()||r.value;return typeof t=="string"&&(t=strip(t)),e=="is"&&!t&&(t=r.df.options[0].value),r.df.original_type=="Check"&&(t=t=="Yes"?1:0),["like","not like"].includes(e)?t&&!(t.startsWith("%")||t.endsWith("%"))&&(t="%"+t+"%"):["in","not in"].includes(e)?t&&(t=t.split(",").map(s=>strip(s))):frappe.boot.additional_filters_config[e]&&(t=r.value||t),t==="%"&&(t=""),t},get_selected_label(r){if(["Link","Dynamic Link"].includes(r.df.fieldtype))return r.get_label_value()},get_default_condition(r){return r.fieldtype=="Data"?"like":r.fieldtype=="Date"||r.fieldtype=="Datetime"?"Between":"="},set_fieldtype(r,e,t){if(r.original_type?r.fieldtype=r.original_type:r.original_type=r.fieldtype,r.description="",r.reqd=0,r.ignore_link_validation=!0,e){r.fieldtype=e;return}r.fieldname=="docstatus"?(r.fieldtype="Select",r.options=[{value:0,label:__("Draft")},{value:1,label:__("Submitted")},{value:2,label:__("Cancelled")}]):r.fieldtype=="Check"?(r.fieldtype="Select",r.options=[{label:__("Yes",null,"Checkbox is checked"),value:"Yes"},{label:__("No",null,"Checkbox is not checked"),value:"No"}]):(["Text","Small Text","Text Editor","Code","Attach","Attach Image","Markdown Editor","HTML Editor","Tag","Phone","JSON","Comments","Barcode","Dynamic Link","Read Only","Assign","Color"].indexOf(r.fieldtype)!=-1||r.fieldtype=="Link"&&["=","!=","descendants of","descendants of (inclusive)","ancestors of","not descendants of","not ancestors of"].indexOf(t)==-1)&&(r.fieldtype="Data"),r.fieldtype==="Data"&&(r.options||"").toLowerCase()==="email"&&(r.options=null),t=="Between"&&(r.fieldtype=="Date"||r.fieldtype=="Datetime")&&(r.fieldtype="DateRange"),t=="Timespan"&&["Date","Datetime","DateRange","Select"].includes(r.fieldtype)&&(r.fieldtype="Select",r.options=this.get_timespan_options(["Last","Yesterday","Today","Tomorrow","This","Next"])),t==="is"&&(r.fieldtype="Select",r.options=[{label:__("Set",null,"Field value is set"),value:"set"},{label:__("Not Set",null,"Field value is not set"),value:"not set"}])},get_timespan_options(r){let e={Last:["Week","Month","Quarter","6 months","Year"],This:["Week","Month","Quarter","Year"],Next:["Week","Month","Quarter","6 months","Year"]},t=[];return r.forEach(s=>{e[s]?e[s].forEach(a=>{t.push({label:`${s} ${a}`,value:`${s.toLowerCase()} ${a.toLowerCase()}`})}):t.push({label:__(s),value:`${s.toLowerCase()}`})}),t}};frappe.ui.FilterGroup=class{constructor(r){$.extend(this,r),this.filters=[],window.fltr=this,this.filter_button?this.make_popover():(this.wrapper=this.parent,this.wrapper.append(this.get_filter_area_template()),this.set_filter_events())}make_popover(){this.init_filter_popover(),this.set_clear_all_filters_event(),this.set_popover_events()}set_clear_all_filters_event(){!this.filter_x_button||this.filter_x_button.on("click",()=>{this.toggle_empty_filters(!0),typeof this.base_list!="undefined"?this.base_list.filter_area.clear():this.clear_filters(),this.update_filter_button()})}hide_popover(){var r;(r=this.filter_button)==null||r.popover("hide")}init_filter_popover(){this.filter_button.popover({content:this.get_filter_area_template(),template:`
				<div class="filter-popover popover">
					<div class="arrow"></div>
					<div class="popover-body popover-content">
					</div>
				</div>
			`,html:!0,trigger:"manual",container:"body",placement:"bottom",offset:"-100px, 0"})}toggle_empty_filters(r){this.wrapper&&this.wrapper.find(".empty-filters").toggle(r)}set_popover_events(){$(document.body).on("click",r=>{if(this.wrapper&&this.wrapper.is(":visible")){let e=$(r.target).is(".datepicker--cell")||$(r.target).closest(".datepicker--nav-title").length!==0||$(r.target).parents(".datepicker--nav-action").length!==0;$(r.target).parents(".filter-popover").length===0&&$(r.target).parents(".filter-box").length===0&&this.filter_button.find($(r.target)).length===0&&!$(r.target).is(this.filter_button)&&!e&&this.wrapper&&this.hide_popover()}}),this.filter_button.on("click",()=>{this.filter_button.popover("toggle")}),this.filter_button.on("shown.bs.popover",()=>{let r=this.filters&&this.filters.length>0;this.wrapper||(this.wrapper=$(".filter-popover"),r&&(this.toggle_empty_filters(!1),this.add_filters_to_popover(this.filters)),this.set_filter_events()),this.toggle_empty_filters(!1),!r&&this.add_filter(this.doctype,"name")}),this.filter_button.on("hidden.bs.popover",()=>{this.apply()}),frappe.router.on("change",()=>{this.wrapper&&this.wrapper.is(":visible")&&this.hide_popover()})}add_filters_to_popover(r){r.forEach(e=>{e.parent=this.wrapper,e.field=null,e.make()})}apply(){this.update_filters(),this.on_change()}update_filter_button(){let r=this.filters.length>0,e=r?__("Filters <span class='filter-label'>{0}</span>",[this.filters.length]):__("Filter");this.filter_button.toggleClass("btn-default",!r).toggleClass("btn-primary-light",r),this.filter_button.find(".filter-icon").toggleClass("active",r),this.filter_button.find(".button-label").html(e),this.filter_button.attr("title",`${this.filters.length} Filter${this.filters.length>1?"s":""} Applied`)}set_filter_events(){this.wrapper.find(".add-filter").on("click",()=>{this.toggle_empty_filters(!1),this.add_filter(this.doctype,"name")}),this.wrapper.find(".clear-filters").on("click",()=>{this.toggle_empty_filters(!0),this.clear_filters(),this.on_change(),this.hide_popover()}),this.wrapper.find(".apply-filters").on("click",()=>this.hide_popover())}add_filters(r){let e=[];for(let t of r)e.push(()=>this.add_filter(...t));return frappe.run_serially(e).then(()=>this.update_filters())}add_filter(r,e,t,s,a){if(!e)return Promise.resolve();if(!this.validate_args(r,e))return!1;let l=arguments.length<2;if(l&&this.wrapper.find(".new-filter:visible").length)return Promise.resolve();{let n=[r,e,t,s,a],o=this.push_new_filter(n,l);return o&&o.then?o:Promise.resolve()}}validate_args(r,e){return r&&e&&!frappe.meta.has_field(r,e)&&frappe.model.is_non_std_field(e)?(frappe.msgprint({message:__("Invalid filter: {0}",[e.bold()]),indicator:"red"}),!1):!0}push_new_filter(r){if(this.filter_exists(r))return;let e=this._push_new_filter(...r);if(e&&e.value)return e._filter_value_set}_push_new_filter(r,e,t,s,a=!1){let l={parent:this.wrapper,parent_doctype:this.doctype,doctype:r,_parent_doctype:this.parent_doctype,fieldname:e,condition:t,value:s,hidden:a,index:this.filters.length+1,on_change:o=>{o&&this.update_filters(),this.on_change()},filter_items:(o,_)=>!this.filter_exists([o,_]),filter_list:this.base_list||this},n=new frappe.ui.Filter(l);return this.filters.push(n),n}get_filter_value(r){return(this.filters.find(t=>t.fieldname==r)||{}).value}filter_exists(r){return this.filters.filter(e=>e.field).some(e=>{let t=e.get_value();return r.length===2?r[0]===t[0]&&r[1]===t[1]:frappe.utils.arrays_equal(t.slice(0,4),r.slice(0,4))})}get_filters(){return this.filters.filter(r=>r.field).map(r=>r.get_value())}update_filters(){let r=e=>![void 0,null].includes(e.get_selected_value());this.filters.map(e=>!r(e)&&e.remove()),this.filters=this.filters.filter(e=>r(e)&&e.field),this.update_filter_button(),this.filters.length===0&&this.toggle_empty_filters(!0)}clear_filters(){this.filters.map(r=>r.remove(!0)),this.filters=[]}get_filter(r){return this.filters.filter(e=>e.field&&e.field.df.fieldname==r)[0]}get_filter_area_template(){return $(`
			<div class="filter-area">
				<div class="filter-edit-area">
					<div class="text-muted empty-filters text-center">
						${__("No filters selected")}
					</div>
				</div>
				<hr class="divider"></hr>
				<div class="filter-action-buttons mt-2">
					<button class="text-muted add-filter btn btn-xs">
						+ ${__("Add a Filter")}
					</button>
					<div>
						<button class="btn btn-secondary btn-xs clear-filters">
							${__("Clear Filters")}
						</button>
						${this.filter_button?`<button class="btn btn-primary btn-xs apply-filters">
								${__("Apply Filters")}
							</button>`:""}
					</div>
				</div>
			</div>`)}get_filters_as_object(){return this.get_filters().reduce((r,e)=>Object.assign(r,{[e[1]]:[e[2],e[3]]}),{})}add_filters_to_filter_group(r){r&&r.length&&(this.toggle_empty_filters(!1),r.forEach(e=>{this.add_filter(e[0],e[1],e[2],e[3])}))}add(r,e=!0){if(!r||Array.isArray(r)&&r.length===0)return Promise.resolve();typeof r[0]=="string"&&(r=[Array.from(arguments)]),r=r.filter(a=>!this.exists(a));let{non_standard_filters:t,promise:s}=this.set_standard_filter(r);return s.then(()=>t.length>0&&this.filter_list.add_filters(t)).then(()=>{e&&this.list_view.refresh()})}};frappe.ui.FieldSelect=class{constructor(e){var t=this;if($.extend(this,e),this.fields_by_name={},this.options=[],this.$input=$('<input class="form-control">').appendTo(this.parent).on("click",function(){$(this).select()}),this.input_class&&this.$input.addClass(this.input_class),this.select_input=this.$input.get(0),this.awesomplete=new Awesomplete(this.select_input,{minChars:0,maxItems:99,autoFirst:!0,list:t.options,item(a){return $(repl('<li class="filter-field-select"><p>%(label)s</p></li>',a)).data("item.autocomplete",a).get(0)}}),this.$input.on("awesomplete-select",function(a){var l=a.originalEvent,n=l.text.value,o=t.awesomplete.get_item(n);t.selected_doctype=o.doctype,t.selected_fieldname=o.fieldname,t.select&&t.select(o.doctype,o.fieldname)}),this.$input.on("awesomplete-selectcomplete",function(a){var l=a.originalEvent,n=l.text.value,o=t.awesomplete.get_item(n);t.$input.val(o.label)}),this.filter_fields)for(var s in this.filter_fields)this.add_field_option(this.filter_fields[s]);else this.build_options();this.set_value(this.doctype,"name")}get_value(){return this.selected_doctype?this.selected_doctype+"."+this.selected_fieldname:null}val(e){if(e===void 0)return this.get_value();this.set_value(e)}clear(){this.selected_doctype=null,this.selected_fieldname=null,this.$input.val("")}set_value(e,t){var s=this;if(this.clear(),!!e){if(e.indexOf(".")!==-1){var a=e.split(".");e=a[0],t=a[1]}$.each(this.options,function(l,n){if(n.doctype===e&&n.fieldname===t)return s.selected_doctype=e,s.selected_fieldname=t,s.$input.val(n.label),!1})}}build_options(){var e=this;e.table_fields=[];var t=$.map(frappe.model.std_fields,function(l){var n={parent:e.doctype};return l.fieldname=="name"&&(n.options=e.doctype),$.extend(copy_dict(l),n)}),s=locals.DocType[e.doctype];s&&cint(s.istable)&&(t=t.concat([{fieldname:"parent",fieldtype:"Data",label:"Parent",parent:e.doctype}])),this.with_blank&&this.options.push({label:"",value:""});var a=t.concat(frappe.meta.docfield_list[e.doctype]);$.each(frappe.utils.sort(a,"label","string"),function(l,n){let o=frappe.get_meta(e.doctype).istable&&e.parent_doctype?e.parent_doctype:e.doctype;frappe.perm.has_perm(o,n.permlevel,"read")&&e.add_field_option(n)}),$.each(e.table_fields,function(l,n){if(n.options){let o=[].concat(frappe.meta.docfield_list[n.options]);if(n.fieldtype==="Table MultiSelect"){let _=frappe.meta.get_docfields(n.options).find(p=>p.fieldtype==="Link");o=_?[_]:[]}$.each(frappe.utils.sort(o,"label","string"),function(_,p){let d=frappe.get_meta(e.doctype).istable&&e.parent_doctype?e.parent_doctype:e.doctype;frappe.perm.has_perm(d,p.permlevel,"read")&&e.add_field_option(p)})}})}add_field_option(e){let t=this;if(e.fieldname=="docstatus"&&!frappe.model.is_submittable(t.doctype))return;if(frappe.model.table_fields.includes(e.fieldtype)){t.table_fields.push(e);return}let s=null,a=null;t.doctype&&e.parent==t.doctype?(s=__(e.label),a=t.doctype):(s=__(e.label)+" ("+__(e.parent)+")",a=e.parent),frappe.model.no_value_type.indexOf(e.fieldtype)==-1&&!(t.fields_by_name[e.parent]&&t.fields_by_name[e.parent][e.fieldname])&&(this.options.push({label:s,value:a+"."+e.fieldname,fieldname:e.fieldname,doctype:e.parent}),t.fields_by_name[e.parent]||(t.fields_by_name[e.parent]={}),t.fields_by_name[e.parent][e.fieldname]=e)}};frappe.templates.edit_filter=`<div class="filter-box">
	<div class="visible-xs flex justify-flex-end">
		<span class="remove-filter">
			{{ __("Remove") }}
		</span>
	</div>
	<div class="list_filter row">
		<div class="fieldname-select-area col-sm-4 ui-front form-group"></div>
		<div class="col-sm-3 form-group">
			<select class="condition form-control input-xs">
				{% for condition in conditions %}
				<option value="{{condition[0]}}">{{ condition[1] }}</option>
				{% endfor %}
			</select>
		</div>
		<div class="col-sm-4 form-group">
			<div class="filter-field"></div>
			<div class="text-muted small filter-description"></div>
		</div>
		<div class="remove-filter col-sm-1 text-center hidden-xs">
			<svg class="icon icon-sm">
				<use href="#icon-close" class="close"></use>
			</svg>
		</div>
	</div>
</div>
`;frappe.ui.Tags=class{constructor({parent:r,placeholder:e,tagsList:t,onTagAdd:s,onTagRemove:a,onTagClick:l,onChange:n}){this.tagsList=t||[],this.onTagAdd=s,this.onTagRemove=a,this.onTagClick=l,this.onChange=n,this.setup(r,e)}setup(r,e){this.$ul=r,this.$input=$('<input class="tags-input form-control"></input>'),this.$inputWrapper=this.get_list_element(this.$input),this.$placeholder=$(`<button class="add-tags-btn text-muted btn btn-link icon-btn" id="add_tags">
				${__(e)}
			</button>`),this.$placeholder.appendTo(this.$ul.find(".form-sidebar-items")),this.$inputWrapper.appendTo(this.$ul),this.deactivate(),this.bind(),this.boot()}bind(){let r=this,e=function(){let t=frappe.utils.xss_sanitise(r.$input.val());r.addTag(t),r.$input.val("")};this.$input.keypress(t=>{(t.which==13||t.keyCode==13)&&e()}),this.$input.focusout(e),this.$input.on("blur",()=>{this.deactivate()}),this.$placeholder.on("click",()=>{this.activate(),this.$input.focus()})}boot(){this.addTags(this.tagsList)}activate(){this.$placeholder.hide(),this.$inputWrapper.show()}deactivate(){this.$inputWrapper.hide(),this.$placeholder.show()}addTag(r){if(r&&r!==""&&!this.tagsList.includes(r)){let e=this.get_tag(r);this.get_list_element(e,"form-tag-row").insertAfter(this.$inputWrapper),this.tagsList.push(r),this.onTagAdd&&this.onTagAdd(r)}}removeTag(r){r=frappe.utils.xss_sanitise(r),this.tagsList.includes(r)&&(this.tagsList.splice(this.tagsList.indexOf(r),1),this.onTagRemove&&this.onTagRemove(r))}addTags(r){r.map(this.addTag.bind(this))}clearTags(){this.$ul.find(".form-tag-row").remove(),this.tagsList=[]}get_list_element(r,e=""){let t=$(`<li class="${e}"></li>`);return r.appendTo(t),t}get_tag(r){let e=frappe.get_data_pill(r,r,(t,s)=>{this.removeTag(t),s.closest(".form-tag-row").remove()});return this.onTagClick&&e.on("click",".pill-label",()=>{this.onTagClick(r)}),e}};frappe.ui.TagEditor=class{constructor(e){$.extend(this,e),this.setup_tags(),this.user_tags||(this.user_tags=""),this.initialized=!0,this.refresh(this.user_tags)}setup_tags(){var e=this;!this.parent||(this.wrapper=this.parent,this.wrapper.length&&(this.tags=new frappe.ui.Tags({parent:this.wrapper,placeholder:'<svg class="es-icon icon-sm"><use href="#es-line-add"></use></svg>',onTagAdd:t=>{if(e.initialized&&!e.refreshing)return frappe.call({method:"frappe.desk.doctype.tag.tag.add_tag",args:e.get_args(t),callback:function(s){var a=e.user_tags?e.user_tags.split(","):[];a.push(t),e.user_tags=a.join(","),e.on_change&&e.on_change(e.user_tags),frappe.tags.utils.fetch_tags()}})},onTagRemove:t=>{if(!e.refreshing)return frappe.call({method:"frappe.desk.doctype.tag.tag.remove_tag",args:e.get_args(t),callback:function(s){var a=e.user_tags.split(",");a.splice(a.indexOf(t),1),e.user_tags=a.join(","),e.on_change&&e.on_change(e.user_tags),frappe.tags.utils.fetch_tags()}})}}),this.setup_awesomplete(),this.setup_complete=!0))}setup_awesomplete(){var e=this,t=this.wrapper.find("input.tags-input"),s=t.get(0);this.awesomplete=new Awesomplete(s,{minChars:0,maxItems:99,list:[]}),t.on("awesomplete-open",function(a){t.attr("state","open")}),t.on("awesomplete-close",function(a){t.attr("state","closed")}),t.on("input",function(a){var l=a.target.value;frappe.call({method:"frappe.desk.doctype.tag.tag.get_tags",args:{doctype:e.frm.doctype,txt:l.toLowerCase()},callback:function(n){e.awesomplete.list=n.message}})}),t.on("focus",function(a){t.attr("state")!="open"&&t.trigger("input")})}get_args(e){return{tag:e,dt:this.frm.doctype,dn:this.frm.docname}}refresh(e){var t=this;if(!(!this.initialized||!this.setup_complete||this.refreshing)){t.refreshing=!0;try{t.tags.clearTags(),e&&(t.user_tags=e,t.tags.addTags(e.split(",")))}catch(s){t.refreshing=!1,setTimeout(function(){t.refresh()},100)}t.refreshing=!1}}};frappe.ui.is_liked=function(r){var e=frappe.ui.get_liked_by(r);return e.indexOf(frappe.session.user)!==-1};frappe.ui.get_liked_by=function(r){var e=r._liked_by;return e&&(e=JSON.parse(e)),e||[]};frappe.ui.toggle_like=function(r,e,t,s){var a=r.hasClass("not-liked")?"Yes":"No";r.css("pointer-events","none"),frappe.call({method:"frappe.desk.like.toggle_like",quiet:!0,args:{doctype:e,name:t,add:a},callback:function(l){if(r.css("pointer-events","auto"),!l.exc){for(let p of document.querySelectorAll(".like-action"))p.dataset.name===t&&p.dataset.doctype===e&&(p.classList.toggle("not-liked",a==="No"),p.classList.toggle("liked",a==="Yes"));var n=locals[e]&&locals[e][t];if(n){var o=JSON.parse(n._liked_by||"[]"),_=o.indexOf(frappe.session.user);a==="Yes"?_===-1&&o.push(frappe.session.user):_!==-1&&(o=o.slice(0,_).concat(o.slice(_+1))),n._liked_by=JSON.stringify(o)}s&&s()}}})};frappe.ui.click_toggle_like=function(){var r=$(this),e=r.siblings(".likes-count"),t=r.hasClass("not-liked"),s=r.attr("data-doctype"),a=r.attr("data-name");return frappe.ui.toggle_like(r,s,a,function(){t?e.text(cint(e.text())+1):e.text(cint(e.text())-1)}),!1};frappe.ui.setup_like_popover=(r,e)=>{frappe.dom.is_touchscreen()||r.on("mouseover",e,function(){let t=$(this);t.popover({animation:!0,placement:"bottom",trigger:"manual",template:`<div class="liked-by-popover popover">
				<div class="arrow"></div>
				<div class="popover-body popover-content"></div>
			</div>`,content:()=>{let s=t.parents(".liked-by").attr("data-liked-by");if(s=s?decodeURI(s):"[]",s=JSON.parse(s),!s.length)return"";let a=$('<ul class="list-unstyled"></ul>'),l="/app/user-profile/";return s.forEach(n=>{a.append(`
						<li data-user=${n}>${frappe.avatar(n,"avatar-xs")}
							<span>${frappe.user.full_name(n)}</span>
						</li>
					`)}),a.children("li").click(n=>{let o=n.currentTarget.dataset.user;t.popover("hide"),frappe.set_route(l+o)}),a},html:!0,container:"body"}),t.popover("show"),$(".popover").on("mouseleave",()=>{t.popover("hide")}),t.on("mouseout",()=>{setTimeout(()=>{$(".popover:hover").length||t.popover("hide")},100)})})};frappe.templates.print_template=`<!DOCTYPE html>
<html lang="{{ lang }}" dir="{{ layout_direction }}">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>{{ title }}</title>
	<link href="{{ base_url }}{{ frappe.assets.bundled_asset('print.bundle.css', frappe.utils.is_rtl(lang)) }}" rel="stylesheet">
	<style>
		{{ print_css }}
	</style>
</head>
<body>
	<div class="print-format-gutter">
		{% if print_settings.repeat_header_footer %}
			<div id="footer-html" class="visible-pdf">
				{% if print_settings.letter_head && print_settings.letter_head.footer %}
					<div class="letter-head-footer">
						{{ print_settings.letter_head.footer }}
					</div>
				{% endif %}
				<p class="text-center small page-number visible-pdf">
					{{ __("Page {0} of {1}", [\`<span class="page"></span>\`, \`<span class="topage"></span>\`]) }}
				</p>
			</div>
		{% endif %}

		<div class="print-format {% if landscape %}landscape{% endif %}"
				{% if columns.length > 20 %}
					{% if can_use_smaller_font %}
						style="font-size: 4.0pt"
					{% endif %}
				{% endif %}
			>
			{% if print_settings.letter_head %}
			<div {% if print_settings.repeat_header_footer %} id="header-html" class="hidden-pdf" {% endif %}>
				<div class="letter-head">{{ print_settings.letter_head.header }}</div>
			</div>
			{% endif %}
			{{ content }}
		</div>
	</div>
</body>
</html>
`;frappe.provide("frappe.views");frappe.views.BaseList=class{constructor(e){Object.assign(this,e)}show(){return frappe.run_serially([()=>this.show_skeleton(),()=>this.fetch_meta(),()=>this.hide_skeleton(),()=>this.check_permissions(),()=>this.init(),()=>this.before_refresh(),()=>this.refresh()])}init(){if(this.init_promise)return this.init_promise;let e=[this.setup_defaults,this.set_stats,this.setup_fields,this.setup_page,this.setup_side_bar,this.setup_main_section,this.setup_view,this.setup_view_menu].map(t=>t.bind(this));return this.init_promise=frappe.run_serially(e),this.init_promise}setup_defaults(){this.page_name=frappe.get_route_str(),this.page_title=this.page_title||frappe.router.doctype_layout||__(this.doctype),this.meta=frappe.get_meta(this.doctype),this.settings=frappe.listview_settings[this.doctype]||{},this.user_settings=frappe.get_user_settings(this.doctype),this.start=0,this.page_length=frappe.is_large_screen()?100:20,this.data=[],this.method="frappe.desk.reportview.get",this.can_create=frappe.model.can_create(this.doctype),this.can_write=frappe.model.can_write(this.doctype),this.fields=[],this.filters=[],this.sort_by=this.meta.sort_field||"modified",this.sort_order=this.meta.sort_order||"desc",this.primary_action=null,this.secondary_action=null,this.menu_items=[{label:__("Refresh"),action:()=>this.refresh(),class:"visible-xs"}]}get_list_view_settings(){return frappe.call("frappe.desk.listview.get_list_settings",{doctype:this.doctype}).then(e=>this.list_view_settings=e.message||{})}async setup_fields(){await this.set_fields(),this.build_fields()}async set_fields(){[].concat(frappe.model.std_fields_list,this.meta.title_field).forEach(t=>this._add_field(t))}get_fields_in_list_view(){return this.meta.fields.filter(e=>frappe.model.is_value_type(e.fieldtype)&&e.in_list_view&&frappe.perm.has_perm(this.doctype,e.permlevel,"read")||e.fieldtype==="Currency"&&e.options&&!e.options.includes(":")||e.fieldname==="status")}build_fields(){this.fields=this.fields.map(e=>(typeof e=="string"&&(e=[e,this.doctype]),e)),this.fields=this.fields.filter(Boolean),this.fields=this.fields.uniqBy(e=>e[0]+e[1])}_add_field(e,t){if(!e)return;if(t||(t=this.doctype),typeof e=="object"){let a=e;e=a.fieldname,t=a.parent||t}this.fields||(this.fields=[]),(frappe.model.std_fields_list.includes(e)||frappe.meta.has_field(t,e)||e==="_seen")&&this.fields.push([e,t])}set_stats(){this.stats=["_user_tags"],this.workflow_state_fieldname=frappe.workflow.get_state_fieldname(this.doctype),this.workflow_state_fieldname&&(frappe.workflow.workflows[this.doctype].override_status||this._add_field(this.workflow_state_fieldname),this.stats.push(this.workflow_state_fieldname))}fetch_meta(){return frappe.model.with_doctype(this.doctype)}show_skeleton(){}hide_skeleton(){}check_permissions(){return!0}setup_page(){this.page=this.parent.page,this.$page=$(this.parent),!this.hide_card_layout&&this.page.main.addClass("frappe-card"),this.page.page_form.removeClass("row").addClass("flex"),this.hide_page_form&&this.page.page_form.hide(),this.hide_sidebar&&this.$page.addClass("no-list-sidebar"),this.setup_page_head()}setup_page_head(){this.set_title(),this.set_menu_items(),this.set_breadcrumbs()}set_title(){this.page.set_title(this.page_title)}setup_view_menu(){let e={Image:"image-view",List:"list",Report:"small-file",Calendar:"calendar",Gantt:"gantt",Kanban:"kanban",Dashboard:"dashboard",Map:"map"};if(frappe.boot.desk_settings.view_switcher&&!this.meta.force_re_route_to_default_view){this.views_menu=this.page.add_custom_button_group(__("{0} View",[this.view_name]),e[this.view_name]||"list"),this.views_list=new frappe.views.ListViewSelect({doctype:this.doctype,parent:this.views_menu,page:this.page,list_view:this,sidebar:this.list_sidebar,icon_map:e})}}set_default_secondary_action(){if(this.secondary_action){let e=this.page.set_secondary_action(this.secondary_action.label,this.secondary_action.action,this.secondary_action.icon);this.secondary_action.icon?this.secondary_action.label||e.addClass("visible-xs"):e.addClass("hidden-xs")}else this.refresh_button=this.page.add_action_icon("es-line-reload",()=>{this.refresh()},"",__("Reload List"))}set_menu_items(){this.set_default_secondary_action(),this.menu_items&&this.menu_items.map(e=>{if(e.condition&&e.condition()===!1)return;let t=this.page.add_menu_item(e.label,e.action,e.standard,e.shortcut);e.class&&t&&t.addClass(e.class)})}set_breadcrumbs(){frappe.breadcrumbs.add(this.meta.module,this.doctype)}setup_side_bar(){this.hide_sidebar||!frappe.boot.desk_settings.list_sidebar||(this.list_sidebar=new frappe.views.ListSidebar({doctype:this.doctype,stats:this.stats,parent:this.$page.find(".layout-side-section"),page:this.page,list_view:this}))}toggle_side_bar(e){let t=e||JSON.parse(localStorage.show_sidebar||"true");t=!t,localStorage.show_sidebar=t,this.show_or_hide_sidebar(),$(document.body).trigger("toggleListSidebar")}show_or_hide_sidebar(){let e=JSON.parse(localStorage.show_sidebar||"true");$(document.body).toggleClass("no-list-sidebar",!e)}setup_main_section(){return frappe.run_serially([this.setup_list_wrapper,this.show_or_hide_sidebar,this.setup_filter_area,this.setup_sort_selector,this.setup_result_area,this.setup_no_result_area,this.setup_freeze_area,this.setup_paging_area].map(e=>e.bind(this)))}setup_list_wrapper(){this.$frappe_list=$('<div class="frappe-list">').appendTo(this.page.main)}setup_filter_area(){if(!this.hide_filters&&(this.filter_area=new T(this),this.filters&&this.filters.length>0))return this.filter_area.set(this.filters).catch(()=>{this.filter_area.clear(!1)})}setup_sort_selector(){this.hide_sort_selector||(this.sort_selector=new frappe.ui.SortSelector({parent:this.$filter_section,doctype:this.doctype,args:{sort_by:this.sort_by,sort_order:this.sort_order},onchange:this.on_sort_change.bind(this)}))}on_sort_change(){this.refresh()}setup_result_area(){this.$result=$('<div class="result">'),this.$frappe_list.append(this.$result)}setup_no_result_area(){this.$no_result=$(`
			<div class="no-result text-muted flex justify-center align-center">
				${this.get_no_result_message()}
			</div>
		`).hide(),this.$frappe_list.append(this.$no_result)}setup_freeze_area(){this.$freeze=$('<div class="freeze"></div>').hide(),this.$frappe_list.append(this.$freeze)}get_no_result_message(){return __("Nothing to show")}setup_paging_area(){let e=[20,100,500];this.$paging_area=$(`<div class="list-paging-area level">
				<div class="level-left">
					<div class="btn-group">
						${e.map(t=>`
							<button type="button" class="btn btn-default btn-sm btn-paging"
								data-value="${t}">
								${t}
							</button>
						`).join("")}
					</div>
				</div>
				<div class="level-right">
					<button class="btn btn-default btn-more btn-sm">
						${__("Load More")}
					</button>
				</div>
			</div>`).hide(),this.$frappe_list.append(this.$paging_area),this.$paging_area.find(`.btn-paging[data-value="${this.page_length}"]`).addClass("btn-info"),this.$paging_area.on("click",".btn-paging, .btn-more",t=>{let s=$(t.currentTarget);s.is(".btn-paging")?(this.$paging_area.find(".btn-paging").removeClass("btn-info"),s.addClass("btn-info"),this.start=0,this.page_length=this.selected_page_count=s.data().value):s.is(".btn-more")&&(this.start=this.start+this.page_length,this.page_length=this.selected_page_count||20),this.refresh()})}get_fields(){return this.fields.map(e=>frappe.model.get_full_column_name(e[0],e[1]))}get_group_by(){let e=this.fields&&this.fields.find(t=>t[0]=="name");return e?frappe.model.get_full_column_name(e[0],e[1]):null}setup_view(){}get_filter_value(e){var s;let t=this.get_filters_for_args().filter(a=>a[1]==e)[0];if(!!t)return{like:(s=t[3])==null?void 0:s.replace(/^%?|%$/g,""),"not set":null}[t[2]]||t[3]}get_filters_for_args(){return this.filter_area?this.filter_area.get().map(e=>e.slice(0,4)):[]}get_args(){return{doctype:this.doctype,fields:this.get_fields(),filters:this.get_filters_for_args(),order_by:this.sort_selector&&this.sort_selector.get_sql_string(),start:this.start,page_length:this.page_length,view:this.view,group_by:this.get_group_by()}}get_call_args(){let e=this.get_args();return{method:this.method,args:e,freeze:this.freeze_on_refresh||!1,freeze_message:this.freeze_message||__("Loading")+"..."}}before_refresh(){}refresh(){let e=this.get_call_args();return this.no_change(e)?Promise.resolve():(this.freeze(!0),frappe.call(e).then(t=>{this.prepare_data(t),this.toggle_result_area(),this.before_render(),this.render(),this.after_render(),this.freeze(!1),this.reset_defaults(),this.settings.refresh&&this.settings.refresh(this)}))}no_change(e){return this.last_args&&JSON.stringify(e)===this.last_args?!0:(this.last_args=JSON.stringify(e),setTimeout(()=>{this.last_args=null},3e3),!1)}prepare_data(e){let t=e.message||{};Object.assign(frappe.boot.user_info,t.user_info),delete t.user_info,t=Array.isArray(t)?t:frappe.utils.dict(t.keys,t.values),this.start===0?this.data=t:this.data=this.data.concat(t),this.data=this.data.uniqBy(s=>s.name)}reset_defaults(){this.page_length=this.page_length+this.start,this.start=0}freeze(){}before_render(){}after_render(){}render(){}on_filter_change(){}toggle_result_area(){this.$result.toggle(this.data.length>0),this.$paging_area.toggle(this.data.length>0),this.$no_result.toggle(this.data.length==0);let e=this.start+this.page_length<=this.data.length;this.$paging_area.find(".btn-more").toggle(e)}call_for_selected_items(e,t={}){t.names=this.get_checked_items(!0),frappe.call({method:e,args:t,freeze:!0,callback:s=>{s.exc||this.refresh()}})}};var T=class{constructor(e){this.list_view=e,this.list_view.page.page_form.append('<div class="standard-filter-section flex"></div>');let t=this.list_view.hide_page_form?this.list_view.page.custom_actions:this.list_view.page.page_form;this.list_view.$filter_section=$('<div class="filter-section flex">').appendTo(t),this.$filter_list_wrapper=this.list_view.$filter_section,this.trigger_refresh=!0,this.setup()}setup(){this.list_view.hide_page_form||this.make_standard_filters(),this.make_filter_list()}get(){let e=this.filter_list.get_filters(),t=this.get_standard_filters();return e.concat(t).uniqBy(JSON.stringify)}set(e){return this.trigger_refresh=!1,this.add(e,!1).then(()=>{this.trigger_refresh=!0,this.filter_list.update_filter_button()})}add(e,t=!0){if(!e||Array.isArray(e)&&e.length===0)return Promise.resolve();typeof e[0]=="string"&&(e=[Array.from(arguments)]),e=e.filter(l=>!this.exists(l));let{non_standard_filters:s,promise:a}=this.set_standard_filter(e);return a.then(()=>s.length>0&&this.filter_list.add_filters(s)).then(()=>{t&&this.list_view.refresh()})}refresh_list_view(){this.trigger_refresh&&(this.list_view.start=0,this.list_view.refresh(),this.list_view.on_filter_change())}exists(e){let t=!1,s=this.list_view.page.fields_dict;return e[2]==="="&&e[1]in s&&s[e[1]].get_value()&&(t=!0),t||(t=this.filter_list.filter_exists(e)),t}set_standard_filter(e){if(e.length===0)return{non_standard_filters:[],promise:Promise.resolve()};let t=this.list_view.page.fields_dict;return e.reduce((s,a)=>{var p,d,c,h;let[l,n,o,_]=a;return s.promise=s.promise||Promise.resolve(),s.non_standard_filters=s.non_standard_filters||[],t[n]&&(o==="="||o==="like"&&((d=(p=t[n])==null?void 0:p.df)==null?void 0:d.fieldtype)!="Link"||o==="descendants of (inclusive)"&&((h=(c=t[n])==null?void 0:c.df)==null?void 0:h.fieldtype)=="Link")?s.promise=s.promise.then(()=>t[n].set_value(_)):s.non_standard_filters.push(a),s},{})}remove_filters(e){e.map(t=>{this.remove(t[1])})}remove(e){let t=this.list_view.page.fields_dict;e in t&&t[e].set_value("");let s=this.filter_list.get_filter(e);return s&&s.remove(),this.filter_list.apply(),Promise.resolve()}clear(e=!0){e||(this.trigger_refresh=!1),this.filter_list.clear_filters();let t=[],s=this.list_view.page.fields_dict;for(let a in s){let l=this.list_view.page.fields_dict[a];t.push(()=>l.set_value(""))}return frappe.run_serially(t).then(()=>{this.trigger_refresh=!0})}make_standard_filters(){this.standard_filters_wrapper=this.list_view.page.page_form.find(".standard-filter-section");let e=[];this.list_view.settings.hide_name_filter||e.push({fieldtype:"Data",label:"ID",condition:"like",fieldname:"name",onchange:()=>this.refresh_list_view()}),this.list_view.custom_filter_configs&&(this.list_view.custom_filter_configs.forEach(a=>{a.onchange=()=>this.refresh_list_view()}),e=e.concat(this.list_view.custom_filter_configs));let t=this.list_view.meta.fields,s=this.list_view.meta.title_field;e=e.concat(t.filter(a=>a.fieldname===s||a.in_standard_filter&&frappe.model.is_value_type(a.fieldtype)).map(a=>{let l=a.options,n="=",o=a.fieldtype;return["Text","Small Text","Text Editor","HTML Editor","Data","Code","Phone","JSON","Read Only"].includes(o)&&(o="Data",n="like"),a.fieldtype=="Select"&&a.options&&(l=a.options.split(`
`),l.length>0&&l[0]!=""&&(l.unshift(""),l=l.join(`
`))),a.fieldtype=="Link"&&a.options&&frappe.boot.treeviews.includes(a.options)&&(n="descendants of (inclusive)"),{fieldtype:o,label:__(a.label),options:l,fieldname:a.fieldname,condition:n,onchange:()=>this.refresh_list_view(),ignore_link_validation:o==="Dynamic Link",is_filter:1}})),e.map(a=>{this.list_view.page.add_field(a,this.standard_filters_wrapper)})}get_standard_filters(){let e=[],t=this.list_view.page.fields_dict;for(let s in t){let a=t[s],l=a.get_value();l&&(a.df.condition==="like"&&!l.includes("%")&&(l="%"+l+"%"),e.push([a.df.doctype||this.list_view.doctype,a.df.fieldname,a.df.condition||"=",l]))}return e}make_filter_list(){$(`<div class="filter-selector">
			<div class="btn-group">
				<button class="btn btn-default btn-sm filter-button">
					<span class="filter-icon">
						${frappe.utils.icon("es-line-filter")}
					</span>
					<span class="button-label hidden-xs">
					${__("Filter")}
					<span>
				</button>
				<button class="btn btn-default btn-sm filter-x-button" title="${__("Clear all filters")}">
					<span class="filter-icon">
						${frappe.utils.icon("es-small-close")}
					</span>
				</button>
			</div>
		</div>`).appendTo(this.$filter_list_wrapper),this.filter_button=this.$filter_list_wrapper.find(".filter-button"),this.filter_x_button=this.$filter_list_wrapper.find(".filter-x-button"),this.filter_list=new frappe.ui.FilterGroup({base_list:this.list_view,parent:this.$filter_list_wrapper,doctype:this.list_view.doctype,filter_button:this.filter_button,filter_x_button:this.filter_x_button,default_filters:[],on_change:()=>this.refresh_list_view()})}is_being_edited(){return this.filter_list&&this.filter_list.wrapper&&this.filter_list.wrapper.find(".filter-box:visible").length>0}};frappe.views.view_modes=["List","Report","Dashboard","Gantt","Kanban","Calendar","Image","Inbox","Tree","Map"];frappe.views.is_valid=r=>frappe.views.view_modes.includes(r);var y=class{constructor({doctype:e}){e||frappe.throw(__("Doctype required")),this.doctype=e}print(e){let t=frappe.model.get_doc(":Print Settings","Print Settings"),s=cint(t.allow_print_for_draft),a=frappe.model.is_submittable(this.doctype),l=cint(t.allow_print_for_cancelled),n=this.get_letterhead_options(),o=e.filter(d=>!a||d.docstatus===1||l&&d.docstatus==2||s&&d.docstatus==0||frappe.user.has_role("Administrator")).map(d=>d.name);if(e.filter(d=>!o.includes(d.name)).length>0){frappe.msgprint(__("You selected Draft or Cancelled documents"));return}if(o.length===0){frappe.msgprint(__("Select atleast 1 record for printing"));return}let p=new frappe.ui.Dialog({title:__("Print Documents"),fields:[{fieldtype:"Select",label:__("Letter Head"),fieldname:"letter_sel",options:n,default:n[0]},{fieldtype:"Select",label:__("Print Format"),fieldname:"print_sel",options:frappe.meta.get_print_formats(this.doctype),default:frappe.get_meta(this.doctype).default_print_format},{fieldtype:"Select",label:__("Page Size"),fieldname:"page_size",options:frappe.meta.get_print_sizes(),default:t.pdf_page_size},{fieldtype:"Float",label:__("Page Height (in mm)"),fieldname:"page_height",depends_on:'eval:doc.page_size == "Custom"',default:t.pdf_page_height},{fieldtype:"Float",label:__("Page Width (in mm)"),fieldname:"page_width",depends_on:'eval:doc.page_size == "Custom"',default:t.pdf_page_width}]});p.set_primary_action(__("Print"),d=>{if(!d)return;let c=frappe.get_meta(this.doctype).default_print_format,h=d.letter_sel==__("No Letterhead")?0:1,b=d.print_sel?d.print_sel:c,u=JSON.stringify(o),w=d.letter_sel,f;if(d.page_size==="Custom"?((d.page_height===0||d.page_width===0)&&frappe.throw(__("Page height and width cannot be zero")),f=JSON.stringify({"page-height":d.page_height,"page-width":d.page_width})):f=JSON.stringify({"page-size":d.page_size}),!window.open("/api/method/frappe.utils.print_format.download_multi_pdf?doctype="+encodeURIComponent(this.doctype)+"&name="+encodeURIComponent(u)+"&format="+encodeURIComponent(b)+"&no_letterhead="+(h?"0":"1")+"&letterhead="+encodeURIComponent(w)+"&options="+encodeURIComponent(f))){frappe.msgprint(__("Please enable pop-ups"));return}}),p.show()}get_letterhead_options(){let e=[__("No Letterhead")];return frappe.call({method:"frappe.client.get_list",args:{doctype:"Letter Head",fields:["name","is_default"],filters:{disabled:0},limit_page_length:0},async:!1,callback(t){t.message&&t.message.forEach(s=>{s.is_default?e.unshift(s.name):e.push(s.name)})}}),e}delete(e,t=null){frappe.call({method:"frappe.desk.reportview.delete_items",freeze:!0,freeze_message:e.length<=10?__("Deleting {0} records...",[e.length]):null,args:{items:e,doctype:this.doctype}}).then(s=>{let a=s.message;a||(a=[]),a.length&&!s._server_messages&&frappe.throw(__("Cannot delete {0}",[a.map(l=>l.bold()).join(", ")])),a.length<e.length&&(frappe.utils.play_sound("delete"),t&&t())})}assign(e,t){if(e.length>0){let s=new frappe.ui.form.AssignToDialog({obj:this,method:"frappe.desk.form.assign_to.add_multiple",doctype:this.doctype,docname:e,bulk_assign:!0,re_assign:!0,callback:t});s.dialog.clear(),s.dialog.show()}else frappe.msgprint(__("Select records for assignment"))}apply_assignment_rule(e,t){e.length>0&&frappe.call("frappe.automation.doctype.assignment_rule.assignment_rule.bulk_apply",{doctype:this.doctype,docnames:e}).then(()=>t())}submit_or_cancel(e,t="submit",s=null){t=t.toLowerCase(),frappe.call({method:"frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs",args:{doctype:this.doctype,action:t,docnames:e}}).then(a=>{let l=a.message;l||(l=[]),l.length&&!a._server_messages&&frappe.throw(__("Cannot {0} {1}",[t,l.map(n=>n.bold()).join(", ")])),l.length<e.length&&(frappe.utils.play_sound(t),s&&s())})}edit(e,t,s){let a=Object.keys(t).sort(function(d,c){return __(cstr(t[d].label)).localeCompare(cstr(__(t[c].label)))}),l=/status/i,n=a.find(d=>l.test(d)),o=new frappe.ui.Dialog({title:__("Bulk Edit"),fields:[{fieldtype:"Select",options:a,default:n,label:__("Field"),fieldname:"field",reqd:1,onchange:()=>{_(o)}},{fieldtype:"Data",label:__("Value"),fieldname:"value",onchange(){p()}}],primary_action:({value:d})=>{let c=t[o.get_value("field")].fieldname;o.disable_primary_action(),frappe.call({method:"frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs",args:{doctype:this.doctype,freeze:!0,docnames:e,action:"update",data:{[c]:d||null}}}).then(h=>{let b=h.message||[];b.length&&!h._server_messages&&(o.enable_primary_action(),frappe.throw(__("Cannot update {0}",[b.map(u=>u.bold?u.bold():u).join(", ")]))),s(),o.hide(),frappe.show_alert(__("Updated successfully"))})},primary_action_label:__("Update {0} records",[e.length])});n&&_(o),p();function _(d){let c=Object.assign({},t[d.get_value("field")]);if(c.label.match(l)&&c.fieldtype==="Select"&&!c.default){let h=[];typeof c.options=="string"&&(h=c.options.split(`
`)),c.default=h[0]||h[1]}c.label=__("Value"),c.onchange=p,delete c.depends_on,d.replace_field("value",c),p()}function p(){let d=o.get_value("value");d==null||d===""?o.set_df_property("value","description",__("You have not entered a value. The field will be set to empty.")):o.set_df_property("value","description","")}o.refresh(),o.show()}add_tags(e,t){let s=new frappe.ui.Dialog({title:__("Add Tags"),fields:[{fieldtype:"MultiSelectPills",fieldname:"tags",label:__("Tags"),reqd:!0,get_data:function(a){return frappe.db.get_link_options("Tag",a)}}],primary_action_label:__("Add"),primary_action:()=>{let a=s.get_values();a&&a.tags&&(s.set_message("Adding Tags..."),frappe.call({method:"frappe.desk.doctype.tag.tag.add_tags",args:{tags:a.tags,dt:this.doctype,docs:e},callback:()=>{s.hide(),t()}}))}});s.show()}export(e,t){frappe.require("data_import_tools.bundle.js",()=>{let s=new frappe.data_import.DataExporter(e,"Insert New Records");s.dialog.set_value("export_records","by_filter"),s.filter_group.add_filters_to_filter_group([[e,"name","in",t,!1]])})}};var k=class{constructor({listview:e,doctype:t,meta:s,settings:a}){t||frappe.throw("DocType required"),this.listview=e,this.doctype=t,this.meta=s,this.settings=a,this.dialog=null,this.fields=this.settings&&this.settings.fields?JSON.parse(this.settings.fields):[],this.subject_field=null,frappe.model.with_doctype("List View Settings",()=>{this.make(),this.get_listview_fields(s),this.setup_fields(),this.setup_remove_fields(),this.add_new_fields(),this.show_dialog()})}make(){let e=this,t=frappe.get_meta("List View Settings");e.dialog=new frappe.ui.Dialog({title:__("{0} Settings",[__(e.doctype)]),fields:t.fields}),e.dialog.set_values(e.settings),e.dialog.set_primary_action(__("Save"),()=>{let s=e.dialog.get_values();frappe.show_alert({message:__("Saving"),indicator:"green"}),frappe.call({method:"frappe.desk.doctype.list_view_settings.list_view_settings.save_listview_settings",args:{doctype:e.doctype,listview_settings:s,removed_listview_fields:e.removed_fields||[]},callback:function(a){e.listview.refresh_columns(a.message.meta,a.message.listview_settings),e.dialog.hide()}})}),e.dialog.fields_dict.total_fields.df.onchange=()=>e.refresh()}refresh(){let e=this;e.setup_fields(),e.add_new_fields(),e.setup_remove_fields()}show_dialog(){let e=this;if(this.settings.fields||e.update_fields(),!e.dialog.get_value("total_fields")){let t=e.fields.length;t<4?t=4:t>10&&(t=10),e.dialog.set_value("total_fields",t)}e.dialog.show()}setup_fields(){function e(o){return o.fieldname==="status_field"}let t=this,s=t.dialog.get_field("fields_html"),a=s.$wrapper[0],l="",n=t.dialog.get_values().total_fields||t.settings.total_fields;for(let o in t.fields){if(o==parseInt(n))break;let _=o==0?"":"sortable",p=o==0?"hide":"",d=o==0||e(t.fields[o])?"hide":"";l+=`
				<div class="control-input flex align-center form-control fields_order ${_}"
					style="display: block; margin-bottom: 5px;" data-fieldname="${t.fields[o].fieldname}"
					data-label="${t.fields[o].label}" data-type="${t.fields[o].type}">

					<div class="row">
						<div class="col-1">
							${frappe.utils.icon("drag","xs","","","sortable-handle "+p)}
						</div>
						<div class="col-10" style="padding-left:0px;">
							${t.fields[o].label}
						</div>
						<div class="col-1 ${d}">
							<a class="text-muted remove-field" data-fieldname="${t.fields[o].fieldname}">
								${frappe.utils.icon("delete","xs")}
							</a>
						</div>
					</div>
				</div>`}s.html(`
			<div class="form-group">
				<div class="clearfix">
					<label class="control-label" style="padding-right: 0px;">Fields</label>
				</div>
				<div class="control-input-wrapper">
				${l}
				</div>
				<p class="help-box small text-muted">
					<a class="add-new-fields text-muted">
						+ Add / Remove Fields
					</a>
				</p>
			</div>
		`),new Sortable(a.getElementsByClassName("control-input-wrapper")[0],{handle:".sortable-handle",draggable:".sortable",onUpdate:()=>{t.update_fields(),t.refresh()}})}add_new_fields(){let e=this,s=e.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("add-new-fields")[0];s.onclick=()=>e.column_selector()}setup_remove_fields(){let e=this,s=e.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("remove-field");for(let a=0;a<s.length;a++)s.item(a).onclick=()=>e.remove_fields(s.item(a).getAttribute("data-fieldname"))}remove_fields(e){let t=this,s=t.fields.map(a=>a.fieldname);for(let a in t.fields)if(t.fields[a].fieldname==e){t.fields.splice(a,1);break}t.set_removed_fields(t.get_removed_listview_fields(t.fields.map(a=>a.fieldname),s)),t.refresh(),t.update_fields()}update_fields(){let e=this,a=e.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("fields_order");e.fields=[];for(let l=0;l<a.length;l++)e.fields.push({fieldname:a.item(l).getAttribute("data-fieldname"),label:a.item(l).getAttribute("data-label")});e.dialog.set_value("fields",JSON.stringify(e.fields)),e.dialog.get_value("fields")}column_selector(){let e=this,t=new frappe.ui.Dialog({title:__("{0} Fields",[__(e.doctype)]),fields:[{label:__("Reset Fields"),fieldtype:"Button",fieldname:"reset_fields",click:()=>e.reset_listview_fields(t)},{label:__("Select Fields"),fieldtype:"MultiCheck",fieldname:"fields",options:e.get_doctype_fields(e.meta,e.fields.map(s=>s.fieldname)),columns:2}]});t.set_primary_action(__("Save"),()=>{let s=t.get_values().fields;e.set_removed_fields(e.get_removed_listview_fields(s,e.fields.map(a=>a.fieldname))),e.fields=[],e.set_subject_field(e.meta),e.set_status_field();for(let a in s){let l=s[a];if(e.fields.length===parseInt(e.dialog.get_values().total_fields))break;if(l!=e.subject_field.fieldname){let n=frappe.meta.get_docfield(e.doctype,l);n&&e.fields.push({label:n.label,fieldname:n.fieldname})}}e.refresh(),e.dialog.set_value("fields",JSON.stringify(e.fields)),t.hide()}),t.show()}reset_listview_fields(e){let t=this;frappe.xcall("frappe.desk.doctype.list_view_settings.list_view_settings.get_default_listview_fields",{doctype:t.doctype}).then(s=>{let a=e.get_field("fields");a.df.options=t.get_doctype_fields(t.meta,s),e.refresh()})}get_listview_fields(e){let t=this;t.settings.fields?t.fields=JSON.parse(this.settings.fields):t.set_list_view_fields(e),t.fields.uniqBy(s=>s.fieldname)}set_list_view_fields(e){let t=this;t.set_subject_field(e),t.set_status_field(),e.fields.forEach(s=>{s.in_list_view&&!frappe.model.no_value_type.includes(s.fieldtype)&&t.subject_field.fieldname!=s.fieldname&&t.fields.push({label:s.label,fieldname:s.fieldname})})}set_subject_field(e){let t=this;if(t.subject_field={label:"ID",fieldname:"name"},e.title_field){let s=frappe.meta.get_docfield(t.doctype,e.title_field.trim());t.subject_field={label:s.label,fieldname:s.fieldname}}t.fields.push(t.subject_field)}set_status_field(){let e=this;frappe.has_indicator(e.doctype)&&e.fields.push({type:"Status",label:"Status",fieldname:"status_field"})}get_doctype_fields(e,t){let s=[];return e.fields.forEach(a=>{frappe.model.no_value_type.includes(a.fieldtype)||s.push({label:a.label,value:a.fieldname,checked:t.includes(a.fieldname)})}),s}get_removed_listview_fields(e,t){let s=this,a=[];return frappe.has_indicator(s.doctype)&&e.push("status_field"),t.forEach(l=>{e.includes(l)||a.push(l)}),a}set_removed_fields(e){let t=this;t.removed_fields?t.removed_fields=t.removed_fields.concat(e):t.removed_fields=e}};frappe.provide("frappe.views");frappe.views.ListView=class extends frappe.views.BaseList{static load_last_view(){let e=frappe.get_route(),t=e[1];if(e.length===2){let a=frappe.get_user_settings(t).last_view;return frappe.set_route("list",frappe.router.doctype_layout||t,frappe.views.is_valid(a)?a.toLowerCase():"list"),!0}return!1}constructor(e){super(e),this.show(),this.debounced_refresh=frappe.utils.debounce(this.process_document_refreshes.bind(this),2e3)}has_permissions(){return frappe.perm.has_perm(this.doctype,0,"read")}show(){this.parent.disable_scroll_to_top=!0,super.show()}check_permissions(){this.has_permissions()||(frappe.set_route(""),frappe.throw(__("Not permitted to view {0}",[this.doctype])))}show_skeleton(){this.$list_skeleton=this.parent.page.container.find(".list-skeleton"),this.$list_skeleton.length||(this.$list_skeleton=$(`
				<div class="row list-skeleton">
					<div class="col-lg-2">
						<div class="list-skeleton-box"></div>
					</div>
					<div class="col">
						<div class="list-skeleton-box"></div>
					</div>
				</div>
			`),this.parent.page.container.find(".page-content").append(this.$list_skeleton)),this.parent.page.container.find(".layout-main").hide(),this.$list_skeleton.show()}hide_skeleton(){this.$list_skeleton&&this.$list_skeleton.hide(),this.parent.page.container.find(".layout-main").show()}get view_name(){return"List"}get view_user_settings(){return this.user_settings[this.view_name]||{}}setup_defaults(){if(super.setup_defaults(),this.view="List",this.sort_by=this.view_user_settings.sort_by||this.sort_by||"modified",this.sort_order=this.view_user_settings.sort_order||this.sort_order||"desc",this.menu_items=this.menu_items.concat(this.get_menu_items()),Array.isArray(this.view_user_settings.filters)){let e=this.view_user_settings.filters;this.filters=this.validate_filters(e)}else this.filters=(this.settings.filters||[]).map(e=>(e.length===3&&(e=[this.doctype,e[0],e[1],e[2]]),e));return this.view_name=="List"&&(this.toggle_paging=!0),this.patch_refresh_and_load_lib(),this.get_list_view_settings()}on_sort_change(e,t){this.sort_by=e,this.sort_order=t,super.on_sort_change()}validate_filters(e){let t=this.meta.fields.map(s=>s.fieldname);return t=t.concat(frappe.model.std_fields_list),e.filter(s=>t.includes(s[1])).uniqBy(s=>s[1])}setup_page(){this.parent.list_view=this,super.setup_page()}setup_page_head(){super.setup_page_head(),this.set_primary_action(),this.set_actions_menu_items()}set_actions_menu_items(){this.actions_menu_items=this.get_actions_menu_items(),this.workflow_action_menu_items=this.get_workflow_action_menu_items(),this.workflow_action_items={},this.actions_menu_items.concat(this.workflow_action_menu_items).forEach(t=>{let s=this.page.add_actions_menu_item(t.label,t.action,t.standard);t.class&&s.addClass(t.class),t.is_workflow_action&&s&&(this.workflow_action_items[t.name]=s)})}show_restricted_list_indicator_if_applicable(){let e=frappe.perm.get_match_rules(this.doctype);e.length&&(this.restricted_list=$(`<button class="btn btn-xs restricted-button flex align-center">
					${frappe.utils.icon("restriction","xs")}
				</button>`).click(()=>this.show_restrictions(e)).appendTo(this.page.page_form))}show_restrictions(e=[]){frappe.msgprint(frappe.render_template("list_view_permission_restrictions",{condition_list:e}),__("Restrictions",null,"Title of message showing restrictions in list view"))}get_fields(){return super.get_fields().concat(Object.entries(this.link_field_title_fields||{}).map(e=>e.join(".")+" as "+e.join("_")))}async set_fields(){this.link_field_title_fields={};let e=[].concat(frappe.model.std_fields_list,this.get_fields_in_list_view(),[this.meta.title_field,this.meta.image_field],this.settings.add_fields||[],this.meta.track_seen?"_seen":null,this.sort_by,"enabled","disabled","color");await Promise.all(e.map(t=>new Promise(s=>{let a=typeof t=="string"?frappe.meta.get_docfield(this.doctype,t):t;a&&a.fieldtype=="Link"&&frappe.boot.link_title_doctypes.includes(a.options)?frappe.model.with_doctype(a.options,()=>{let l=frappe.get_meta(a.options);l.show_title_field_in_link&&(this.link_field_title_fields[typeof t=="string"?t:t.fieldname]=l.title_field),this._add_field(t),s()}):(this._add_field(t),s())}))),this.fields.forEach(t=>{let s=frappe.meta.get_docfield(t[1],t[0]);s&&s.fieldtype==="Currency"&&s.options&&!s.options.includes(":")&&this._add_field(s.options)})}patch_refresh_and_load_lib(){this.refresh=this.refresh.bind(this),this.refresh=frappe.utils.throttle(this.refresh,1e3),this.load_lib=new Promise(t=>{this.required_libs?frappe.require(this.required_libs,t):t()});let e=5*60*1e3;setInterval(()=>{frappe.get_route_str()===this.page_name&&this.refresh()},e)}set_primary_action(){if(this.can_create&&!frappe.boot.read_only){let e=__(frappe.router.doctype_layout)||__(this.doctype),t=`${__("Add",null,"Primary action in list view")} ${e}`;this.page.set_primary_action(t,()=>{this.settings.primary_action?this.settings.primary_action():this.make_new_doc()},"add")}else this.page.clear_primary_action()}make_new_doc(){let e=this.doctype,t={};this.filter_area.get().forEach(s=>{s[2]==="="&&frappe.model.is_non_std_field(s[1])&&(t[s[1]]=s[3])}),frappe.new_doc(e,t)}setup_view(){this.setup_columns(),this.render_header(),this.render_skeleton(),this.setup_events(),this.settings.onload&&this.settings.onload(this),this.show_restricted_list_indicator_if_applicable()}refresh_columns(e,t){this.meta=e,this.list_view_settings=t,this.setup_columns(),this.refresh(!0)}refresh(e=!1){return super.refresh().then(()=>{this.render_header(e),this.update_checkbox(),this.update_url_with_filters(),this.setup_realtime_updates()})}update_checkbox(e){if(!this.$checkbox_actions)return;let t=this.$checkbox_actions.find(".list-check-all");t.prop("checked")&&e&&!e.prop("checked")&&t.prop("checked",!1),t.prop("checked",this.$checks.length===this.data.length)}setup_freeze_area(){this.$freeze=$(`<div class="freeze flex justify-center align-center text-muted">
				${__("Loading")}...
			</div>`).hide(),this.$result.append(this.$freeze)}setup_columns(){this.columns=[];let e=frappe.meta.get_docfield.bind(null,this.doctype);this.meta.title_field?this.columns.push({type:"Subject",df:e(this.meta.title_field)}):this.columns.push({type:"Subject",df:{label:__("ID"),fieldname:"name"}}),this.columns.push({type:"Tag"}),frappe.has_indicator(this.doctype)&&this.columns.push({type:"Status"});let t=this.get_fields_in_list_view();this.columns=this.columns.concat(t.filter(a=>frappe.has_indicator(this.doctype)&&a.fieldname==="status"||!a.in_list_view?!1:a.fieldname!==this.meta.title_field).map(a=>({type:"Field",df:a}))),this.list_view_settings.fields&&(this.columns=this.reorder_listview_fields());let s=6;window.innerWidth<=1366?s=4:window.innerWidth>=1920&&(s=10),this.columns=this.columns.slice(0,this.list_view_settings.total_fields||s),!this.settings.hide_name_column&&this.meta.title_field&&this.meta.title_field!=="name"&&this.columns.push({type:"Field",df:{label:__("ID"),fieldname:"name"}})}reorder_listview_fields(){let e=[],t=JSON.parse(this.list_view_settings.fields);e.push(this.columns[0]),e.push(this.columns[1]),this.columns.splice(0,2);for(let s in t)for(let a in this.columns){let l=t[s],n=this.columns[a];if(n.type=="Status"&&l.fieldname=="status_field"){e.push(n);break}else if(n.type=="Field"&&l.fieldname===n.df.fieldname){e.push(n);break}}return e}get_documentation_link(){return this.meta.documentation?`<a href="${this.meta.documentation}" target="blank" class="meta-description small text-muted">Need Help?</a>`:""}get_no_result_message(){let e=this.get_documentation_link(),t=this.filter_area&&this.filter_area.get(),s=t&&t.length,a=s?__("No {0} found with matching filters. Clear filters to see all {0}.",[__(this.doctype)]):this.meta.description?__(this.meta.description):__("You haven't created a {0} yet",[__(this.doctype)]),l=s?__("Create a new {0}",[__(this.doctype)],"Create a new document from list view"):__("Create your first {0}",[__(this.doctype)],"Create a new document from list view"),n=this.settings.empty_state_image||"/assets/frappe/images/ui-states/list-empty-state.svg",o=this.can_create?`<p><button class="btn btn-default btn-sm btn-new-doc hidden-xs">
				${l}
			</button> <button class="btn btn-primary btn-new-doc visible-xs">
				${__("Create New",null,"Create a new document from list view")}
			</button></p>`:"";return`<div class="msg-box no-border">
			<div>
				<img src="${n}" alt="Generic Empty State" class="null-state">
			</div>
			<p>${a}</p>
			${o}
			${e}
		</div>`}freeze(){this.list_view_settings&&!this.list_view_settings.disable_count&&this.$result.find(".list-count").html(`<span>${__("Refreshing",null,"Document count in list view")}...</span>`)}get_args(){let e=super.get_args();return this.list_view_settings&&!this.list_view_settings.disable_comment_count?e.with_comment_count=1:e.with_comment_count=0,e}before_refresh(){return frappe.route_options&&this.filter_area&&(this.filters=this.parse_filters_from_route_options(),frappe.route_options=null,this.filters.length>0)?this.filter_area.clear(!1).then(()=>this.filter_area.set(this.filters)):Promise.resolve()}parse_filters_from_settings(){return(this.settings.filters||[]).map(e=>(e.length===3&&(e=[this.doctype,e[0],e[1],e[2]]),e))}toggle_result_area(){super.toggle_result_area(),this.toggle_actions_menu_button(this.$result.find(".list-row-check:checked").length>0)}toggle_actions_menu_button(e){e?(this.page.show_actions_menu(),this.page.clear_primary_action()):(this.page.hide_actions_menu(),this.set_primary_action())}render_header(e=!1){e&&this.$result.find(".list-row-head").remove(),this.$result.find(".list-row-head").length===0&&this.$result.prepend(this.get_header_html())}render_skeleton(){let e=this.get_list_row_html_skeleton('<div><input type="checkbox" class="render-list-checkbox"/></div>');this.$result.append(e)}before_render(){this.settings.before_render&&this.settings.before_render(),frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.save_view_user_settings({filters:this.filter_area&&this.filter_area.get(),sort_by:this.sort_selector&&this.sort_selector.sort_by,sort_order:this.sort_selector&&this.sort_selector.sort_order}),this.toggle_paging&&this.$paging_area.toggle(!1)}after_render(){this.$no_result.html(`
			<div class="no-result text-muted flex justify-center align-center">
				${this.get_no_result_message()}
			</div>
		`),this.setup_new_doc_event(),this.toggle_paging&&this.$paging_area.toggle(!0)}render(){this.render_list(),this.set_rows_as_checked(),this.render_count()}render_list(){this.$result.find(".list-row-container").remove(),this.data.length>0&&this.$result.append(this.data.map((e,t)=>(e._idx=t,this.get_list_row_html(e))).join(""))}render_count(){this.list_view_settings.disable_count||this.get_count_str().then(e=>{this.$result.find(".list-count").html(`<span>${e}</span>`)})}get_header_html(){if(!this.columns)return;let e=this.columns[0].df,t=`
			<input class="level-item list-check-all" type="checkbox"
				title="${__("Select All")}">
			<span class="level-item" data-sort-by="${e.fieldname}"
				title="${__("Click to sort by {0}",[e.label])}">
				${__(e.label)}
			</span>
		`,s=this.columns.map(l=>{var _,p,d;let n=["list-row-col ellipsis",l.type=="Subject"?"list-subject level":"hidden-xs",l.type=="Tag"?"tag-col hide":"",frappe.model.is_numeric_field(l.df)?"text-right":""].join(" "),o="";if(l.type==="Subject")o=t;else{let c=(_=l.df)==null?void 0:_.fieldname;o=`<span ${c?` data-sort-by="${c}"
							title="${__("Click to sort by {0}",[(p=l.df)==null?void 0:p.label])}"`:""}>
						${__(((d=l.df)==null?void 0:d.label)||l.type)}
					</span>`}return`<div class="${n}">${o}</div>
			`}).join(""),a=`
			<span class="list-count"></span>
			<span class="level-item list-liked-by-me hidden-xs">
				<span title="${__("Liked by me")}">
					${frappe.utils.icon("es-solid-heart","sm","like-icon")}
				</span>
			</span>
		`;return this.get_header_html_skeleton(s,a)}get_header_html_skeleton(e="",t=""){return`
			<header class="level list-row-head text-muted">
				<div class="level-left list-header-subject">
					${e}
				</div>
				<div class="level-left checkbox-actions">
					<div class="level list-subject">
						<input class="level-item list-check-all" type="checkbox"
							title="${__("Select All")}">
						<span class="level-item list-header-meta"></span>
					</div>
				</div>
				<div class="level-right">
					${t}
				</div>
			</header>
		`}get_left_html(e){return this.columns.map(t=>this.get_column_html(t,e)).join("")}get_right_html(e){return this.get_meta_html(e)}get_list_row_html(e){return this.get_list_row_html_skeleton(this.get_left_html(e),this.get_right_html(e))}get_list_row_html_skeleton(e="",t=""){return`
			<div class="list-row-container" tabindex="1">
				<div class="level list-row">
					<div class="level-left ellipsis">
						${e}
					</div>
					<div class="level-right text-muted ellipsis">
						${t}
					</div>
				</div>
			</div>
		`}get_column_html(e,t){var w,f,m;if(e.type==="Status"||((w=e.df)==null?void 0:w.options)=="Workflow State"){let g=((f=e.df)==null?void 0:f.options)=="Workflow State";return`
				<div class="list-row-col hidden-xs ellipsis">
					${this.get_indicator_html(t,g)}
				</div>
			`}if(e.type==="Tag"){let g=this.tags_shown?"":"hide",v=t._user_tags?this.get_tags_html(t._user_tags,2):'<div class="tags-empty">-</div>';return`
				<div class="list-row-col tag-col ${g} hidden-xs ellipsis">
					${v}
				</div>
			`}let s=e.df||{},a=s.label,l=s.fieldname,n=this.link_field_title_fields[l],o=t[l]||"",_=n&&t[l+"_"+n]||o;(((m=frappe.boot)==null?void 0:m.translated_doctypes)||[]).includes(s.options)&&(_=__(_));let d=()=>s.fieldtype==="Code"?o:s.fieldtype==="Percent"?`<div class="progress" style="margin: 0px;">
						<div class="progress-bar progress-bar-success" role="progressbar"
							aria-valuenow="${o}"
							aria-valuemin="0" aria-valuemax="100" style="width: ${Math.round(o)}%;">
						</div>
					</div>`:frappe.format(o,s,null,t),c=()=>{let g,v;if(s.fieldtype=="Text Editor"||s.fetch_from&&["Text","Small Text"].includes(s.fieldtype)?v=strip_html(_):v=typeof _=="string"?frappe.utils.escape_html(_):_,s.fieldtype==="Rating"){let B=s.options||5;v=v*B}return s.fieldtype==="Image"?g=s.options?`<img src="${t[s.options]}"
					style="max-height: 30px; max-width: 100%;">`:`<div class="missing-image small">
						${frappe.utils.icon("restriction")}
					</div>`:s.fieldtype==="Select"?g=`<span class="filterable indicator-pill ${frappe.utils.guess_colour(v)} ellipsis"
					data-filter="${l},=,${o}">
					<span class="ellipsis"> ${__(v)} </span>
				</span>`:s.fieldtype==="Link"?g=`<a class="filterable ellipsis"
					data-filter="${l},=,${o}">
					${v}
				</a>`:["Text Editor","Text","Small Text","HTML Editor","Markdown Editor"].includes(s.fieldtype)?g=`<span class="ellipsis">
					${v}
				</span>`:g=`<a class="filterable ellipsis"
					data-filter="${l},=,${frappe.utils.escape_html(o)}">
					${d()}
				</a>`,`<span class="ellipsis"
				title="${__(a)}: ${frappe.utils.escape_html(v)}">
				${g}
			</span>`},b=["list-row-col ellipsis",{Subject:"list-subject level",Field:"hidden-xs"}[e.type],frappe.model.is_numeric_field(s)?"text-right":""].join(" "),u;return this.settings.formatters&&this.settings.formatters[l]&&e.type!=="Subject"?u=this.settings.formatters[l](o,s,t):u={Subject:this.get_subject_html(t),Field:c()}[e.type],`
			<div class="${b}">
				${u}
			</div>
		`}get_tags_html(e,t,s=!1){let a=l=>{let n="",o="";if(l)return s&&(n=frappe.get_palette(l),o=`background-color: var(${n[0]}); color: var(${n[1]})`),`<div class="tag-pill ellipsis" title="${l}" style="${o}">${l}</div>`};return e.split(",").slice(1,t+1).map(a).join("")}get_meta_html(e){let t="",s=null;this.settings.button&&this.settings.button.show(e)&&(s=`
				<span class="list-actions">
					<button class="btn btn-action btn-default btn-xs"
						data-name="${e.name}" data-idx="${e._idx}"
						title="${this.settings.button.get_description(e)}">
						${this.settings.button.get_label(e)}
					</button>
				</span>
			`);let a=comment_when(e.modified,!0),l="",n=JSON.parse(e._assign||"[]");n.length&&(l=`<div class="list-assignments d-flex align-items-center">
					${frappe.avatar_group(n,3,{filterable:!0})[0].outerHTML}
				</div>`);let o=null;return this.list_view_settings&&!this.list_view_settings.disable_comment_count&&(o=$('<span class="comment-count d-flex align-items-center"></span>'),$(o).append(`
				${frappe.utils.icon("es-line-chat-alt")}
				${e._comment_count>99?"99+":e._comment_count||0}`)),t+=`
			<div class="level-item list-row-activity hidden-xs">
				<div class="hidden-md hidden-xs">
					${s||l}
				</div>
				<span class="modified">${a}</span>
				${o?$(o).prop("outerHTML"):""}
				${o?'<span class="mx-2">\xB7</span>':""}
				<span class="list-row-like hidden-xs style="margin-bottom: 1px;">
					${this.get_like_html(e)}
				</span>
			</div>
			<div class="level-item visible-xs text-right">
				${this.get_indicator_html(e)}
			</div>
		`,t}get_count_str(){let e=this.data.length,t=this.data.uniqBy(s=>s.name).length;return frappe.db.count(this.doctype,{filters:this.get_filters_for_args()}).then(s=>{this.total_count=s||e,this.count_without_children=t!==e?t:void 0;let a=__("{0} of {1}",[e,this.total_count]);return this.count_without_children&&(a=__("{0} of {1} ({2} rows with children)",[t,this.total_count,e])),a})}get_form_link(e){return this.settings.get_form_link?this.settings.get_form_link(e):`/app/${encodeURIComponent(frappe.router.slug(frappe.router.doctype_layout||this.doctype))}/${encodeURIComponent(cstr(e.name))}`}get_seen_class(e){return JSON.parse(e._seen||"[]").includes(frappe.session.user)?"":"bold"}get_like_html(e){let t=JSON.parse(e._liked_by||"[]"),s=t.includes(frappe.session.user)?"liked-by liked":"not-liked",a=t.map(o=>frappe.user_info(o).fullname).join(", "),l=document.createElement("div");l.innerHTML=`
			<span class="like-action ${s}">
				${frappe.utils.icon("es-solid-heart","sm","like-icon")}
			</span>
			<span class="likes-count">
				${t.length>99?__("99")+"+":__(t.length||"")}
			</span>
		`;let n=l.querySelector(".like-action");return n.setAttribute("data-liked-by",e._liked_by||"[]"),n.setAttribute("data-doctype",this.doctype),n.setAttribute("data-name",e.name),n.setAttribute("title",a),l.innerHTML}get_subject_html(e){let t=this.columns[0].df,s=e[t.fieldname];if(this.settings.formatters&&this.settings.formatters[t.fieldname]){let p=this.settings.formatters[t.fieldname];s=p(s,t,e)}s||(s=e.name);let a=this.get_seen_class(e),l=document.createElement("div");l.innerHTML=`
			<span class="level-item select-like">
				<input class="list-row-checkbox" type="checkbox">
			</span>
			<span class="level-item ${a} ellipsis">
				<a class="ellipsis"></a>
			</span>
		`;let n=l.querySelector(".list-row-checkbox");n.dataset.doctype=this.doctype,n.dataset.name=e.name;let o=l.querySelector(".level-item a");o.dataset.doctype=this.doctype,o.dataset.name=e.name,o.href=this.get_form_link(e);let _=frappe.utils.html2text(s);return o.title=_,o.textContent=_,l.innerHTML}get_indicator_html(e,t){let s=frappe.get_indicator(e,this.doctype,t),l=[__("Document is in draft state"),__("Document has been submitted"),__("Document has been cancelled")][e.docstatus||0];return s?`<span class="indicator-pill ${s[1]} filterable no-indicator-dot ellipsis"
				data-filter='${s[2]}' title='${l}'>
				<span class="ellipsis"> ${__(s[0])}</span>
			</span>`:""}get_indicator_dot(e){let t=frappe.get_indicator(e,this.doctype);return t?`<span class='indicator ${t[1]}' title='${__(t[0])}'></span>`:""}get_image_url(e){let t=e.image?e.image:e[this.meta.image_field];return window.cordova&&!frappe.utils.is_url(t)&&(t=frappe.base_url+t),t||null}setup_events(){this.setup_filterable(),this.setup_sort_by(),this.setup_list_click(),this.setup_drag_click(),this.setup_tag_event(),this.setup_new_doc_event(),this.setup_check_events(),this.setup_like(),this.setup_realtime_updates(),this.setup_action_handler(),this.setup_keyboard_navigation()}setup_keyboard_navigation(){let e=()=>{this.$result.find(".list-row-container:first").focus()},t=()=>{$(document.activeElement).next().focus()},s=()=>{$(document.activeElement).prev().focus()},a=()=>$(document.activeElement).is(".list-row-container"),l=d=>{d.find("input[type=checkbox]").click()},n=()=>a()?$(document.activeElement):null,o=()=>this.page.wrapper.is(":visible"),_=()=>$(document.activeElement).is("input"),p=d=>{if(!o()||_())return!1;n()?d==="down"?t():s():e()};frappe.ui.keys.add_shortcut({shortcut:"down",action:()=>p("down"),description:__("Navigate list down",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"up",action:()=>p("up"),description:__("Navigate list up",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"shift+down",action:()=>{if(!o()||_())return!1;let d=n();l(d),t()},description:__("Select multiple list items",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"shift+up",action:()=>{if(!o()||_())return!1;let d=n();l(d),s()},description:__("Select multiple list items",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"enter",action:()=>{let d=n();return d?(d.find("a[data-name]")[0].click(),!0):!1},description:__("Open list item",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"space",action:()=>{let d=n();return d?(l(d),!0):!1},description:__("Select list item",null,"Description of a list view shortcut"),page:this.page})}setup_filterable(){this.$result.on("click",".filterable",e=>{if(e.metaKey||e.ctrlKey)return;e.stopPropagation();let a=$(e.currentTarget).attr("data-filter").split("|").map(l=>(l=l.split(","),l[2]==="Today"?l[2]=frappe.datetime.get_today():l[2]=="User"&&(l[2]=frappe.session.user),this.filter_area.remove(l[0]),[this.doctype,l[0],l[1],l.slice(2).join(",")]));this.filter_area.add(a)})}setup_sort_by(){this.$result.on("click","[data-sort-by]",e=>{let t=e.currentTarget.getAttribute("data-sort-by");if(!t)return;let s="asc";this.sort_by===t&&(s=this.sort_order==="asc"?"desc":"asc"),this.sort_selector.set_value(t,s),this.on_sort_change(t,s)})}setup_list_click(){this.$result.on("click",".list-row, .image-view-header, .file-header",e=>{let t=$(e.target);if((e.ctrlKey||e.metaKey)&&!t.is("a")){let n=$(e.currentTarget).find(".list-row-checkbox");n.prop("checked",!n.prop("checked")),e.preventDefault(),this.on_row_checked();return}if(t.hasClass("filterable")||t.hasClass("select-like")||t.hasClass("file-select")||t.hasClass("list-row-like")||t.is(":checkbox")){e.stopPropagation();return}if(t.is("a"))return;let a=$(e.currentTarget).find(".list-subject a").get(0);if(a)return frappe.set_route(a.pathname),!1})}setup_drag_click(){this.dragClick=!1,this.$result.on("mousedown",".list-row-checkbox",e=>{this.dragClick=!0,this.check=!e.target.checked}),$(document).on("mouseup",()=>{this.dragClick=!1}),this.$result.on("mousemove",".level.list-row",e=>{this.dragClick&&this.check_row_on_drag(e,this.check)})}check_row_on_drag(e,t=!0){$(e.target).find(".list-row-checkbox").prop("checked",t),this.on_row_checked()}setup_action_handler(){this.$result.on("click",".btn-action",e=>{let t=$(e.currentTarget),s=this.data[t.attr("data-idx")];return this.settings.button.action(s),e.stopPropagation(),!1})}setup_check_events(){this.$result.on("change","input[type=checkbox]",t=>{let s=$(t.currentTarget);if(s.is(".list-header-subject .list-check-all")){let a=this.$result.find(".checkbox-actions .list-check-all");a.prop("checked",s.prop("checked")),a.trigger("change")}else s.is(".checkbox-actions .list-check-all")?(this.$result.find(".list-header-subject .list-check-all").prop("checked",s.prop("checked")),this.$result.find(".list-row-checkbox").prop("checked",s.prop("checked"))):s.attr("data-parent")&&this.$result.find(`.${s.attr("data-parent")}`).find(".list-row-checkbox").prop("checked",s.prop("checked"));this.on_row_checked()}),this.$result.on("click",".list-row-checkbox",t=>{let s=$(t.currentTarget);if(t.shiftKey&&this.$checkbox_cursor&&!s.is(this.$checkbox_cursor)){let a=decodeURIComponent(this.$checkbox_cursor.data().name),l=decodeURIComponent(s.data().name),n=this.data.findIndex(h=>h.name===a),o=this.data.findIndex(h=>h.name===l),[_,p]=[n,o];_>p&&([_,p]=[p,_]);let c=this.data.slice(_+1,p).map(h=>h.name).map(h=>`.list-row-checkbox[data-name="${encodeURIComponent(h)}"]`).join(",");this.$result.find(c).prop("checked",!0)}this.$checkbox_cursor=s,this.update_checkbox(s)});let e=this;this.page.actions_btn_group.on("show.bs.dropdown",()=>{e.toggle_workflow_actions()})}setup_like(){this.$result.on("click",".like-action",frappe.ui.click_toggle_like),this.$result.on("click",".list-liked-by-me",e=>{let t=$(e.currentTarget);t.toggleClass("active"),t.hasClass("active")?this.filter_area.add(this.doctype,"_liked_by","like","%"+frappe.session.user+"%"):this.filter_area.remove("_liked_by")})}setup_new_doc_event(){this.$no_result.find(".btn-new-doc").click(()=>{this.settings.primary_action?this.settings.primary_action():this.make_new_doc()})}setup_tag_event(){this.tags_shown=!1,this.list_sidebar&&this.list_sidebar.parent.on("click",".list-tag-preview",()=>{this.tags_shown=!this.tags_shown,this.toggle_tags()})}setup_realtime_updates(){var e;this.pending_document_refreshes=[],!(((e=this.list_view_settings)==null?void 0:e.disable_auto_refresh)||this.realtime_events_setup)&&(frappe.realtime.doctype_subscribe(this.doctype),frappe.realtime.off("list_update"),frappe.realtime.on("list_update",t=>{(t==null?void 0:t.doctype)===this.doctype&&(this.$checks&&this.$checks.length||this.avoid_realtime_update()||(this.pending_document_refreshes.push(t),this.debounced_refresh()))}),this.realtime_events_setup=!0)}disable_realtime_updates(){frappe.realtime.doctype_unsubscribe(this.doctype),this.realtime_events_setup=!1}process_document_refreshes(){if(!this.pending_document_refreshes.length)return;let e=frappe.get_route()||[];if(!cur_list||e[0]!="List"||cur_list.doctype!=e[1]){this.pending_document_refreshes=[],this.disable_realtime_updates();return}let t=this.pending_document_refreshes.map(a=>a.name);if(this.pending_document_refreshes=this.pending_document_refreshes.filter(a=>t.indexOf(a.name)===-1),!t.length)return;let s=this.get_call_args();s.args.filters.push([this.doctype,"name","in",t]),s.args.start=0,frappe.call(s).then(({message:a})=>{if(!a)return;let l=frappe.utils.dict(a.keys,a.values);if(!(l&&l.length)){this.data=this.data.filter(n=>t.indexOf(n.name)===-1),this.render_list();return}l.forEach(n=>{let o=this.data.findIndex(_=>_.name===n.name);o===-1?this.data.push(n):this.data[o]=n}),this.data.sort((n,o)=>{let _=n[this.sort_by]||"",p=o[this.sort_by]||"",d=0;return _>p&&(d=1),p>_&&(d=-1),this.sort_order==="desc"&&(d=-d),d}),this.$checks&&this.$checks.length&&this.set_rows_as_checked(),this.toggle_result_area(),this.render_list()})}avoid_realtime_update(){return!!(this.filter_area.is_being_edited()||this.disable_list_update)}set_rows_as_checked(){$.each(this.$checks,(e,t)=>{let s=$(t).attr("data-name");this.$result.find(`.list-row-checkbox[data-name='${s}']`).prop("checked",!0)}),this.on_row_checked()}on_row_checked(){this.$list_head_subject=this.$list_head_subject||this.$result.find("header .list-header-subject"),this.$checkbox_actions=this.$checkbox_actions||this.$result.find("header .checkbox-actions"),this.$checks=this.$result.find(".list-row-checkbox:checked"),this.$list_head_subject.toggle(this.$checks.length===0),this.$checkbox_actions.toggle(this.$checks.length>0),this.$checks.length===0?this.$list_head_subject.find(".list-check-all").prop("checked",!1):(this.$checkbox_actions.find(".list-header-meta").html(__("{0} items selected",[this.$checks.length])),this.$checkbox_actions.show(),this.$list_head_subject.hide()),this.update_checkbox(),this.toggle_actions_menu_button(this.$checks.length>0)}toggle_tags(){this.$result.find(".tag-col").toggleClass("hide");let e=this.tags_shown?__("Hide Tags"):__("Show Tags");this.list_sidebar.parent.find(".list-tag-preview").text(e)}get_checked_items(e){let t=Array.from(this.$checks||[]).map(s=>cstr(unescape($(s).data().name)));return e?t:this.data.filter(s=>t.includes(s.name))}clear_checked_items(){this.$checks&&this.$checks.prop("checked",!1),this.on_row_checked()}save_view_user_settings(e){return frappe.model.user_settings.save(this.doctype,this.view_name,e)}on_update(){}update_url_with_filters(){frappe.get_route_str()==this.page_name&&!this.report_name&&window.history.replaceState(null,null,this.get_url_with_filters())}get_url_with_filters(){let e=this.get_search_params(),t=window.location.href.replace(window.location.search,"");return e.size&&(t+="?"+e.toString()),t}get_search_params(){let e=new URLSearchParams;return this.get_filters_for_args().forEach(t=>{t[2]==="="?e.append(t[1],t[3]):e.append(t[1],JSON.stringify([t[2],t[3]]))}),e}get_menu_items(){let e=this.doctype,t=[];return frappe.model.can_import(e,null,this.meta)&&t.push({label:__("Import",null,"Button in list view menu"),action:()=>frappe.set_route("list","data-import",{reference_doctype:e}),standard:!0}),frappe.user_roles.includes("System Manager")&&t.push({label:__("User Permissions",null,"Button in list view menu"),action:()=>frappe.set_route("list","user-permission",{allow:e}),standard:!0}),frappe.user_roles.includes("System Manager")&&t.push({label:__("Role Permissions Manager",null,"Button in list view menu"),action:()=>frappe.set_route("permission-manager",{doctype:e}),standard:!0}),frappe.model.can_create("Custom Field")&&frappe.model.can_create("Property Setter")&&t.push({label:__("Customize",null,"Button in list view menu"),action:()=>{!this.meta||(this.meta.custom?frappe.set_route("form","doctype",e):this.meta.custom||frappe.set_route("form","customize-form",{doc_type:e}))},standard:!0,shortcut:"Ctrl+J"}),t.push({label:__("Toggle Sidebar",null,"Button in list view menu"),action:()=>this.toggle_side_bar(),condition:()=>!this.hide_sidebar,standard:!0,shortcut:"Ctrl+K"}),frappe.user.has_role("System Manager")&&frappe.boot.developer_mode===1&&t.push({label:__("Edit DocType",null,"Button in list view menu"),action:()=>frappe.set_route("form","doctype",e),standard:!0}),frappe.user.has_role("System Manager")&&this.get_view_settings&&t.push(this.get_view_settings()),t}get_view_settings(){return{label:__("List Settings",null,"Button in list view menu"),action:()=>this.show_list_settings(),standard:!0}}show_list_settings(){frappe.model.with_doctype(this.doctype,()=>{new k({listview:this,doctype:this.doctype,settings:this.list_view_settings,meta:frappe.get_meta(this.doctype)})})}get_workflow_action_menu_items(){let e=[],t=this;return frappe.model.has_workflow(this.doctype)&&frappe.workflow.get_all_transition_actions(this.doctype).forEach(a=>{e.push({label:__(a),name:a,action:()=>{t.disable_list_update=!0,frappe.xcall("frappe.model.workflow.bulk_workflow_approval",{docnames:this.get_checked_items(!0),doctype:this.doctype,action:a}).finally(()=>{t.disable_list_update=!1})},is_workflow_action:!0})}),e}toggle_workflow_actions(){if(!frappe.model.has_workflow(this.doctype))return;Object.keys(this.workflow_action_items).forEach(t=>{this.workflow_action_items[t].addClass("disabled")});let e=this.get_checked_items();frappe.xcall("frappe.model.workflow.get_common_transition_actions",{docs:e,doctype:this.doctype}).then(t=>{Object.keys(this.workflow_action_items).forEach(s=>{this.workflow_action_items[s].removeClass("disabled"),this.workflow_action_items[s].toggle(t.includes(s))})})}get_actions_menu_items(){let e=this.doctype,t=[],s=new y({doctype:this.doctype}),a=f=>f.fieldname&&frappe.model.is_value_type(f)&&f.fieldtype!=="Read Only"&&!f.hidden&&!f.read_only&&!f.is_virtual,l=f=>frappe.meta.get_docfields(f).some(m=>a(m)),n=f=>frappe.perm.has_perm(f,0,"submit"),o=()=>({label:__("Assign To",null,"Button in list view actions menu"),action:()=>{this.disable_list_update=!0,s.assign(this.get_checked_items(!0),()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})},standard:!0}),_=()=>({label:__("Apply Assignment Rule",null,"Button in list view actions menu"),action:()=>{this.disable_list_update=!0,s.apply_assignment_rule(this.get_checked_items(!0),()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})},standard:!0}),p=()=>({label:__("Add Tags",null,"Button in list view actions menu"),action:()=>{this.disable_list_update=!0,s.add_tags(this.get_checked_items(!0),()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})},standard:!0}),d=()=>({label:__("Print",null,"Button in list view actions menu"),action:()=>s.print(this.get_checked_items()),standard:!0}),c=()=>({label:__("Delete",null,"Button in list view actions menu"),action:()=>{let f=this.get_checked_items(!0).map(g=>g.toString()),m=__("Delete {0} item permanently?",[f.length],"Title of confirmation dialog");f.length>1&&(m=__("Delete {0} items permanently?",[f.length],"Title of confirmation dialog")),frappe.confirm(m,()=>{this.disable_list_update=!0,s.delete(f,()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})})},standard:!0}),h=()=>({label:__("Cancel",null,"Button in list view actions menu"),action:()=>{let f=this.get_checked_items(!0);f.length>0&&frappe.confirm(__("Cancel {0} documents?",[f.length],"Title of confirmation dialog"),()=>{this.disable_list_update=!0,s.submit_or_cancel(f,"cancel",()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})})},standard:!0}),b=()=>({label:__("Submit",null,"Button in list view actions menu"),action:()=>{let f=this.get_checked_items(!0);f.length>0&&frappe.confirm(__("Submit {0} documents?",[f.length],"Title of confirmation dialog"),()=>{this.disable_list_update=!0,s.submit_or_cancel(f,"submit",()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})})},standard:!0}),u=()=>({label:__("Edit",null,"Button in list view actions menu"),action:()=>{let f={};frappe.meta.get_docfields(e).forEach(m=>{a(m)&&(f[m.label]=Object.assign({},m))}),this.disable_list_update=!0,s.edit(this.get_checked_items(!0),f,()=>{this.disable_list_update=!1,this.refresh()})},standard:!0}),w=()=>({label:__("Export",null,"Button in list view actions menu"),action:()=>{let f=this.get_checked_items(!0);s.export(e,f)},standard:!0});return l(e)&&t.push(u()),t.push(w()),t.push(o()),t.push(_()),t.push(p()),frappe.model.can_print(e)&&t.push(d()),frappe.model.is_submittable(e)&&n(e)&&!frappe.model.has_workflow(e)&&t.push(b()),frappe.model.can_cancel(e)&&!frappe.model.has_workflow(e)&&t.push(h()),frappe.model.can_delete(e)&&t.push(c()),t}parse_filters_from_route_options(){let e=[];for(let a in frappe.route_options){let l=null,n=frappe.route_options[a],o;if($.isArray(n)&&n[0].startsWith("[")&&n[0].endsWith("]")){o=[];for(var t=0;t<n.length;t++)o.push(JSON.parse(n[t]))}else typeof n=="string"&&n.startsWith("[")&&n.endsWith("]")&&(n=JSON.parse(n));if(a.includes(".")&&(l=a.split(".")[0],a=a.split(".")[1]),l||(l=frappe.meta.get_doctype_for_field(this.doctype,a)),l)if(o)for(var s=0;s<o.length;s++)$.isArray(o[s])?e.push([l,a,o[s][0],o[s][1]]):e.push([l,a,"=",o[s]]);else $.isArray(n)?e.push([l,a,n[0],n[1]]):e.push([l,a,"=",n])}return e}};frappe.get_list_view=r=>{let e=`List/${r}/List`;return frappe.views.list_view[e]};frappe.provide("frappe.views.list_view");window.cur_list=null;frappe.views.ListFactory=class extends frappe.views.Factory{make(e){let t=this,s=e[1],a=frappe.utils.to_title_case(e[2]||"List");s=="File"&&!["Report","Dashboard"].includes(a)&&(a="File");let l=frappe.views[a+"View"];l||(l=frappe.views.ListView),!(l&&l.load_last_view&&l.load_last_view())&&(frappe.provide("frappe.views.list_view."+s),frappe.views.list_view[t.page_name]=new l({doctype:s,parent:t.make_page(!0,t.page_name)}),t.set_cur_list())}before_show(){if(this.re_route_to_view())return!1;this.set_module_breadcrumb()}on_show(){this.set_cur_list(),cur_list&&cur_list.show()}re_route_to_view(){let e=this.route[1],t=frappe.route_history.slice(-2)[0];if(this.route[0]==="List"&&this.route.length===2&&frappe.views.list_view[e]&&t&&t[0]==="List"&&t[1]===e)return window.history.go(-1),!0}set_module_breadcrumb(){if(frappe.route_history.length>1){let e=frappe.route_history[frappe.route_history.length-2];if(e[0]==="modules"){let t=this.route[1],s=e[1];frappe.module_links[s]&&frappe.module_links[s].includes(t)&&frappe.breadcrumbs.set_doctype_module(t,s)}}}set_cur_list(){cur_list=frappe.views.list_view[this.page_name],cur_list&&cur_list.doctype!==this.route[1]&&(window.cur_list=null)}};frappe.provide("frappe.views");frappe.views.ListViewSelect=class{constructor(e){$.extend(this,e),this.set_current_view(),this.setup_views()}add_view_to_menu(e,t){this.doctype=="File"&&e=="List"&&(e="File"),this.page.add_custom_menu_item(this.parent,__(e),t,!0,null,this.icon_map[e]||"list").parent().attr("data-view",e)}set_current_view(){this.current_view="List";let e=frappe.get_route(),t=frappe.utils.to_title_case(e[2]||"");e.length>2&&frappe.views.view_modes.includes(t)&&(this.current_view=t,this.current_view==="Kanban"?this.kanban_board=e[3]:this.current_view==="Inbox"&&(this.email_account=e[3]))}set_route(e,t){let s=[this.slug(),"view",e];t&&s.push(t);let a=cur_list==null?void 0:cur_list.get_search_params();a&&(frappe.route_options=Object.fromEntries(a)),frappe.set_route(s)}setup_views(){let e={List:{condition:!0,action:()=>this.set_route("list")},Report:{condition:!0,action:()=>this.set_route("report"),current_view_handler:()=>{let t=this.get_reports(),s={};frappe.get_route().length>3&&(s={label:__("Report Builder"),action:()=>this.set_route("report")}),this.setup_dropdown_in_sidebar("Report",t,s)}},Dashboard:{condition:!0,action:()=>this.set_route("dashboard")},Calendar:{condition:frappe.views.calendar[this.doctype],action:()=>this.set_route("calendar","default"),current_view_handler:()=>{this.get_calendars().then(t=>{this.setup_dropdown_in_sidebar("Calendar",t)})}},Gantt:{condition:frappe.views.calendar[this.doctype],action:()=>this.set_route("gantt")},Inbox:{condition:this.doctype==="Communication"&&frappe.boot.email_accounts.length,action:()=>this.set_route("inbox"),current_view_handler:()=>{let t=this.get_email_accounts(),s;has_common(frappe.user_roles,["System Manager","Administrator"])&&(s={label:__("New Email Account"),action:()=>frappe.new_doc("Email Account")}),this.setup_dropdown_in_sidebar("Inbox",t,s)}},Image:{condition:this.list_view.meta.image_field,action:()=>this.set_route("image")},Tree:{condition:frappe.treeview_settings[this.doctype]||frappe.get_meta(this.doctype).is_tree,action:()=>this.set_route("tree")},Kanban:{condition:this.doctype!="File",action:()=>this.setup_kanban_boards(),current_view_handler:()=>{frappe.views.KanbanView.get_kanbans(this.doctype).then(t=>this.setup_kanban_switcher(t))}},Map:{condition:this.list_view.settings.get_coords_method||this.list_view.meta.fields.find(t=>t.fieldname==="latitude")&&this.list_view.meta.fields.find(t=>t.fieldname==="longitude")||this.list_view.meta.fields.find(t=>t.fieldname==="location"&&t.fieldtype=="Geolocation"),action:()=>this.set_route("map")}};frappe.views.view_modes.forEach(t=>{this.current_view!==t&&e[t].condition&&this.add_view_to_menu(t,e[t].action),this.current_view==t&&e[t].current_view_handler&&e[t].current_view_handler()})}setup_dropdown_in_sidebar(e,t,s){if(!this.sidebar)return;let a=this.sidebar.sidebar.find(".views-section");a.find(".sidebar-label").html(__(e));let l=a.find(".views-dropdown"),n=__("Select {0}",[__(e)]),o="";if(!t||!t.length)o=`<div class="empty-state">
						${__("No {0} Found",[__(e)])}
				</div>`;else{let _=this.get_page_name();t.map(p=>{p.name.toLowerCase()==_.toLowerCase()?n=p.name:o+=`<li><a class="dropdown-item" href="${p.route}">${p.name}</a></li>`})}a.find(".selected-view").html(n),s&&(a.find(".sidebar-action a").html(s.label),a.find(".sidebar-action a").click(()=>s.action())),l.html(o),a.removeClass("hide")}setup_kanban_switcher(e){let t=this.page.add_custom_button_group(__("Select Kanban"),null,this.list_view.$filter_section);e.map(l=>{this.page.add_custom_menu_item(t,l.name,()=>this.set_route("kanban",l.name),!1)});let s=this.list_view.board_perms;(s?s.create:!0)&&this.page.add_custom_menu_item(t,__("Create New Kanban Board"),()=>frappe.views.KanbanView.show_kanban_dialog(this.doctype),!0)}get_page_name(){return frappe.utils.to_title_case(frappe.get_route().slice(-1)[0]||"")}get_reports(){let e=[],t=[],s=l=>{l.map(n=>{if(!n.ref_doctype||n.ref_doctype==this.doctype){let o=n.report_type==="Report Builder"?`/app/list/${n.ref_doctype}/report`:"/app/query-report",_=n.route||o+"/"+(n.title||n.name);e.indexOf(_)===-1&&(e.push(_),t.push({name:__(n.title||n.name),route:_}))}})};this.list_view.settings.reports&&s(this.list_view.settings.reports);var a=Object.values(frappe.boot.user.all_reports).sort((l,n)=>l.title.localeCompare(n.title))||[];return s(a),t}setup_kanban_boards(){var s;function e(a){frappe.db.get_value("Kanban Board",{reference_doctype:a},"name",l=>{$.isEmptyObject(l)?frappe.views.KanbanView.show_kanban_dialog(a):frappe.set_route("list",a,"kanban",l.name)})}let t=(s=frappe.model.user_settings[this.doctype].Kanban)==null?void 0:s.last_kanban_board;t?frappe.db.exists("Kanban Board",t).then(a=>{a?frappe.set_route("list",this.doctype,"kanban",t):e(this.doctype)}):e(this.doctype)}get_calendars(){let e=this.doctype,t=[];return frappe.db.get_list("Calendar View",{filters:{reference_doctype:e}}).then(s=>{if(!!(s&&Array.isArray(s)&&s.length))return frappe.views.calendar[this.doctype]&&t.push({name:"Default",route:`/app/${this.slug()}/view/calendar/default`}),s.map(a=>{t.push({name:a.name,route:`/app/${this.slug()}/view/calendar/${a.name}`})}),t})}get_email_accounts(){let e=[];return frappe.boot.email_accounts.forEach(s=>{let l=`/app/communication/view/inbox/${s.email_id=="All Accounts"?"All Accounts":s.email_account}`,n=["All Accounts","Sent Mail","Spam","Trash"].includes(s.email_id)?__(s.email_id):s.email_account;e.push({name:n,route:l})}),e}slug(){return frappe.router.slug(frappe.router.doctype_layout||this.doctype)}};frappe.provide("frappe.ui");var x=class{constructor({wrapper:e,doctype:t}){Object.assign(this,arguments[0]),this.can_add_global=frappe.user.has_role(["System Manager","Administrator"]),this.filters=[],this.make(),this.bind(),this.refresh()}make(){this.wrapper.html(`
			<li class="input-area"></li>
			<li class="sidebar-action">
				<a class="saved-filters-preview">${__("Show Saved")}</a>
			</li>
			<div class="saved-filters"></div>
		`),this.$input_area=this.wrapper.find(".input-area"),this.$list_filters=this.wrapper.find(".list-filters"),this.$saved_filters=this.wrapper.find(".saved-filters").hide(),this.$saved_filters_preview=this.wrapper.find(".saved-filters-preview"),this.saved_filters_hidden=!0,this.toggle_saved_filters(!0),this.filter_input=frappe.ui.form.make_control({df:{fieldtype:"Data",placeholder:__("Filter Name"),input_class:"input-xs"},parent:this.$input_area,render_input:1}),this.is_global_input=frappe.ui.form.make_control({df:{fieldtype:"Check",label:__("Is Global")},parent:this.$input_area,render_input:1})}bind(){this.bind_save_filter(),this.bind_toggle_saved_filters(),this.bind_click_filter(),this.bind_remove_filter()}refresh(){this.get_list_filters().then(()=>{this.filters.length?this.$saved_filters_preview.show():this.$saved_filters_preview.hide();let e=this.filters.map(t=>this.filter_template(t));this.wrapper.find(".filter-pill").remove(),this.$saved_filters.append(e)}),this.is_global_input.toggle(!1),this.filter_input.set_description("")}filter_template(e){return`<div class="list-link filter-pill list-sidebar-button btn btn-default" data-name="${e.name}">
			<a class="ellipsis filter-name">${e.filter_name}</a>
			<a class="remove">${frappe.utils.icon("close")}</a>
		</div>`}bind_toggle_saved_filters(){this.wrapper.find(".saved-filters-preview").click(()=>{this.toggle_saved_filters(this.saved_filters_hidden)})}toggle_saved_filters(e){this.$saved_filters.toggle(e);let t=e?__("Hide Saved"):__("Show Saved");this.wrapper.find(".saved-filters-preview").text(t),this.saved_filters_hidden=!this.saved_filters_hidden}bind_click_filter(){this.wrapper.on("click",".filter-pill .filter-name",e=>{let t=$(e.currentTarget).parent(".filter-pill");this.set_applied_filter(t);let s=t.attr("data-name");this.list_view.filter_area.clear().then(()=>{this.list_view.filter_area.add(this.get_filters_values(s))})})}bind_remove_filter(){this.wrapper.on("click",".filter-pill .remove",e=>{let t=$(e.currentTarget).closest(".filter-pill"),s=t.text().trim();frappe.confirm(__("Are you sure you want to remove the {0} filter?",[s.bold()]),()=>{let a=t.attr("data-name"),l=this.get_filters_values(a);t.remove(),this.remove_filter(a).then(()=>this.refresh()),this.list_view.filter_area.remove_filters(l)})})}bind_save_filter(){this.filter_input.$input.keydown(frappe.utils.debounce(e=>{let t=this.filter_input.get_value(),s=Boolean(t);if(e.which===frappe.ui.keyCode.ENTER){if(!s||this.filter_name_exists(t))return;this.filter_input.set_value(""),this.save_filter(t).then(()=>this.refresh()),this.toggle_saved_filters(!0)}else{let a=__("Press Enter to save");this.filter_name_exists(t)&&(a=__("Duplicate Filter Name")),this.filter_input.set_description(s?a:""),this.can_add_global&&this.is_global_input.toggle(s)}},300))}save_filter(e){return frappe.db.insert({doctype:"List Filter",reference_doctype:this.list_view.doctype,filter_name:e,for_user:this.is_global_input.get_value()?"":frappe.session.user,filters:JSON.stringify(this.get_current_filters())})}remove_filter(e){if(!!e)return frappe.db.delete_doc("List Filter",e)}get_filters_values(e){let t=this.filters.find(s=>s.name===e);return JSON.parse(t.filters||"[]")}get_current_filters(){return this.list_view.filter_area.get()}filter_name_exists(e){return(this.filters||[]).find(t=>t.filter_name===e)}get_list_filters(){return frappe.session.user==="Guest"?Promise.resolve():frappe.db.get_list("List Filter",{fields:["name","filter_name","for_user","filters"],filters:{reference_doctype:this.list_view.doctype},or_filters:[["for_user","=",frappe.session.user],["for_user","=",""]]}).then(e=>{this.filters=e||[]})}set_applied_filter(e){this.$saved_filters.find(".btn-primary-light").toggleClass("btn-primary-light btn-default"),e.toggleClass("btn-default btn-primary-light")}};frappe.provide("frappe.views");frappe.views.ListSidebar=class{constructor(e){$.extend(this,e),this.make()}make(){var e=frappe.render_template("list_sidebar",{doctype:this.doctype});this.sidebar=$('<div class="list-sidebar overlay-sidebar hidden-xs hidden-sm"></div>').html(e).appendTo(this.page.sidebar.empty()),this.setup_list_filter(),this.setup_list_group_by(),$(document).trigger("list_sidebar_setup"),this.list_view.list_view_settings&&this.list_view.list_view_settings.disable_sidebar_stats?this.sidebar.find(".list-tags").remove():this.sidebar.find(".list-stats").on("show.bs.dropdown",t=>{this.reload_stats()}),this.add_insights_banner()}setup_views(){var e=!1;frappe.views.calendar[this.doctype]&&(this.sidebar.find('.list-link[data-view="Calendar"]').removeClass("hide"),this.sidebar.find('.list-link[data-view="Gantt"]').removeClass("hide"),e=!0),this.sidebar.find('.list-link[data-view="Kanban"]').removeClass("hide"),this.doctype==="Communication"&&frappe.boot.email_accounts.length&&(this.sidebar.find('.list-link[data-view="Inbox"]').removeClass("hide"),e=!0),(frappe.treeview_settings[this.doctype]||frappe.get_meta(this.doctype).is_tree)&&this.sidebar.find(".tree-link").removeClass("hide"),this.current_view="List";var t=frappe.get_route();t.length>2&&frappe.views.view_modes.includes(t[2])&&(this.current_view=t[2],this.current_view==="Kanban"?this.kanban_board=t[3]:this.current_view==="Inbox"&&(this.email_account=t[3])),this.sidebar.find('.list-link[data-view="'+this.current_view+'"] a').attr("disabled","disabled").addClass("disabled"),this.sidebar.find('.list-link[data-view="Kanban"] a, .list-link[data-view="Inbox"] a').attr("disabled",null).removeClass("disabled"),this.list_view.meta.image_field&&(this.sidebar.find('.list-link[data-view="Image"]').removeClass("hide"),e=!0),(this.list_view.settings.get_coords_method||this.list_view.meta.fields.find(s=>s.fieldname==="latitude")&&this.list_view.meta.fields.find(s=>s.fieldname==="longitude")||this.list_view.meta.fields.find(s=>s.fieldname==="location"&&s.fieldtype=="Geolocation"))&&(this.sidebar.find('.list-link[data-view="Map"]').removeClass("hide"),e=!0),e&&this.sidebar.find('.list-link[data-view="List"]').removeClass("hide")}setup_reports(){var e=this,t=[],s=this.page.sidebar.find(".reports-dropdown"),a=!1,l=function(o){$.each(o,function(_,p){if(!p.ref_doctype||p.ref_doctype==e.doctype){var d=p.report_type==="Report Builder"?`List/${p.ref_doctype}/Report`:"query-report",c=p.route||d+"/"+(p.title||p.name);t.indexOf(c)===-1&&(t.push(c),a||(e.get_divider().appendTo(s),a=!0),$('<li><a href="#'+c+'">'+__(p.title||p.name)+"</a></li>").appendTo(s))}})};this.list_view.settings.reports&&l(this.list_view.settings.reports);var n=Object.values(frappe.boot.user.all_reports).sort((o,_)=>o.title.localeCompare(_.title))||[];l(n)}setup_list_filter(){this.list_filter=new x({wrapper:this.page.sidebar.find(".list-filters"),doctype:this.doctype,list_view:this.list_view})}setup_kanban_boards(){let e=this.page.sidebar.find(".kanban-dropdown");frappe.views.KanbanView.setup_dropdown_in_sidebar(this.doctype,e)}setup_keyboard_shortcuts(){this.sidebar.find(".list-link > a, .list-link > .btn-group > a").each((e,t)=>{frappe.ui.keys.get_shortcut_group(this.page).add($(t))})}setup_list_group_by(){this.list_group_by=new frappe.views.ListGroupBy({doctype:this.doctype,sidebar:this,list_view:this.list_view,page:this.page})}get_stats(){var e=this;let t=e.sidebar.find(".list-stats-dropdown .stat-result");this.set_loading_state(t),frappe.call({method:"frappe.desk.reportview.get_sidebar_stats",type:"GET",args:{stats:e.stats,doctype:e.doctype,filters:(e.list_view.filter_area?e.list_view.get_filters_for_args():e.default_filters)||[]},callback:function(s){let a=(s.message.stats||{})._user_tags||[];e.render_stat(a);let l=e.sidebar.find(".list-stats-dropdown");frappe.utils.setup_search(l,".stat-link",".stat-label")}})}set_loading_state(e){e.html(`<li>
			<div class="empty-state">
				${__("Loading...")}
			</div>
		</li>`)}render_stat(e){let t={stats:e,label:__("Tags")},s=$(frappe.render_template("list_sidebar_stat",t)).on("click",".stat-link",a=>{let l=$(a.currentTarget).attr("data-field"),n=$(a.currentTarget).attr("data-label"),o="like",_=this.list_view.filter_area.filter_list.get_filter(l);_&&_.remove(),n=="No Tags"&&(n="%,%",o="not like"),this.list_view.filter_area.add(this.doctype,l,o,n)});this.sidebar.find(".list-stats-dropdown .stat-result").html(s)}reload_stats(){this.sidebar.find(".stat-link").remove(),this.sidebar.find(".stat-no-records").remove(),this.get_stats()}add_insights_banner(){try{if(this.list_view.view!="Report"||localStorage.getItem("show_insights_banner")=="false")return;this.insights_banner&&this.insights_banner.remove();let e="Get more insights with",t="https://frappe.io/s/insights",s="Frappe Insights";this.insights_banner=$(`
				<div style="position: relative;">
					<div class="pr-3">
						${e} <a href="${t}" target="_blank" style="color: var(--text-color)">${s} &rarr; </a>
					</div>
					<div style="position: absolute; top: -1px; right: -4px; cursor: pointer;" title="Dismiss"
						onclick="localStorage.setItem('show_insights_banner', 'false') || this.parentElement.remove()">
						<svg class="icon  icon-sm" style="">
							<use class="" href="#icon-close"></use>
						</svg>
					</div>
				</div>
			`).appendTo(this.sidebar)}catch(e){console.error(e)}}};frappe.templates.list_sidebar=`<ul class="list-unstyled sidebar-menu user-actions hide">
	<li class="divider"></li>
</ul>
<ul class="list-unstyled sidebar-menu">
	<div class="sidebar-section views-section hide">
		<li class="sidebar-label">
		</li>
		<div class="current-view">
			<li class="list-link">
				<a class="btn btn-default btn-sm list-sidebar-button"
					data-toggle="dropdown"
					aria-haspopup="true"
					aria-expanded="false"
					href="#"
				>
					<span class="selected-view ellipsis">
					</span>
					<span>
						<svg class="icon icon-xs">
							<use href="#icon-select"></use>
						</svg>
					</span>
				</a>
				<ul class="dropdown-menu views-dropdown" role="menu">
				</ul>
			</li>
			<li class="sidebar-action">
				<a class="view-action"></a>
			</li>
		</div>
	</div>

	<div class="sidebar-section filter-section">
		<li class="sidebar-label">
			{{ __("Filter By") }}
		</li>

		<div class="list-group-by">
		</div>

		<div class="list-tags">
			<li class="list-stats list-link">
				<a
					class="btn btn-default btn-sm list-sidebar-button"
					data-toggle="dropdown"
					aria-haspopup="true"
					aria-expanded="false"
					href="#"
				>
					<span>{{ __("Tags") }}</span>
					<span>
						<svg class="icon icon-xs">
							<use href="#icon-select"></use>
						</svg>
					</span>
				</a>
				<ul class="dropdown-menu list-stats-dropdown" role="menu">
					<div class="dropdown-search">
						<input type="text" placeholder={{__("Search") }} data-element="search" class="form-control input-xs">
					</div>
					<div class="stat-result">
					</div>
				</ul>
			</li>
			<li class="sidebar-action show-tags">
				<a class="list-tag-preview">{{ __("Show Tags") }}</a>
			</li>
		</div>
	</div>

	<div class="sidebar-section save-filter-section">
		<li class="sidebar-label">
			{{ __("Save Filter") }}
		</li>
		<li class="list-filters list-link"></li>
</ul>
`;frappe.templates.list_sidebar_stat=`
{% if (!stats.length) { %}
<li class="stat-no-records text-muted">{{ __("No records tagged.") }}</li>
{% } else {
	for (var i=0, l=stats.length; i < l; i++) {
		var stat_label = stats[i][0];
		var stat_count = stats[i][1];
%}
<li>
	<a class="stat-link dropdown-item" data-label="{{ stat_label %}" data-field="_user_tags" href="#" onclick="return false;">
		<span class="stat-label">{{ __(stat_label) }}</span>
		<span>{{ stat_count }}</span>
	</a>
</li>
	{% }
} %}
`;frappe.provide("frappe.views");frappe.views.ListGroupBy=class{constructor(e){$.extend(this,e),this.make_wrapper(),this.user_settings=frappe.get_user_settings(this.doctype),this.group_by_fields=["assigned_to","owner"],this.user_settings.group_by_fields&&(this.group_by_fields=this.group_by_fields.concat(this.user_settings.group_by_fields)),this.render_group_by_items(),this.make_group_by_fields_modal(),this.setup_dropdown(),this.setup_filter_by()}make_group_by_fields_modal(){let e=new frappe.ui.Dialog({title:__("Select Filters"),fields:this.get_group_by_dropdown_fields()});e.set_primary_action(__("Save"),({group_by_fields:t})=>{frappe.model.user_settings.save(this.doctype,"group_by_fields",t||null),this.group_by_fields=t?["assigned_to","owner",...t]:["assigned_to","owner"],this.render_group_by_items(),this.setup_dropdown(),e.hide()}),e.$body.prepend(`
			<div class="filters-search">
				<input type="text"
					placeholder="${__("Search")}"
					data-element="search" class="form-control input-xs">
			</div>
		`),this.page.sidebar.find(".add-list-group-by a").on("click",()=>{frappe.utils.setup_search(e.$body,".unit-checkbox",".label-area"),e.show()})}make_wrapper(){this.$wrapper=this.sidebar.sidebar.find(".list-group-by");let e=`
			<div class="list-group-by-fields">
			</div>
			<li class="add-list-group-by sidebar-action">
				<a class="add-group-by">
					${__("Edit Filters")}
				</a>
			</li>
		`;this.$wrapper.html(e)}render_group_by_items(){let e=s=>{let a,l;if(s==="assigned_to")a=__("Assigned To");else if(s==="owner")a=__("Created By");else{a=frappe.meta.get_label(this.doctype,s);let n=frappe.meta.get_docfield(this.doctype,s);if(!n)return;l=n.fieldtype}return`<li class="group-by-field list-link">
					<a class="btn btn-default btn-sm list-sidebar-button" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false"
					data-label="${a}" data-fieldname="${s}" data-fieldtype="${l}"
					href="#" onclick="return false;">
						<span class="ellipsis">${__(a)}</span>
						<span>${frappe.utils.icon("select","xs")}</span>
					</a>
					<ul class="dropdown-menu group-by-dropdown" role="menu">
					</ul>
			</li>`},t=this.group_by_fields.map(e).join("");this.$wrapper.find(".list-group-by-fields").html(t)}setup_dropdown(){this.$wrapper.find(".group-by-field").on("show.bs.dropdown",e=>{let t=$(e.currentTarget).find(".group-by-dropdown");this.set_loading_state(t);let s=$(e.currentTarget).find("a").attr("data-fieldname"),a=$(e.currentTarget).find("a").attr("data-fieldtype");this.get_group_by_count(s).then(l=>{if(l.length){let n=this.list_view.get_filter_value(s=="assigned_to"?"_assign":s);this.render_dropdown_items(l,a,t,n),this.setup_search(t)}else this.set_empty_state(t)})})}set_loading_state(e){e.html(`<li>
			<div class="empty-state group-by-loading">
				${__("Loading...")}
			</div>
		</li>`)}set_empty_state(e){e.html(`<div class="empty-state group-by-empty">
				${__("No filters found")}
			</div>`)}setup_search(e){frappe.utils.setup_search(e,".group-by-item",".group-by-value","data-name")}get_group_by_dropdown_fields(){let e=[],t=this.list_view.meta.fields.filter(s=>["Select","Link","Data","Int","Check"].includes(s.fieldtype));return e.push({label:__(this.doctype),fieldname:"group_by_fields",fieldtype:"MultiCheck",columns:2,options:t.map(s=>({label:__(s.label),value:s.fieldname,checked:this.group_by_fields.includes(s.fieldname)}))}),e}get_group_by_count(e){let t=this.list_view.get_filters_for_args();t=t.filter(a=>!a.includes(e==="assigned_to"?"_assign":e));let s={doctype:this.doctype,current_filters:t,field:e};return frappe.call("frappe.desk.listview.get_group_by_count",s).then(a=>{let l=a.message||[];l=l.filter(o=>o.count!==0);let n=l.find(o=>o.name===frappe.session.user);return l=l.filter(o=>!["Guest","Administrator",frappe.session.user].includes(o.name)),n&&l.unshift(n),l})}render_dropdown_items(e,t,s,a){let l=`
			<div class="dropdown-search">
				<input type="text"
					placeholder="${__("Search")}"
					data-element="search"
					class="dropdown-search-input form-control input-xs"
				>
			</div>
		`,n="",o="";e.map(p=>{p.name===a?n=this.get_dropdown_html(p,t,!0):o+=this.get_dropdown_html(p,t)});let _=l+n+o;s.toggleClass("has-selected",Boolean(n)),s.html(_)}get_dropdown_html(e,t,s=!1){let a;e.name==null?a=__("Not Set"):e.name===frappe.session.user?a=__("Me"):t&&t=="Check"?a=e.name=="0"?__("No"):__("Yes"):a=__(e.name);let l=e.name==null?"":encodeURIComponent(e.name),n=s?`<span class="applied"> ${frappe.utils.icon("tick","xs")} </span>`:"";return`<li class="group-by-item ${s?"selected":""}" data-value="${l}">
			<a class="dropdown-item" href="#" onclick="return false;">
				${n}
				<span class="group-by-value ellipsis" data-name="${e.name}">${a}</span>
				<span class="group-by-count">${e.count}</span>
			</a>
		</li>`}setup_filter_by(){this.$wrapper.on("click",".group-by-item",e=>{let t=$(e.currentTarget),s=t.hasClass("selected"),a=t.parents(".group-by-field").find("a").data("fieldname"),l=typeof t.data("value")=="string"?decodeURIComponent(t.data("value").trim()):t.data("value");return a=a==="assigned_to"?"_assign":a,this.list_view.filter_area.remove(a).then(()=>{if(!s)return this.apply_filter(a,l)})})}apply_filter(e,t){let s="=";return t===""&&(s="is",t="not set"),e==="_assign"&&(s="like",t=`%${t}%`),this.list_view.filter_area.add(this.doctype,e,s,t)}};frappe.templates.list_view_permission_restrictions=`<table class="table table-bordered" style="margin: 0;">
	<thead>
		<th>{{ __("Field") }}</th>
		<th>{{ __("Value") }}</th>
	</thead>
	<tbody>
		{% for (let condition of condition_list ) { %}
			{% for (let key in condition) { %}
			<tr>
				<td>{{ __(key) }}</td>
				<td>{{ frappe.utils.comma_or(condition[key]) }}</td>
			</tr>
			{% } %}
		{% } %}
	</tbody>
</table>
`;frappe.provide("frappe.views");frappe.views.GanttView=class extends frappe.views.ListView{get view_name(){return"Gantt"}setup_defaults(){return super.setup_defaults().then(()=>{this.page_title=this.page_title+" "+__("Gantt"),this.calendar_settings=frappe.views.calendar[this.doctype]||{},typeof this.calendar_settings.gantt=="object"&&Object.assign(this.calendar_settings,this.calendar_settings.gantt),this.calendar_settings.order_by?(this.sort_by=this.calendar_settings.order_by,this.sort_order="asc"):(this.sort_by=this.view_user_settings.sort_by||this.calendar_settings.field_map.start,this.sort_order=this.view_user_settings.sort_order||"asc")})}setup_view(){}prepare_data(e){super.prepare_data(e),this.prepare_tasks()}prepare_tasks(){var e=this,t=this.meta,s=this.calendar_settings.field_map;this.tasks=this.data.map(function(a){var l=0;s.progress&&$.isFunction(s.progress)?l=s.progress(a):s.progress&&(l=a[s.progress]);var n;t.title_field?n=a.progress?__("{0} ({1}) - {2}%",[a[t.title_field],a.name,a.progress]):__("{0} ({1})",[a[t.title_field],a.name]):n=a[s.title];var o={start:a[s.start],end:a[s.end],name:n,id:a[s.id||"name"],doctype:e.doctype,progress:l,dependencies:a.depends_on_tasks||""};return a.color&&frappe.ui.color.validate_hex(a.color)&&(o.custom_class="color-"+a.color.substr(1)),a.is_milestone&&(o.custom_class="bar-milestone"),o})}render(){this.load_lib.then(()=>{this.render_gantt()})}render_header(){}render_gantt(){let e=this,t=this.view_user_settings.gantt_view_mode||"Day",s=this.calendar_settings.field_map,a="YYYY-MM-DD";this.$result.empty(),this.$result.addClass("gantt-modern"),this.gantt=new Gantt(this.$result[0],this.tasks,{bar_height:35,bar_corner_radius:4,resize_handle_width:8,resize_handle_height:28,resize_handle_corner_radius:3,resize_handle_offset:4,view_mode:t,date_format:"YYYY-MM-DD",on_click:l=>{frappe.set_route("Form",l.doctype,l.id)},on_date_change:(l,n,o)=>{!e.can_write||frappe.db.set_value(l.doctype,l.id,{[s.start]:moment(n).format(a),[s.end]:moment(o).format(a)})},on_progress_change:(l,n)=>{if(!!e.can_write){var o="progress";$.isFunction(s.progress)?o=null:s.progress&&(o=s.progress),o&&frappe.db.set_value(l.doctype,l.id,{[o]:parseInt(n)})}},on_view_change:l=>{e.save_view_user_settings({gantt_view_mode:l})},custom_popup_html:l=>{var n=e.get_item(l.id),o=`<div class="title">${l.name}</div>
					<div class="subtitle">${moment(l._start).format("MMM D")} - ${moment(l._end).format("MMM D")}</div>`,_=e.settings.gantt_custom_popup_html;if(_&&$.isFunction(_)){var p=l;o=_(p,n)}return'<div class="details-container">'+o+"</div>"}}),this.setup_view_mode_buttons(),this.set_colors()}setup_view_mode_buttons(){if(this.$paging_area.find(".gantt-view-mode").length>0)return;let t=this.gantt.options.view_modes||[],s=n=>this.gantt.view_is(n)?"btn-info":"",a=`<div class="btn-group gantt-view-mode">
				${t.map(n=>`<button type="button"
						class="btn btn-default btn-sm btn-view-mode ${s(n)}"
						data-value="${n}">
						${__(n)}
					</button>`).join("")}
			</div>`;this.$paging_area.find(".level-left").append(a);let l=n=>setTimeout(()=>this.gantt.change_view_mode(n),0);this.$paging_area.on("click",".btn-view-mode",n=>{let o=$(n.currentTarget);this.$paging_area.find(".btn-view-mode").removeClass("btn-info"),o.addClass("btn-info");let _=o.data().value;l(_)})}set_colors(){let t=this.tasks.map(s=>s.custom_class).filter(s=>s&&s.startsWith("color-")).map(s=>{let a=s.replace("#",""),l="#"+s.substr(6),n=frappe.ui.color.get_contrast_color(l);return`
				.gantt .bar-wrapper.${a} .bar {
					fill: ${l};
				}
				.gantt .bar-wrapper.${a} .bar-progress {
					fill: ${n};
				}
			`}).join("");t=`<style>${t}</style>`,this.$result.prepend(t)}get_item(e){return this.data.find(t=>t.name===e)}get required_libs(){return["assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.css","assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.min.js"]}};frappe.provide("frappe.views.calendar");frappe.provide("frappe.views.calendars");frappe.views.CalendarView=class extends frappe.views.ListView{static load_last_view(){let e=frappe.get_route();if(e.length===3){let t=e[1],s=frappe.get_user_settings(t).Calendar||{};return e.push(s.last_calendar||"default"),frappe.set_route(e),!0}else return!1}toggle_result_area(){}get view_name(){return"Calendar"}setup_defaults(){return super.setup_defaults().then(()=>{this.page_title=__("{0} Calendar",[this.page_title]),this.calendar_settings=frappe.views.calendar[this.doctype]||{},this.calendar_name=frappe.get_route()[3]})}setup_page(){this.hide_page_form=!0,super.setup_page()}setup_view(){}before_render(){super.before_render(),this.save_view_user_settings({last_calendar:this.calendar_name})}render(){if(this.calendar){this.calendar.refresh();return}this.load_lib.then(()=>this.get_calendar_preferences()).then(e=>{this.calendar=new frappe.views.Calendar(e)})}get_calendar_preferences(){let e={doctype:this.doctype,parent:this.$result,page:this.page,list_view:this},t=this.calendar_name;return new Promise(s=>{t==="default"?(Object.assign(e,frappe.views.calendar[this.doctype]),s(e)):frappe.model.with_doc("Calendar View",t,()=>{let a=frappe.get_doc("Calendar View",t);if(!a){frappe.show_alert(__("{0} is not a valid Calendar. Redirecting to default Calendar.",[t.bold()])),frappe.set_route("List",this.doctype,"Calendar","default");return}Object.assign(e,{field_map:{id:"name",start:a.start_date_field,end:a.end_date_field,title:a.subject_field,allDay:a.all_day?1:0}}),s(e)})})}get required_libs(){let e=["assets/frappe/js/lib/fullcalendar/fullcalendar.min.css","assets/frappe/js/lib/fullcalendar/fullcalendar.min.js"],t=frappe.boot.lang;return t&&t!=="en"&&e.push("assets/frappe/js/lib/fullcalendar/locale-all.js"),e}};frappe.views.Calendar=class{constructor(e){$.extend(this,e),this.field_map=this.field_map||{id:"name",start:"start",end:"end",allDay:"all_day",convertToUserTz:"convert_to_user_tz"},this.color_map={danger:"red",success:"green",warning:"orange",default:"blue"},this.get_default_options()}get_default_options(){return new Promise(e=>{let t=localStorage.getItem("cal_defaultView"),s=localStorage.getItem("cal_weekends");e({defaultView:t||"month",weekends:s||!0})}).then(e=>{this.make_page(),this.setup_options(e),this.make(),this.setup_view_mode_button(e),this.bind()})}make_page(){var e=this;e.page.clear_user_actions(),$.each(frappe.boot.calendars,function(t,s){frappe.model.can_read(s)&&e.page.add_menu_item(__(s),function(){frappe.set_route("List",s,"Calendar")})}),$(this.parent).on("show",function(){e.$cal.fullCalendar("refetchEvents")})}make(){this.$wrapper=this.parent,this.$cal=$("<div>").appendTo(this.$wrapper),this.footnote_area=frappe.utils.set_footnote(this.footnote_area,this.$wrapper,__("Select or drag across time slots to create a new event.")),this.footnote_area.css({"border-top":"0px"}),this.$cal.fullCalendar(this.cal_options),this.set_css()}setup_view_mode_button(e){var t=this;$(t.footnote_area).find(".btn-weekend").detach();let a=`<button class="btn btn-default btn-xs btn-weekend">${e.weekends?__("Hide Weekends"):__("Show Weekends")}</button>`;t.footnote_area.append(a)}set_localStorage_option(e,t){localStorage.removeItem(e),localStorage.setItem(e,t)}bind(){let e=this;e.$wrapper.find(".fc-button-group").on("click",".btn",function(){let s=$(this).hasClass("fc-agendaWeek-button")?"agendaWeek":$(this).hasClass("fc-agendaDay-button")?"agendaDay":"month";e.set_localStorage_option("cal_defaultView",s)}),e.$wrapper.on("click",".btn-weekend",function(){e.cal_options.weekends=!e.cal_options.weekends,e.$cal.fullCalendar("option","weekends",e.cal_options.weekends),e.set_localStorage_option("cal_weekends",e.cal_options.weekends),e.set_css(),e.setup_view_mode_button(e.cal_options)})}set_css(){this.$wrapper.find("button.fc-state-default").removeClass("fc-state-default").addClass("btn btn-default"),this.$wrapper.find(".fc-month-button, .fc-agendaWeek-button, .fc-agendaDay-button").wrapAll('<div class="btn-group" />'),this.$wrapper.find(".fc-prev-button span").attr("class","").html(frappe.utils.icon("left")),this.$wrapper.find(".fc-next-button span").attr("class","").html(frappe.utils.icon("right")),this.$wrapper.find(".fc-today-button").prepend(frappe.utils.icon("today")),this.$wrapper.find(".fc-day-number").wrap('<div class="fc-day"></div>');var e=this.$wrapper.find(".fc-button-group");e.find(".fc-state-active").addClass("active"),e.find(".btn").on("click",function(){e.find(".btn").removeClass("active"),$(this).addClass("active")})}get_system_datetime(e){return e._offset=moment(e).tz(frappe.sys_defaults.time_zone)._offset,frappe.datetime.convert_to_system_tz(e)}setup_options(e){var t=this;e.meridiem="false",this.cal_options={locale:frappe.boot.lang,header:{left:"prev, title, next",right:"today, month, agendaWeek, agendaDay"},editable:!0,selectable:!0,selectHelper:!0,forceEventDuration:!0,displayEventTime:!0,defaultView:e.defaultView,weekends:e.weekends,nowIndicator:!0,buttonText:{today:__("Today"),month:__("Month"),week:__("Week"),day:__("Day")},events:function(s,a,l,n){return frappe.call({method:t.get_events_method||"frappe.desk.calendar.get_events",type:"GET",args:t.get_args(s,a),callback:function(o){var _=o.message||[];_=t.prepare_events(_),n(_)}})},displayEventEnd:!0,eventRender:function(s,a){a.attr("title",s.tooltip)},eventClick:function(s){var a=s.doctype||t.doctype;frappe.model.can_read(a)&&frappe.set_route("Form",a,s.name)},eventDrop:function(s,a,l){t.update_event(s,l)},eventResize:function(s,a,l){t.update_event(s,l)},select:function(s,a,l,n){if(!(n.name==="month"&&a-s===864e5)){var o=frappe.model.get_new_doc(t.doctype);if(o[t.field_map.start]=t.get_system_datetime(s),t.field_map.end&&(o[t.field_map.end]=t.get_system_datetime(a)),t.field_map.allDay){var _=s._ambigTime&&a._ambigTime?1:0;o[t.field_map.allDay]=_,_&&(o[t.field_map.end]=t.get_system_datetime(moment(a).subtract(1,"s")))}frappe.set_route("Form",t.doctype,o.name)}},dayClick:function(s,a,l){if(l.name==="month"){let n=$("td[data-date="+s.format("YYYY-MM-DD")+"]");n.hasClass("date-clicked")&&(t.$cal.fullCalendar("changeView","agendaDay"),t.$cal.fullCalendar("gotoDate",s),t.$wrapper.find(".date-clicked").removeClass("date-clicked"),t.$wrapper.find(".fc-month-button").removeClass("active"),t.$wrapper.find(".fc-agendaDay-button").addClass("active")),t.$wrapper.find(".date-clicked").removeClass("date-clicked"),n.addClass("date-clicked")}return!1}},this.options&&$.extend(this.cal_options,this.options)}get_args(e,t){var s={doctype:this.doctype,start:this.get_system_datetime(e),end:this.get_system_datetime(t),fields:this.fields,filters:this.list_view.filter_area.get(),field_map:this.field_map};return s}refresh(){this.$cal.fullCalendar("refetchEvents")}prepare_events(e){var t=this;return(e||[]).map(s=>(s.id=s.name,s.editable=frappe.model.can_write(s.doctype||t.doctype),s.docstatus&&s.docstatus>0&&(s.editable=!1),$.each(t.field_map,function(a,l){s[a]=s[l]}),typeof s.allDay=="undefined"&&(s.allDay=t.field_map.allDay),t.field_map.convertToUserTz||(s.convertToUserTz=1),s.convertToUserTz&&(s.start=frappe.datetime.convert_to_user_tz(s.start),s.end=frappe.datetime.convert_to_user_tz(s.end)),!frappe.datetime.validate(s.start)&&s.end&&(s.start=frappe.datetime.add_days(s.end,-1)),s.start&&!frappe.datetime.validate(s.end)&&(s.end=frappe.datetime.add_days(s.start,1)),t.fix_end_date_for_event_render(s),t.prepare_colors(s),s.title=frappe.utils.html2text(s.title),s))}prepare_colors(e){let t,s;return this.get_css_class?(s=this.color_map[this.get_css_class(e)]||"blue",s.startsWith("#")&&(s=frappe.ui.color.validate_hex(s)?s:"blue"),e.backgroundColor=frappe.ui.color.get(s,"extra-light"),e.textColor=frappe.ui.color.get(s,"dark")):(t=e.color,(!frappe.ui.color.validate_hex(t)||!t)&&(t=frappe.ui.color.get("blue","extra-light")),e.backgroundColor=t,e.textColor=frappe.ui.color.get_contrast_color(t)),e}update_event(e,t){var s=this;return frappe.model.remove_from_locals(s.doctype,e.name),frappe.call({method:s.update_event_method||"frappe.desk.calendar.update_event",args:s.get_update_args(e),callback:function(a){a.exc&&(frappe.show_alert(__("Unable to update event")),t())},error:function(){t()}})}get_update_args(e){var t=this,s={name:e[this.field_map.id]};return s[this.field_map.start]=t.get_system_datetime(e.start),this.field_map.allDay&&(s[this.field_map.allDay]=e.start._ambigTime&&e.end._ambigTime?1:0),this.field_map.end&&(e.end||(e.end=e.start.add(1,"hour")),s[this.field_map.end]=t.get_system_datetime(e.end),s[this.field_map.allDay]&&(s[this.field_map.end]=t.get_system_datetime(moment(e.end).subtract(1,"s")))),s.doctype=e.doctype||this.doctype,{args:s,field_map:this.field_map}}fix_end_date_for_event_render(e){e.allDay&&(e.start=e.start?$.fullCalendar.moment(e.start).stripTime():null,e.end=e.end?$.fullCalendar.moment(e.end).add(1,"day").stripTime():null)}};frappe.provide("frappe.views");frappe.views.DashboardView=class extends frappe.views.ListView{get view_name(){return"Dashboard"}setup_defaults(){return super.setup_defaults().then(()=>{this.page_title=__("{0} Dashboard",[__(this.doctype)]),this.dashboard_settings=frappe.get_user_settings(this.doctype).dashboard_settings||null})}render(){}setup_page(){this.hide_sidebar=!0,this.hide_page_form=!0,this.hide_filters=!0,this.hide_sort_selector=!0,super.setup_page()}setup_view(){this.chart_group||this.number_card_group||(this.setup_dashboard_page(),this.setup_dashboard_customization(),this.make_dashboard())}setup_dashboard_customization(){this.page.add_menu_item(__("Customize Dashboard"),()=>this.customize()),this.page.add_menu_item(__("Reset Dashboard Customizations"),()=>this.reset_dashboard_customization()),this.add_customization_buttons()}setup_dashboard_page(){let e='<div class="dashboard-view"></div>';this.$frappe_list.html(e),this.page.clear_secondary_action(),this.$dashboard_page=this.$page.find(".layout-main-section-wrapper").addClass("dashboard-page"),this.page.main.removeClass("frappe-card"),this.$dashboard_wrapper=this.$page.find(".dashboard-view"),this.$chart_header=this.$page.find(".dashboard-header"),frappe.utils.bind_actions_with_object(this.$dashboard_page,this)}add_customization_buttons(){this.save_customizations_button=this.page.add_button(__("Save Customizations"),()=>{this.save_dashboard_customization(),this.page.standard_actions.show()},{btn_class:"btn-primary"}),this.discard_customizations_button=this.page.add_button(__("Discard"),()=>{this.discard_dashboard_customization(),this.page.standard_actions.show()}),this.toggle_customization_buttons(!1)}set_primary_action(){}toggle_customization_buttons(e){this.save_customizations_button.toggle(e),this.discard_customizations_button.toggle(e)}make_dashboard(){this.dashboard_settings?(this.charts=this.dashboard_settings.charts,this.number_cards=this.dashboard_settings.number_cards,this.render_dashboard()):frappe.run_serially([()=>this.fetch_dashboard_items("Dashboard Chart",{chart_type:["in",["Count","Sum","Group By"]],document_type:this.doctype,is_public:1},"charts"),()=>this.fetch_dashboard_items("Number Card",{document_type:this.doctype,is_public:1},"number_cards"),()=>this.render_dashboard()])}render_dashboard(){this.$dashboard_wrapper.empty(),frappe.dashboard_utils.get_dashboard_settings().then(e=>{this.dashboard_chart_settings=e.chart_config?JSON.parse(e.chart_config):{},this.charts.map(t=>{t.label=t.chart_name,t.chart_settings=this.dashboard_chart_settings[t.chart_name]||{}}),this.render_dashboard_charts()}),this.render_number_cards(),!this.charts.length&&!this.number_cards.length&&this.render_empty_state()}fetch_dashboard_items(e,t,s){return frappe.db.get_list(e,{filters:t,fields:["*"]}).then(a=>{this[s]=a})}render_number_cards(){this.number_card_group=new frappe.widget.WidgetGroup({container:this.$dashboard_wrapper,type:"number_card",columns:3,options:{allow_sorting:!0,allow_create:!0,allow_delete:!0,allow_hiding:!0},default_values:{doctype:this.doctype},widgets:this.number_cards||[],in_customize_mode:this.in_customize_mode||!1}),this.in_customize_mode&&this.number_card_group.customize()}render_dashboard_charts(){this.chart_group=new frappe.widget.WidgetGroup({container:this.$dashboard_wrapper,type:"chart",columns:2,height:240,options:{allow_sorting:!0,allow_create:!0,allow_delete:!0,allow_hiding:!0,allow_resize:!0},custom_dialog:()=>this.show_add_chart_dialog(),widgets:this.charts,in_customize_mode:this.in_customize_mode||!1}),this.in_customize_mode&&this.chart_group.customize(),this.chart_group.container.find(".widget-group-head").hide()}render_empty_state(){let e=`<p>${__("You haven't added any Dashboard Charts or Number Cards yet.")}
			<br>${__("Click On Customize to add your first widget")}</p>`,t=`<p><button class="btn btn-primary btn-sm" data-action="customize">
				${__("Customize")}
			</button></p>`,a=`<div class="msg-box no-border empty-dashboard">
			<div>
				<img src="/assets/frappe/images/ui-states/list-empty-state.svg" alt="Generic Empty State" class="null-state">
			</div>
			${e}
			${t}
		</div>`;this.$dashboard_wrapper.append(a),this.$empty_state=this.$dashboard_wrapper.find(".empty-dashboard")}customize(){this.in_customize_mode||(this.page.standard_actions.hide(),this.$empty_state&&this.$empty_state.remove(),this.toggle_customize(!0),this.in_customize_mode=!0,this.chart_group.customize(),this.number_card_group.customize())}get_widgets_to_save(e){let t=e.get_widget_config(),s=[];return t.order.map(a=>{s.push(t.widgets[a])}),this.remove_duplicates(s)}save_dashboard_customization(){this.toggle_customize(!1);let e=this.get_widgets_to_save(this.chart_group),t=this.get_widgets_to_save(this.number_card_group);this.dashboard_settings={charts:e,number_cards:t},frappe.model.user_settings.save(this.doctype,"dashboard_settings",this.dashboard_settings),this.make_dashboard()}discard_dashboard_customization(){this.dashboard_settings=frappe.get_user_settings(this.doctype).dashboard_settings||null,this.toggle_customize(!1),this.render_dashboard()}reset_dashboard_customization(){frappe.confirm(__("Are you sure you want to reset all customizations?"),()=>{this.dashboard_settings=null,frappe.model.user_settings.save(this.doctype,"dashboard_settings",this.dashboard_settings).then(()=>this.make_dashboard()),this.toggle_customize(!1)})}toggle_customize(e){this.toggle_customization_buttons(e),this.in_customize_mode=e}show_add_chart_dialog(){let e=this.get_field_options(),t=new frappe.ui.Dialog({title:__("Add a {0} Chart",[__(this.doctype)]),fields:[{fieldname:"new_or_existing",fieldtype:"Select",label:"Choose an existing chart or create a new chart",options:["New Chart","Existing Chart"],reqd:1},{label:"Chart",fieldname:"chart",fieldtype:"Link",get_query:()=>({query:"frappe.desk.doctype.dashboard_chart.dashboard_chart.get_charts_for_user",filters:{document_type:this.doctype}}),options:"Dashboard Chart",depends_on:'eval: doc.new_or_existing == "Existing Chart"'},{fieldname:"sb_2",fieldtype:"Section Break",depends_on:'eval: doc.new_or_existing == "New Chart"'},{label:"Chart Label",fieldname:"label",fieldtype:"Data",mandatory_depends_on:'eval: doc.new_or_existing == "New Chart"'},{fieldname:"cb_1",fieldtype:"Column Break"},{label:"Chart Type",fieldname:"chart_type",fieldtype:"Select",options:["Time Series","Group By"],mandatory_depends_on:'eval: doc.new_or_existing == "New Chart"'},{fieldname:"sb_2",fieldtype:"Section Break",label:"Chart Config",depends_on:'eval: doc.chart_type == "Time Series" && doc.new_or_existing == "New Chart"'},{label:"Function",fieldname:"chart_function",fieldtype:"Select",options:["Count","Sum","Average"],default:"Count"},{label:"Timespan",fieldtype:"Select",fieldname:"timespan",depends_on:'eval: doc.chart_type == "Time Series"',options:["Last Year","Last Quarter","Last Month","Last Week"],default:"Last Year"},{fieldname:"cb_2",fieldtype:"Column Break"},{label:"Value Based On",fieldtype:"Select",fieldname:"based_on",options:e.value_fields,depends_on:'eval: doc.chart_function=="Sum"'},{label:"Time Series Based On",fieldtype:"Select",fieldname:"based_on",options:e.date_fields,mandatory_depends_on:'eval: doc.chart_type == "Time Series"'},{label:"Time Interval",fieldname:"time_interval",fieldtype:"Select",depends_on:'eval: doc.chart_type == "Time Series"',options:["Yearly","Quarterly","Monthly","Weekly","Daily"],default:"Monthly"},{fieldname:"sb_2",fieldtype:"Section Break",label:"Chart Config",depends_on:'eval: doc.chart_type == "Group By" && doc.new_or_existing == "New Chart"'},{label:"Group By Type",fieldname:"group_by_type",fieldtype:"Select",options:["Count","Sum","Average"],default:"Count"},{label:"Aggregate Function Based On",fieldtype:"Select",fieldname:"aggregate_function_based_on",options:e.aggregate_function_fields,depends_on:'eval: ["Sum", "Average"].includes(doc.group_by_type)'},{fieldname:"cb_2",fieldtype:"Column Break"},{label:"Group By Based On",fieldtype:"Select",fieldname:"group_by_based_on",options:e.group_by_fields,default:"Last Year"},{label:"Number of Groups",fieldtype:"Int",fieldname:"number_of_groups",default:0},{fieldname:"sb_3",fieldtype:"Section Break",depends_on:'eval: doc.new_or_existing == "New Chart"'},{label:"Chart Type",fieldname:"type",fieldtype:"Select",options:["Line","Bar","Percentage","Pie"],depends_on:'eval: doc.new_or_existing == "New Chart"'},{fieldname:"cb_1",fieldtype:"Column Break"},{label:"Chart Color",fieldname:"color",fieldtype:"Color",depends_on:'eval: doc.new_or_existing == "New Chart"'}],primary_action_label:__("Add"),primary_action:s=>{let a=s;a.new_or_existing=="New Chart"?(a.chart_name=a.label,a.chart_type=a.chart_type=="Time Series"?a.chart_function:a.chart_type,a.document_type=this.doctype,a.filters_json="[]",frappe.xcall("frappe.desk.doctype.dashboard_chart.dashboard_chart.create_dashboard_chart",{args:a}).then(l=>{this.chart_group.new_widget.on_create({chart_name:l.chart_name,name:l.chart_name,label:a.label})})):this.chart_group.new_widget.on_create({chart_name:a.chart,label:a.chart,name:a.chart}),t.hide()}});t.show()}get_field_options(){let e=[{label:__("Created On"),value:"creation"},{label:__("Last Modified On"),value:"modified"}],t=[],s=[],a=[];return frappe.get_meta(this.doctype).fields.map(l=>{if(["Date","Datetime"].includes(l.fieldtype)&&e.push({label:l.label,value:l.fieldname}),frappe.model.numeric_fieldtypes.includes(l.fieldtype)){if(l.fieldtype=="Currency"&&(!l.options||l.options!=="Company:company:default_currency"))return;t.push({label:l.label,value:l.fieldname}),a.push({label:l.label,value:l.fieldname})}["Link","Select"].includes(l.fieldtype)&&s.push({label:l.label,value:l.fieldname})}),{date_fields:e,value_fields:t,group_by_fields:s,aggregate_function_fields:a}}remove_duplicates(e){return e.filter((t,s)=>e.indexOf(t)===s)}};frappe.provide("frappe.views");frappe.views.ImageView=class extends frappe.views.ListView{get view_name(){return"Image"}setup_defaults(){return super.setup_defaults().then(()=>{this.page_title=this.page_title+" "+__("Images")})}setup_view(){this.setup_columns(),this.setup_check_events(),this.setup_like()}set_fields(){this.fields=["name",...this.get_fields_in_list_view().map(e=>e.fieldname),this.meta.title_field,this.meta.image_field,"_liked_by"]}prepare_data(e){super.prepare_data(e),this.items=this.data.map(t=>(t._image_url=this.get_image_url(t),t))}render(){this.get_attached_images().then(()=>{this.render_image_view(),this.gallery?this.gallery.prepare_pswp_items(this.items,this.images_map):this.setup_gallery()})}render_image_view(){var e=this.items.map(this.item_html.bind(this)).join("");this.$page.find(".layout-main-section-wrapper").addClass("image-view"),this.$result.html(`
			<div class="image-view-container">
				${e}
			</div>
		`),this.render_count()}item_details_html(e){let t=this.get_fields_in_list_view().map(n=>n.fieldname)||[],s=this.meta.title_field||"name";t=t.filter(n=>n!==s);let a='<div><ul class="list-unstyled image-view-info">',l=!1;return t.forEach((n,o)=>{e[n]&&!l&&(o==0?a+=`<li>${__(e[n])}</li>`:a+=`<li class="text-muted">${__(e[n])}</li>`,l=!0)}),a+="</ul></div>",a}item_html(e){e._name=encodeURI(e.name);let t=e._name,s=strip_html(e[this.meta.title_field||"name"]),a=frappe.utils.escape_html(s),l=e._image_url?"":"no-image",n=e._image_url?`<img data-name="${t}" src="${e._image_url}" alt="${s}">`:`<span class="placeholder-text">
				${frappe.get_abbr(s)}
			</span>`,o=this.item_details_html(e),_=e._image_url?`<div class="zoom-view" data-name="${t}">
				${frappe.utils.icon("expand","xs")}
			</div>`:"";return`
			<div class="image-view-item ellipsis">
				<div class="image-view-header">
					<div>
						<input class="level-item list-row-checkbox hidden-xs"
							type="checkbox" data-name="${escape(e.name)}">
						${this.get_like_html(e)}
					</div>
				</span>
				</div>
				<div class="image-view-body ${l}">
					<a data-name="${t}"
						title="${t}"
						href="${this.get_form_link(e)}"
					>
						<div class="image-field"
							data-name="${t}"
						>
							${n}
						</div>
					</a>
					${_}
				</div>
				<div class="image-view-footer">
					<div class="image-title">
						<span class="ellipsis" title="${a}">
							<a class="ellipsis" href="${this.get_form_link(e)}"
								title="${a}" data-doctype="${this.doctype}" data-name="${e.name}">
								${s}
							</a>
						</span>
					</div>
					${o}
				</div>
			</div>
		`}get_attached_images(){return frappe.call({method:"frappe.core.api.file.get_attached_images",args:{doctype:this.doctype,names:this.items.map(e=>e.name)}}).then(e=>{this.images_map=Object.assign(this.images_map||{},e.message)})}get_header_html(){}setup_gallery(){var e=this;this.gallery=new frappe.views.GalleryView({doctype:this.doctype,items:this.items,wrapper:this.$result,images_map:this.images_map}),this.$result.on("click",".zoom-view",function(t){t.preventDefault(),t.stopPropagation();var s=$(this).data().name;return s=decodeURIComponent(s),e.gallery.show(s),!1})}};frappe.views.GalleryView=class{constructor(e){$.extend(this,e);var t=this;this.lib_ready=this.load_lib(),this.lib_ready.then(function(){t.prepare()})}prepare(){if(this.pswp_root=$("body > .pswp"),this.pswp_root.length===0){var e=frappe.render_template("photoswipe_dom");this.pswp_root=$(e).appendTo("body")}}prepare_pswp_items(e,t){var s=this;return e&&(this.items=this.items.concat(e),this.images_map=t),new Promise(a=>{let l=this.items.map(function(n){let o='img[data-name="'+n._name+'"]',_=s.wrapper.find(o).get(0),p,d;return _&&(p=_.naturalWidth,d=_.naturalHeight),_||(_=s.wrapper.find('.image-field[data-name="'+n._name+'"]').get(0),p=_.getBoundingClientRect().width,d=_.getBoundingClientRect().height),{src:n._image_url,msrc:n._image_url,name:n.name,w:p,h:d,el:_}});this.pswp_items=l,a()})}show(e){this.lib_ready.then(()=>this.prepare_pswp_items()).then(()=>this._show(e))}_show(e){let t=this,s=this.pswp_items;var l={index:s.findIndex(n=>n.name===e),getThumbBoundsFn:function(n){let o='img[data-name="'+s[n]._name+'"]',_=t.wrapper.find(o).get(0);if(!!_){var p=window.pageYOffset||document.documentElement.scrollTop,d=_.getBoundingClientRect();return{x:d.left,y:d.top+p,w:d.width}}},history:!1,shareEl:!1,showHideOpacity:!0};this.pswp=new PhotoSwipe(this.pswp_root.get(0),PhotoSwipeUI_Default,s,l),this.browse_images(),this.pswp.init()}browse_images(){let e=this.pswp_root.find(".pswp__more-items"),t=this.images_map,s=null;this.pswp.listen("afterChange",function(){let _=t[this.currItem.name];if(!_||_.length===1){e.html("");return}a();let p=_.map(o).join("");e.html(p)}),this.pswp.listen("beforeChange",n),this.pswp.listen("initialZoomOut",n),this.pswp.listen("destroy",()=>{$(document).off("mousemove",a)}),e.on("click",".pswp__more-item",_=>{let p=_.target,d=this.pswp.items.findIndex(c=>c.name===this.pswp.currItem.name);this.pswp.goTo(d),this.pswp.items.splice(d,1,{src:p.src,w:p.naturalWidth,h:p.naturalHeight,name:this.pswp.currItem.name}),this.pswp.invalidateCurrItems(),this.pswp.updateSize(!0)}),$(document).on("mousemove",a);function a(){clearTimeout(s),l(),s=setTimeout(n,2e3)}function l(){e.show()}function n(){e.hide()}function o(_){return`<div class="pswp__more-item">
				<img src="${_}">
			</div>`}}load_lib(){return new Promise(e=>{var t="assets/frappe/js/lib/photoswipe/";frappe.require([t+"photoswipe.css",t+"default-skin.css",t+"photoswipe.js",t+"photoswipe-ui-default.js"],e)})}};frappe.provide("frappe.utils");frappe.provide("frappe.views");frappe.views.MapView=class extends frappe.views.ListView{get view_name(){return"Map"}setup_defaults(){super.setup_defaults(),this.page_title=__("{0} Map",[this.page_title])}setup_view(){}on_filter_change(){this.get_coords()}render(){this.get_coords().then(()=>{this.render_map_view()}),this.$paging_area.find(".level-left").append("<div></div>")}render_map_view(){if(this.map_id=frappe.dom.get_unique_id(),this.$result.html(`<div id="${this.map_id}" class="map-view-container"></div>`),L.Icon.Default.imagePath=frappe.utils.map_defaults.image_path,this.map=L.map(this.map_id).setView(frappe.utils.map_defaults.center,frappe.utils.map_defaults.zoom),L.tileLayer(frappe.utils.map_defaults.tiles,frappe.utils.map_defaults.options).addTo(this.map),L.control.scale().addTo(this.map),this.coords.features&&this.coords.features.length){this.coords.features.forEach(t=>L.geoJSON(t).bindPopup(t.properties.name).addTo(this.map));let e=this.coords.features[0].geometry.coordinates.reverse();this.map.panTo(e,8)}}get_coords(){let e=this.settings&&this.settings.get_coords_method||"frappe.geo.utils.get_coords";return cur_list.meta.fields.find(t=>t.fieldname==="location"&&t.fieldtype==="Geolocation")?this.type="location_field":cur_list.meta.fields.find(t=>t.fieldname==="latitude")&&cur_list.meta.fields.find(t=>t.fieldname==="longitude")&&(this.type="coordinates"),frappe.call({method:e,args:{doctype:this.doctype,filters:cur_list.filter_area.get(),type:this.type}}).then(t=>{this.coords=t.message})}get required_libs(){return["assets/frappe/js/lib/leaflet/leaflet.css","assets/frappe/js/lib/leaflet/leaflet.js"]}};var C=class{constructor({kanbanview:e,doctype:t,meta:s,settings:a}){t||frappe.throw(__("DocType required")),this.kanbanview=e,this.doctype=t,this.meta=s,this.settings=a,this.dialog=null,this.fields=this.settings&&this.settings.fields,frappe.model.with_doctype("List View Settings",()=>{this.make(),this.get_fields(),this.setup_fields(),this.setup_remove_fields(),this.add_new_fields(),this.show_dialog()})}make(){this.dialog=new frappe.ui.Dialog({title:__("{0} Settings",[__(this.doctype)]),fields:[{fieldname:"show_labels",label:__("Show Labels"),fieldtype:"Check"},{fieldname:"fields_html",fieldtype:"HTML"},{fieldname:"fields",fieldtype:"Code",hidden:1}]}),this.dialog.set_values(this.settings),this.dialog.set_primary_action(__("Save"),()=>{frappe.show_alert({message:__("Saving"),indicator:"green"}),frappe.call({method:"frappe.desk.doctype.kanban_board.kanban_board.save_settings",args:{board_name:this.settings.name,settings:this.dialog.get_values()},callback:e=>{this.kanbanview.board=e.message,this.kanbanview.render(),this.dialog.hide()}})})}refresh(){this.setup_fields(),this.add_new_fields(),this.setup_remove_fields()}show_dialog(){this.settings.fields||this.update_fields(),this.dialog.show()}setup_fields(){let e=this.dialog.get_field("fields_html"),t=e.$wrapper[0],s="";for(let a of this.fields){let l=this.get_docfield(a);s+=`
				<div class="control-input flex align-center form-control fields_order sortable"
					style="display: block; margin-bottom: 5px;"
					data-fieldname="${l.fieldname}"
					data-label="${l.label}"
					data-type="${l.type}">

					<div class="row">
						<div class="col-md-1">
							${frappe.utils.icon("drag","xs","","","sortable-handle")}
						</div>
						<div class="col-md-10" style="padding-left:0px;">
							${__(l.label)}
						</div>
						<div class="col-md-1">
							<a class="text-muted remove-field" data-fieldname="${l.fieldname}">
								${frappe.utils.icon("delete","xs")}
							</a>
						</div>
					</div>
				</div>`}e.html(`
			<div class="form-group">
				<div class="clearfix">
					<label class="control-label" style="padding-right: 0px;">${__("Fields")}</label>
				</div>
				<div class="control-input-wrapper">
				${s}
				</div>
				<p class="help-box small text-muted">
					<a class="add-new-fields text-muted">
						${__("+ Add / Remove Fields")}
					</a>
				</p>
			</div>
		`),new Sortable(t.getElementsByClassName("control-input-wrapper")[0],{handle:".sortable-handle",draggable:".sortable",onUpdate:a=>{this.fields.splice(a.newIndex,0,this.fields.splice(a.oldIndex,1)[0]),this.dialog.set_value("fields",JSON.stringify(this.fields)),this.refresh()}})}add_new_fields(){let e=this.get_dialog_fields_wrapper().getElementsByClassName("add-new-fields")[0];e.onclick=()=>this.show_column_selector()}setup_remove_fields(){let e=this.get_dialog_fields_wrapper().getElementsByClassName("remove-field");for(let t=0;t<e.length;t++)e.item(t).onclick=()=>this.remove_fields(e.item(t).getAttribute("data-fieldname"))}get_dialog_fields_wrapper(){return this.dialog.get_field("fields_html").$wrapper[0]}remove_fields(e){this.fields=this.fields.filter(t=>t!==e),this.dialog.set_value("fields",JSON.stringify(this.fields)),this.refresh()}update_fields(){let t=this.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("fields_order");this.fields=[];for(let s=0;s<t.length;s++)this.fields.push(t.item(s).getAttribute("data-fieldname"));this.dialog.set_value("fields",JSON.stringify(this.fields))}show_column_selector(){let e=new frappe.ui.Dialog({title:__("{0} Fields",[__(this.doctype)]),fields:[{label:__("Select Fields"),fieldtype:"MultiCheck",fieldname:"fields",options:this.get_multiselect_fields(),columns:2}]});e.set_primary_action(__("Save"),()=>{this.fields=e.get_values().fields||[],this.dialog.set_value("fields",JSON.stringify(this.fields)),this.refresh(),e.hide()}),e.show()}get_fields(){this.fields=this.settings.fields,this.fields.uniqBy(e=>e.fieldname)}get_docfield(e){return frappe.meta.get_docfield(this.doctype,e)||frappe.model.get_std_field(e)}get_multiselect_fields(){let e=["idx","lft","rgt","old_parent","_user_tags","_liked_by","_comments","_assign",this.meta.title_field||"name"],t=["Attach Image","Text Editor","HTML Editor","Code","Color",...frappe.model.no_value_type];return frappe.model.std_fields.concat(this.kanbanview.get_fields_in_list_view()).filter(s=>!e.includes(s.fieldname)&&!t.includes(s.fieldtype)).map(s=>({label:__(s.label),value:s.fieldname,checked:this.fields.includes(s.fieldname)}))}};frappe.provide("frappe.views");frappe.views.KanbanView=class extends frappe.views.ListView{static load_last_view(){let e=frappe.get_route();if(e.length===3){let t=e[1],s=frappe.get_user_settings(t).Kanban||{};return s.last_kanban_board?(e.push(s.last_kanban_board),frappe.set_route(e),!0):new frappe.views.KanbanView({doctype:t})}return!1}get view_name(){return"Kanban"}show(){frappe.views.KanbanView.get_kanbans(this.doctype).then(e=>e.length?e.length&&frappe.get_route().length!==4?frappe.views.KanbanView.show_kanban_dialog(this.doctype,!0):(this.kanbans=e,frappe.run_serially([()=>this.show_skeleton(),()=>this.fetch_meta(),()=>this.hide_skeleton(),()=>this.check_permissions(),()=>this.init(),()=>this.before_refresh(),()=>this.refresh()])):frappe.views.KanbanView.show_kanban_dialog(this.doctype,!0))}init(){return super.init().then(()=>{this.page.menu.find(".dropdown-item").length===1&&this.page.hide_menu()})}setup_defaults(){return super.setup_defaults().then(()=>{let e=()=>this.kanbans.length&&this.kanbans[0].name;return this.board_name=frappe.get_route()[3]||e()||null,this.page_title=__(this.board_name),this.card_meta=this.get_card_meta(),this.page_length=0,frappe.run_serially([()=>this.set_board_perms_and_push_menu_items(),()=>this.get_board()])})}set_board_perms_and_push_menu_items(){return frappe.call({method:"frappe.client.get_doc_permissions",args:{doctype:"Kanban Board",docname:this.board_name},callback:e=>{this.board_perms=e.message.permissions||{},this.push_menu_items()}})}push_menu_items(){this.board_perms.write&&this.menu_items.push({label:__("Save filters"),action:()=>{this.save_kanban_board_filters()}}),this.board_perms.delete&&this.menu_items.push({label:__("Delete Kanban Board"),action:()=>{frappe.confirm(__("Are you sure you want to proceed?"),()=>{frappe.db.delete_doc("Kanban Board",this.board_name).then(()=>{frappe.show_alert(`Kanban Board ${this.board_name} deleted.`),frappe.set_route("List",this.doctype,"List")})})}})}setup_paging_area(){}toggle_result_area(){this.$result.toggle(this.data.length>0)}get_board(){return frappe.db.get_doc("Kanban Board",this.board_name).then(e=>{this.board=e,this.board.filters_array=JSON.parse(this.board.filters||"[]"),this.board.fields=JSON.parse(this.board.fields||"[]"),this.filters=this.board.filters_array})}setup_page(){this.hide_sidebar=!0,this.hide_page_form=!0,this.hide_card_layout=!0,this.hide_sort_selector=!0,super.setup_page()}setup_view(){this.board.columns.length>5&&this.page.container.addClass("full-width"),this.setup_realtime_updates(),this.setup_like()}set_fields(){super.set_fields(),this._add_field(this.card_meta.title_field)}before_render(){frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.save_view_user_settings({last_kanban_board:this.board_name})}render_list(){}on_filter_change(){!this.board_perms.write||(JSON.stringify(this.board.filters_array)!==JSON.stringify(this.filter_area.get())?this.page.set_indicator(__("Not Saved"),"orange"):this.page.clear_indicator())}save_kanban_board_filters(){let e=this.filter_area.get();frappe.db.set_value("Kanban Board",this.board_name,"filters",e).then(t=>{if(t.exc){frappe.show_alert({indicator:"red",message:__("There was an error saving filters")});return}frappe.show_alert({indicator:"green",message:__("Filters saved")}),this.board.filters_array=e,this.on_filter_change()})}get_fields(){return this.fields.push([this.board.field_name,this.board.reference_doctype]),super.get_fields()}render(){let e=this.board_name;this.kanban?e===this.kanban.board_name&&this.kanban.update(this.data):this.kanban=new frappe.views.KanbanBoard({doctype:this.doctype,board:this.board,board_name:e,cards:this.data,card_meta:this.card_meta,wrapper:this.$result,cur_list:this,user_settings:this.view_user_settings})}get_card_meta(){var e=frappe.get_meta(this.doctype);let t=N({},frappe.route_options);var s=frappe.model.get_new_doc(this.doctype);frappe.route_options=t;var a=null,l=!1;this.meta.title_field&&(a=frappe.meta.get_field(this.doctype,this.meta.title_field)),this.meta.fields.forEach(o=>{["Data","Text","Small Text","Text Editor"].includes(o.fieldtype)&&!o.hidden&&!a&&(a=o)});var n=e.fields.filter(o=>o.reqd&&!s[o.fieldname]);return(n.some(o=>frappe.model.table_fields.includes(o.fieldtype))||n.length>1)&&(l=!0),a||(a=frappe.meta.get_field(this.doctype,"name")),{quick_entry:l,title_field:a}}get_view_settings(){return{label:__("Kanban Settings",null,"Button in kanban view menu"),action:()=>this.show_kanban_settings(),standard:!0}}show_kanban_settings(){frappe.model.with_doctype(this.doctype,()=>{new C({kanbanview:this,doctype:this.doctype,settings:this.board,meta:frappe.get_meta(this.doctype)})})}get required_libs(){return"kanban_board.bundle.js"}};frappe.views.KanbanView.get_kanbans=function(r){let e=[];return t().then(s=>(s&&s.forEach(a=>{let l=`/app/${frappe.router.slug(a.reference_doctype)}/view/kanban/${a.name}`;e.push({name:a.name,route:l})}),e));function t(){return frappe.call("frappe.desk.doctype.kanban_board.kanban_board.get_kanban_boards",{doctype:r}).then(s=>s.message)}};frappe.views.KanbanView.show_kanban_dialog=function(r){let e=s();e.show();function t(l,n,o){return frappe.call({method:"frappe.desk.doctype.kanban_board.kanban_board.quick_kanban_board",args:{doctype:r,board_name:l,field_name:n,project:o},callback:function(_){var p=_.message;p.filters&&(frappe.provide("frappe.kanban_filters"),frappe.kanban_filters[p.kanban_board_name]=p.filters),frappe.set_route("List",r,"Kanban",p.kanban_board_name)}})}function s(){let l=frappe.get_meta(r).fields.filter(c=>c.fieldtype==="Select"&&c.fieldname!=="kanban_column"),n=a(l),o=l.length>0,_=o?__("Save"):__("Customize Form"),p=o?__("New Kanban Board"):__("No Select Field Found"),d=()=>{if(o){let c=e.get_values();t(c.board_name,c.field_name,c.project).then(()=>e.hide(),h=>frappe.msgprint(h))}else frappe.set_route("Form","Customize Form",{doc_type:r})};return new frappe.ui.Dialog({title:p,fields:n,primary_action_label:_,primary_action:d})}function a(l){if(!l.length)return[{fieldtype:"HTML",options:`
					<div>
						<p class="text-medium">
						${__('No fields found that can be used as a Kanban Column. Use the Customize Form to add a Custom Field of type "Select".')}
						</p>
					</div>
				`}];let n=[{fieldtype:"Data",fieldname:"board_name",label:__("Kanban Board Name"),reqd:1,description:["Note","ToDo"].includes(r)?__("This Kanban Board will be private"):""},{fieldtype:"Select",fieldname:"field_name",label:__("Columns based on"),options:l.map(o=>({label:o.label,value:o.fieldname})),default:l[0],reqd:1}];return r==="Task"&&n.push({fieldtype:"Link",fieldname:"project",label:__("Project"),options:"Project"}),n}};frappe.provide("frappe.views");frappe.views.InboxView=class extends frappe.views.ListView{static load_last_view(){let e=frappe.get_route();if(!e[3]&&frappe.boot.email_accounts.length){let s;return frappe.boot.email_accounts[0].email_id=="All Accounts"?s="All Accounts":s=frappe.boot.email_accounts[0].email_account,frappe.set_route("List","Communication","Inbox",s),!0}else(!e[3]||e[3]!=="All Accounts"&&!t(e[3]))&&frappe.throw(__("No email account associated with the User. Please add an account under User > Email Inbox."));return!1;function t(s){return frappe.boot.email_accounts.find(a=>a.email_account===s)}}get view_name(){return"Inbox"}show(){super.show(),this.save_view_user_settings({last_email_account:this.current_email_account})}setup_defaults(){super.setup_defaults(),this.sort_by=this.view_user_settings.sort_by||"communication_date",this.sort_order=this.view_user_settings.sort_order||"desc",this.email_account=frappe.get_route()[3],this.page_title=this.email_account,this.filters=this.get_inbox_filters()}setup_columns(){this.columns=[],this.columns.push({type:"Subject",df:{label:__("Subject"),fieldname:"subject"}}),this.columns.push({type:"Field",df:{label:this.is_sent_emails?__("To"):__("From"),fieldname:this.is_sent_emails?"recipients":"sender"}})}get_seen_class(e){return Boolean(e.seen)||JSON.parse(e._seen||"[]").includes(frappe.session.user)?"":"bold"}get is_sent_emails(){let e=this.filter_area.get().find(t=>t[1]==="sent_or_received");return e&&e[3]==="Sent"}render_header(){this.$result.find(".list-row-head").remove(),this.$result.prepend(this.get_header_html())}render(){this.setup_columns(),this.render_header(),this.render_list(),this.on_row_checked(),this.render_count()}get_meta_html(e){let t=e.has_attachment?`<span class="fa fa-paperclip fa-large" title="${__("Has Attachments")}"></span>`:"",s="";e.reference_doctype&&e.reference_doctype!==this.doctype&&(s=`<a class="text-muted grey"
				href="${frappe.utils.get_form_link(e.reference_doctype,e.reference_name)}"
				title="${__("Linked with {0}",[e.reference_doctype])}">
				<i class="fa fa-link fa-large"></i>
			</a>`);let a=comment_when(e.communication_date,!0),l=e.status=="Closed"?`<span class="fa fa-check fa-large" title="${__(e.status)}"></span>`:e.status=="Replied"?`<span class="fa fa-mail-reply fa-large" title="${__(e.status)}"></span>`:"";return`
			<div class="level-item list-row-activity">
				${s}
				${t}
				${l}
				${a}
			</div>
		`}get_inbox_filters(){var e=this.email_account,t=[["Communication","communication_type","=","Communication",!0],["Communication","communication_medium","=","Email",!0]],s=[];if(e==="Sent")s=t.concat([["Communication","sent_or_received","=","Sent",!0],["Communication","email_status","not in","Spam,Trash",!0]]);else if(["Spam","Trash"].includes(e))s=t.concat([["Communication","email_status","=",e,!0],["Communication","email_account","in",frappe.boot.all_accounts,!0]]);else{var a="=";e=="All Accounts"&&(a="in",e=frappe.boot.all_accounts),s=t.concat([["Communication","sent_or_received","=","Received",!0],["Communication","status","=","Open",!0],["Communication","email_account",a,e,!0],["Communication","email_status","not in","Spam,Trash",!0]])}return s}get_no_result_message(){var e=this.email_account,t;return["Spam","Trash"].includes(e)?__("No {0} mail",[e]):(!e&&!frappe.boot.email_accounts.length?t={doctype:"Email Account",msg:__("No Email Account"),label:__("New Email Account")}:t={doctype:"Communication",msg:__("No Emails"),label:__("Compose Email")},`
			<div class="msg-box no-border">
				${frappe.model.can_create(t.doctype)?`<p>${t.msg}</p>
			<p>
				<button class="btn btn-primary btn-sm btn-new-doc">
					${t.label}
				</button>
			</p>
			`:`<p>${__("No Email Accounts Assigned")}</p>`}
			</div>
		`)}make_new_doc(){!this.email_account&&!frappe.boot.email_accounts.length?(frappe.route_options={email_id:frappe.session.user_email},frappe.new_doc("Email Account")):new frappe.views.CommunicationComposer}};frappe.provide("frappe.views");frappe.views.FileView=class extends frappe.views.ListView{static load_last_view(){if(frappe.get_route().length===2){let t=frappe.get_user_settings("File","File");return frappe.set_route("List","File",t.last_folder||frappe.boot.home_folder),!0}return A()}get view_name(){return"File"}show(){A()||super.show()}setup_view(){this.render_header(),this.setup_events(),this.$page.find(".layout-main-section-wrapper").addClass("file-view"),this.add_file_action_buttons(),this.page.add_button(__("Toggle Grid View"),()=>{frappe.views.FileView.grid_view=!frappe.views.FileView.grid_view,this.refresh()})}setup_no_result_area(){this.$no_result=$(`<div class="no-result">
			<div class="breadcrumbs">${this.get_breadcrumbs_html()}</div>
			<div class="text-muted flex justify-center align-center">
				${this.get_no_result_message()}
			</div>
		</div>`).hide(),this.$frappe_list.append(this.$no_result)}get_args(){let e=super.get_args();return frappe.views.FileView.grid_view&&Object.assign(e,{order_by:`is_folder desc, ${this.sort_by} ${this.sort_order}`}),e}set_breadcrumbs(){let e=frappe.get_route();e.splice(-1),e[e.length-1]!=="File"&&frappe.breadcrumbs.add({type:"Custom",label:__("Home"),route:"/app/List/File/Home"})}setup_defaults(){return super.setup_defaults().then(()=>{this.page_title=__("File Manager");let e=frappe.get_route();this.current_folder=e.slice(2).join("/")||"Home",this.filters=[["File","folder","=",this.current_folder,!0]],this.order_by=this.view_user_settings.order_by||"file_name asc",this.menu_items=this.menu_items.concat(this.file_menu_items())})}file_menu_items(){return[{label:__("Home"),action:()=>{frappe.set_route("List","File","Home")}},{label:__("New Folder"),action:()=>{frappe.prompt(__("Name"),e=>{e.value.indexOf("/")>-1&&frappe.throw(__("Folder name should not include '/' (slash)"));let t={file_name:e.value,folder:this.current_folder};frappe.call({method:"frappe.core.api.file.create_new_folder",args:t})},__("Enter folder name"),__("Create"))}},{label:__("Import Zip"),action:()=>{new frappe.ui.FileUploader({folder:this.current_folder,restrictions:{allowed_file_types:[".zip"]},on_success:e=>{frappe.show_alert(__("Unzipping files...")),frappe.call("frappe.core.api.file.unzip_file",{name:e.name}).then(t=>{t.message&&frappe.show_alert(__("Unzipped {0} files",[t.message]))})}})}}]}add_file_action_buttons(){this.$cut_button=this.page.add_button(__("Cut"),()=>{frappe.file_manager.cut(this.get_checked_items(),this.current_folder),this.$checks.parents(".file-wrapper").addClass("cut")}).hide(),this.$paste_btn=this.page.add_button(__("Paste"),()=>frappe.file_manager.paste(this.current_folder)).hide(),this.page.add_actions_menu_item(__("Export as zip"),()=>{let e=this.get_checked_items(!0);e.length&&open_url_post("/api/method/frappe.core.api.file.zip_files",{files:JSON.stringify(e)})})}set_fields(){this.fields=this.meta.fields.filter(e=>frappe.model.is_value_type(e.fieldtype)&&!e.hidden).map(e=>e.fieldname).concat(["name","modified","creation"])}prepare_data(e){super.prepare_data(e),this.data=this.data.map(s=>this.prepare_datum(s));let{sort_by:t}=this.sort_selector;t==="file_name"&&this.data.sort((s,a)=>s.is_folder&&!a.is_folder?-1:!s.is_folder&&a.is_folder?1:0)}prepare_datum(e){let t="",s="";e.is_folder?(t="folder-normal",s="folder"):frappe.utils.is_image_file(e.file_name)?(t="image",s="image"):(t="file",s="file");let a=e.file_name||e.file_url;return a=a.slice(0,60),e._title=a,e.icon_class=t,e._type=s,e.subject_html=`
			${frappe.utils.icon(t)}
			<span>${a}</span>
			${e.is_private?'<i class="fa fa-lock fa-fw text-warning"></i>':""}
		`,e}before_render(){super.before_render(),frappe.model.user_settings.save("File","grid_view",frappe.views.FileView.grid_view),this.save_view_user_settings({last_folder:this.current_folder})}render(){this.$result.empty().removeClass("file-grid-view"),frappe.views.FileView.grid_view?this.render_grid_view():(super.render(),this.render_header())}after_render(){}render_list(){frappe.views.FileView.grid_view?this.render_grid_view():super.render_list()}render_grid_view(){let e=this.data.map(t=>{let s=t.icon_class+"-large",a=t._type=="image"?`<div class="file-image"><img src="${t.file_url}" alt="${t.file_name}"></div>`:frappe.utils.icon(s,{width:"40px",height:"45px"}),l=escape(t.name),n=t.type!="Folder";return`
				<a href="${this.get_route_url(t)}"
					draggable="${n}" class="file-wrapper ellipsis" data-name="${l}">
					<div class="file-header">
						<input class="level-item list-row-checkbox hidden-xs" type="checkbox" data-name="${l}">
					</div>
					<div class="file-body">
						${a}
					</div>
					<div class="file-footer">
						<div class="file-title ellipsis">${t._title}</div>
						<div class="file-creation">${this.get_creation_date(t)}</div>
					</div>
				</a>
			`}).join("");this.$result.addClass("file-grid-view"),this.$result.empty().html(`<div class="file-grid">
				${e}
			</div>`)}get_breadcrumbs_html(){let t=frappe.get_route().slice(2);return t.map((s,a)=>a===t.length-1?`<span>${s}</span>`:`<a href="${t.reduce((n,o,_)=>(_<=a&&(n+="/"+o),n),"/app/file/view")}">${s}</a>`).join("&nbsp;/&nbsp;")}get_header_html(){let e=this.get_breadcrumbs_html(),t=frappe.views.FileView.grid_view?"":`<input class="level-item list-check-all hidden-xs" type="checkbox" title="${__("Select All")}">`,s=frappe.views.FileView.grid_view?"":`<div class="list-row-col ellipsis hidden-xs">
					<span>${__("Size")}</span>
				</div>
				<div class="list-row-col ellipsis hidden-xs">
					<span>${__("Type")}</span>
				</div>
				<div class="list-row-col ellipsis hidden-xs">
					<span>${__("Created")}</span>
				</div>`,a=`
			<div class="list-row-col list-subject level">
				${t}
				<span class="level-item">${e}</span>
			</div>
			${s}
		`;return this.get_header_html_skeleton(a,'<span class="list-count"></span>')}get_route_url(e){return e.is_folder?"/app/List/File/"+e.name:this.get_form_link(e)}get_creation_date(e){let[t]=e.creation.split(" "),s;return t===frappe.datetime.now_date()?s=comment_when(e.creation):s=frappe.datetime.str_to_user(t),s}get_left_html(e){e=this.prepare_datum(e);let t=e.file_size?frappe.form.formatters.FileSize(e.file_size):"",s=this.get_route_url(e);return`
			<div class="list-row-col ellipsis list-subject level">
				<span class="level-item file-select">
					<input class="list-row-checkbox"
						type="checkbox" data-name="${e.name}">
				</span>
				<span class="level-item  ellipsis" title="${frappe.utils.escape_html(e.file_name)}">
					<a class="ellipsis" href="${s}" title="${frappe.utils.escape_html(e.file_name)}">
						${e.subject_html}
					</a>
				</span>
			</div>
			<div class="list-row-col ellipsis hidden-xs text-muted">
				<span>${t}</span>
			</div>
			<div class="list-row-col ellipsis hidden-xs text-muted">
				<span>${e.file_type||""}</span>
			</div>
			<div class="list-row-col ellipsis hidden-xs text-muted">
				<span>${this.get_creation_date(e)}</span>
			</div>
		`}get_right_html(e){return`
			<div class="level-item list-row-activity">
				${comment_when(e.modified)}
			</div>
		`}setup_events(){super.setup_events(),this.setup_drag_events()}setup_drag_events(){this.$result.on("dragstart",".files .file-wrapper",e=>{e.stopPropagation(),e.originalEvent.dataTransfer.setData("Text",$(e.currentTarget).attr("data-name")),e.target.style.opacity="0.4",frappe.file_manager.cut([{name:$(e.currentTarget).attr("data-name")}],this.current_folder)}),this.$result.on("dragover",e=>{e.preventDefault()},!1),this.$result.on("dragend",".files .file-wrapper",e=>{e.preventDefault(),e.stopPropagation(),e.target.style.opacity="1"}),this.$result.on("drop",e=>{e.stopPropagation(),e.preventDefault();let t=$(e.target).parents(".file-wrapper"),s=e.originalEvent.dataTransfer;if(!!s){if(s.files&&s.files.length>0)new frappe.ui.FileUploader({files:s.files,folder:this.current_folder});else if(s.getData("Text")&&t.parents(".folders").length!==0){let a=s.getData("Text"),l=decodeURIComponent(t.attr("data-name"));frappe.file_manager.paste(l),frappe.show_alert(`File ${a} moved to ${l}`)}}})}toggle_result_area(){super.toggle_result_area(),this.toggle_cut_paste_buttons()}on_row_checked(){super.on_row_checked(),this.toggle_cut_paste_buttons()}toggle_cut_paste_buttons(){let e=!frappe.file_manager.can_paste||frappe.file_manager.old_folder===this.current_folder,t=!(this.$checks&&this.$checks.length>0);this.$paste_btn.toggle(!e),this.$cut_button.toggle(!t)}};frappe.views.FileView.grid_view=frappe.get_user_settings("File").grid_view||!1;function A(){return frappe.get_route()[2]==="List"?(frappe.set_route("List","File","Home"),!0):!1}var Xe=K(F());frappe.provide("frappe.views");frappe.provide("frappe.interaction_settings");frappe.views.InteractionComposer=class{constructor(e){$.extend(this,e),this.make()}make(){let e=this;e.dialog=new frappe.ui.Dialog({title:e.title||e.subject||__("New Activity"),no_submit_on_enter:!0,fields:e.get_fields(),primary_action_label:__("Create"),primary_action:function(){e.create_action()}}),$(document).on("upload_complete",function(t,s){if(e.dialog.display){let a=$(e.dialog.fields_dict.select_attachments.wrapper),l=a.find("[data-file-name]:checked").map(function(){return $(this).attr("data-file-name")});e.render_attach(),l.push(s.name),$.each(l,function(n,o){a.find('[data-file-name="'+o+'"]').prop("checked",!0)})}}),e.prepare(),e.dialog.show()}get_fields(){let e=this,t=Object.keys(D());return[{label:__("Reference"),fieldtype:"Select",fieldname:"interaction_type",options:t,reqd:1,onchange:()=>{let s=e.get_values();e.get_fields().forEach(a=>{a.fieldname!="interaction_type"&&(e.dialog.set_df_property(a.fieldname,"reqd",0),e.dialog.set_df_property(a.fieldname,"hidden",0))}),e.set_reqd_hidden_fields(s),e.get_event_categories()}},{label:__("Category"),fieldtype:"Select",fieldname:"category",options:"",hidden:1},{label:__("Public"),fieldtype:"Check",fieldname:"public",default:"0"},{fieldtype:"Column Break"},{label:__("Date"),fieldtype:"Datetime",fieldname:"due_date"},{label:__("Assigned To"),fieldtype:"Link",fieldname:"assigned_to",options:"User"},{fieldtype:"Section Break"},{label:__("Summary"),fieldtype:"Data",fieldname:"summary"},{fieldtype:"Section Break"},{fieldtype:"Text Editor",fieldname:"description"},{fieldtype:"Section Break"},{label:__("Select Attachments"),fieldtype:"HTML",fieldname:"select_attachments"}]}get_event_categories(){let e=this;frappe.model.with_doctype("Event",()=>{let t=frappe.meta.get_docfield("Event","event_category").options.split(`
`);e.dialog.get_input("category").empty().add_options(t)})}prepare(){this.setup_attach()}set_reqd_hidden_fields(e){let t=this;if(e&&"interaction_type"in e){let s=D();s[e.interaction_type].reqd_fields.forEach(a=>{t.dialog.set_df_property(a,"reqd",1)}),s[e.interaction_type].hidden_fields.forEach(a=>{t.dialog.set_df_property(a,"hidden",1)})}}setup_attach(){var e=this.dialog.fields_dict,t=$(e.select_attachments.wrapper);this.attachments||(this.attachments=[]);let s={folder:"Home/Attachments",on_success:a=>this.attachments.push(a)};this.frm&&(s={doctype:this.frm.doctype,docname:this.frm.docname,folder:"Home/Attachments",on_success:a=>{this.frm.attachments.attachment_uploaded(a),this.render_attach()}}),$("<h6 class='text-muted add-attachment' style='margin-top: 12px; cursor:pointer;'>"+__("Select Attachments")+"</h6><div class='attach-list'></div>			<p class='add-more-attachments'>			<a class='text-muted small'><i class='octicon octicon-plus' style='font-size: 12px'></i> "+__("Add Attachment")+"</a></p>").appendTo(t.empty()),t.find(".add-more-attachments a").on("click",()=>new frappe.ui.FileUploader(s)),this.render_attach()}render_attach(){let e=this.dialog.fields_dict,t=$(e.select_attachments.wrapper).find(".attach-list").empty(),s=[];this.attachments&&this.attachments.length&&(s=s.concat(this.attachments)),cur_frm&&(s=s.concat(cur_frm.get_files())),s.length&&$.each(s,function(a,l){!l.file_name||(l.file_url=frappe.urllib.get_full_url(l.file_url),$(repl('<p class="checkbox"><label><span><input type="checkbox" data-file-name="%(name)s"></input></span><span class="small">%(file_name)s</span> <a href="%(file_url)s" target="_blank" class="text-muted small"><i class="fa fa-share" style="vertical-align: middle; margin-left: 3px;"></i></label></p>',l)).appendTo(t))})}create_action(){let e=this,t=e.dialog.get_primary_btn(),s=this.get_values();if(!s)return;let a=$.map($(e.dialog.wrapper).find("[data-file-name]:checked"),function(l){return $(l).attr("data-file-name")});e.create_interaction(t,s,a)}get_values(){let e=this,t=this.dialog.get_values(!0);return t&&(t.reference_doctype=e.frm.doc.doctype,t.reference_document=e.frm.doc.name),t}create_interaction(e,t,s){let a=this;a.dialog.hide();let l=D(),n={};return Object.keys(t).forEach(o=>{n[l[t.interaction_type].field_map[o]]=t[o]}),"event_type"in n&&(n.event_type=t.public==1?"Public":"Private"),n.doctype=="Event"&&(n.event_participants=[{reference_doctype:t.reference_doctype,reference_docname:t.reference_document}]),"owner"in n||(n.owner=frappe.session.user),!("assigned_by"in n)&&n.doctype=="ToDo"&&(n.assigned_by=frappe.session.user),frappe.call({method:"frappe.client.insert",args:{doc:n},btn:e,callback:function(o){o.exc?frappe.msgprint(__("There were errors while creating the document. Please try again.")):(frappe.show_alert({message:__("{0} created successfully",[t.interaction_type]),indicator:"green"}),"assigned_to"in t&&a.assign_document(o.message,t.assigned_to),s&&a.add_attachments(o.message,s),cur_frm&&cur_frm.reload_doc())}})}assign_document(e,t){e.doctype!="ToDo"&&frappe.call({method:"frappe.desk.form.assign_to.add",args:{doctype:e.doctype,name:e.name,assign_to:JSON.stringify([t])},callback:function(s){if(s.exc){frappe.show_alert({message:__("The document could not be correctly assigned"),indicator:"orange"});return}else{frappe.show_alert({message:__("The document has been assigned to {0}",[t]),indicator:"green"});return}}})}add_attachments(e,t){frappe.call({method:"frappe.utils.file_manager.add_attachments",args:{doctype:e.doctype,name:e.name,attachments:JSON.stringify(t)},callback:function(s){if(s.exc){frappe.show_alert({message:__("The attachments could not be correctly linked to the new document"),indicator:"orange"});return}else return}})}};function D(){return{Event:{field_map:{interaction_type:"doctype",summary:"subject",description:"description",category:"event_category",due_date:"starts_on",public:"event_type"},reqd_fields:["summary","due_date"],hidden_fields:[]},ToDo:{field_map:{interaction_type:"doctype",description:"description",due_date:"date",reference_doctype:"reference_type",reference_document:"reference_name",assigned_to:"allocated_to"},reqd_fields:["description"],hidden_fields:["public","category"]}}}frappe.templates.image_view_item_row=`<div class="image-view-item has-checkbox ellipsis">
	<div class="image-view-header doclist-row">
		<div class="list-value">
		{{ subject }}
		</div>
	</div>
	<!-- Image -->
	<div class="image-view-body">
		<a  data-name="{{ data.name }}"
			title="{{ data.name }}"
			href="/app/Form/{{ data.doctype }}/{{ data.name }}"
		>
			<div class="image-field"
				data-name="{{ data.name }}"
				style="
				{% if (!data._image_url) { %}
					background-color: {{ color }};
				{% } %}
				border: 0px;"
			>
				{% if (!data._image_url) { %}
				<span class="placeholder-text">
					{%= frappe.get_abbr(data._title) %}
				</span>
				{% } %}
				{% if (data._image_url) { %}
				<img data-name="{{ data.name }}" src="{{ data._image_url }}" alt="{{data.title}}">
				{% } %}
				<button class="btn btn-default zoom-view" data-name="{{data.name}}">
					<i class="fa fa-search-plus"></i>
				</button>
			</div>
		</a>
	</div>
</div>
`;frappe.templates.photoswipe_dom=`

<!-- http://photoswipe.com/documentation/getting-started.html -->
<!-- Root element of PhotoSwipe. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

	<!-- Background of PhotoSwipe.
		 It's a separate element as animating opacity is faster than rgba(). -->
	<div class="pswp__bg"></div>

	<!-- Slides wrapper with overflow:hidden. -->
	<div class="pswp__scroll-wrap">

		<!-- Container that holds slides.
			PhotoSwipe keeps only 3 of them in the DOM to save memory.
			Don't modify these 3 pswp__item elements, data is added later on. -->
		<div class="pswp__container">
			<div class="pswp__item"></div>
			<div class="pswp__item"></div>
			<div class="pswp__item"></div>
		</div>

		<div class="pswp__more-items">

		</div>

		<!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
		<div class="pswp__ui pswp__ui--hidden">

			<div class="pswp__top-bar">

				<!--  Controls are self-explanatory. Order can be changed. -->

				<div class="pswp__counter"></div>

				<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

				<button class="pswp__button pswp__button--share" title="Share"></button>

				<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

				<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

				<!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
				<!-- element will get class pswp__preloader--active when preloader is running -->
				<div class="pswp__preloader">
					<div class="pswp__preloader__icn">
					  <div class="pswp__preloader__cut">
						<div class="pswp__preloader__donut"></div>
					  </div>
					</div>
				</div>
			</div>

			<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
				<div class="pswp__share-tooltip"></div>
			</div>

			<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
			</button>

			<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
			</button>

			<div class="pswp__caption">
				<div class="pswp__caption__center"></div>
			</div>

		</div>

	</div>

</div>`;frappe.templates.kanban_board=`<div class="kanban">
	<div class="kanban-column add-new-column">
		<div class="kanban-column-title compose-column">
			<a> + {{ __("Add Column") }}</a>
		</div>
		<form class="compose-column-form kanban-column-title">
			<input class="new-column-title" name="title" type="text" autocomplete="off">
		</form>
	</div>
	<div class="kanban-empty-state text-muted text-center" style="display: none;">
		{{ __("Loading...") }}
	</div>
</div>`;frappe.templates.kanban_column=`<div class="kanban-column" data-column-value="{{title}}">
	<div class="kanban-column-header">
		<span class="kanban-column-title">
			<span class="indicator-pill {{indicator}}"></span>
			<span class="kanban-title ellipsis" title="{{title}}">{{ __(title) }}</span>
		</span>
		<div class="column-options dropdown pull-right">
			<a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<svg class="icon icon-sm">
					<use href="#icon-dot-horizontal"></use>
				</svg>
			</a>
			<ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
				<li><a class="dropdown-item" data-action="archive">{{ __("Archive") }}</a></li>
			</ul>
		</div>
	</div>
	<div class="add-card">
		<div class="ellipsis">
			+ {{ __("Add {0}", [__(doctype)]) }}
		</div>
	</div>
	<div class="kanban-card new-card-area">
		<textarea name="title"></textarea>
	</div>
	<div class="kanban-cards">
	</div>
</div>`;frappe.templates.kanban_card=`<div class="kanban-card-wrapper {{ disable_click }}" data-name="{{encodeURIComponent(name)}}">
	<div class="kanban-card content">
		{% if(image_url) { %}
		<div class="kanban-image">
			<img  src="{{image_url}}" alt="{{title}}">
		</div>
		{% } %}
		<div class="kanban-card-body">
			<div class="kanban-title-area">
				<a href="{{ form_link }}">
					<div class="kanban-card-title ellipsis" title="{{title}}">
						{{ title }}
					</div>
				</a>
				<br>
				<div class="kanban-card-doc text-muted">
					{{ doc_content }}
				</div>
			</div>
			<div class="kanban-card-meta">
			</div>
		</div>
	</div>
</div>
`;})();
/* @preserve
for translation, don't remove
__("List View") __("Report View") __("Dashboard View") __("Gantt View"),
__("Kanban View") __("Calendar View") __("Image View") __("Inbox View"),
__("Tree View") __("Map View") */
//# sourceMappingURL=list.bundle.BQEJXJSX.js.map
