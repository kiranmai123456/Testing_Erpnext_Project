{
  "version": 3,
  "sources": ["../../../../../apps/frappe/frappe/public/js/frappe/dom.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/formatters.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/section.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/tab.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/column.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/layout.js", "../../../../../apps/frappe/frappe/public/js/frappe/ui/field_group.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/link_selector.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/multi_select_dialog.js", "../../../../../apps/frappe/frappe/public/js/frappe/ui/dialog.js"],
  "sourcesContent": ["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n// add a new dom element\nfrappe.provide(\"frappe.dom\");\n\nfrappe.dom = {\n\tid_count: 0,\n\tfreeze_count: 0,\n\tby_id: function (id) {\n\t\treturn document.getElementById(id);\n\t},\n\tget_unique_id: function () {\n\t\tconst id = \"unique-\" + frappe.dom.id_count;\n\t\tfrappe.dom.id_count++;\n\t\treturn id;\n\t},\n\tset_unique_id: function (ele) {\n\t\tvar $ele = $(ele);\n\t\tif ($ele.attr(\"id\")) {\n\t\t\treturn $ele.attr(\"id\");\n\t\t}\n\t\tvar id = \"unique-\" + frappe.dom.id_count;\n\t\t$ele.attr(\"id\", id);\n\t\tfrappe.dom.id_count++;\n\t\treturn id;\n\t},\n\teval: function (txt) {\n\t\tif (!txt) return;\n\t\tvar el = document.createElement(\"script\");\n\t\tel.appendChild(document.createTextNode(txt));\n\t\t// execute the script globally\n\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(el);\n\t},\n\tremove_script_and_style: function (txt) {\n\t\tconst evil_tags = [\"script\", \"style\", \"noscript\", \"title\", \"meta\", \"base\", \"head\"];\n\t\tconst parser = new DOMParser();\n\t\tconst doc = parser.parseFromString(txt, \"text/html\");\n\t\tconst body = doc.body;\n\t\tlet found = !!doc.head.innerHTML;\n\n\t\tfor (const tag of evil_tags) {\n\t\t\tfor (const element of body.getElementsByTagName(tag)) {\n\t\t\t\tfound = true;\n\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t}\n\t\t}\n\n\t\tfor (const element of body.getElementsByTagName(\"link\")) {\n\t\t\tconst relation = element.getAttribute(\"rel\");\n\t\t\tif (relation && relation.toLowerCase().trim() === \"stylesheet\") {\n\t\t\t\tfound = true;\n\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t}\n\t\t}\n\n\t\tif (found) {\n\t\t\treturn body.innerHTML;\n\t\t} else {\n\t\t\t// don't disturb\n\t\t\treturn txt;\n\t\t}\n\t},\n\tis_element_in_viewport: function (el, tolerance = 0) {\n\t\t//special bonus for those using jQuery\n\t\tif (typeof jQuery === \"function\" && el instanceof jQuery) {\n\t\t\tel = el[0];\n\t\t}\n\n\t\tvar rect = el.getBoundingClientRect();\n\n\t\treturn (\n\t\t\trect.top + tolerance >= 0 &&\n\t\t\trect.left + tolerance >= 0 &&\n\t\t\trect.bottom - tolerance <= $(window).height() &&\n\t\t\trect.right - tolerance <= $(window).width()\n\t\t);\n\t},\n\n\tis_element_in_modal(element) {\n\t\treturn Boolean($(element).parents(\".modal\").length);\n\t},\n\n\tset_style: function (txt, id) {\n\t\tif (!txt) return;\n\n\t\tvar se = document.createElement(\"style\");\n\t\tse.type = \"text/css\";\n\n\t\tif (id) {\n\t\t\tvar element = document.getElementById(id);\n\t\t\tif (element) {\n\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t}\n\t\t\tse.id = id;\n\t\t}\n\n\t\tif (se.styleSheet) {\n\t\t\tse.styleSheet.cssText = txt;\n\t\t} else {\n\t\t\tse.appendChild(document.createTextNode(txt));\n\t\t}\n\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(se);\n\t\treturn se;\n\t},\n\tadd: function (parent, newtag, className, cs, innerHTML, onclick) {\n\t\tif (parent && parent.substr) parent = frappe.dom.by_id(parent);\n\t\tvar c = document.createElement(newtag);\n\t\tif (parent) parent.appendChild(c);\n\n\t\t// if image, 3rd parameter is source\n\t\tif (className) {\n\t\t\tif (newtag.toLowerCase() == \"img\") c.src = className;\n\t\t\telse c.className = className;\n\t\t}\n\t\tif (cs) frappe.dom.css(c, cs);\n\t\tif (innerHTML) c.innerHTML = innerHTML;\n\t\tif (onclick) c.onclick = onclick;\n\t\treturn c;\n\t},\n\tcss: function (ele, s) {\n\t\tif (ele && s) {\n\t\t\t$.extend(ele.style, s);\n\t\t}\n\t\treturn ele;\n\t},\n\tactivate: function ($parent, $child, common_class, active_class = \"active\") {\n\t\t$parent.find(`.${common_class}.${active_class}`).removeClass(active_class);\n\t\t$child.addClass(active_class);\n\t},\n\tfreeze: function (msg, css_class) {\n\t\t// blur\n\t\tif (!$(\"#freeze\").length) {\n\t\t\tvar freeze = $('<div id=\"freeze\" class=\"modal-backdrop fade\"></div>')\n\t\t\t\t.on(\"click\", function () {\n\t\t\t\t\tif (cur_frm && cur_frm.cur_grid) {\n\t\t\t\t\t\tcur_frm.cur_grid.toggle_view();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.appendTo(\"#body\");\n\n\t\t\tfreeze.html(\n\t\t\t\trepl(\n\t\t\t\t\t'<div class=\"freeze-message-container\"><div class=\"freeze-message\"><p class=\"lead\">%(msg)s</p></div></div>',\n\t\t\t\t\t{ msg: msg || \"\" }\n\t\t\t\t)\n\t\t\t);\n\n\t\t\tsetTimeout(function () {\n\t\t\t\tfreeze.addClass(\"in\");\n\t\t\t}, 1);\n\t\t} else {\n\t\t\t$(\"#freeze\").addClass(\"in\");\n\t\t}\n\n\t\tif (css_class) {\n\t\t\t$(\"#freeze\").addClass(css_class);\n\t\t}\n\n\t\tfrappe.dom.freeze_count++;\n\t},\n\tunfreeze: function () {\n\t\tif (!frappe.dom.freeze_count) return; // anything open?\n\t\tfrappe.dom.freeze_count--;\n\t\tif (!frappe.dom.freeze_count) {\n\t\t\tvar freeze = $(\"#freeze\").removeClass(\"in\").remove();\n\t\t}\n\t},\n\tsave_selection: function () {\n\t\t// via http://stackoverflow.com/questions/5605401/insert-link-in-contenteditable-element\n\t\tif (window.getSelection) {\n\t\t\tvar sel = window.getSelection();\n\t\t\tif (sel.getRangeAt && sel.rangeCount) {\n\t\t\t\tvar ranges = [];\n\t\t\t\tfor (var i = 0, len = sel.rangeCount; i < len; ++i) {\n\t\t\t\t\tranges.push(sel.getRangeAt(i));\n\t\t\t\t}\n\t\t\t\treturn ranges;\n\t\t\t}\n\t\t} else if (document.selection && document.selection.createRange) {\n\t\t\treturn document.selection.createRange();\n\t\t}\n\t\treturn null;\n\t},\n\trestore_selection: function (savedSel) {\n\t\tif (savedSel) {\n\t\t\tif (window.getSelection) {\n\t\t\t\tvar sel = window.getSelection();\n\t\t\t\tsel.removeAllRanges();\n\t\t\t\tfor (var i = 0, len = savedSel.length; i < len; ++i) {\n\t\t\t\t\tsel.addRange(savedSel[i]);\n\t\t\t\t}\n\t\t\t} else if (document.selection && savedSel.select) {\n\t\t\t\tsavedSel.select();\n\t\t\t}\n\t\t}\n\t},\n\tis_touchscreen: function () {\n\t\treturn \"ontouchstart\" in window;\n\t},\n\thandle_broken_images(container) {\n\t\t$(container)\n\t\t\t.find(\"img\")\n\t\t\t.on(\"error\", (e) => {\n\t\t\t\tconst $img = $(e.currentTarget);\n\t\t\t\t$img.addClass(\"no-image\");\n\t\t\t});\n\t},\n\tscroll_to_bottom(container) {\n\t\tconst $container = $(container);\n\t\t$container.scrollTop($container[0].scrollHeight);\n\t},\n\tfile_to_base64(file_obj) {\n\t\treturn new Promise((resolve) => {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = function () {\n\t\t\t\tresolve(reader.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(file_obj);\n\t\t});\n\t},\n\tscroll_to_section(section_name) {\n\t\tsetTimeout(() => {\n\t\t\tconst section = $(`a:contains(\"${section_name}\")`);\n\t\t\tif (section.length) {\n\t\t\t\tif (section.parent().hasClass(\"collapsed\")) {\n\t\t\t\t\t// opens the section\n\t\t\t\t\tsection.click();\n\t\t\t\t}\n\t\t\t\tfrappe.ui.scroll(section.parent().parent());\n\t\t\t}\n\t\t}, 200);\n\t},\n\tpixel_to_inches(pixels) {\n\t\tconst div = $(\n\t\t\t'<div id=\"dpi\" style=\"height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;\"></div>'\n\t\t);\n\t\tdiv.appendTo(document.body);\n\n\t\tconst dpi_x = document.getElementById(\"dpi\").offsetWidth;\n\t\tconst inches = pixels / dpi_x;\n\t\tdiv.remove();\n\n\t\treturn inches;\n\t},\n};\n\nfrappe.ellipsis = function (text, max) {\n\tif (!max) max = 20;\n\ttext = cstr(text);\n\tif (text.length > max) {\n\t\ttext = text.substr(0, max) + \"...\";\n\t}\n\treturn text;\n};\n\nfrappe.run_serially = function (tasks) {\n\tvar result = Promise.resolve();\n\ttasks.forEach((task) => {\n\t\tif (task) {\n\t\t\tresult = result.then ? result.then(task) : Promise.resolve();\n\t\t}\n\t});\n\treturn result;\n};\n\nfrappe.load_image = (src, onload, onerror, preprocess = () => {}) => {\n\tvar tester = new Image();\n\ttester.onload = function () {\n\t\tonload(this);\n\t};\n\ttester.onerror = onerror;\n\n\tpreprocess(tester);\n\ttester.src = src;\n};\n\nfrappe.timeout = (seconds) => {\n\treturn new Promise((resolve) => {\n\t\tsetTimeout(() => resolve(), seconds * 1000);\n\t});\n};\n\nfrappe.scrub = function (text, spacer = \"_\") {\n\treturn text.replace(/ /g, spacer).toLowerCase();\n};\n\nfrappe.unscrub = function (txt) {\n\treturn frappe.model.unscrub(txt);\n};\n\nfrappe.get_data_pill = (label, target_id = null, remove_action = null, image = null) => {\n\tlet data_pill_wrapper = $(`\n\t\t<button class=\"data-pill btn\">\n\t\t\t<div class=\"flex align-center ellipsis\">\n\t\t\t\t${image ? image : \"\"}\n\t\t\t\t<span class=\"pill-label\">${label}</span>\n\t\t\t</div>\n\t\t</button>\n\t`);\n\n\tif (remove_action) {\n\t\tlet remove_btn = $(`\n\t\t\t<span class=\"remove-btn cursor-pointer\">\n\t\t\t\t${frappe.utils.icon(\"close\", \"sm\")}\n\t\t\t</span>\n\t\t`).click(() => {\n\t\t\tremove_action(target_id || label, data_pill_wrapper);\n\t\t});\n\t\tdata_pill_wrapper.append(remove_btn);\n\t}\n\n\treturn data_pill_wrapper;\n};\n\nfrappe.get_modal = function (title, content) {\n\treturn $(`<div class=\"modal fade\" style=\"overflow: auto;\" tabindex=\"-1\">\n\t\t<div class=\"modal-dialog\">\n\t\t\t<div class=\"modal-content\">\n\t\t\t\t<div class=\"modal-header\">\n\t\t\t\t\t<div class=\"fill-width flex title-section\">\n\t\t\t\t\t\t<span class=\"indicator hidden\"></span>\n\t\t\t\t\t\t<h4 class=\"modal-title\">${title}</h4>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"modal-actions\">\n\t\t\t\t\t\t<button class=\"btn btn-modal-minimize btn-link hide\">\n\t\t\t\t\t\t\t${frappe.utils.icon(\"collapse\")}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class=\"btn btn-modal-close btn-link\" data-dismiss=\"modal\">\n\t\t\t\t\t\t\t${frappe.utils.icon(\"close-alt\", \"sm\", \"close-alt\")}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"modal-body ui-front\">${content}</div>\n\t\t\t\t<div class=\"modal-footer hide\">\n\t\t\t\t\t<div class=\"custom-actions\"></div>\n\t\t\t\t\t<div class=\"standard-actions\">\n\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary btn-sm hide btn-modal-secondary\">\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary btn-sm hide btn-modal-primary\">\n\t\t\t\t\t\t\t${__(\"Confirm\")}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>`);\n};\n\nfrappe.is_online = function () {\n\tif (frappe.boot.developer_mode == 1) {\n\t\t// always online in developer_mode\n\t\treturn true;\n\t}\n\tif (\"onLine\" in navigator) {\n\t\treturn navigator.onLine;\n\t}\n\treturn true;\n};\n\nfrappe.create_shadow_element = function (wrapper, html, css, js) {\n\tlet random_id = \"custom-block-\" + frappe.utils.get_random(5).toLowerCase();\n\n\tclass CustomBlock extends HTMLElement {\n\t\tconstructor() {\n\t\t\tsuper();\n\n\t\t\t// html\n\t\t\tlet div = document.createElement(\"div\");\n\t\t\tdiv.innerHTML = frappe.dom.remove_script_and_style(html);\n\n\t\t\t// link global desk css\n\t\t\tlet link = document.createElement(\"link\");\n\t\t\tlink.rel = \"stylesheet\";\n\t\t\tlink.href = frappe.assets.bundled_asset(\"desk.bundle.css\");\n\n\t\t\t// css\n\t\t\tlet style = document.createElement(\"style\");\n\t\t\tstyle.textContent = css;\n\n\t\t\t// javascript\n\t\t\tlet script = document.createElement(\"script\");\n\t\t\tscript.textContent = `\n\t\t\t\t(function() {\n\t\t\t\t\tlet cname = ${JSON.stringify(random_id)};\n\t\t\t\t\tlet root_element = document.querySelector(cname).shadowRoot;\n\t\t\t\t\t${js}\n\t\t\t\t})();\n\t\t\t`;\n\n\t\t\tthis.attachShadow({ mode: \"open\" });\n\t\t\tthis.shadowRoot?.appendChild(link);\n\t\t\tthis.shadowRoot?.appendChild(div);\n\t\t\tthis.shadowRoot?.appendChild(style);\n\t\t\tthis.shadowRoot?.appendChild(script);\n\t\t}\n\t}\n\n\tif (!customElements.get(random_id)) {\n\t\tcustomElements.define(random_id, CustomBlock);\n\t}\n\twrapper.innerHTML = `<${random_id}></${random_id}>`;\n};\n\n// bind online/offline events\n$(window).on(\"online\", function () {\n\tif (document.hidden) return;\n\tfrappe.show_alert({\n\t\tindicator: \"green\",\n\t\tmessage: __(\"You are connected to internet.\"),\n\t});\n});\n\n$(window).on(\"offline\", function () {\n\tif (document.hidden) return;\n\tfrappe.show_alert({\n\t\tindicator: \"orange\",\n\t\tmessage: __(\"Connection lost. Some features might not work.\"),\n\t});\n});\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n// for license information please see license.txt\n\nfrappe.provide(\"frappe.form.formatters\");\n\nfrappe.form.link_formatters = {};\n\nfrappe.form.formatters = {\n\t_right: function (value, options) {\n\t\tif (options && (options.inline || options.only_value)) {\n\t\t\treturn value;\n\t\t} else {\n\t\t\treturn \"<div style='text-align: right'>\" + value + \"</div>\";\n\t\t}\n\t},\n\t_apply_custom_formatter: function (value, df) {\n\t\t/* you can add a custom formatter in df.formatter\n\t\texample:\n\t\t\tfrappe.meta.docfield_map[df.parent][df.fieldname].formatter = (value) => {\n\t\t\t\tif (value==='Test') return '\uD83D\uDE1C';\n\t\t\t}\n\t\t*/\n\n\t\tif (df) {\n\t\t\tconst std_df =\n\t\t\t\tfrappe.meta.docfield_map[df.parent] &&\n\t\t\t\tfrappe.meta.docfield_map[df.parent][df.fieldname];\n\t\t\tif (std_df && std_df.formatter && typeof std_df.formatter === \"function\") {\n\t\t\t\tvalue = std_df.formatter(value, df);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t},\n\tData: function (value, df) {\n\t\tif (df && df.options == \"URL\") {\n\t\t\tif (!value) return;\n\t\t\treturn `<a href=\"${value}\" title=\"Open Link\" target=\"_blank\">${value}</a>`;\n\t\t}\n\t\tvalue = value == null ? \"\" : value;\n\n\t\treturn frappe.form.formatters._apply_custom_formatter(value, df);\n\t},\n\tAutocomplete: function (value, df) {\n\t\treturn __(frappe.form.formatters[\"Data\"](value, df));\n\t},\n\tSelect: function (value, df) {\n\t\treturn __(frappe.form.formatters[\"Data\"](value, df));\n\t},\n\tFloat: function (value, docfield, options, doc) {\n\t\t// don't allow 0 precision for Floats, hence or'ing with null\n\t\tvar precision =\n\t\t\tdocfield.precision ||\n\t\t\tcint(frappe.boot.sysdefaults && frappe.boot.sysdefaults.float_precision) ||\n\t\t\tnull;\n\t\tif (docfield.options && docfield.options.trim()) {\n\t\t\t// options points to a currency field, but expects precision of float!\n\t\t\tdocfield.precision = precision;\n\t\t\treturn frappe.form.formatters.Currency(value, docfield, options, doc);\n\t\t} else {\n\t\t\t// show 1.000000 as 1\n\t\t\tif (!(options || {}).always_show_decimals && !is_null(value)) {\n\t\t\t\tvar temp = cstr(value).split(\".\");\n\t\t\t\tif (temp[1] == undefined || cint(temp[1]) === 0) {\n\t\t\t\t\tprecision = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvalue = value == null || value === \"\" ? \"\" : value;\n\n\t\t\treturn frappe.form.formatters._right(format_number(value, null, precision), options);\n\t\t}\n\t},\n\tInt: function (value, docfield, options) {\n\t\tif (cstr(docfield.options).trim() === \"File Size\") {\n\t\t\treturn frappe.form.formatters.FileSize(value);\n\t\t}\n\t\treturn frappe.form.formatters._right(value == null ? \"\" : cint(value), options);\n\t},\n\tPercent: function (value, docfield, options) {\n\t\tconst precision =\n\t\t\tdocfield.precision ||\n\t\t\tcint(frappe.boot.sysdefaults && frappe.boot.sysdefaults.float_precision) ||\n\t\t\t2;\n\t\treturn frappe.form.formatters._right(flt(value, precision) + \"%\", options);\n\t},\n\tRating: function (value, docfield) {\n\t\tlet rating_html = \"\";\n\t\tlet number_of_stars = docfield.options || 5;\n\t\tvalue = value * number_of_stars;\n\t\tvalue = Math.round(value * 2) / 2; // roundoff number to nearest 0.5\n\t\tArray.from({ length: cint(number_of_stars) }, (_, i) => i + 1).forEach((i) => {\n\t\t\trating_html += `<svg class=\"icon icon-md\" data-rating=${i} viewBox=\"0 0 24 24\" fill=\"none\">\n\t\t\t\t<path class=\"right-half ${\n\t\t\t\t\ti <= (value || 0) ? \"star-click\" : \"\"\n\t\t\t\t}\" d=\"M11.9987 3.00011C12.177 3.00011 12.3554 3.09303 12.4471 3.27888L14.8213 8.09112C14.8941 8.23872 15.0349 8.34102 15.1978 8.3647L20.5069 9.13641C20.917 9.19602 21.0807 9.69992 20.7841 9.9892L16.9421 13.7354C16.8243 13.8503 16.7706 14.0157 16.7984 14.1779L17.7053 19.4674C17.7753 19.8759 17.3466 20.1874 16.9798 19.9945L12.2314 17.4973C12.1586 17.459 12.0786 17.4398 11.9987 17.4398V3.00011Z\" fill=\"var(--star-fill)\" stroke=\"var(--star-fill)\"/>\n\t\t\t\t<path class=\"left-half ${\n\t\t\t\t\ti <= (value || 0) || i - 0.5 == value ? \"star-click\" : \"\"\n\t\t\t\t}\" d=\"M11.9987 3.00011C11.8207 3.00011 11.6428 3.09261 11.5509 3.27762L9.15562 8.09836C9.08253 8.24546 8.94185 8.34728 8.77927 8.37075L3.42887 9.14298C3.01771 9.20233 2.85405 9.70811 3.1525 9.99707L7.01978 13.7414C7.13858 13.8564 7.19283 14.0228 7.16469 14.1857L6.25116 19.4762C6.18071 19.8842 6.6083 20.1961 6.97531 20.0045L11.7672 17.5022C11.8397 17.4643 11.9192 17.4454 11.9987 17.4454V3.00011Z\" fill=\"var(--star-fill)\" stroke=\"var(--star-fill)\"/>\n\t\t\t</svg>`;\n\t\t});\n\t\treturn `<div class=\"rating\">\n\t\t\t${rating_html}\n\t\t</div>`;\n\t},\n\tCurrency: function (value, docfield, options, doc) {\n\t\tvar currency = frappe.meta.get_field_currency(docfield, doc);\n\n\t\tlet precision;\n\t\tif (typeof docfield.precision == \"number\") {\n\t\t\tprecision = docfield.precision;\n\t\t} else {\n\t\t\tprecision = cint(\n\t\t\t\tdocfield.precision || frappe.boot.sysdefaults.currency_precision || 2\n\t\t\t);\n\t\t}\n\n\t\t// If you change anything below, it's going to hurt a company in UAE, a bit.\n\t\tif (precision > 2) {\n\t\t\tvar parts = cstr(value).split(\".\"); // should be minimum 2, comes from the DB\n\t\t\tvar decimals = parts.length > 1 ? parts[1] : \"\"; // parts.length == 2 ???\n\n\t\t\tif (decimals.length < 3 || decimals.length < precision) {\n\t\t\t\tconst fraction =\n\t\t\t\t\tfrappe.model.get_value(\":Currency\", currency, \"fraction_units\") || 100; // if not set, minimum 2.\n\n\t\t\t\tif (decimals.length < cstr(fraction).length) {\n\t\t\t\t\tprecision = cstr(fraction).length - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvalue = value == null || value === \"\" ? \"\" : value;\n\t\tvalue = format_currency(value, currency, precision);\n\n\t\tif (options && options.only_value) {\n\t\t\treturn value;\n\t\t} else {\n\t\t\treturn frappe.form.formatters._right(value, options);\n\t\t}\n\t},\n\tCheck: function (value) {\n\t\treturn `<input type=\"checkbox\" disabled\n\t\t\tclass=\"disabled-${value ? \"selected\" : \"deselected\"}\">`;\n\t},\n\tLink: function (value, docfield, options, doc) {\n\t\tvar doctype = docfield._options || docfield.options;\n\t\tvar original_value = value;\n\t\tlet link_title = frappe.utils.get_link_title(doctype, value);\n\n\t\tif (link_title === value) {\n\t\t\tlink_title = null;\n\t\t}\n\n\t\tif (value && value.match && value.match(/^['\"].*['\"]$/)) {\n\t\t\tvalue.replace(/^.(.*).$/, \"$1\");\n\t\t}\n\n\t\tif (options && (options.for_print || options.only_value)) {\n\t\t\treturn link_title || value;\n\t\t}\n\n\t\tif (frappe.form.link_formatters[doctype]) {\n\t\t\t// don't apply formatters in case of composite (parent field of same type)\n\t\t\tif (doc && doctype !== doc.doctype) {\n\t\t\t\tvalue = frappe.form.link_formatters[doctype](value, doc, docfield);\n\t\t\t}\n\t\t}\n\n\t\tif (!value) {\n\t\t\treturn \"\";\n\t\t}\n\t\tif (value[0] == \"'\" && value[value.length - 1] == \"'\") {\n\t\t\treturn value.substring(1, value.length - 1);\n\t\t}\n\t\tif (docfield && docfield.link_onclick) {\n\t\t\treturn repl('<a onclick=\"%(onclick)s\" href=\"#\">%(value)s</a>', {\n\t\t\t\tonclick: docfield.link_onclick.replace(/\"/g, \"&quot;\") + \"; return false;\",\n\t\t\t\tvalue: value,\n\t\t\t});\n\t\t} else if (docfield && doctype) {\n\t\t\tif (frappe.model.can_read(doctype)) {\n\t\t\t\tconst a = document.createElement(\"a\");\n\t\t\t\ta.href = `/app/${encodeURIComponent(\n\t\t\t\t\tfrappe.router.slug(doctype)\n\t\t\t\t)}/${encodeURIComponent(original_value)}`;\n\t\t\t\ta.dataset.doctype = doctype;\n\t\t\t\ta.dataset.name = original_value;\n\t\t\t\ta.dataset.value = original_value;\n\t\t\t\ta.innerText = __((options && options.label) || link_title || value);\n\t\t\t\treturn a.outerHTML;\n\t\t\t} else {\n\t\t\t\treturn link_title || value;\n\t\t\t}\n\t\t} else {\n\t\t\treturn link_title || value;\n\t\t}\n\t},\n\tDate: function (value) {\n\t\tif (!frappe.datetime.str_to_user) {\n\t\t\treturn value;\n\t\t}\n\t\tif (value) {\n\t\t\tvalue = frappe.datetime.str_to_user(value, false, true);\n\t\t\t// handle invalid date\n\t\t\tif (value === \"Invalid date\") {\n\t\t\t\tvalue = null;\n\t\t\t}\n\t\t}\n\n\t\treturn value || \"\";\n\t},\n\tDateRange: function (value) {\n\t\tif (Array.isArray(value)) {\n\t\t\treturn __(\"{0} to {1}\", [\n\t\t\t\tfrappe.datetime.str_to_user(value[0]),\n\t\t\t\tfrappe.datetime.str_to_user(value[1]),\n\t\t\t]);\n\t\t} else {\n\t\t\treturn value || \"\";\n\t\t}\n\t},\n\tDatetime: function (value) {\n\t\tif (value) {\n\t\t\treturn moment(frappe.datetime.convert_to_user_tz(value)).format(\n\t\t\t\tfrappe.boot.sysdefaults.date_format.toUpperCase() +\n\t\t\t\t\t\" \" +\n\t\t\t\t\t(frappe.boot.sysdefaults.time_format || \"HH:mm:ss\")\n\t\t\t);\n\t\t} else {\n\t\t\treturn \"\";\n\t\t}\n\t},\n\tText: function (value, df) {\n\t\tif (value) {\n\t\t\tvar tags = [\"<p\", \"<div\", \"<br\", \"<table\"];\n\t\t\tvar match = false;\n\n\t\t\tfor (var i = 0; i < tags.length; i++) {\n\t\t\t\tif (value.match(tags[i])) {\n\t\t\t\t\tmatch = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!match) {\n\t\t\t\tvalue = frappe.utils.replace_newlines(value);\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.form.formatters.Data(value, df);\n\t},\n\tTime: function (value) {\n\t\tif (value) {\n\t\t\tvalue = frappe.datetime.str_to_user(value, true);\n\t\t}\n\n\t\treturn value || \"\";\n\t},\n\tDuration: function (value, docfield) {\n\t\tif (value) {\n\t\t\tlet duration_options = frappe.utils.get_duration_options(docfield);\n\t\t\tvalue = frappe.utils.get_formatted_duration(value, duration_options);\n\t\t}\n\n\t\treturn value || \"0s\";\n\t},\n\tLikedBy: function (value) {\n\t\tvar html = \"\";\n\t\t$.each(JSON.parse(value || \"[]\"), function (i, v) {\n\t\t\tif (v) html += frappe.avatar(v);\n\t\t});\n\t\treturn html;\n\t},\n\tTag: function (value) {\n\t\tvar html = \"\";\n\t\t$.each((value || \"\").split(\",\"), function (i, v) {\n\t\t\tif (v)\n\t\t\t\thtml += `\n\t\t\t\t<span\n\t\t\t\t\tclass=\"data-pill btn-xs align-center ellipsis\"\n\t\t\t\t\tstyle=\"background-color: var(--control-bg); box-shadow: none; margin-right: 4px;\"\n\t\t\t\t\tdata-field=\"_user_tags\" data-label=\"${v}'\">\n\t\t\t\t\t${v}\n\t\t\t\t</span>`;\n\t\t});\n\t\treturn html;\n\t},\n\tComment: function (value) {\n\t\treturn value;\n\t},\n\tAssign: function (value) {\n\t\tvar html = \"\";\n\t\t$.each(JSON.parse(value || \"[]\"), function (i, v) {\n\t\t\tif (v)\n\t\t\t\thtml +=\n\t\t\t\t\t'<span class=\"label label-warning\" \\\n\t\t\t\tstyle=\"margin-right: 7px;\"\\\n\t\t\t\tdata-field=\"_assign\">' +\n\t\t\t\t\tv +\n\t\t\t\t\t\"</span>\";\n\t\t});\n\t\treturn html;\n\t},\n\tSmallText: function (value) {\n\t\treturn frappe.form.formatters.Text(value);\n\t},\n\tTextEditor: function (value) {\n\t\tlet formatted_value = frappe.form.formatters.Text(value);\n\t\t// to use ql-editor styles\n\t\ttry {\n\t\t\tif (\n\t\t\t\t!$(formatted_value).find(\".ql-editor\").length &&\n\t\t\t\t!$(formatted_value).hasClass(\"ql-editor\")\n\t\t\t) {\n\t\t\t\tformatted_value = `<div class=\"ql-editor read-mode\">${formatted_value}</div>`;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tformatted_value = `<div class=\"ql-editor read-mode\">${formatted_value}</div>`;\n\t\t}\n\n\t\treturn formatted_value;\n\t},\n\tCode: function (value) {\n\t\treturn \"<pre>\" + (value == null ? \"\" : $(\"<div>\").text(value).html()) + \"</pre>\";\n\t},\n\tWorkflowState: function (value) {\n\t\tvar workflow_state = frappe.get_doc(\"Workflow State\", value);\n\t\tif (workflow_state) {\n\t\t\treturn repl(\n\t\t\t\t\"<span class='label label-%(style)s' \\\n\t\t\t\tdata-workflow-state='%(value)s'\\\n\t\t\t\tstyle='padding-bottom: 4px; cursor: pointer;'>\\\n\t\t\t\t<i class='fa fa-small fa-white fa-%(icon)s'></i> %(value)s</span>\",\n\t\t\t\t{\n\t\t\t\t\tvalue: value,\n\t\t\t\t\tstyle: workflow_state.style.toLowerCase(),\n\t\t\t\t\ticon: workflow_state.icon,\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\treturn \"<span class='label'>\" + value + \"</span>\";\n\t\t}\n\t},\n\tEmail: function (value) {\n\t\treturn $(\"<div></div>\").text(value).html();\n\t},\n\tFileSize: function (value) {\n\t\tvalue = cint(value);\n\t\tif (value > 1048576) {\n\t\t\treturn (value / 1048576).toFixed(2) + \"M\";\n\t\t} else if (value > 1024) {\n\t\t\treturn (value / 1024).toFixed(2) + \"K\";\n\t\t}\n\t\treturn value;\n\t},\n\tTableMultiSelect: function (rows, df, options) {\n\t\trows = rows || [];\n\t\tconst meta = frappe.get_meta(df.options);\n\t\tconst link_field = meta.fields.find((df) => df.fieldtype === \"Link\");\n\t\tconst formatted_values = rows.map((row) => {\n\t\t\tconst value = row[link_field.fieldname];\n\t\t\treturn `<span class=\"text-nowrap\">\n\t\t\t\t${frappe.format(value, link_field, options, row)}\n\t\t\t</span>`;\n\t\t});\n\t\treturn formatted_values.join(\", \");\n\t},\n\tColor: (value) => {\n\t\treturn value\n\t\t\t? `<div>\n\t\t\t<div class=\"selected-color\" style=\"background-color: ${value}\"></div>\n\t\t\t<span class=\"color-value\">${value}</span>\n\t\t</div>`\n\t\t\t: \"\";\n\t},\n\tIcon: (value) => {\n\t\treturn value\n\t\t\t? `<div>\n\t\t\t<div class=\"selected-icon\">${frappe.utils.icon(value, \"md\")}</div>\n\t\t\t<span class=\"icon-value\">${value}</span>\n\t\t</div>`\n\t\t\t: \"\";\n\t},\n\tAttach: format_attachment_url,\n\tAttachImage: format_attachment_url,\n};\n\nfunction format_attachment_url(url) {\n\treturn url ? `<a href=\"${url}\" target=\"_blank\">${url}</a>` : \"\";\n}\n\nfrappe.form.get_formatter = function (fieldtype) {\n\tif (!fieldtype) fieldtype = \"Data\";\n\treturn frappe.form.formatters[fieldtype.replace(/ /g, \"\")] || frappe.form.formatters.Data;\n};\n\nfrappe.format = function (value, df, options, doc) {\n\tif (!df) df = { fieldtype: \"Data\" };\n\tif (df.fieldname == \"_user_tags\") df = { ...df, fieldtype: \"Tag\" };\n\tvar fieldtype = df.fieldtype || \"Data\";\n\n\t// format Dynamic Link as a Link\n\tif (fieldtype === \"Dynamic Link\") {\n\t\tfieldtype = \"Link\";\n\t\tdf._options = doc ? doc[df.options] : null;\n\t}\n\n\tvar formatter = df.formatter || frappe.form.get_formatter(fieldtype);\n\n\tvar formatted = formatter(value, df, options, doc);\n\n\tif (typeof formatted == \"string\") formatted = frappe.dom.remove_script_and_style(formatted);\n\n\treturn formatted;\n};\n\nfrappe.get_format_helper = function (doc) {\n\tvar helper = {\n\t\tget_formatted: function (fieldname) {\n\t\t\tvar df = frappe.meta.get_docfield(doc.doctype, fieldname);\n\t\t\tif (!df) {\n\t\t\t\tconsole.log(\"fieldname not found: \" + fieldname);\n\t\t\t}\n\t\t\treturn frappe.format(doc[fieldname], df, { inline: 1 }, doc);\n\t\t},\n\t};\n\t$.extend(helper, doc);\n\treturn helper;\n};\n\nfrappe.form.link_formatters[\"User\"] = function (value, doc, docfield) {\n\tlet full_name = doc && (doc.full_name || (docfield && doc[`${docfield.fieldname}_full_name`]));\n\treturn full_name || value;\n};\n", "export default class Section {\n\tconstructor(parent, df, card_layout, layout) {\n\t\tthis.layout = layout;\n\t\tthis.card_layout = card_layout;\n\t\tthis.parent = parent;\n\t\tthis.df = df || {};\n\t\tthis.columns = [];\n\t\tthis.fields_list = [];\n\t\tthis.fields_dict = {};\n\n\t\tthis.make();\n\n\t\tif (\n\t\t\tthis.df.label &&\n\t\t\tthis.df.collapsible &&\n\t\t\tlocalStorage.getItem(df.css_class + \"-closed\")\n\t\t) {\n\t\t\tthis.collapse();\n\t\t}\n\n\t\tthis.row = {\n\t\t\twrapper: this.wrapper,\n\t\t};\n\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\tlet make_card = this.card_layout;\n\t\tthis.wrapper = $(`<div class=\"row\n\t\t\t\t${this.df.is_dashboard_section ? \"form-dashboard-section\" : \"form-section\"}\n\t\t\t\t${make_card ? \"card-section\" : \"\"}\" data-fieldname=\"${this.df.fieldname}\">\n\t\t\t`).appendTo(this.parent);\n\n\t\tif (this.df) {\n\t\t\tif (this.df.label) {\n\t\t\t\tthis.make_head();\n\t\t\t}\n\t\t\tif (this.df.description) {\n\t\t\t\tthis.description_wrapper = $(\n\t\t\t\t\t`<div class=\"col-sm-12 form-section-description\">\n\t\t\t\t\t\t${__(this.df.description)}\n\t\t\t\t\t</div>`\n\t\t\t\t);\n\n\t\t\t\tthis.wrapper.append(this.description_wrapper);\n\t\t\t}\n\t\t\tif (this.df.css_class) {\n\t\t\t\tthis.wrapper.addClass(this.df.css_class);\n\t\t\t}\n\t\t\tif (this.df.hide_border) {\n\t\t\t\tthis.wrapper.toggleClass(\"hide-border\", true);\n\t\t\t}\n\t\t}\n\n\t\tthis.body = $('<div class=\"section-body\">').appendTo(this.wrapper);\n\n\t\tif (this.df.body_html) {\n\t\t\tthis.body.append(this.df.body_html);\n\t\t}\n\t}\n\n\tmake_head() {\n\t\tthis.head = $(`\n\t\t\t<div class=\"section-head\">\n\t\t\t\t${__(this.df.label)}\n\t\t\t\t<span class=\"ml-2 collapse-indicator mb-1\"></span>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.head.appendTo(this.wrapper);\n\t\tthis.indicator = this.head.find(\".collapse-indicator\");\n\t\tthis.indicator.hide();\n\n\t\tif (this.df.collapsible) {\n\t\t\tthis.head.addClass(\"collapsible\");\n\t\t\t// show / hide based on status\n\t\t\tthis.collapse_link = this.head.on(\"click\", () => {\n\t\t\t\tthis.collapse();\n\t\t\t});\n\t\t\tthis.set_icon();\n\t\t\tthis.indicator.show();\n\t\t}\n\t}\n\n\treplace_field(fieldname, fieldobj) {\n\t\tif (this.fields_dict[fieldname]?.df) {\n\t\t\tconst olfldobj = this.fields_dict[fieldname];\n\t\t\tconst idx = this.fields_list.findIndex((e) => e == olfldobj);\n\t\t\tthis.fields_list.splice(idx, 1, fieldobj);\n\t\t\tthis.fields_dict[fieldname] = fieldobj;\n\t\t\tfieldobj.section = this;\n\t\t}\n\t}\n\n\tadd_field(fieldobj) {\n\t\tthis.fields_list.push(fieldobj);\n\t\tthis.fields_dict[fieldobj.df.fieldname] = fieldobj;\n\t\tfieldobj.section = this;\n\t}\n\n\trefresh(hide) {\n\t\tif (!this.df) return;\n\t\t// hide if explicitly hidden\n\t\thide = hide || this.df.hidden || this.df.hidden_due_to_dependency;\n\t\tthis.wrapper.toggleClass(\"hide-control\", !!hide);\n\t}\n\n\tcollapse(hide) {\n\t\t// unknown edge case\n\t\tif (!(this.head && this.body)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (hide === undefined) {\n\t\t\thide = !this.body.hasClass(\"hide\");\n\t\t}\n\n\t\tthis.body.toggleClass(\"hide\", hide);\n\t\tthis.head && this.head.toggleClass(\"collapsed\", hide);\n\n\t\tthis.set_icon(hide);\n\n\t\tthis.fields_list.forEach((f) => f.on_section_collapse && f.on_section_collapse(hide));\n\n\t\t// save state for next reload ('' is falsy)\n\t\tif (this.df.css_class)\n\t\t\tlocalStorage.setItem(this.df.css_class + \"-closed\", hide ? \"1\" : \"\");\n\t}\n\n\tset_icon(hide) {\n\t\tlet indicator_icon = hide ? \"es-line-down\" : \"es-line-up\";\n\t\tthis.indicator && this.indicator.html(frappe.utils.icon(indicator_icon, \"sm\", \"mb-1\"));\n\t}\n\n\tis_collapsed() {\n\t\treturn this.body.hasClass(\"hide\");\n\t}\n\n\thas_missing_mandatory() {\n\t\tlet missing_mandatory = false;\n\t\tfor (let j = 0, l = this.fields_list.length; j < l; j++) {\n\t\t\tconst section_df = this.fields_list[j].df;\n\t\t\tif (section_df.reqd && this.layout.doc[section_df.fieldname] == null) {\n\t\t\t\tmissing_mandatory = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn missing_mandatory;\n\t}\n\n\thide() {\n\t\tthis.on_section_toggle(false);\n\t}\n\n\tshow() {\n\t\tthis.on_section_toggle(true);\n\t}\n\n\ton_section_toggle(show) {\n\t\tthis.wrapper.toggleClass(\"hide-control\", !show);\n\t\t// this.on_section_toggle && this.on_section_toggle(show);\n\t}\n}\n", "export default class Tab {\n\tconstructor(layout, df, frm, tab_link_container, tabs_content) {\n\t\tthis.layout = layout;\n\t\tthis.df = df || {};\n\t\tthis.frm = frm;\n\t\tthis.doctype = this.frm.doctype;\n\t\tthis.label = this.df && this.df.label;\n\t\tthis.tab_link_container = tab_link_container;\n\t\tthis.tabs_content = tabs_content;\n\t\tthis.make();\n\t\tthis.setup_listeners();\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\tconst id = `${frappe.scrub(this.doctype, \"-\")}-${this.df.fieldname}`;\n\t\tthis.tab_link = $(`\n\t\t\t<li class=\"nav-item\">\n\t\t\t\t<a class=\"nav-link ${this.df.active ? \"active\" : \"\"}\" id=\"${id}-tab\"\n\t\t\t\t\tdata-toggle=\"tab\"\n\t\t\t\t\tdata-fieldname=\"${this.df.fieldname}\"\n\t\t\t\t\thref=\"#${id}\"\n\t\t\t\t\trole=\"tab\"\n\t\t\t\t\taria-controls=\"${this.label}\">\n\t\t\t\t\t\t${__(this.label)}\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t`).appendTo(this.tab_link_container);\n\n\t\tthis.wrapper = $(`<div class=\"tab-pane fade show ${this.df.active ? \"active\" : \"\"}\"\n\t\t\tid=\"${id}\" role=\"tabpanel\" aria-labelledby=\"${id}-tab\">`).appendTo(this.tabs_content);\n\t}\n\n\trefresh() {\n\t\tif (!this.df) return;\n\n\t\t// hide if explicitly hidden\n\t\tlet hide = this.df.hidden || this.df.hidden_due_to_dependency;\n\n\t\t// hide if no read permission\n\t\tif (!hide && this.frm && !this.frm.get_perm(this.df.permlevel || 0, \"read\")) {\n\t\t\thide = true;\n\t\t}\n\n\t\tif (!hide) {\n\t\t\t// show only if there is at least one visible section or control\n\t\t\thide = true;\n\t\t\tif (\n\t\t\t\tthis.wrapper.find(\n\t\t\t\t\t\".form-section:not(.hide-control, .empty-section), .form-dashboard-section:not(.hide-control, .empty-section)\"\n\t\t\t\t).length\n\t\t\t) {\n\t\t\t\thide = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.toggle(!hide);\n\t}\n\n\ttoggle(show) {\n\t\tthis.tab_link.toggleClass(\"hide\", !show);\n\t\tthis.wrapper.toggleClass(\"hide\", !show);\n\t\tthis.tab_link.toggleClass(\"show\", show);\n\t\tthis.wrapper.toggleClass(\"show\", show);\n\t\tthis.hidden = !show;\n\t}\n\n\tshow() {\n\t\tthis.tab_link.show();\n\t}\n\n\thide() {\n\t\tthis.tab_link.hide();\n\t}\n\n\tadd_field(fieldobj) {\n\t\tfieldobj.tab = this;\n\t}\n\treplace_field(fieldobj) {\n\t\tfieldobj.tab = this;\n\t}\n\n\tset_active() {\n\t\tthis.tab_link.find(\".nav-link\").tab(\"show\");\n\t\tthis.wrapper.addClass(\"show\");\n\t\tthis.frm?.set_active_tab?.(this);\n\t}\n\n\tis_active() {\n\t\treturn this.wrapper.hasClass(\"active\");\n\t}\n\n\tis_hidden() {\n\t\treturn this.wrapper.hasClass(\"hide\") && this.tab_link.hasClass(\"hide\");\n\t}\n\n\tsetup_listeners() {\n\t\tthis.tab_link.find(\".nav-link\").on(\"shown.bs.tab\", () => {\n\t\t\tthis?.frm.set_active_tab?.(this);\n\t\t});\n\t}\n}\n", "export default class Column {\n\tconstructor(section, df) {\n\t\tif (!df) df = {};\n\n\t\tthis.df = df;\n\t\tthis.section = section;\n\t\tthis.section.columns.push(this);\n\t\tthis.make();\n\t\tthis.resize_all_columns();\n\t}\n\n\tmake() {\n\t\tthis.wrapper = $(`\n\t\t\t<div class=\"form-column\" data-fieldname=\"${this.df.fieldname}\">\n\t\t\t\t<form>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t`).appendTo(this.section.body);\n\n\t\tthis.form = this.wrapper.find(\"form\").on(\"submit\", () => false);\n\n\t\tif (this.df.description) {\n\t\t\t$(`\n\t\t\t\t<p class=\"col-sm-12 form-column-description\">\n\t\t\t\t\t${__(this.df.description)}\n\t\t\t\t</p>\n\t\t\t`).prependTo(this.wrapper);\n\t\t}\n\n\t\tif (this.df.label) {\n\t\t\t$(`\n\t\t\t\t<label class=\"column-label\">\n\t\t\t\t\t${__(this.df.label)}\n\t\t\t\t</label>\n\t\t\t`).prependTo(this.wrapper);\n\t\t}\n\t}\n\n\tresize_all_columns() {\n\t\t// distribute all columns equally\n\t\tlet columns = this.section.wrapper.find(\".form-column\").length;\n\t\tlet colspan = cint(12 / columns);\n\n\t\tif (columns == 5) {\n\t\t\tcolspan = 20;\n\t\t}\n\n\t\tthis.section.wrapper\n\t\t\t.find(\".form-column\")\n\t\t\t.removeClass()\n\t\t\t.addClass(\"form-column\")\n\t\t\t.addClass(\"col-sm-\" + colspan);\n\t}\n\n\tadd_field() {}\n\n\trefresh() {\n\t\tthis.section.refresh();\n\t}\n}\n", "import Section from \"./section.js\";\nimport Tab from \"./tab.js\";\nimport Column from \"./column.js\";\n\nfrappe.ui.form.Layout = class Layout {\n\tconstructor(opts) {\n\t\tthis.views = {};\n\t\tthis.pages = [];\n\t\tthis.tabs = [];\n\t\tthis.sections = [];\n\t\tthis.page_breaks = [];\n\t\tthis.sections_dict = {};\n\t\tthis.fields_list = [];\n\t\tthis.fields_dict = {};\n\t\tthis.section_count = 0;\n\t\tthis.column_count = 0;\n\n\t\t$.extend(this, opts);\n\t}\n\n\tmake() {\n\t\tif (!this.parent && this.body) {\n\t\t\tthis.parent = this.body;\n\t\t}\n\t\tthis.wrapper = $('<div class=\"form-layout\">').appendTo(this.parent);\n\t\tthis.message = $('<div class=\"form-message hidden\"></div>').appendTo(this.wrapper);\n\t\tthis.page = $('<div class=\"form-page\"></div>').appendTo(this.wrapper);\n\n\t\tif (!this.fields) {\n\t\t\tthis.fields = this.get_doctype_fields();\n\t\t}\n\n\t\tif (this.is_tabbed_layout()) {\n\t\t\tthis.setup_tabbed_layout();\n\t\t}\n\n\t\tthis.setup_tab_events();\n\t\tthis.frm && this.setup_tooltip_events();\n\t\tthis.render();\n\t}\n\n\tsetup_tabbed_layout() {\n\t\t$(`\n\t\t\t<div class=\"form-tabs-list\">\n\t\t\t\t<ul class=\"nav form-tabs\" id=\"form-tabs\" role=\"tablist\"></ul>\n\t\t\t</div>\n\t\t`).appendTo(this.page);\n\t\tthis.tab_link_container = this.page.find(\".form-tabs\");\n\t\tthis.tabs_content = $(`<div class=\"form-tab-content tab-content\"></div>`).appendTo(\n\t\t\tthis.page\n\t\t);\n\t\tthis.setup_events();\n\t}\n\n\tget_doctype_fields() {\n\t\tlet fields = [this.get_new_name_field()];\n\t\tif (this.doctype_layout) {\n\t\t\tfields = fields.concat(this.get_fields_from_layout());\n\t\t} else {\n\t\t\tfields = fields.concat(\n\t\t\t\tfrappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype])\n\t\t\t);\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tget_new_name_field() {\n\t\treturn {\n\t\t\tparent: this.frm.doctype,\n\t\t\tfieldtype: \"Data\",\n\t\t\tfieldname: \"__newname\",\n\t\t\treqd: 1,\n\t\t\thidden: 1,\n\t\t\tlabel: __(\"Name\"),\n\t\t\tget_status: function (field) {\n\t\t\t\tif (\n\t\t\t\t\tfield.frm &&\n\t\t\t\t\tfield.frm.is_new() &&\n\t\t\t\t\tfield.frm.meta.autoname &&\n\t\t\t\t\t[\"prompt\", \"name\"].includes(field.frm.meta.autoname.toLowerCase())\n\t\t\t\t) {\n\t\t\t\t\treturn \"Write\";\n\t\t\t\t}\n\t\t\t\treturn \"None\";\n\t\t\t},\n\t\t};\n\t}\n\n\tget_fields_from_layout() {\n\t\tconst fields = [];\n\t\tfor (let f of this.doctype_layout.fields) {\n\t\t\tconst docfield = copy_dict(frappe.meta.docfield_map[this.doctype][f.fieldname]);\n\t\t\tdocfield.label = f.label;\n\t\t\tfields.push(docfield);\n\t\t}\n\t\treturn fields;\n\t}\n\n\tshow_message(html, color) {\n\t\tif (this.message_color) {\n\t\t\t// remove previous color\n\t\t\tthis.message.removeClass(this.message_color);\n\t\t}\n\t\tlet close_message = $(`<div class=\"close-message\">${frappe.utils.icon(\"close\")}</div>`);\n\t\tthis.message_color =\n\t\t\tcolor && [\"yellow\", \"blue\", \"red\", \"green\", \"orange\"].includes(color) ? color : \"blue\";\n\t\tif (html) {\n\t\t\tif (html.substr(0, 1) !== \"<\") {\n\t\t\t\t// wrap in a block\n\t\t\t\thtml = \"<div>\" + html + \"</div>\";\n\t\t\t}\n\t\t\tthis.message.removeClass(\"hidden\").addClass(this.message_color);\n\t\t\t$(html).appendTo(this.message);\n\t\t\tclose_message.appendTo(this.message);\n\t\t\tclose_message.on(\"click\", () => this.message.empty().addClass(\"hidden\"));\n\t\t} else {\n\t\t\tthis.message.empty().addClass(\"hidden\");\n\t\t}\n\t}\n\n\trender(new_fields) {\n\t\tlet fields = new_fields || this.fields;\n\n\t\tthis.section = null;\n\t\tthis.column = null;\n\n\t\tif (this.no_opening_section() && !this.is_tabbed_layout()) {\n\t\t\tthis.fields.unshift({ fieldtype: \"Section Break\" });\n\t\t}\n\n\t\tif (this.is_tabbed_layout()) {\n\t\t\t// add a tab without `fieldname` to avoid conflicts\n\t\t\tlet default_tab = {\n\t\t\t\tlabel: __(\"Details\"),\n\t\t\t\tfieldtype: \"Tab Break\",\n\t\t\t\tfieldname: \"__details\",\n\t\t\t};\n\n\t\t\tlet first_field_visible = this.fields.find((element) => element.hidden == false);\n\t\t\tlet first_tab =\n\t\t\t\tfirst_field_visible?.fieldtype === \"Tab Break\" ? first_field_visible : null;\n\n\t\t\tif (!first_tab) {\n\t\t\t\tthis.fields.splice(0, 0, default_tab);\n\t\t\t} else {\n\t\t\t\t// reshuffle __newname field to accomodate under 1st Tab Break\n\t\t\t\tlet newname_field = this.fields.find((df) => df.fieldname === \"__newname\");\n\t\t\t\tif (newname_field && newname_field.get_status(this) === \"Write\") {\n\t\t\t\t\tthis.fields.splice(0, 1);\n\t\t\t\t\tthis.fields.splice(1, 0, newname_field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfields.forEach((df) => {\n\t\t\tswitch (df.fieldtype) {\n\t\t\t\tcase \"Fold\":\n\t\t\t\t\tthis.make_page(df);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Page Break\":\n\t\t\t\t\tthis.make_page_break();\n\t\t\t\t\tthis.make_section(df);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Section Break\":\n\t\t\t\t\tthis.make_section(df);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Column Break\":\n\t\t\t\t\tthis.make_column(df);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Tab Break\":\n\t\t\t\t\tthis.make_tab(df);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.make_field(df);\n\t\t\t}\n\t\t});\n\t}\n\n\tno_opening_section() {\n\t\treturn (\n\t\t\t(this.fields[0] && this.fields[0].fieldtype != \"Section Break\") || !this.fields.length\n\t\t);\n\t}\n\n\tno_opening_tab() {\n\t\treturn (this.fields[1] && this.fields[1].fieldtype != \"Tab Break\") || !this.fields.length;\n\t}\n\n\tis_tabbed_layout() {\n\t\treturn this.fields.find((f) => f.fieldtype === \"Tab Break\");\n\t}\n\n\treplace_field(fieldname, df, render) {\n\t\tdf.fieldname = fieldname; // change of fieldname is avoided\n\t\tif (this.fields_dict[fieldname] && this.fields_dict[fieldname].df) {\n\t\t\tconst prev_fieldobj = this.fields_dict[fieldname];\n\t\t\tconst fieldobj = this.init_field(df, prev_fieldobj.parent, render);\n\t\t\tprev_fieldobj.$wrapper.replaceWith(fieldobj.$wrapper);\n\t\t\tconst idx = this.fields_list.findIndex((e) => e == prev_fieldobj);\n\t\t\tthis.fields_list.splice(idx, 1, fieldobj);\n\t\t\tthis.fields_dict[fieldname] = fieldobj;\n\t\t\tthis.sections.forEach((section) => section.replace_field(fieldname, fieldobj));\n\t\t\tprev_fieldobj.tab?.replace_field(fieldobj);\n\t\t\tthis.refresh_fields([df]);\n\t\t}\n\t}\n\n\tmake_field(df, colspan, render) {\n\t\t!this.section && this.make_section();\n\t\t!this.column && this.make_column();\n\n\t\tconst parent = this.column.form.get(0);\n\t\tconst fieldobj = this.init_field(df, parent, render);\n\t\tthis.fields_list.push(fieldobj);\n\t\tthis.fields_dict[df.fieldname] = fieldobj;\n\n\t\tthis.section.add_field(fieldobj);\n\t\tthis.column.add_field(fieldobj);\n\n\t\tif (this.current_tab) {\n\t\t\tthis.current_tab.add_field(fieldobj);\n\t\t}\n\t}\n\n\tinit_field(df, parent, render = false) {\n\t\tconst fieldobj = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tdoctype: this.doctype,\n\t\t\tparent: parent,\n\t\t\tfrm: this.frm,\n\t\t\trender_input: render,\n\t\t\tdoc: this.doc,\n\t\t\tlayout: this,\n\t\t});\n\n\t\tfieldobj.layout = this;\n\t\treturn fieldobj;\n\t}\n\n\tmake_page_break() {\n\t\tthis.page = $('<div class=\"form-page page-break\"></div>').appendTo(this.wrapper);\n\t}\n\n\tmake_page(df) {\n\t\tlet me = this;\n\t\tlet head = $(`\n\t\t\t<div class=\"form-clickable-section text-center\">\n\t\t\t\t<a class=\"btn-fold h6 text-muted\">\n\t\t\t\t\t${__(\"Show more details\")}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t`).appendTo(this.wrapper);\n\n\t\tthis.page = $('<div class=\"form-page second-page hide\"></div>').appendTo(this.wrapper);\n\n\t\tthis.fold_btn = head.find(\".btn-fold\").on(\"click\", function () {\n\t\t\tlet page = $(this).parent().next();\n\t\t\tif (page.hasClass(\"hide\")) {\n\t\t\t\t$(this).removeClass(\"btn-fold\").html(__(\"Hide details\"));\n\t\t\t\tpage.removeClass(\"hide\");\n\t\t\t\tfrappe.utils.scroll_to($(this), true, 30);\n\t\t\t\tme.folded = false;\n\t\t\t} else {\n\t\t\t\t$(this).addClass(\"btn-fold\").html(__(\"Show more details\"));\n\t\t\t\tpage.addClass(\"hide\");\n\t\t\t\tme.folded = true;\n\t\t\t}\n\t\t});\n\n\t\tthis.section = null;\n\t\tthis.folded = true;\n\t}\n\n\tunfold() {\n\t\tthis.fold_btn.trigger(\"click\");\n\t}\n\n\tmake_section(df = {}) {\n\t\tthis.section_count++;\n\t\tif (!df.fieldname) {\n\t\t\tdf.fieldname = `__section_${this.section_count}`;\n\t\t\tdf.fieldtype = \"Section Break\";\n\t\t}\n\n\t\tthis.section = new Section(\n\t\t\tthis.current_tab ? this.current_tab.wrapper : this.page,\n\t\t\tdf,\n\t\t\tthis.card_layout,\n\t\t\tthis\n\t\t);\n\t\tthis.sections.push(this.section);\n\t\tthis.sections_dict[df.fieldname] = this.section;\n\n\t\t// append to layout fields\n\t\tif (df) {\n\t\t\tthis.fields_dict[df.fieldname] = this.section;\n\t\t\tthis.fields_list.push(this.section);\n\t\t}\n\n\t\tthis.column = null;\n\t}\n\n\tmake_column(df = {}) {\n\t\tthis.column_count++;\n\t\tif (!df.fieldname) {\n\t\t\tdf.fieldname = `__column_${this.section_count}`;\n\t\t\tdf.fieldtype = \"Column Break\";\n\t\t}\n\n\t\tthis.column = new Column(this.section, df);\n\t\tif (df && df.fieldname) {\n\t\t\tthis.fields_list.push(this.column);\n\t\t}\n\t}\n\n\tmake_tab(df) {\n\t\tthis.section = null;\n\t\tlet tab = new Tab(this, df, this.frm, this.tab_link_container, this.tabs_content);\n\t\tthis.current_tab = tab;\n\t\tthis.make_section({ fieldtype: \"Section Break\" });\n\t\tthis.tabs.push(tab);\n\t\treturn tab;\n\t}\n\n\trefresh(doc) {\n\t\tif (doc) this.doc = doc;\n\n\t\tif (this.frm) {\n\t\t\tthis.wrapper.find(\".empty-form-alert\").remove();\n\t\t}\n\n\t\t// NOTE this might seem redundant at first, but it needs to be executed when frm.refresh_fields is called\n\t\tthis.attach_doc_and_docfields(true);\n\n\t\tif (this.frm && this.frm.wrapper) {\n\t\t\t$(this.frm.wrapper).trigger(\"refresh-fields\");\n\t\t}\n\n\t\t// dependent fields\n\t\tthis.refresh_dependency();\n\n\t\t// refresh sections\n\t\tthis.refresh_sections();\n\n\t\tif (this.frm) {\n\t\t\t// collapse sections\n\t\t\tthis.refresh_section_collapse();\n\t\t}\n\n\t\tif (document.activeElement) {\n\t\t\tif (document.activeElement.tagName == \"INPUT\" && this.is_numeric_field_active()) {\n\t\t\t\tdocument.activeElement.select();\n\t\t\t}\n\t\t}\n\t}\n\n\tis_numeric_field_active() {\n\t\tconst control = $(document.activeElement).closest(\".frappe-control\");\n\t\tconst fieldtype = (control.data() || {}).fieldtype;\n\t\treturn frappe.model.numeric_fieldtypes.includes(fieldtype);\n\t}\n\n\trefresh_sections() {\n\t\t// hide invisible sections\n\t\tthis.wrapper.find(\".form-section:not(.hide-control)\").each(function () {\n\t\t\tconst section = $(this).removeClass(\"empty-section visible-section\");\n\t\t\tif (section.find(\".frappe-control:not(.hide-control)\").length) {\n\t\t\t\tsection.addClass(\"visible-section\");\n\t\t\t} else if (\n\t\t\t\tsection.parent().hasClass(\"tab-pane\") ||\n\t\t\t\tsection.parent().hasClass(\"form-page\")\n\t\t\t) {\n\t\t\t\t// nothing visible, hide the section\n\t\t\t\tsection.addClass(\"empty-section\");\n\t\t\t}\n\t\t});\n\n\t\t// refresh tabs\n\t\tthis.is_tabbed_layout() && this.refresh_tabs();\n\t}\n\n\trefresh_tabs() {\n\t\tfor (let tab of this.tabs) {\n\t\t\ttab.refresh();\n\t\t}\n\n\t\tconst visible_tabs = this.tabs.filter((tab) => !tab.hidden);\n\t\tif (visible_tabs && visible_tabs.length == 1) {\n\t\t\tvisible_tabs[0].tab_link.toggleClass(\"hide show\");\n\t\t}\n\t\tthis.set_tab_as_active();\n\t}\n\n\tselect_tab(label_or_fieldname) {\n\t\tfor (let tab of this.tabs) {\n\t\t\tif (\n\t\t\t\ttab.label.toLowerCase() === label_or_fieldname.toLowerCase() ||\n\t\t\t\ttab.df.fieldname?.toLowerCase() === label_or_fieldname.toLowerCase()\n\t\t\t) {\n\t\t\t\ttab.set_active();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tset_tab_as_active() {\n\t\tlet frm_active_tab = this?.frm.get_active_tab?.();\n\t\tif (frm_active_tab) {\n\t\t\tfrm_active_tab.set_active();\n\t\t} else if (this.tabs.length) {\n\t\t\t// set first tab as active when opening for first time, or new doc\n\t\t\tlet first_visible_tab = this.tabs.find((tab) => !tab.is_hidden());\n\t\t\tfirst_visible_tab && first_visible_tab.set_active();\n\t\t}\n\t}\n\n\trefresh_fields(fields) {\n\t\tlet fieldnames = fields.map((field) => {\n\t\t\tif (field.fieldname) return field.fieldname;\n\t\t});\n\n\t\tthis.fields_list.map((fieldobj) => {\n\t\t\tif (fieldnames.includes(fieldobj.df.fieldname)) {\n\t\t\t\tfieldobj.refresh();\n\t\t\t\tif (fieldobj.df[\"default\"]) {\n\t\t\t\t\tfieldobj.set_input(fieldobj.df[\"default\"]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_fields(fields) {\n\t\tthis.render(fields);\n\t\tthis.refresh_fields(fields);\n\t}\n\n\trefresh_section_collapse() {\n\t\tif (!(this.sections && this.sections.length)) return;\n\n\t\tfor (let i = 0; i < this.sections.length; i++) {\n\t\t\tlet section = this.sections[i];\n\t\t\tlet df = section.df;\n\t\t\tif (df && df.collapsible) {\n\t\t\t\tlet collapse = true;\n\n\t\t\t\tif (df.collapsible_depends_on) {\n\t\t\t\t\tcollapse = !this.evaluate_depends_on_value(df.collapsible_depends_on);\n\t\t\t\t}\n\n\t\t\t\tif (collapse && section.has_missing_mandatory()) {\n\t\t\t\t\tcollapse = false;\n\t\t\t\t}\n\n\t\t\t\tsection.collapse(collapse);\n\t\t\t}\n\t\t}\n\t}\n\n\tattach_doc_and_docfields(refresh) {\n\t\tlet me = this;\n\t\tfor (let i = 0, l = this.fields_list.length; i < l; i++) {\n\t\t\tlet fieldobj = this.fields_list[i];\n\t\t\tif (me.doc) {\n\t\t\t\tfieldobj.doc = me.doc;\n\t\t\t\tfieldobj.doctype = me.doc.doctype;\n\t\t\t\tfieldobj.docname = me.doc.name;\n\t\t\t\tfieldobj.df =\n\t\t\t\t\tfrappe.meta.get_docfield(me.doc.doctype, fieldobj.df.fieldname, me.doc.name) ||\n\t\t\t\t\tfieldobj.df;\n\t\t\t}\n\t\t\trefresh && fieldobj.df && fieldobj.refresh && fieldobj.refresh();\n\t\t}\n\t}\n\n\trefresh_section_count() {\n\t\tthis.wrapper.find(\".section-count-label:visible\").each(function (i) {\n\t\t\t$(this).html(i + 1);\n\t\t});\n\t}\n\n\tsetup_events() {\n\t\tlet last_scroll = 0;\n\t\tlet tabs_list = $(\".form-tabs-list\");\n\t\tlet tabs_content = this.tabs_content[0];\n\t\tif (!tabs_list.length) return;\n\n\t\t$(window).scroll(\n\t\t\tfrappe.utils.throttle(() => {\n\t\t\t\tlet current_scroll = document.documentElement.scrollTop;\n\t\t\t\tif (current_scroll > 0 && last_scroll <= current_scroll) {\n\t\t\t\t\ttabs_list.removeClass(\"form-tabs-sticky-down\");\n\t\t\t\t\ttabs_list.addClass(\"form-tabs-sticky-up\");\n\t\t\t\t} else {\n\t\t\t\t\ttabs_list.removeClass(\"form-tabs-sticky-up\");\n\t\t\t\t\ttabs_list.addClass(\"form-tabs-sticky-down\");\n\t\t\t\t}\n\t\t\t\tlast_scroll = current_scroll;\n\t\t\t}, 500)\n\t\t);\n\n\t\tthis.tab_link_container.off(\"click\").on(\"click\", \".nav-link\", (e) => {\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t\t$(e.currentTarget).tab(\"show\");\n\t\t\tif (tabs_content.getBoundingClientRect().top < 100) {\n\t\t\t\ttabs_content.scrollIntoView();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t$(\".page-head\").css(\"top\", \"-15px\");\n\t\t\t\t\t$(\".form-tabs-list\").removeClass(\"form-tabs-sticky-down\");\n\t\t\t\t\t$(\".form-tabs-list\").addClass(\"form-tabs-sticky-up\");\n\t\t\t\t}, 3);\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_tab_events() {\n\t\tthis.wrapper.on(\"keydown\", (ev) => {\n\t\t\tif (ev.which == 9) {\n\t\t\t\tlet current = $(ev.target);\n\t\t\t\tlet doctype = current.attr(\"data-doctype\");\n\t\t\t\tlet fieldname = current.attr(\"data-fieldname\");\n\t\t\t\tif (doctype) {\n\t\t\t\t\treturn this.handle_tab(doctype, fieldname, ev.shiftKey);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_tooltip_events() {\n\t\t$(document).on(\"keydown\", (e) => {\n\t\t\tif (e.altKey) {\n\t\t\t\tthis.wrapper.addClass(\"show-tooltip\");\n\t\t\t}\n\t\t});\n\t\t$(document).on(\"keyup\", (e) => {\n\t\t\tif (!e.altKey) {\n\t\t\t\tthis.wrapper.removeClass(\"show-tooltip\");\n\t\t\t}\n\t\t});\n\t\tthis.frm.page &&\n\t\t\tfrappe.ui.keys.add_shortcut({\n\t\t\t\tshortcut: \"alt+hover\",\n\t\t\t\tpage: this.frm.page,\n\t\t\t\tdescription: __(\"Show Fieldname (click to copy on clipboard)\"),\n\t\t\t});\n\t}\n\n\thandle_tab(doctype, fieldname, shift) {\n\t\tlet grid_row = null,\n\t\t\tprev = null,\n\t\t\tfields = this.fields_list,\n\t\t\tfocused = false;\n\n\t\t// in grid\n\t\tif (doctype != this.doctype) {\n\t\t\tgrid_row = this.get_open_grid_row();\n\t\t\tif (!grid_row || !grid_row.layout) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfields = grid_row.layout.fields_list;\n\t\t}\n\n\t\tfor (let i = 0, len = fields.length; i < len; i++) {\n\t\t\tif (fields[i].df.fieldname == fieldname) {\n\t\t\t\tif (shift) {\n\t\t\t\t\tif (prev) {\n\t\t\t\t\t\tthis.set_focus(prev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(this.primary_button).focus();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (i < len - 1) {\n\t\t\t\t\tfocused = this.focus_on_next_field(i, fields);\n\t\t\t\t}\n\n\t\t\t\tif (focused) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.is_visible(fields[i])) prev = fields[i];\n\t\t}\n\n\t\tif (!focused) {\n\t\t\t// last field in this group\n\t\t\tif (grid_row) {\n\t\t\t\t// in grid\n\t\t\t\tif (grid_row.doc.idx == grid_row.grid.grid_rows.length) {\n\t\t\t\t\t// last row, close it and find next field\n\t\t\t\t\tgrid_row.toggle_view(false, function () {\n\t\t\t\t\t\tgrid_row.grid.frm.layout.handle_tab(\n\t\t\t\t\t\t\tgrid_row.grid.df.parent,\n\t\t\t\t\t\t\tgrid_row.grid.df.fieldname\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// next row\n\t\t\t\t\tgrid_row.grid.grid_rows[grid_row.doc.idx].toggle_view(true);\n\t\t\t\t}\n\t\t\t} else if (!shift) {\n\t\t\t\t// End of tab navigation\n\t\t\t\t$(this.primary_button).focus();\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tfocus_on_next_field(start_idx, fields) {\n\t\t// loop to find next eligible fields\n\t\tfor (let i = start_idx + 1, len = fields.length; i < len; i++) {\n\t\t\tlet field = fields[i];\n\t\t\tif (this.is_visible(field)) {\n\t\t\t\tif (field.df.fieldtype === \"Table\") {\n\t\t\t\t\t// open table grid\n\t\t\t\t\tif (!(field.grid.grid_rows && field.grid.grid_rows.length)) {\n\t\t\t\t\t\t// empty grid, add a new row\n\t\t\t\t\t\tfield.grid.add_new_row();\n\t\t\t\t\t}\n\t\t\t\t\t// show grid row (if exists)\n\t\t\t\t\tfield.grid.grid_rows[0].show_form();\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (!frappe.model.no_value_type.includes(field.df.fieldtype)) {\n\t\t\t\t\tthis.set_focus(field);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tis_visible(field) {\n\t\treturn (\n\t\t\tfield.disp_status === \"Write\" && field.df && \"hidden\" in field.df && !field.df.hidden\n\t\t);\n\t}\n\n\tset_focus(field) {\n\t\tif (field.tab) {\n\t\t\tfield.tab.set_active();\n\t\t}\n\t\t// next is table, show the table\n\t\tif (field.df.fieldtype == \"Table\") {\n\t\t\tif (!field.grid.grid_rows.length) {\n\t\t\t\tfield.grid.add_new_row(1);\n\t\t\t} else {\n\t\t\t\tfield.grid.grid_rows[0].toggle_view(true);\n\t\t\t}\n\t\t} else if (field.editor) {\n\t\t\tfield.editor.set_focus();\n\t\t} else if (field.$input) {\n\t\t\tfield.$input.focus();\n\t\t}\n\t}\n\n\tget_open_grid_row() {\n\t\treturn $(\".grid-row-open\").data(\"grid_row\");\n\t}\n\n\trefresh_dependency() {\n\t\t/**\n\t\t\tResolve \"depends_on\" and show / hide accordingly\n\t\t\tbuild dependants' dictionary\n\t\t*/\n\n\t\tlet has_dep = false;\n\n\t\tconst fields = this.fields_list.concat(this.tabs);\n\n\t\tfor (let fkey in fields) {\n\t\t\tlet f = fields[fkey];\n\t\t\tif (f.df.depends_on || f.df.mandatory_depends_on || f.df.read_only_depends_on) {\n\t\t\t\thas_dep = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!has_dep) return;\n\n\t\t// show / hide based on values\n\t\tfor (let i = fields.length - 1; i >= 0; i--) {\n\t\t\tlet f = fields[i];\n\t\t\tf.guardian_has_value = true;\n\t\t\tif (f.df.depends_on) {\n\t\t\t\t// evaluate guardian\n\n\t\t\t\tf.guardian_has_value = this.evaluate_depends_on_value(f.df.depends_on);\n\n\t\t\t\t// show / hide\n\t\t\t\tif (f.guardian_has_value) {\n\t\t\t\t\tif (f.df.hidden_due_to_dependency) {\n\t\t\t\t\t\tf.df.hidden_due_to_dependency = false;\n\t\t\t\t\t\tf.refresh();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!f.df.hidden_due_to_dependency) {\n\t\t\t\t\t\tf.df.hidden_due_to_dependency = true;\n\t\t\t\t\t\tf.refresh();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (f.df.mandatory_depends_on) {\n\t\t\t\tthis.set_dependant_property(f.df.mandatory_depends_on, f.df.fieldname, \"reqd\");\n\t\t\t}\n\n\t\t\tif (f.df.read_only_depends_on) {\n\t\t\t\tthis.set_dependant_property(\n\t\t\t\t\tf.df.read_only_depends_on,\n\t\t\t\t\tf.df.fieldname,\n\t\t\t\t\t\"read_only\"\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.refresh_section_count();\n\t}\n\n\tset_dependant_property(condition, fieldname, property) {\n\t\tlet set_property = this.evaluate_depends_on_value(condition);\n\t\tlet value = set_property ? 1 : 0;\n\t\tlet form_obj;\n\n\t\tif (this.frm) {\n\t\t\tform_obj = this.frm;\n\t\t} else if (this.is_dialog || this.doctype === \"Web Form\") {\n\t\t\tform_obj = this;\n\t\t}\n\t\tif (form_obj) {\n\t\t\tif (this.doc && this.doc.parent && this.doc.parentfield) {\n\t\t\t\tform_obj.setting_dependency = true;\n\t\t\t\tform_obj.set_df_property(\n\t\t\t\t\tthis.doc.parentfield,\n\t\t\t\t\tproperty,\n\t\t\t\t\tvalue,\n\t\t\t\t\tthis.doc.parent,\n\t\t\t\t\tfieldname,\n\t\t\t\t\tthis.doc.name\n\t\t\t\t);\n\t\t\t\tform_obj.setting_dependency = false;\n\t\t\t\t// refresh child fields\n\t\t\t\tthis.fields_dict[fieldname] && this.fields_dict[fieldname].refresh();\n\t\t\t} else {\n\t\t\t\tform_obj.set_df_property(fieldname, property, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tevaluate_depends_on_value(expression) {\n\t\tlet out = null;\n\t\tlet doc = this.doc;\n\n\t\tif (!doc && this.get_values) {\n\t\t\tdoc = this.get_values(true);\n\t\t}\n\n\t\tif (!doc) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet parent = this.frm ? this.frm.doc : this.doc || null;\n\n\t\tif (typeof expression === \"boolean\") {\n\t\t\tout = expression;\n\t\t} else if (typeof expression === \"function\") {\n\t\t\tout = expression(doc);\n\t\t} else if (expression.substr(0, 5) == \"eval:\") {\n\t\t\ttry {\n\t\t\t\tout = frappe.utils.eval(expression.substr(5), { doc, parent });\n\t\t\t\tif (parent && parent.istable && expression.includes(\"is_submittable\")) {\n\t\t\t\t\tout = true;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tfrappe.throw(__('Invalid \"depends_on\" expression'));\n\t\t\t}\n\t\t} else if (expression.substr(0, 3) == \"fn:\" && this.frm) {\n\t\t\tout = this.frm.script_manager.trigger(\n\t\t\t\texpression.substr(3),\n\t\t\t\tthis.doctype,\n\t\t\t\tthis.docname\n\t\t\t);\n\t\t} else {\n\t\t\tvar value = doc[expression];\n\t\t\tif ($.isArray(value)) {\n\t\t\t\tout = !!value.length;\n\t\t\t} else {\n\t\t\t\tout = !!value;\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n};\n", "import \"../form/layout\";\n\nfrappe.provide(\"frappe.ui\");\n\nfrappe.ui.FieldGroup = class FieldGroup extends frappe.ui.form.Layout {\n\tconstructor(opts) {\n\t\tsuper(opts);\n\t\tthis.dirty = false;\n\t\t$.each(this.fields || [], function (i, f) {\n\t\t\tif (!f.fieldname && f.label) {\n\t\t\t\tf.fieldname = f.label.replace(/ /g, \"_\").toLowerCase();\n\t\t\t}\n\t\t});\n\t\tif (this.values) {\n\t\t\tthis.set_values(this.values);\n\t\t}\n\t}\n\n\tmake() {\n\t\tlet me = this;\n\t\tif (this.fields) {\n\t\t\tsuper.make();\n\t\t\tthis.refresh();\n\t\t\t// set default\n\t\t\t$.each(this.fields_list, function (i, field) {\n\t\t\t\tif (field.df[\"default\"]) {\n\t\t\t\t\tlet def_value = field.df[\"default\"];\n\n\t\t\t\t\tif (def_value == \"Today\" && field.df[\"fieldtype\"] == \"Date\") {\n\t\t\t\t\t\tdef_value = frappe.datetime.get_today();\n\t\t\t\t\t}\n\n\t\t\t\t\tfield.set_input(def_value);\n\t\t\t\t\t// if default and has depends_on, render its fields.\n\t\t\t\t\tme.refresh_dependency();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!this.no_submit_on_enter) {\n\t\t\t\tthis.catch_enter_as_submit();\n\t\t\t}\n\n\t\t\t$(this.wrapper)\n\t\t\t\t.find(\"input, select\")\n\t\t\t\t.on(\"change awesomplete-selectcomplete\", () => {\n\t\t\t\t\tthis.dirty = true;\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t\t\t() => me.refresh_dependency(),\n\t\t\t\t\t]);\n\t\t\t\t});\n\t\t}\n\t}\n\n\tfocus_on_first_input() {\n\t\tif (this.no_focus) return;\n\t\t$.each(this.fields_list, function (i, f) {\n\t\t\tif (![\"Date\", \"Datetime\", \"Time\", \"Check\"].includes(f.df.fieldtype) && f.set_focus) {\n\t\t\t\tf.set_focus();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t}\n\n\tcatch_enter_as_submit() {\n\t\tlet me = this;\n\t\t$(this.body)\n\t\t\t.find('input[type=\"text\"], input[type=\"password\"], select')\n\t\t\t.keypress(function (e) {\n\t\t\t\tif (e.which == 13) {\n\t\t\t\t\tif (me.has_primary_action) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tme.get_primary_btn().trigger(\"click\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tget_input(fieldname) {\n\t\tlet field = this.fields_dict[fieldname];\n\t\tif (!field) return \"\";\n\t\treturn $(field.txt ? field.txt : field.input);\n\t}\n\n\tget_field(fieldname) {\n\t\treturn this.fields_dict[fieldname];\n\t}\n\n\tget_values(ignore_errors, check_invalid) {\n\t\tlet ret = {};\n\t\tlet errors = [];\n\t\tlet invalid = [];\n\n\t\tfor (let key in this.fields_dict) {\n\t\t\tlet f = this.fields_dict[key];\n\t\t\tif (f.get_value) {\n\t\t\t\tlet v = f.get_value();\n\t\t\t\tif (f.df.reqd && is_null(typeof v === \"string\" ? strip_html(v) : v))\n\t\t\t\t\terrors.push(__(f.df.label));\n\n\t\t\t\tif (f.df.reqd && f.df.fieldtype === \"Text Editor\" && is_null(strip_html(cstr(v))))\n\t\t\t\t\terrors.push(__(f.df.label));\n\n\t\t\t\tif (!is_null(v)) ret[f.df.fieldname] = v;\n\t\t\t}\n\n\t\t\tif (this.is_dialog && f.df.reqd && !f.value) {\n\t\t\t\tf.refresh_input();\n\t\t\t}\n\n\t\t\tif (f.df.invalid) {\n\t\t\t\tinvalid.push(__(f.df.label));\n\t\t\t}\n\t\t}\n\n\t\tif (errors.length && !ignore_errors) {\n\t\t\tfrappe.msgprint({\n\t\t\t\ttitle: __(\"Missing Values Required\"),\n\t\t\t\tmessage:\n\t\t\t\t\t__(\"Following fields have missing values:\") +\n\t\t\t\t\t\"<br><br><ul><li>\" +\n\t\t\t\t\terrors.join(\"<li>\") +\n\t\t\t\t\t\"</ul>\",\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t\treturn null;\n\t\t}\n\n\t\tif (invalid.length && check_invalid) {\n\t\t\tfrappe.msgprint({\n\t\t\t\ttitle: __(\"Inavlid Values\"),\n\t\t\t\tmessage:\n\t\t\t\t\t__(\"Following fields have invalid values:\") +\n\t\t\t\t\t\"<br><br><ul><li>\" +\n\t\t\t\t\tinvalid.join(\"<li>\") +\n\t\t\t\t\t\"</ul>\",\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t\treturn null;\n\t\t}\n\t\treturn ret;\n\t}\n\n\tget_value(key) {\n\t\tlet f = this.fields_dict[key];\n\t\treturn f && (f.get_value ? f.get_value() : null);\n\t}\n\n\tset_value(key, val) {\n\t\treturn new Promise((resolve) => {\n\t\t\tlet f = this.fields_dict[key];\n\t\t\tif (f) {\n\t\t\t\tf.set_value(val).then(() => {\n\t\t\t\t\tf.set_input?.(val);\n\t\t\t\t\tthis.refresh_dependency();\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\thas_field(fieldname) {\n\t\treturn !!this.fields_dict[fieldname];\n\t}\n\n\tset_input(key, val) {\n\t\treturn this.set_value(key, val);\n\t}\n\n\tset_values(dict) {\n\t\tlet promises = [];\n\t\tfor (let key in dict) {\n\t\t\tif (this.fields_dict[key]) {\n\t\t\t\tpromises.push(this.set_value(key, dict[key]));\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tclear() {\n\t\tfor (let key in this.fields_dict) {\n\t\t\tlet f = this.fields_dict[key];\n\t\t\tif (f && f.set_input) {\n\t\t\t\tf.set_input(f.df[\"default\"] || \"\");\n\t\t\t}\n\t\t}\n\t}\n\n\tset_df_property(fieldname, prop, value) {\n\t\tif (!fieldname) {\n\t\t\treturn;\n\t\t}\n\t\tconst field = this.get_field(fieldname);\n\t\tfield.df[prop] = value;\n\t\tfield.refresh();\n\t}\n};\n", "// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.LinkSelector = class LinkSelector {\n\tconstructor(opts) {\n\t\t/* help: Options: doctype, get_query, target */\n\t\t$.extend(this, opts);\n\n\t\tvar me = this;\n\t\tif (this.doctype != \"[Select]\") {\n\t\t\tfrappe.model.with_doctype(this.doctype, function (r) {\n\t\t\t\tme.make();\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make();\n\t\t}\n\t}\n\tmake() {\n\t\tvar me = this;\n\n\t\tthis.start = 0;\n\t\tthis.page_length = 10;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Select {0}\", [this.doctype == \"[Select]\" ? __(\"value\") : __(this.doctype)]),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tfieldname: \"txt\",\n\t\t\t\t\tlabel: __(\"Beginning with\"),\n\t\t\t\t\tdescription: __(\"You can use wildcard %\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\t\tfieldname: \"results\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tfieldname: \"more\",\n\t\t\t\t\tlabel: __(\"More\"),\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tme.start += me.page_length;\n\t\t\t\t\t\tme.search();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __(\"Search\"),\n\t\t\tprimary_action: function () {\n\t\t\t\tme.start = 0;\n\t\t\t\tme.search();\n\t\t\t},\n\t\t});\n\n\t\tif (this.txt) this.dialog.fields_dict.txt.set_input(this.txt);\n\n\t\tthis.dialog.get_input(\"txt\").on(\"keypress\", function (e) {\n\t\t\tif (e.which === 13) {\n\t\t\t\tme.start = 0;\n\t\t\t\tme.search();\n\t\t\t}\n\t\t});\n\t\tthis.dialog.show();\n\t\tthis.search();\n\t}\n\tsearch() {\n\t\tvar args = {\n\t\t\ttxt: this.dialog.fields_dict.txt.get_value(),\n\t\t\tsearchfield: \"name\",\n\t\t\tstart: this.start,\n\t\t\tpage_length: this.page_length,\n\t\t};\n\t\tvar me = this;\n\n\t\tif (this.target.set_custom_query) {\n\t\t\tthis.target.set_custom_query(args);\n\t\t}\n\n\t\t// load custom query from grid\n\t\tif (\n\t\t\tthis.target.is_grid &&\n\t\t\tthis.target.fieldinfo[this.fieldname] &&\n\t\t\tthis.target.fieldinfo[this.fieldname].get_query\n\t\t) {\n\t\t\t$.extend(args, this.target.fieldinfo[this.fieldname].get_query(cur_frm.doc));\n\t\t}\n\n\t\tfrappe.link_search(\n\t\t\tthis.doctype,\n\t\t\targs,\n\t\t\tfunction (results) {\n\t\t\t\tvar parent = me.dialog.fields_dict.results.$wrapper;\n\t\t\t\tif (args.start === 0) {\n\t\t\t\t\tparent.empty();\n\t\t\t\t}\n\n\t\t\t\tif (results.length) {\n\t\t\t\t\tfor (const v of results) {\n\t\t\t\t\t\tvar row = $(\n\t\t\t\t\t\t\trepl(\n\t\t\t\t\t\t\t\t'<div class=\"row link-select-row\">\\\n\t\t\t\t\t\t<div class=\"col-xs-4\">\\\n\t\t\t\t\t\t\t<b><a href=\"#\">%(name)s</a></b></div>\\\n\t\t\t\t\t\t<div class=\"col-xs-8\">\\\n\t\t\t\t\t\t\t<span class=\"text-muted\">%(values)s</span></div>\\\n\t\t\t\t\t\t</div>',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: v[0],\n\t\t\t\t\t\t\t\t\tvalues: v.splice(1).join(\", \"),\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t).appendTo(parent);\n\n\t\t\t\t\t\trow.find(\"a\")\n\t\t\t\t\t\t\t.attr(\"data-value\", v[0])\n\t\t\t\t\t\t\t.click(function () {\n\t\t\t\t\t\t\t\tvar value = $(this).attr(\"data-value\");\n\t\t\t\t\t\t\t\tif (me.target.is_grid) {\n\t\t\t\t\t\t\t\t\t// set in grid\n\t\t\t\t\t\t\t\t\t// call search after value is set to get latest filtered results\n\t\t\t\t\t\t\t\t\tme.set_in_grid(value).then(() => me.search());\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (me.target.doctype)\n\t\t\t\t\t\t\t\t\t\tme.target.parse_validate_and_set_in_model(value);\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\tme.target.set_input(value);\n\t\t\t\t\t\t\t\t\t\tme.target.$input.trigger(\"change\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$(\n\t\t\t\t\t\t'<p><br><span class=\"text-muted\">' +\n\t\t\t\t\t\t\t__(\"No Results\") +\n\t\t\t\t\t\t\t\"</span>\" +\n\t\t\t\t\t\t\t(frappe.model.can_create(me.doctype)\n\t\t\t\t\t\t\t\t? '<br><br><a class=\"new-doc btn btn-default btn-sm\">' +\n\t\t\t\t\t\t\t\t  __(\"Create a new {0}\", [__(me.doctype)]) +\n\t\t\t\t\t\t\t\t  \"</a>\"\n\t\t\t\t\t\t\t\t: \"\") +\n\t\t\t\t\t\t\t\"</p>\"\n\t\t\t\t\t)\n\t\t\t\t\t\t.appendTo(parent)\n\t\t\t\t\t\t.find(\".new-doc\")\n\t\t\t\t\t\t.click(function () {\n\t\t\t\t\t\t\tfrappe.new_doc(me.doctype);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tvar more_btn = me.dialog.fields_dict.more.$wrapper;\n\t\t\t\tif (results.length < me.page_length) {\n\t\t\t\t\tmore_btn.hide();\n\t\t\t\t} else {\n\t\t\t\t\tmore_btn.show();\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis.dialog.get_primary_btn()\n\t\t);\n\t}\n\tset_in_grid(value) {\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.qty_fieldname) {\n\t\t\t\tfrappe.prompt(\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"qty\",\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tlabel: \"Qty\",\n\t\t\t\t\t\tdefault: 1,\n\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t},\n\t\t\t\t\t(data) => {\n\t\t\t\t\t\tlet updated = (this.target.frm.doc[this.target.df.fieldname] || []).some(\n\t\t\t\t\t\t\t(d) => {\n\t\t\t\t\t\t\t\tif (d[this.fieldname] === value) {\n\t\t\t\t\t\t\t\t\tfrappe.model\n\t\t\t\t\t\t\t\t\t\t.set_value(d.doctype, d.name, this.qty_fieldname, data.qty)\n\t\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t\t\t\t\t\t__(\"Added {0} ({1})\", [\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\t\t\t\t\t\t\td[this.qty_fieldname],\n\t\t\t\t\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!updated) {\n\t\t\t\t\t\t\tlet d = null;\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => (d = this.target.add_new_row()),\n\t\t\t\t\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tlet args = {};\n\t\t\t\t\t\t\t\t\targs[this.fieldname] = value;\n\t\t\t\t\t\t\t\t\targs[this.qty_fieldname] = data.qty;\n\t\t\t\t\t\t\t\t\treturn frappe.model.set_value(d.doctype, d.name, args);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => frappe.show_alert(__(\"Added {0} ({1})\", [value, data.qty])),\n\t\t\t\t\t\t\t\t() => resolve(),\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t__(\"Set Quantity\"),\n\t\t\t\t\t__(\"Set Quantity\")\n\t\t\t\t);\n\t\t\t} else if (this.dynamic_link_field) {\n\t\t\t\tlet d = this.target.add_new_row();\n\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\td.doctype,\n\t\t\t\t\td.name,\n\t\t\t\t\tthis.dynamic_link_field,\n\t\t\t\t\tthis.dynamic_link_reference\n\t\t\t\t);\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, this.fieldname, value).then(() => {\n\t\t\t\t\tfrappe.show_alert(__(\"{0} {1} added\", [this.dynamic_link_reference, value]));\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet d = this.target.add_new_row();\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, this.fieldname, value).then(() => {\n\t\t\t\t\tfrappe.show_alert(__(\"{0} added\", [value]));\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n};\n\nfrappe.link_search = function (doctype, args, callback, btn) {\n\tif (!args) {\n\t\targs = {\n\t\t\ttxt: \"\",\n\t\t};\n\t}\n\targs.doctype = doctype;\n\tif (!args.searchfield) {\n\t\targs.searchfield = \"name\";\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.search.search_widget\",\n\t\ttype: \"GET\",\n\t\targs: args,\n\t\tcallback: function (r) {\n\t\t\tcallback && callback(r.message);\n\t\t},\n\t\tbtn: btn,\n\t});\n};\n", "frappe.ui.form.MultiSelectDialog = class MultiSelectDialog {\n\tconstructor(opts) {\n\t\t/* Options: doctype, target, setters, get_query, action, add_filters_group, data_fields, primary_action_label, columns */\n\t\tObject.assign(this, opts);\n\t\tthis.for_select = this.doctype == \"[Select]\";\n\t\tif (!this.for_select) {\n\t\t\tfrappe.model.with_doctype(this.doctype, () => this.init());\n\t\t} else {\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\tinit() {\n\t\tthis.page_length = 20;\n\t\tthis.child_page_length = 20;\n\t\tthis.fields = this.get_fields();\n\n\t\tthis.make();\n\t}\n\n\tget_fields() {\n\t\tconst primary_fields = this.get_primary_filters();\n\t\tconst result_fields = this.get_result_fields();\n\t\tconst data_fields = this.get_data_fields();\n\t\tconst child_selection_fields = this.get_child_selection_fields();\n\n\t\treturn [...primary_fields, ...result_fields, ...data_fields, ...child_selection_fields];\n\t}\n\n\tget_result_fields() {\n\t\tconst show_next_page = () => {\n\t\t\tthis.page_length += 20;\n\t\t\tthis.get_results();\n\t\t};\n\t\treturn [\n\t\t\t{\n\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\tfieldname: \"results_area\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Button\",\n\t\t\t\tfieldname: \"more_btn\",\n\t\t\t\tlabel: __(\"More\"),\n\t\t\t\tclick: show_next_page.bind(this),\n\t\t\t},\n\t\t];\n\t}\n\n\tget_data_fields() {\n\t\tif (this.data_fields && this.data_fields.length) {\n\t\t\t// Custom Data Fields\n\t\t\treturn [{ fieldtype: \"Section Break\" }, ...this.data_fields];\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tget_child_selection_fields() {\n\t\tconst fields = [];\n\t\tif (this.allow_child_item_selection && this.child_fieldname) {\n\t\t\tconst show_more_child_results = () => {\n\t\t\t\tthis.child_page_length += 20;\n\t\t\t\tthis.show_child_results();\n\t\t\t};\n\t\t\tfields.push({ fieldtype: \"HTML\", fieldname: \"child_selection_area\" });\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Button\",\n\t\t\t\tfieldname: \"more_child_btn\",\n\t\t\t\thidden: 1,\n\t\t\t\tlabel: __(\"More\"),\n\t\t\t\tclick: show_more_child_results.bind(this),\n\t\t\t});\n\t\t}\n\t\treturn fields;\n\t}\n\n\tmake() {\n\t\tlet doctype_plural = __(this.doctype).plural();\n\t\tlet title = __(\"Select {0}\", [this.for_select ? __(\"value\") : doctype_plural]);\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: title,\n\t\t\tfields: this.fields,\n\t\t\tsize: this.size,\n\t\t\tprimary_action_label: this.primary_action_label || __(\"Get Items\"),\n\t\t\tsecondary_action_label: __(\"Make {0}\", [__(this.doctype)]),\n\t\t\tprimary_action: () => {\n\t\t\t\tlet filters_data = this.get_custom_filters();\n\t\t\t\tconst data_values = cur_dialog.get_values(); // to pass values of data fields\n\t\t\t\tconst filtered_children = this.get_selected_child_names();\n\t\t\t\tconst selected_documents = [\n\t\t\t\t\t...this.get_checked_values(),\n\t\t\t\t\t...this.get_parent_name_of_selected_children(),\n\t\t\t\t];\n\t\t\t\tthis.action(selected_documents, {\n\t\t\t\t\t...this.args,\n\t\t\t\t\t...data_values,\n\t\t\t\t\t...filters_data,\n\t\t\t\t\tfiltered_children,\n\t\t\t\t});\n\t\t\t},\n\t\t\tsecondary_action: this.make_new_document.bind(this),\n\t\t});\n\n\t\tif (this.add_filters_group) {\n\t\t\tthis.make_filter_area();\n\t\t}\n\n\t\tthis.args = {};\n\n\t\tthis.setup_results();\n\t\tthis.bind_events();\n\t\tthis.get_results();\n\t\tthis.dialog.show();\n\t}\n\n\tmake_new_document(e) {\n\t\t// If user wants to close the modal\n\t\tif (e) {\n\t\t\tthis.set_route_options();\n\t\t\tfrappe.new_doc(this.doctype, true);\n\t\t}\n\t}\n\n\tset_route_options() {\n\t\t// set route options to get pre-filled form fields\n\t\tfrappe.route_options = {};\n\t\tif (Array.isArray(this.setters)) {\n\t\t\tfor (let df of this.setters) {\n\t\t\t\tfrappe.route_options[df.fieldname] =\n\t\t\t\t\tthis.dialog.fields_dict[df.fieldname].get_value() || undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tObject.keys(this.setters).forEach((setter) => {\n\t\t\t\tfrappe.route_options[setter] =\n\t\t\t\t\tthis.dialog.fields_dict[setter].get_value() || undefined;\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_results() {\n\t\tthis.$parent = $(this.dialog.body);\n\t\tthis.$wrapper = this.dialog.fields_dict.results_area.$wrapper\n\t\t\t.append(`<div class=\"results my-3\"\n\t\t\tstyle=\"border: 1px solid #d1d8dd; border-radius: 3px; height: 300px; overflow: auto;\"></div>`);\n\n\t\tthis.$results = this.$wrapper.find(\".results\");\n\t\tthis.$results.append(this.make_list_row());\n\t}\n\n\tshow_child_results() {\n\t\tthis.get_child_result().then((r) => {\n\t\t\tthis.child_results = r.message || [];\n\t\t\tthis.render_child_datatable();\n\n\t\t\tthis.$wrapper.addClass(\"hidden\");\n\t\t\tthis.$child_wrapper.removeClass(\"hidden\");\n\t\t\tthis.dialog.fields_dict.more_btn.$wrapper.hide();\n\t\t});\n\t}\n\n\tis_child_selection_enabled() {\n\t\treturn this.dialog.fields_dict[\"allow_child_item_selection\"]?.get_value();\n\t}\n\n\ttoggle_child_selection() {\n\t\tif (this.is_child_selection_enabled()) {\n\t\t\tthis.show_child_results();\n\t\t} else {\n\t\t\tthis.child_results = [];\n\t\t\tthis.get_results();\n\t\t\tthis.$wrapper.removeClass(\"hidden\");\n\t\t\tthis.$child_wrapper.addClass(\"hidden\");\n\t\t}\n\t}\n\n\trender_child_datatable() {\n\t\tif (!this.child_datatable) {\n\t\t\tthis.setup_child_datatable();\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.child_datatable.rowmanager.checkMap = [];\n\t\t\t\tthis.child_datatable.refresh(this.get_child_datatable_rows());\n\t\t\t\tthis.$child_wrapper.find(\".dt-scrollable\").css(\"height\", \"300px\");\n\t\t\t\tthis.$child_wrapper.find(\".dt-scrollable\").css(\"overflow-y\", \"scroll\");\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\tget_child_datatable_columns() {\n\t\tconst parent = this.doctype;\n\t\treturn [parent, ...this.child_columns].map((d) => ({\n\t\t\tname: frappe.unscrub(d),\n\t\t\teditable: false,\n\t\t}));\n\t}\n\n\tget_child_datatable_rows() {\n\t\tif (this.child_results.length > this.child_page_length) {\n\t\t\tthis.dialog.fields_dict.more_child_btn.toggle(true);\n\t\t} else {\n\t\t\tthis.dialog.fields_dict.more_child_btn.toggle(false);\n\t\t}\n\t\treturn this.child_results\n\t\t\t.slice(0, this.child_page_length)\n\t\t\t.map((d) => Object.values(d).slice(1)); // slice name field\n\t}\n\n\tsetup_child_datatable() {\n\t\tconst header_columns = this.get_child_datatable_columns();\n\t\tconst rows = this.get_child_datatable_rows();\n\t\tthis.$child_wrapper = this.dialog.fields_dict.child_selection_area.$wrapper;\n\t\tthis.$child_wrapper.addClass(\"my-3\");\n\n\t\tthis.child_datatable = new frappe.DataTable(this.$child_wrapper.get(0), {\n\t\t\tcolumns: header_columns,\n\t\t\tdata: rows,\n\t\t\tlayout: \"fluid\",\n\t\t\tinlineFilters: true,\n\t\t\tserialNoColumn: false,\n\t\t\tcheckboxColumn: true,\n\t\t\tcellHeight: 35,\n\t\t\tnoDataMessage: __(\"No Data\"),\n\t\t\tdisableReorderColumn: true,\n\t\t});\n\t\tthis.$child_wrapper.find(\".dt-scrollable\").css(\"height\", \"300px\");\n\t}\n\n\tget_primary_filters() {\n\t\tlet fields = [];\n\n\t\tlet columns = new Array(3);\n\n\t\t// Hack for three column layout\n\t\t// To add column break\n\t\tcolumns[0] = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tlabel: __(\"Name\"),\n\t\t\t\tfieldname: \"search_term\",\n\t\t\t},\n\t\t];\n\t\tcolumns[1] = [];\n\t\tcolumns[2] = [];\n\n\t\tif ($.isArray(this.setters)) {\n\t\t\tthis.setters.forEach((setter, index) => {\n\t\t\t\tcolumns[(index + 1) % 3].push(setter);\n\t\t\t});\n\t\t} else {\n\t\t\tObject.keys(this.setters).forEach((setter, index) => {\n\t\t\t\tlet df_prop = frappe.meta.docfield_map[this.doctype][setter];\n\n\t\t\t\t// Index + 1 to start filling from index 1\n\t\t\t\t// Since Search is a standrd field already pushed\n\t\t\t\tcolumns[(index + 1) % 3].push({\n\t\t\t\t\tfieldtype: df_prop.fieldtype,\n\t\t\t\t\tlabel: df_prop.label,\n\t\t\t\t\tfieldname: setter,\n\t\t\t\t\toptions: df_prop.options,\n\t\t\t\t\tdefault: this.setters[setter],\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/seal\n\t\tif (Object.seal) {\n\t\t\tObject.seal(columns);\n\t\t\t// now a is a fixed-size array with mutable entries\n\t\t}\n\n\t\tif (this.allow_child_item_selection) {\n\t\t\tthis.child_doctype = frappe.meta.get_docfield(\n\t\t\t\tthis.doctype,\n\t\t\t\tthis.child_fieldname\n\t\t\t).options;\n\t\t\tcolumns[0].push({\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: __(\"Select {0}\", [__(this.child_doctype)]),\n\t\t\t\tfieldname: \"allow_child_item_selection\",\n\t\t\t\tonchange: this.toggle_child_selection.bind(this),\n\t\t\t});\n\t\t}\n\n\t\tfields = [\n\t\t\t...columns[0],\n\t\t\t{ fieldtype: \"Column Break\" },\n\t\t\t...columns[1],\n\t\t\t{ fieldtype: \"Column Break\" },\n\t\t\t...columns[2],\n\t\t\t{ fieldtype: \"Section Break\", fieldname: \"primary_filters_sb\" },\n\t\t];\n\n\t\tif (this.add_filters_group) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\tfieldname: \"filter_area\",\n\t\t\t});\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tmake_filter_area() {\n\t\tthis.filter_group = new frappe.ui.FilterGroup({\n\t\t\tparent: this.dialog.get_field(\"filter_area\").$wrapper,\n\t\t\tdoctype: this.doctype,\n\t\t\ton_change: () => {\n\t\t\t\tif (this.is_child_selection_enabled()) {\n\t\t\t\t\tthis.show_child_results();\n\t\t\t\t} else {\n\t\t\t\t\tthis.get_results();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\t// 'Apply Filter' breaks since the filers are not in a popover\n\t\t// Hence keeping it hidden\n\t\tthis.filter_group.wrapper.find(\".apply-filters\").hide();\n\t}\n\n\tget_custom_filters() {\n\t\tif (this.add_filters_group && this.filter_group) {\n\t\t\treturn this.filter_group.get_filters().reduce((acc, filter) => {\n\t\t\t\treturn Object.assign(acc, {\n\t\t\t\t\t[filter[1]]: [filter[2], filter[3]],\n\t\t\t\t});\n\t\t\t}, {});\n\t\t} else {\n\t\t\treturn {};\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tlet me = this;\n\n\t\tthis.$results.on(\"click\", \".list-item-container\", function (e) {\n\t\t\tif (!$(e.target).is(\":checkbox\") && !$(e.target).is(\"a\")) {\n\t\t\t\t$(this).find(\":checkbox\").trigger(\"click\");\n\t\t\t}\n\t\t});\n\n\t\tthis.$results.on(\"click\", \".list-item--head :checkbox\", (e) => {\n\t\t\tthis.$results\n\t\t\t\t.find(\".list-item-container .list-row-check\")\n\t\t\t\t.prop(\"checked\", $(e.target).is(\":checked\"));\n\t\t});\n\n\t\tthis.$parent.find(\".input-with-feedback\").on(\"change\", () => {\n\t\t\tfrappe.flags.auto_scroll = false;\n\t\t\tif (this.is_child_selection_enabled()) {\n\t\t\t\tthis.show_child_results();\n\t\t\t} else {\n\t\t\t\tthis.get_results();\n\t\t\t}\n\t\t});\n\n\t\tthis.$parent.find('[data-fieldtype=\"Data\"]').on(\"input\", () => {\n\t\t\tvar $this = $(this);\n\t\t\tclearTimeout($this.data(\"timeout\"));\n\t\t\t$this.data(\n\t\t\t\t\"timeout\",\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tfrappe.flags.auto_scroll = false;\n\t\t\t\t\tif (me.is_child_selection_enabled()) {\n\t\t\t\t\t\tme.show_child_results();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.empty_list();\n\t\t\t\t\t\tme.get_results();\n\t\t\t\t\t}\n\t\t\t\t}, 300)\n\t\t\t);\n\t\t});\n\t}\n\n\tget_parent_name_of_selected_children() {\n\t\tif (!this.child_datatable || !this.child_datatable.datamanager.rows.length) return [];\n\n\t\tlet parent_names = this.child_datatable.rowmanager.checkMap.reduce(\n\t\t\t(parent_names, checked, index) => {\n\t\t\t\tif (checked == 1) {\n\t\t\t\t\tconst parent_name = this.child_results[index].parent;\n\t\t\t\t\tif (!parent_names.includes(parent_name)) {\n\t\t\t\t\t\tparent_names.push(parent_name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn parent_names;\n\t\t\t},\n\t\t\t[]\n\t\t);\n\n\t\treturn parent_names;\n\t}\n\n\tget_selected_child_names() {\n\t\tif (!this.child_datatable || !this.child_datatable.datamanager.rows.length) return [];\n\n\t\tlet checked_names = this.child_datatable.rowmanager.checkMap.reduce(\n\t\t\t(checked_names, checked, index) => {\n\t\t\t\tif (checked == 1) {\n\t\t\t\t\tconst child_row_name = this.child_results[index].name;\n\t\t\t\t\tchecked_names.push(child_row_name);\n\t\t\t\t}\n\t\t\t\treturn checked_names;\n\t\t\t},\n\t\t\t[]\n\t\t);\n\n\t\treturn checked_names;\n\t}\n\n\tget_checked_values() {\n\t\t// Return name of checked value.\n\t\treturn this.$results\n\t\t\t.find(\".list-item-container\")\n\t\t\t.map(function () {\n\t\t\t\tif ($(this).find(\".list-row-check:checkbox:checked\").length > 0) {\n\t\t\t\t\treturn $(this).attr(\"data-item-name\");\n\t\t\t\t}\n\t\t\t})\n\t\t\t.get();\n\t}\n\n\tget_checked_items() {\n\t\t// Return checked items with all the column values.\n\t\tlet checked_values = this.get_checked_values();\n\t\treturn this.results.filter((res) => checked_values.includes(res.name));\n\t}\n\n\tget_datatable_columns() {\n\t\tif (this.get_query && this.get_query().query && this.columns) return this.columns;\n\n\t\tif (Array.isArray(this.setters))\n\t\t\treturn [\"name\", ...this.setters.map((df) => df.fieldname)];\n\n\t\treturn [\"name\", ...Object.keys(this.setters)];\n\t}\n\n\tmake_list_row(result = {}) {\n\t\tvar me = this;\n\t\t// Make a head row by default (if result not passed)\n\t\tlet head = Object.keys(result).length === 0;\n\n\t\tlet contents = ``;\n\t\tthis.get_datatable_columns().forEach(function (column) {\n\t\t\tcontents += `<div class=\"list-item__content ellipsis\">\n\t\t\t\t${\n\t\t\t\t\thead\n\t\t\t\t\t\t? `<span class=\"ellipsis text-muted\" title=\"${__(\n\t\t\t\t\t\t\t\tfrappe.model.unscrub(column)\n\t\t\t\t\t\t  )}\">${__(frappe.model.unscrub(column))}</span>`\n\t\t\t\t\t\t: column !== \"name\"\n\t\t\t\t\t\t? `<span class=\"ellipsis result-row\" title=\"${__(\n\t\t\t\t\t\t\t\tresult[column] || \"\"\n\t\t\t\t\t\t  )}\">${__(result[column] || \"\")}</span>`\n\t\t\t\t\t\t: `<a href=\"${\n\t\t\t\t\t\t\t\t\"/app/\" + frappe.router.slug(me.doctype) + \"/\" + result[column] ||\n\t\t\t\t\t\t\t\t\"\"\n\t\t\t\t\t\t  }\" class=\"list-id ellipsis\" title=\"${__(result[column] || \"\")}\">\n\t\t\t\t\t\t\t${__(result[column] || \"\")}</a>`\n\t\t\t\t}\n\t\t\t</div>`;\n\t\t});\n\n\t\tlet $row = $(`<div class=\"list-item\">\n\t\t\t<div class=\"list-item__content\" style=\"flex: 0 0 10px;\">\n\t\t\t\t<input type=\"checkbox\" class=\"list-row-check\" data-item-name=\"${result.name}\" ${\n\t\t\tresult.checked ? \"checked\" : \"\"\n\t\t}>\n\t\t\t</div>\n\t\t\t${contents}\n\t\t</div>`);\n\n\t\thead\n\t\t\t? $row.addClass(\"list-item--head\")\n\t\t\t: ($row = $(\n\t\t\t\t\t`<div class=\"list-item-container\" data-item-name=\"${result.name}\"></div>`\n\t\t\t  ).append($row));\n\n\t\treturn $row;\n\t}\n\n\trender_result_list(results, more = 0, empty = true) {\n\t\tvar me = this;\n\t\tvar more_btn = me.dialog.fields_dict.more_btn.$wrapper;\n\n\t\t// Make empty result set if filter is set\n\t\tif (!frappe.flags.auto_scroll && empty) {\n\t\t\tthis.empty_list();\n\t\t}\n\t\tmore_btn.hide();\n\t\t$(\".modal-dialog .list-item--head\").css(\"z-index\", 1);\n\n\t\tif (results.length === 0) return;\n\t\tif (more) more_btn.show();\n\n\t\tlet checked = this.get_checked_values();\n\n\t\tresults\n\t\t\t.filter((result) => !checked.includes(result.name))\n\t\t\t.forEach((result) => {\n\t\t\t\tme.$results.append(me.make_list_row(result));\n\t\t\t});\n\n\t\tthis.$results.find(\".list-item--head\").css(\"z-index\", 1);\n\n\t\tif (frappe.flags.auto_scroll) {\n\t\t\tthis.$results.animate({ scrollTop: me.$results.prop(\"scrollHeight\") }, 500);\n\t\t}\n\t}\n\n\tempty_list() {\n\t\t// Store all checked items\n\t\tlet checked = this.get_checked_items().map((item) => {\n\t\t\treturn {\n\t\t\t\t...item,\n\t\t\t\tchecked: true,\n\t\t\t};\n\t\t});\n\n\t\t// Remove **all** items\n\t\tthis.$results.find(\".list-item-container\").remove();\n\n\t\t// Rerender checked items\n\t\tthis.render_result_list(checked, 0, false);\n\t}\n\n\tget_filters_from_setters() {\n\t\tlet me = this;\n\t\tlet filters = (this.get_query ? this.get_query().filters : {}) || {};\n\t\tlet filter_fields = [];\n\n\t\tif ($.isArray(this.setters)) {\n\t\t\tfor (let df of this.setters) {\n\t\t\t\tfilters[df.fieldname] =\n\t\t\t\t\tme.dialog.fields_dict[df.fieldname].get_value() || undefined;\n\t\t\t\tme.args[df.fieldname] = filters[df.fieldname];\n\t\t\t\tfilter_fields.push(df.fieldname);\n\t\t\t}\n\t\t} else {\n\t\t\tObject.keys(this.setters).forEach(function (setter) {\n\t\t\t\tvar value = me.dialog.fields_dict[setter].get_value();\n\t\t\t\tif (me.dialog.fields_dict[setter].df.fieldtype == \"Data\" && value) {\n\t\t\t\t\tfilters[setter] = [\"like\", \"%\" + value + \"%\"];\n\t\t\t\t} else {\n\t\t\t\t\tfilters[setter] = value || undefined;\n\t\t\t\t\tme.args[setter] = filters[setter];\n\t\t\t\t\tfilter_fields.push(setter);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn [filters, filter_fields];\n\t}\n\n\tget_args_for_search() {\n\t\tlet [filters, filter_fields] = this.get_filters_from_setters();\n\n\t\tlet custom_filters = this.get_custom_filters();\n\t\tObject.assign(filters, custom_filters);\n\n\t\treturn {\n\t\t\tdoctype: this.doctype,\n\t\t\ttxt: this.dialog.fields_dict[\"search_term\"].get_value(),\n\t\t\tfilters: filters,\n\t\t\tfilter_fields: filter_fields,\n\t\t\tpage_length: this.page_length + 5,\n\t\t\tquery: this.get_query ? this.get_query().query : \"\",\n\t\t\tas_dict: 1,\n\t\t};\n\t}\n\n\tasync perform_search(args) {\n\t\tconst res = await frappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: \"frappe.desk.search.search_widget\",\n\t\t\tno_spinner: true,\n\t\t\targs: args,\n\t\t});\n\t\tconst more = res.message.length && res.message.length > this.page_length ? 1 : 0;\n\n\t\treturn [res.message, more];\n\t}\n\n\tasync get_results() {\n\t\tconst args = this.get_args_for_search();\n\t\tlet [results, more] = await this.perform_search(args);\n\n\t\tif (more) {\n\t\t\tresults = results.splice(0, this.page_length);\n\t\t}\n\n\t\tthis.results = [];\n\t\tif (results.length) {\n\t\t\tresults.forEach((result) => {\n\t\t\t\tresult.checked = 0;\n\t\t\t\tthis.results.push(result);\n\t\t\t});\n\t\t}\n\t\tthis.render_result_list(this.results, more);\n\t}\n\n\tasync get_filtered_parents_for_child_search() {\n\t\tconst parent_search_args = this.get_args_for_search();\n\t\tparent_search_args.filter_fields = [\"name\"];\n\t\tconst [results, _] = await this.perform_search(parent_search_args);\n\n\t\tlet parent_names = [];\n\t\tif (results.length) {\n\t\t\tparent_names = results.map((v) => v.name);\n\t\t}\n\t\treturn parent_names;\n\t}\n\n\tasync add_parent_filters(filters) {\n\t\tconst parent_names = await this.get_filtered_parents_for_child_search();\n\t\tif (parent_names.length) {\n\t\t\tfilters.push([\"parent\", \"in\", parent_names]);\n\t\t}\n\t}\n\n\tadd_custom_child_filters(filters) {\n\t\tif (this.add_filters_group && this.filter_group) {\n\t\t\tthis.filter_group.get_filters().forEach((filter) => {\n\t\t\t\tif (filter[0] == this.child_doctype) {\n\t\t\t\t\tfilters.push([filter[1], filter[2], filter[3]]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tasync get_child_result() {\n\t\tlet filters = [[\"parentfield\", \"=\", this.child_fieldname]];\n\n\t\tawait this.add_parent_filters(filters);\n\t\tthis.add_custom_child_filters(filters);\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.child_doctype,\n\t\t\t\tfilters: filters,\n\t\t\t\tfields: [\"name\", \"parent\", ...this.child_columns],\n\t\t\t\tparent: this.doctype,\n\t\t\t\tlimit_page_length: this.child_page_length + 5,\n\t\t\t\torder_by: \"parent\",\n\t\t\t},\n\t\t});\n\t}\n};\n", "import \"./field_group\";\nimport \"../dom\";\n\nfrappe.provide(\"frappe.ui\");\n\nwindow.cur_dialog = null;\n\nfrappe.ui.open_dialogs = [];\n\nfrappe.ui.Dialog = class Dialog extends frappe.ui.FieldGroup {\n\tconstructor(opts) {\n\t\tsuper();\n\t\tthis.display = false;\n\t\tthis.is_dialog = true;\n\n\t\t$.extend(this, { animate: true, size: null }, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.$wrapper = frappe.get_modal(\"\", \"\");\n\n\t\tif (this.static) {\n\t\t\tthis.$wrapper.modal({\n\t\t\t\tbackdrop: \"static\",\n\t\t\t\tkeyboard: false,\n\t\t\t});\n\t\t\tthis.get_close_btn().hide();\n\t\t}\n\n\t\tif (!this.size) this.set_modal_size();\n\n\t\tthis.wrapper = this.$wrapper.find(\".modal-dialog\").get(0);\n\t\tif (this.size == \"small\") $(this.wrapper).addClass(\"modal-sm\");\n\t\telse if (this.size == \"large\") $(this.wrapper).addClass(\"modal-lg\");\n\t\telse if (this.size == \"extra-large\") $(this.wrapper).addClass(\"modal-xl\");\n\n\t\tthis.make_head();\n\t\tthis.modal_body = this.$wrapper.find(\".modal-body\");\n\t\tthis.$body = $(\"<div></div>\").appendTo(this.modal_body);\n\t\tthis.body = this.$body.get(0);\n\t\tthis.$message = $('<div class=\"hide modal-message\"></div>').appendTo(this.modal_body);\n\t\tthis.header = this.$wrapper.find(\".modal-header\");\n\t\tthis.footer = this.$wrapper.find(\".modal-footer\");\n\t\tthis.standard_actions = this.footer.find(\".standard-actions\");\n\t\tthis.custom_actions = this.footer.find(\".custom-actions\");\n\t\tthis.set_indicator();\n\n\t\t// make fields (if any)\n\t\tsuper.make();\n\n\t\tthis.refresh_section_collapse();\n\n\t\t// show footer\n\t\tthis.action = this.action || { primary: {}, secondary: {} };\n\t\tif (this.primary_action || (this.action.primary && this.action.primary.onsubmit)) {\n\t\t\tthis.set_primary_action(\n\t\t\t\tthis.primary_action_label ||\n\t\t\t\t\tthis.action.primary.label ||\n\t\t\t\t\t__(\"Submit\", null, \"Primary action in dialog\"),\n\t\t\t\tthis.primary_action || this.action.primary.onsubmit\n\t\t\t);\n\t\t}\n\n\t\tif (this.secondary_action) {\n\t\t\tthis.set_secondary_action(this.secondary_action);\n\t\t}\n\n\t\tif (\n\t\t\tthis.secondary_action_label ||\n\t\t\t(this.action.secondary && this.action.secondary.label)\n\t\t) {\n\t\t\tthis.set_secondary_action_label(\n\t\t\t\tthis.secondary_action_label || this.action.secondary.label\n\t\t\t);\n\t\t}\n\n\t\tif (this.minimizable) {\n\t\t\tthis.header\n\t\t\t\t.find(\".title-section\")\n\t\t\t\t.click(() => this.is_minimized && this.toggle_minimize());\n\t\t\tthis.get_minimize_btn()\n\t\t\t\t.removeClass(\"hide\")\n\t\t\t\t.on(\"click\", () => this.toggle_minimize());\n\t\t}\n\n\t\tvar me = this;\n\t\tthis.$wrapper\n\t\t\t.on(\"hide.bs.modal\", function () {\n\t\t\t\tme.display = false;\n\t\t\t\tme.is_minimized = false;\n\t\t\t\tme.hide_scrollbar(false);\n\t\t\t\t// hide any grid row form if open\n\t\t\t\tfrappe.ui.form.get_open_grid_form?.()?.hide_form();\n\n\t\t\t\tif (frappe.ui.open_dialogs[frappe.ui.open_dialogs.length - 1] === me) {\n\t\t\t\t\tfrappe.ui.open_dialogs.pop();\n\t\t\t\t\tif (frappe.ui.open_dialogs.length) {\n\t\t\t\t\t\twindow.cur_dialog =\n\t\t\t\t\t\t\tfrappe.ui.open_dialogs[frappe.ui.open_dialogs.length - 1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\twindow.cur_dialog = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tme.onhide && me.onhide();\n\t\t\t\tme.on_hide && me.on_hide();\n\t\t\t})\n\t\t\t.on(\"shown.bs.modal\", function () {\n\t\t\t\t// focus on first input\n\t\t\t\tme.display = true;\n\t\t\t\twindow.cur_dialog = me;\n\t\t\t\tfrappe.ui.open_dialogs.push(me);\n\t\t\t\tme.focus_on_first_input();\n\t\t\t\tme.hide_scrollbar(true);\n\t\t\t\tme.on_page_show && me.on_page_show();\n\t\t\t\t$(document).trigger(\"frappe.ui.Dialog:shown\");\n\t\t\t\t$(document).off(\"focusin.modal\");\n\t\t\t})\n\t\t\t.on(\"scroll\", function () {\n\t\t\t\tvar $input = $(\"input:focus\");\n\t\t\t\tif (\n\t\t\t\t\t$input.length &&\n\t\t\t\t\t[\"Date\", \"Datetime\", \"Time\"].includes($input.attr(\"data-fieldtype\"))\n\t\t\t\t) {\n\t\t\t\t\t$input.blur();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tset_modal_size() {\n\t\tif (!this.fields) {\n\t\t\tthis.size = \"\";\n\t\t\treturn;\n\t\t}\n\n\t\tlet col_brk = 0;\n\t\tlet cur_col_brk = 0;\n\n\t\t// if fields have more than 2 Column Breaks before encountering Section Break, make it large\n\t\tthis.fields.forEach((field) => {\n\t\t\tif (field.fieldtype == \"Column Break\") {\n\t\t\t\tcur_col_brk++;\n\n\t\t\t\tif (cur_col_brk > col_brk) {\n\t\t\t\t\tcol_brk = cur_col_brk;\n\t\t\t\t}\n\t\t\t} else if (field.fieldtype == \"Section Break\") {\n\t\t\t\tcur_col_brk = 0;\n\t\t\t}\n\t\t});\n\n\t\tthis.size = col_brk >= 4 ? \"extra-large\" : col_brk >= 2 ? \"large\" : \"\";\n\t}\n\n\tget_primary_btn() {\n\t\treturn this.standard_actions.find(\".btn-primary\");\n\t}\n\n\tget_minimize_btn() {\n\t\treturn this.$wrapper.find(\".modal-header .btn-modal-minimize\");\n\t}\n\n\tset_message(text) {\n\t\tthis.$message.removeClass(\"hide\");\n\t\tthis.$body.addClass(\"hide\");\n\t\tthis.$message.text(text);\n\t}\n\n\tclear_message() {\n\t\tthis.$message.addClass(\"hide\");\n\t\tthis.$body.removeClass(\"hide\");\n\t}\n\n\tclear() {\n\t\tsuper.clear();\n\t\tthis.clear_message();\n\t}\n\n\tset_primary_action(label, click) {\n\t\tthis.footer.removeClass(\"hide\");\n\t\tthis.has_primary_action = true;\n\t\tvar me = this;\n\t\tconst primary_btn = this.get_primary_btn().removeClass(\"hide\").html(label);\n\t\tif (typeof click == \"function\") {\n\t\t\tprimary_btn.off(\"click\").on(\"click\", function () {\n\t\t\t\tme.primary_action_fulfilled = true;\n\t\t\t\t// get values and send it\n\t\t\t\t// as first parameter to click callback\n\t\t\t\t// if no values then return\n\t\t\t\tvar values = me.get_values();\n\t\t\t\tif (!values) return;\n\t\t\t\tclick && click.apply(me, [values]);\n\t\t\t});\n\t\t}\n\t\treturn primary_btn;\n\t}\n\n\tset_secondary_action(click) {\n\t\tthis.footer.removeClass(\"hide\");\n\t\treturn this.get_secondary_btn().removeClass(\"hide\").off(\"click\").on(\"click\", click);\n\t}\n\n\tset_secondary_action_label(label) {\n\t\tthis.get_secondary_btn().removeClass(\"hide\").html(label);\n\t}\n\n\tdisable_primary_action() {\n\t\tthis.get_primary_btn().addClass(\"disabled\");\n\t}\n\n\tenable_primary_action() {\n\t\tthis.get_primary_btn().removeClass(\"disabled\");\n\t}\n\n\tmake_head() {\n\t\tthis.set_title(this.title);\n\t}\n\n\tset_title(t) {\n\t\tthis.$wrapper.find(\".modal-title\").html(t);\n\t}\n\n\tset_indicator() {\n\t\tif (this.indicator) {\n\t\t\tthis.header\n\t\t\t\t.find(\".indicator\")\n\t\t\t\t.removeClass()\n\t\t\t\t.addClass(\"indicator \" + this.indicator);\n\t\t}\n\t}\n\n\tshow() {\n\t\t// show it\n\t\tif (this.animate) {\n\t\t\tthis.$wrapper.addClass(\"fade\");\n\t\t} else {\n\t\t\tthis.$wrapper.removeClass(\"fade\");\n\t\t}\n\t\tthis.$wrapper.modal(\"show\");\n\n\t\tthis.$wrapper.removeClass(\"modal-minimize\");\n\n\t\tif (this.minimizable && this.is_minimized) {\n\t\t\t$(\".modal-backdrop\").toggle();\n\t\t\tthis.is_minimized = false;\n\t\t}\n\n\t\t// clear any message\n\t\tthis.clear_message();\n\n\t\tthis.primary_action_fulfilled = false;\n\t\tthis.is_visible = true;\n\t\treturn this;\n\t}\n\n\thide() {\n\t\tthis.$wrapper.modal(\"hide\");\n\t\tthis.is_visible = false;\n\t}\n\n\tget_close_btn() {\n\t\treturn this.$wrapper.find(\".btn-modal-close\");\n\t}\n\n\tget_secondary_btn() {\n\t\treturn this.standard_actions.find(\".btn-modal-secondary\");\n\t}\n\n\tno_cancel() {\n\t\tthis.get_close_btn().toggle(false);\n\t}\n\n\tcancel() {\n\t\tthis.get_close_btn().trigger(\"click\");\n\t}\n\n\ttoggle_minimize() {\n\t\t$(\".modal-backdrop\").toggle();\n\t\tlet modal = this.$wrapper.closest(\".modal\").toggleClass(\"modal-minimize\");\n\t\tmodal.attr(\"tabindex\") ? modal.removeAttr(\"tabindex\") : modal.attr(\"tabindex\", -1);\n\t\tthis.is_minimized = !this.is_minimized;\n\t\tconst icon = this.is_minimized ? \"expand\" : \"collapse\";\n\t\tthis.get_minimize_btn().html(frappe.utils.icon(icon));\n\t\tthis.on_minimize_toggle && this.on_minimize_toggle(this.is_minimized);\n\t\tthis.header.find(\".modal-title\").toggleClass(\"cursor-pointer\");\n\t\tthis.hide_scrollbar(!this.is_minimized);\n\t}\n\n\thide_scrollbar(bool) {\n\t\t$(\"body\").css(\"overflow\", bool ? \"hidden\" : \"auto\");\n\t}\n\n\tadd_custom_action(label, action, css_class = null) {\n\t\tthis.footer.removeClass(\"hide\");\n\t\tlet action_button = $(`\n\t\t\t<button class=\"btn btn-secondary btn-sm ${css_class || \"\"}\">\n\t\t\t\t${label}\n\t\t\t</button>\n\t\t`);\n\t\tthis.custom_actions.append(action_button);\n\n\t\taction && action_button.click(action);\n\t}\n};\n\nfrappe.ui.hide_open_dialog = () => {\n\t// hide open dialog\n\tif (window.cur_dialog) {\n\t\tif (!cur_dialog.minimizable) {\n\t\t\tcur_dialog.hide();\n\t\t} else if (!cur_dialog.is_minimized) {\n\t\t\tcur_dialog.toggle_minimize();\n\t\t}\n\t}\n};\n"],
  "mappings": "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",
  "names": ["id", "ele", "$ele", "txt", "el", "evil_tags", "doc", "body", "found", "tag", "element", "relation", "tolerance", "rect", "se", "parent", "newtag", "className", "cs", "innerHTML", "onclick", "c", "s", "$parent", "$child", "common_class", "active_class", "msg", "css_class", "freeze", "sel", "ranges", "i", "len", "savedSel", "container", "$container", "file_obj", "resolve", "reader", "section_name", "section", "pixels", "div", "dpi_x", "inches", "text", "max", "tasks", "result", "task", "src", "onload", "onerror", "preprocess", "tester", "seconds", "spacer", "label", "target_id", "remove_action", "image", "data_pill_wrapper", "remove_btn", "title", "content", "wrapper", "html", "css", "js", "random_id", "CustomBlock", "_a", "_b", "_c", "_d", "link", "style", "script", "value", "options", "df", "std_df", "docfield", "doc", "precision", "temp", "rating_html", "number_of_stars", "_", "i", "currency", "parts", "decimals", "fraction", "doctype", "original_value", "link_title", "a", "tags", "match", "duration_options", "html", "v", "formatted_value", "e", "workflow_state", "rows", "link_field", "row", "format_attachment_url", "url", "fieldtype", "__spreadProps", "__spreadValues", "formatter", "formatted", "helper", "fieldname", "Section", "parent", "df", "card_layout", "layout", "make_card", "fieldname", "fieldobj", "_a", "olfldobj", "idx", "e", "hide", "f", "indicator_icon", "missing_mandatory", "j", "l", "section_df", "show", "Tab", "layout", "df", "frm", "tab_link_container", "tabs_content", "id", "hide", "show", "fieldobj", "_a", "_b", "Column", "section", "df", "columns", "colspan", "opts", "fields", "field", "f", "docfield", "html", "color", "close_message", "new_fields", "default_tab", "first_field_visible", "element", "newname_field", "df", "fieldname", "render", "_a", "prev_fieldobj", "fieldobj", "idx", "e", "section", "colspan", "parent", "me", "head", "page", "Section", "Column", "tab", "Tab", "doc", "fieldtype", "visible_tabs", "label_or_fieldname", "_b", "frm_active_tab", "first_visible_tab", "fieldnames", "i", "collapse", "refresh", "l", "last_scroll", "tabs_list", "tabs_content", "current_scroll", "ev", "current", "doctype", "shift", "grid_row", "prev", "focused", "len", "start_idx", "has_dep", "fkey", "condition", "property", "value", "form_obj", "expression", "out", "opts", "i", "f", "me", "field", "def_value", "e", "fieldname", "ignore_errors", "check_invalid", "ret", "errors", "invalid", "key", "v", "val", "resolve", "_a", "dict", "promises", "prop", "value", "opts", "me", "r", "e", "args", "results", "parent", "v", "row", "value", "more_btn", "resolve", "data", "d", "doctype", "callback", "btn", "opts", "primary_fields", "result_fields", "data_fields", "child_selection_fields", "show_next_page", "fields", "show_more_child_results", "doctype_plural", "title", "filters_data", "data_values", "filtered_children", "selected_documents", "__spreadProps", "__spreadValues", "df", "setter", "r", "_a", "d", "header_columns", "rows", "columns", "index", "df_prop", "acc", "filter", "me", "e", "$this", "parent_names", "checked", "parent_name", "checked_names", "child_row_name", "checked_values", "res", "result", "head", "contents", "column", "$row", "results", "more", "empty", "more_btn", "item", "filters", "filter_fields", "value", "custom_filters", "args", "parent_search_args", "_", "v", "opts", "me", "_a", "_b", "_c", "$input", "col_brk", "cur_col_brk", "field", "text", "label", "click", "primary_btn", "values", "t", "modal", "icon", "bool", "action", "css_class", "action_button"]
}
