(()=>{var C=Object.defineProperty,x=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var v=(i,e,t)=>e in i?C(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,d=(i,e)=>{for(var t in e||(e={}))z.call(e,t)&&v(i,t,e[t]);if(w)for(var t of w(e))L.call(e,t)&&v(i,t,e[t]);return i},f=(i,e)=>x(i,T(e));frappe.provide("frappe.dom");frappe.dom={id_count:0,freeze_count:0,by_id:function(i){return document.getElementById(i)},get_unique_id:function(){let i="unique-"+frappe.dom.id_count;return frappe.dom.id_count++,i},set_unique_id:function(i){var e=$(i);if(e.attr("id"))return e.attr("id");var t="unique-"+frappe.dom.id_count;return e.attr("id",t),frappe.dom.id_count++,t},eval:function(i){if(!!i){var e=document.createElement("script");e.appendChild(document.createTextNode(i)),document.getElementsByTagName("head")[0].appendChild(e)}},remove_script_and_style:function(i){let e=["script","style","noscript","title","meta","base","head"],s=new DOMParser().parseFromString(i,"text/html"),a=s.body,r=!!s.head.innerHTML;for(let l of e)for(let n of a.getElementsByTagName(l))r=!0,n.parentNode.removeChild(n);for(let l of a.getElementsByTagName("link")){let n=l.getAttribute("rel");n&&n.toLowerCase().trim()==="stylesheet"&&(r=!0,l.parentNode.removeChild(l))}return r?a.innerHTML:i},is_element_in_viewport:function(i,e=0){typeof jQuery=="function"&&i instanceof jQuery&&(i=i[0]);var t=i.getBoundingClientRect();return t.top+e>=0&&t.left+e>=0&&t.bottom-e<=$(window).height()&&t.right-e<=$(window).width()},is_element_in_modal(i){return Boolean($(i).parents(".modal").length)},set_style:function(i,e){if(!!i){var t=document.createElement("style");if(t.type="text/css",e){var s=document.getElementById(e);s&&s.parentNode.removeChild(s),t.id=e}return t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i)),document.getElementsByTagName("head")[0].appendChild(t),t}},add:function(i,e,t,s,a,r){i&&i.substr&&(i=frappe.dom.by_id(i));var l=document.createElement(e);return i&&i.appendChild(l),t&&(e.toLowerCase()=="img"?l.src=t:l.className=t),s&&frappe.dom.css(l,s),a&&(l.innerHTML=a),r&&(l.onclick=r),l},css:function(i,e){return i&&e&&$.extend(i.style,e),i},activate:function(i,e,t,s="active"){i.find(`.${t}.${s}`).removeClass(s),e.addClass(s)},freeze:function(i,e){if($("#freeze").length)$("#freeze").addClass("in");else{var t=$('<div id="freeze" class="modal-backdrop fade"></div>').on("click",function(){if(cur_frm&&cur_frm.cur_grid)return cur_frm.cur_grid.toggle_view(),!1}).appendTo("#body");t.html(repl('<div class="freeze-message-container"><div class="freeze-message"><p class="lead">%(msg)s</p></div></div>',{msg:i||""})),setTimeout(function(){t.addClass("in")},1)}e&&$("#freeze").addClass(e),frappe.dom.freeze_count++},unfreeze:function(){if(!!frappe.dom.freeze_count&&(frappe.dom.freeze_count--,!frappe.dom.freeze_count))var i=$("#freeze").removeClass("in").remove()},save_selection:function(){if(window.getSelection){var i=window.getSelection();if(i.getRangeAt&&i.rangeCount){for(var e=[],t=0,s=i.rangeCount;t<s;++t)e.push(i.getRangeAt(t));return e}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restore_selection:function(i){if(i)if(window.getSelection){var e=window.getSelection();e.removeAllRanges();for(var t=0,s=i.length;t<s;++t)e.addRange(i[t])}else document.selection&&i.select&&i.select()},is_touchscreen:function(){return"ontouchstart"in window},handle_broken_images(i){$(i).find("img").on("error",e=>{$(e.currentTarget).addClass("no-image")})},scroll_to_bottom(i){let e=$(i);e.scrollTop(e[0].scrollHeight)},file_to_base64(i){return new Promise(e=>{let t=new FileReader;t.onload=function(){e(t.result)},t.readAsDataURL(i)})},scroll_to_section(i){setTimeout(()=>{let e=$(`a:contains("${i}")`);e.length&&(e.parent().hasClass("collapsed")&&e.click(),frappe.ui.scroll(e.parent().parent()))},200)},pixel_to_inches(i){let e=$('<div id="dpi" style="height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"></div>');e.appendTo(document.body);let t=document.getElementById("dpi").offsetWidth,s=i/t;return e.remove(),s}};frappe.ellipsis=function(i,e){return e||(e=20),i=cstr(i),i.length>e&&(i=i.substr(0,e)+"..."),i};frappe.run_serially=function(i){var e=Promise.resolve();return i.forEach(t=>{t&&(e=e.then?e.then(t):Promise.resolve())}),e};frappe.load_image=(i,e,t,s=()=>{})=>{var a=new Image;a.onload=function(){e(this)},a.onerror=t,s(a),a.src=i};frappe.timeout=i=>new Promise(e=>{setTimeout(()=>e(),i*1e3)});frappe.scrub=function(i,e="_"){return i.replace(/ /g,e).toLowerCase()};frappe.unscrub=function(i){return frappe.model.unscrub(i)};frappe.get_data_pill=(i,e=null,t=null,s=null)=>{let a=$(`
		<button class="data-pill btn">
			<div class="flex align-center ellipsis">
				${s||""}
				<span class="pill-label">${i}</span>
			</div>
		</button>
	`);if(t){let r=$(`
			<span class="remove-btn cursor-pointer">
				${frappe.utils.icon("close","sm")}
			</span>
		`).click(()=>{t(e||i,a)});a.append(r)}return a};frappe.get_modal=function(i,e){return $(`<div class="modal fade" style="overflow: auto;" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<div class="fill-width flex title-section">
						<span class="indicator hidden"></span>
						<h4 class="modal-title">${i}</h4>
					</div>
					<div class="modal-actions">
						<button class="btn btn-modal-minimize btn-link hide">
							${frappe.utils.icon("collapse")}
						</button>
						<button class="btn btn-modal-close btn-link" data-dismiss="modal">
							${frappe.utils.icon("close-alt","sm","close-alt")}
						</button>
					</div>
				</div>
				<div class="modal-body ui-front">${e}</div>
				<div class="modal-footer hide">
					<div class="custom-actions"></div>
					<div class="standard-actions">
						<button type="button" class="btn btn-secondary btn-sm hide btn-modal-secondary">
						</button>
						<button type="button" class="btn btn-primary btn-sm hide btn-modal-primary">
							${__("Confirm")}
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>`)};frappe.is_online=function(){return frappe.boot.developer_mode==1?!0:"onLine"in navigator?navigator.onLine:!0};frappe.create_shadow_element=function(i,e,t,s){let a="custom-block-"+frappe.utils.get_random(5).toLowerCase();class r extends HTMLElement{constructor(){var u,g,b,y;super();let n=document.createElement("div");n.innerHTML=frappe.dom.remove_script_and_style(e);let o=document.createElement("link");o.rel="stylesheet",o.href=frappe.assets.bundled_asset("desk.bundle.css");let c=document.createElement("style");c.textContent=t;let m=document.createElement("script");m.textContent=`
				(function() {
					let cname = ${JSON.stringify(a)};
					let root_element = document.querySelector(cname).shadowRoot;
					${s}
				})();
			`,this.attachShadow({mode:"open"}),(u=this.shadowRoot)==null||u.appendChild(o),(g=this.shadowRoot)==null||g.appendChild(n),(b=this.shadowRoot)==null||b.appendChild(c),(y=this.shadowRoot)==null||y.appendChild(m)}}customElements.get(a)||customElements.define(a,r),i.innerHTML=`<${a}></${a}>`};$(window).on("online",function(){document.hidden||frappe.show_alert({indicator:"green",message:__("You are connected to internet.")})});$(window).on("offline",function(){document.hidden||frappe.show_alert({indicator:"orange",message:__("Connection lost. Some features might not work.")})});frappe.provide("frappe.form.formatters");frappe.form.link_formatters={};frappe.form.formatters={_right:function(i,e){return e&&(e.inline||e.only_value)?i:"<div style='text-align: right'>"+i+"</div>"},_apply_custom_formatter:function(i,e){if(e){let t=frappe.meta.docfield_map[e.parent]&&frappe.meta.docfield_map[e.parent][e.fieldname];t&&t.formatter&&typeof t.formatter=="function"&&(i=t.formatter(i,e))}return i},Data:function(i,e){return e&&e.options=="URL"?i?`<a href="${i}" title="Open Link" target="_blank">${i}</a>`:void 0:(i=i==null?"":i,frappe.form.formatters._apply_custom_formatter(i,e))},Autocomplete:function(i,e){return __(frappe.form.formatters.Data(i,e))},Select:function(i,e){return __(frappe.form.formatters.Data(i,e))},Float:function(i,e,t,s){var a=e.precision||cint(frappe.boot.sysdefaults&&frappe.boot.sysdefaults.float_precision)||null;if(e.options&&e.options.trim())return e.precision=a,frappe.form.formatters.Currency(i,e,t,s);if(!(t||{}).always_show_decimals&&!is_null(i)){var r=cstr(i).split(".");(r[1]==null||cint(r[1])===0)&&(a=0)}return i=i==null||i===""?"":i,frappe.form.formatters._right(format_number(i,null,a),t)},Int:function(i,e,t){return cstr(e.options).trim()==="File Size"?frappe.form.formatters.FileSize(i):frappe.form.formatters._right(i==null?"":cint(i),t)},Percent:function(i,e,t){let s=e.precision||cint(frappe.boot.sysdefaults&&frappe.boot.sysdefaults.float_precision)||2;return frappe.form.formatters._right(flt(i,s)+"%",t)},Rating:function(i,e){let t="",s=e.options||5;return i=i*s,i=Math.round(i*2)/2,Array.from({length:cint(s)},(a,r)=>r+1).forEach(a=>{t+=`<svg class="icon icon-md" data-rating=${a} viewBox="0 0 24 24" fill="none">
				<path class="right-half ${a<=(i||0)?"star-click":""}" d="M11.9987 3.00011C12.177 3.00011 12.3554 3.09303 12.4471 3.27888L14.8213 8.09112C14.8941 8.23872 15.0349 8.34102 15.1978 8.3647L20.5069 9.13641C20.917 9.19602 21.0807 9.69992 20.7841 9.9892L16.9421 13.7354C16.8243 13.8503 16.7706 14.0157 16.7984 14.1779L17.7053 19.4674C17.7753 19.8759 17.3466 20.1874 16.9798 19.9945L12.2314 17.4973C12.1586 17.459 12.0786 17.4398 11.9987 17.4398V3.00011Z" fill="var(--star-fill)" stroke="var(--star-fill)"/>
				<path class="left-half ${a<=(i||0)||a-.5==i?"star-click":""}" d="M11.9987 3.00011C11.8207 3.00011 11.6428 3.09261 11.5509 3.27762L9.15562 8.09836C9.08253 8.24546 8.94185 8.34728 8.77927 8.37075L3.42887 9.14298C3.01771 9.20233 2.85405 9.70811 3.1525 9.99707L7.01978 13.7414C7.13858 13.8564 7.19283 14.0228 7.16469 14.1857L6.25116 19.4762C6.18071 19.8842 6.6083 20.1961 6.97531 20.0045L11.7672 17.5022C11.8397 17.4643 11.9192 17.4454 11.9987 17.4454V3.00011Z" fill="var(--star-fill)" stroke="var(--star-fill)"/>
			</svg>`}),`<div class="rating">
			${t}
		</div>`},Currency:function(i,e,t,s){var a=frappe.meta.get_field_currency(e,s);let r;if(typeof e.precision=="number"?r=e.precision:r=cint(e.precision||frappe.boot.sysdefaults.currency_precision||2),r>2){var l=cstr(i).split("."),n=l.length>1?l[1]:"";if(n.length<3||n.length<r){let o=frappe.model.get_value(":Currency",a,"fraction_units")||100;n.length<cstr(o).length&&(r=cstr(o).length-1)}}return i=i==null||i===""?"":i,i=format_currency(i,a,r),t&&t.only_value?i:frappe.form.formatters._right(i,t)},Check:function(i){return`<input type="checkbox" disabled
			class="disabled-${i?"selected":"deselected"}">`},Link:function(i,e,t,s){var a=e._options||e.options,r=i;let l=frappe.utils.get_link_title(a,i);if(l===i&&(l=null),i&&i.match&&i.match(/^['"].*['"]$/)&&i.replace(/^.(.*).$/,"$1"),t&&(t.for_print||t.only_value))return l||i;if(frappe.form.link_formatters[a]&&s&&a!==s.doctype&&(i=frappe.form.link_formatters[a](i,s,e)),!i)return"";if(i[0]=="'"&&i[i.length-1]=="'")return i.substring(1,i.length-1);if(e&&e.link_onclick)return repl('<a onclick="%(onclick)s" href="#">%(value)s</a>',{onclick:e.link_onclick.replace(/"/g,"&quot;")+"; return false;",value:i});if(e&&a)if(frappe.model.can_read(a)){let n=document.createElement("a");return n.href=`/app/${encodeURIComponent(frappe.router.slug(a))}/${encodeURIComponent(r)}`,n.dataset.doctype=a,n.dataset.name=r,n.dataset.value=r,n.innerText=__(t&&t.label||l||i),n.outerHTML}else return l||i;else return l||i},Date:function(i){return frappe.datetime.str_to_user?(i&&(i=frappe.datetime.str_to_user(i,!1,!0),i==="Invalid date"&&(i=null)),i||""):i},DateRange:function(i){return Array.isArray(i)?__("{0} to {1}",[frappe.datetime.str_to_user(i[0]),frappe.datetime.str_to_user(i[1])]):i||""},Datetime:function(i){return i?moment(frappe.datetime.convert_to_user_tz(i)).format(frappe.boot.sysdefaults.date_format.toUpperCase()+" "+(frappe.boot.sysdefaults.time_format||"HH:mm:ss")):""},Text:function(i,e){if(i){for(var t=["<p","<div","<br","<table"],s=!1,a=0;a<t.length;a++)if(i.match(t[a])){s=!0;break}s||(i=frappe.utils.replace_newlines(i))}return frappe.form.formatters.Data(i,e)},Time:function(i){return i&&(i=frappe.datetime.str_to_user(i,!0)),i||""},Duration:function(i,e){if(i){let t=frappe.utils.get_duration_options(e);i=frappe.utils.get_formatted_duration(i,t)}return i||"0s"},LikedBy:function(i){var e="";return $.each(JSON.parse(i||"[]"),function(t,s){s&&(e+=frappe.avatar(s))}),e},Tag:function(i){var e="";return $.each((i||"").split(","),function(t,s){s&&(e+=`
				<span
					class="data-pill btn-xs align-center ellipsis"
					style="background-color: var(--control-bg); box-shadow: none; margin-right: 4px;"
					data-field="_user_tags" data-label="${s}'">
					${s}
				</span>`)}),e},Comment:function(i){return i},Assign:function(i){var e="";return $.each(JSON.parse(i||"[]"),function(t,s){s&&(e+='<span class="label label-warning" 				style="margin-right: 7px;"				data-field="_assign">'+s+"</span>")}),e},SmallText:function(i){return frappe.form.formatters.Text(i)},TextEditor:function(i){let e=frappe.form.formatters.Text(i);try{!$(e).find(".ql-editor").length&&!$(e).hasClass("ql-editor")&&(e=`<div class="ql-editor read-mode">${e}</div>`)}catch(t){e=`<div class="ql-editor read-mode">${e}</div>`}return e},Code:function(i){return"<pre>"+(i==null?"":$("<div>").text(i).html())+"</pre>"},WorkflowState:function(i){var e=frappe.get_doc("Workflow State",i);return e?repl("<span class='label label-%(style)s' 				data-workflow-state='%(value)s'				style='padding-bottom: 4px; cursor: pointer;'>				<i class='fa fa-small fa-white fa-%(icon)s'></i> %(value)s</span>",{value:i,style:e.style.toLowerCase(),icon:e.icon}):"<span class='label'>"+i+"</span>"},Email:function(i){return $("<div></div>").text(i).html()},FileSize:function(i){return i=cint(i),i>1048576?(i/1048576).toFixed(2)+"M":i>1024?(i/1024).toFixed(2)+"K":i},TableMultiSelect:function(i,e,t){i=i||[];let a=frappe.get_meta(e.options).fields.find(l=>l.fieldtype==="Link");return i.map(l=>{let n=l[a.fieldname];return`<span class="text-nowrap">
				${frappe.format(n,a,t,l)}
			</span>`}).join(", ")},Color:i=>i?`<div>
			<div class="selected-color" style="background-color: ${i}"></div>
			<span class="color-value">${i}</span>
		</div>`:"",Icon:i=>i?`<div>
			<div class="selected-icon">${frappe.utils.icon(i,"md")}</div>
			<span class="icon-value">${i}</span>
		</div>`:"",Attach:k,AttachImage:k};function k(i){return i?`<a href="${i}" target="_blank">${i}</a>`:""}frappe.form.get_formatter=function(i){return i||(i="Data"),frappe.form.formatters[i.replace(/ /g,"")]||frappe.form.formatters.Data};frappe.format=function(i,e,t,s){e||(e={fieldtype:"Data"}),e.fieldname=="_user_tags"&&(e=f(d({},e),{fieldtype:"Tag"}));var a=e.fieldtype||"Data";a==="Dynamic Link"&&(a="Link",e._options=s?s[e.options]:null);var r=e.formatter||frappe.form.get_formatter(a),l=r(i,e,t,s);return typeof l=="string"&&(l=frappe.dom.remove_script_and_style(l)),l};frappe.get_format_helper=function(i){var e={get_formatted:function(t){var s=frappe.meta.get_docfield(i.doctype,t);return s||console.log("fieldname not found: "+t),frappe.format(i[t],s,{inline:1},i)}};return $.extend(e,i),e};frappe.form.link_formatters.User=function(i,e,t){return e&&(e.full_name||t&&e[`${t.fieldname}_full_name`])||i};var h=class{constructor(e,t,s,a){this.layout=a,this.card_layout=s,this.parent=e,this.df=t||{},this.columns=[],this.fields_list=[],this.fields_dict={},this.make(),this.df.label&&this.df.collapsible&&localStorage.getItem(t.css_class+"-closed")&&this.collapse(),this.row={wrapper:this.wrapper},this.refresh()}make(){let e=this.card_layout;this.wrapper=$(`<div class="row
				${this.df.is_dashboard_section?"form-dashboard-section":"form-section"}
				${e?"card-section":""}" data-fieldname="${this.df.fieldname}">
			`).appendTo(this.parent),this.df&&(this.df.label&&this.make_head(),this.df.description&&(this.description_wrapper=$(`<div class="col-sm-12 form-section-description">
						${__(this.df.description)}
					</div>`),this.wrapper.append(this.description_wrapper)),this.df.css_class&&this.wrapper.addClass(this.df.css_class),this.df.hide_border&&this.wrapper.toggleClass("hide-border",!0)),this.body=$('<div class="section-body">').appendTo(this.wrapper),this.df.body_html&&this.body.append(this.df.body_html)}make_head(){this.head=$(`
			<div class="section-head">
				${__(this.df.label)}
				<span class="ml-2 collapse-indicator mb-1"></span>
			</div>
		`),this.head.appendTo(this.wrapper),this.indicator=this.head.find(".collapse-indicator"),this.indicator.hide(),this.df.collapsible&&(this.head.addClass("collapsible"),this.collapse_link=this.head.on("click",()=>{this.collapse()}),this.set_icon(),this.indicator.show())}replace_field(e,t){var s;if((s=this.fields_dict[e])!=null&&s.df){let a=this.fields_dict[e],r=this.fields_list.findIndex(l=>l==a);this.fields_list.splice(r,1,t),this.fields_dict[e]=t,t.section=this}}add_field(e){this.fields_list.push(e),this.fields_dict[e.df.fieldname]=e,e.section=this}refresh(e){!this.df||(e=e||this.df.hidden||this.df.hidden_due_to_dependency,this.wrapper.toggleClass("hide-control",!!e))}collapse(e){!(this.head&&this.body)||(e===void 0&&(e=!this.body.hasClass("hide")),this.body.toggleClass("hide",e),this.head&&this.head.toggleClass("collapsed",e),this.set_icon(e),this.fields_list.forEach(t=>t.on_section_collapse&&t.on_section_collapse(e)),this.df.css_class&&localStorage.setItem(this.df.css_class+"-closed",e?"1":""))}set_icon(e){let t=e?"es-line-down":"es-line-up";this.indicator&&this.indicator.html(frappe.utils.icon(t,"sm","mb-1"))}is_collapsed(){return this.body.hasClass("hide")}has_missing_mandatory(){let e=!1;for(let t=0,s=this.fields_list.length;t<s;t++){let a=this.fields_list[t].df;if(a.reqd&&this.layout.doc[a.fieldname]==null){e=!0;break}}return e}hide(){this.on_section_toggle(!1)}show(){this.on_section_toggle(!0)}on_section_toggle(e){this.wrapper.toggleClass("hide-control",!e)}};var _=class{constructor(e,t,s,a,r){this.layout=e,this.df=t||{},this.frm=s,this.doctype=this.frm.doctype,this.label=this.df&&this.df.label,this.tab_link_container=a,this.tabs_content=r,this.make(),this.setup_listeners(),this.refresh()}make(){let e=`${frappe.scrub(this.doctype,"-")}-${this.df.fieldname}`;this.tab_link=$(`
			<li class="nav-item">
				<a class="nav-link ${this.df.active?"active":""}" id="${e}-tab"
					data-toggle="tab"
					data-fieldname="${this.df.fieldname}"
					href="#${e}"
					role="tab"
					aria-controls="${this.label}">
						${__(this.label)}
				</a>
			</li>
		`).appendTo(this.tab_link_container),this.wrapper=$(`<div class="tab-pane fade show ${this.df.active?"active":""}"
			id="${e}" role="tabpanel" aria-labelledby="${e}-tab">`).appendTo(this.tabs_content)}refresh(){if(!this.df)return;let e=this.df.hidden||this.df.hidden_due_to_dependency;!e&&this.frm&&!this.frm.get_perm(this.df.permlevel||0,"read")&&(e=!0),e||(e=!0,this.wrapper.find(".form-section:not(.hide-control, .empty-section), .form-dashboard-section:not(.hide-control, .empty-section)").length&&(e=!1)),this.toggle(!e)}toggle(e){this.tab_link.toggleClass("hide",!e),this.wrapper.toggleClass("hide",!e),this.tab_link.toggleClass("show",e),this.wrapper.toggleClass("show",e),this.hidden=!e}show(){this.tab_link.show()}hide(){this.tab_link.hide()}add_field(e){e.tab=this}replace_field(e){e.tab=this}set_active(){var e,t;this.tab_link.find(".nav-link").tab("show"),this.wrapper.addClass("show"),(t=(e=this.frm)==null?void 0:e.set_active_tab)==null||t.call(e,this)}is_active(){return this.wrapper.hasClass("active")}is_hidden(){return this.wrapper.hasClass("hide")&&this.tab_link.hasClass("hide")}setup_listeners(){this.tab_link.find(".nav-link").on("shown.bs.tab",()=>{var e,t;(t=this==null?void 0:(e=this.frm).set_active_tab)==null||t.call(e,this)})}};var p=class{constructor(e,t){t||(t={}),this.df=t,this.section=e,this.section.columns.push(this),this.make(),this.resize_all_columns()}make(){this.wrapper=$(`
			<div class="form-column" data-fieldname="${this.df.fieldname}">
				<form>
				</form>
			</div>
		`).appendTo(this.section.body),this.form=this.wrapper.find("form").on("submit",()=>!1),this.df.description&&$(`
				<p class="col-sm-12 form-column-description">
					${__(this.df.description)}
				</p>
			`).prependTo(this.wrapper),this.df.label&&$(`
				<label class="column-label">
					${__(this.df.label)}
				</label>
			`).prependTo(this.wrapper)}resize_all_columns(){let e=this.section.wrapper.find(".form-column").length,t=cint(12/e);e==5&&(t=20),this.section.wrapper.find(".form-column").removeClass().addClass("form-column").addClass("col-sm-"+t)}add_field(){}refresh(){this.section.refresh()}};frappe.ui.form.Layout=class{constructor(e){this.views={},this.pages=[],this.tabs=[],this.sections=[],this.page_breaks=[],this.sections_dict={},this.fields_list=[],this.fields_dict={},this.section_count=0,this.column_count=0,$.extend(this,e)}make(){!this.parent&&this.body&&(this.parent=this.body),this.wrapper=$('<div class="form-layout">').appendTo(this.parent),this.message=$('<div class="form-message hidden"></div>').appendTo(this.wrapper),this.page=$('<div class="form-page"></div>').appendTo(this.wrapper),this.fields||(this.fields=this.get_doctype_fields()),this.is_tabbed_layout()&&this.setup_tabbed_layout(),this.setup_tab_events(),this.frm&&this.setup_tooltip_events(),this.render()}setup_tabbed_layout(){$(`
			<div class="form-tabs-list">
				<ul class="nav form-tabs" id="form-tabs" role="tablist"></ul>
			</div>
		`).appendTo(this.page),this.tab_link_container=this.page.find(".form-tabs"),this.tabs_content=$('<div class="form-tab-content tab-content"></div>').appendTo(this.page),this.setup_events()}get_doctype_fields(){let e=[this.get_new_name_field()];return this.doctype_layout?e=e.concat(this.get_fields_from_layout()):e=e.concat(frappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype])),e}get_new_name_field(){return{parent:this.frm.doctype,fieldtype:"Data",fieldname:"__newname",reqd:1,hidden:1,label:__("Name"),get_status:function(e){return e.frm&&e.frm.is_new()&&e.frm.meta.autoname&&["prompt","name"].includes(e.frm.meta.autoname.toLowerCase())?"Write":"None"}}}get_fields_from_layout(){let e=[];for(let t of this.doctype_layout.fields){let s=copy_dict(frappe.meta.docfield_map[this.doctype][t.fieldname]);s.label=t.label,e.push(s)}return e}show_message(e,t){this.message_color&&this.message.removeClass(this.message_color);let s=$(`<div class="close-message">${frappe.utils.icon("close")}</div>`);this.message_color=t&&["yellow","blue","red","green","orange"].includes(t)?t:"blue",e?(e.substr(0,1)!=="<"&&(e="<div>"+e+"</div>"),this.message.removeClass("hidden").addClass(this.message_color),$(e).appendTo(this.message),s.appendTo(this.message),s.on("click",()=>this.message.empty().addClass("hidden"))):this.message.empty().addClass("hidden")}render(e){let t=e||this.fields;if(this.section=null,this.column=null,this.no_opening_section()&&!this.is_tabbed_layout()&&this.fields.unshift({fieldtype:"Section Break"}),this.is_tabbed_layout()){let s={label:__("Details"),fieldtype:"Tab Break",fieldname:"__details"},a=this.fields.find(l=>l.hidden==!1);if(!((a==null?void 0:a.fieldtype)==="Tab Break"?a:null))this.fields.splice(0,0,s);else{let l=this.fields.find(n=>n.fieldname==="__newname");l&&l.get_status(this)==="Write"&&(this.fields.splice(0,1),this.fields.splice(1,0,l))}}t.forEach(s=>{switch(s.fieldtype){case"Fold":this.make_page(s);break;case"Page Break":this.make_page_break(),this.make_section(s);break;case"Section Break":this.make_section(s);break;case"Column Break":this.make_column(s);break;case"Tab Break":this.make_tab(s);break;default:this.make_field(s)}})}no_opening_section(){return this.fields[0]&&this.fields[0].fieldtype!="Section Break"||!this.fields.length}no_opening_tab(){return this.fields[1]&&this.fields[1].fieldtype!="Tab Break"||!this.fields.length}is_tabbed_layout(){return this.fields.find(e=>e.fieldtype==="Tab Break")}replace_field(e,t,s){var a;if(t.fieldname=e,this.fields_dict[e]&&this.fields_dict[e].df){let r=this.fields_dict[e],l=this.init_field(t,r.parent,s);r.$wrapper.replaceWith(l.$wrapper);let n=this.fields_list.findIndex(o=>o==r);this.fields_list.splice(n,1,l),this.fields_dict[e]=l,this.sections.forEach(o=>o.replace_field(e,l)),(a=r.tab)==null||a.replace_field(l),this.refresh_fields([t])}}make_field(e,t,s){!this.section&&this.make_section(),!this.column&&this.make_column();let a=this.column.form.get(0),r=this.init_field(e,a,s);this.fields_list.push(r),this.fields_dict[e.fieldname]=r,this.section.add_field(r),this.column.add_field(r),this.current_tab&&this.current_tab.add_field(r)}init_field(e,t,s=!1){let a=frappe.ui.form.make_control({df:e,doctype:this.doctype,parent:t,frm:this.frm,render_input:s,doc:this.doc,layout:this});return a.layout=this,a}make_page_break(){this.page=$('<div class="form-page page-break"></div>').appendTo(this.wrapper)}make_page(e){let t=this,s=$(`
			<div class="form-clickable-section text-center">
				<a class="btn-fold h6 text-muted">
					${__("Show more details")}
				</a>
			</div>
		`).appendTo(this.wrapper);this.page=$('<div class="form-page second-page hide"></div>').appendTo(this.wrapper),this.fold_btn=s.find(".btn-fold").on("click",function(){let a=$(this).parent().next();a.hasClass("hide")?($(this).removeClass("btn-fold").html(__("Hide details")),a.removeClass("hide"),frappe.utils.scroll_to($(this),!0,30),t.folded=!1):($(this).addClass("btn-fold").html(__("Show more details")),a.addClass("hide"),t.folded=!0)}),this.section=null,this.folded=!0}unfold(){this.fold_btn.trigger("click")}make_section(e={}){this.section_count++,e.fieldname||(e.fieldname=`__section_${this.section_count}`,e.fieldtype="Section Break"),this.section=new h(this.current_tab?this.current_tab.wrapper:this.page,e,this.card_layout,this),this.sections.push(this.section),this.sections_dict[e.fieldname]=this.section,e&&(this.fields_dict[e.fieldname]=this.section,this.fields_list.push(this.section)),this.column=null}make_column(e={}){this.column_count++,e.fieldname||(e.fieldname=`__column_${this.section_count}`,e.fieldtype="Column Break"),this.column=new p(this.section,e),e&&e.fieldname&&this.fields_list.push(this.column)}make_tab(e){this.section=null;let t=new _(this,e,this.frm,this.tab_link_container,this.tabs_content);return this.current_tab=t,this.make_section({fieldtype:"Section Break"}),this.tabs.push(t),t}refresh(e){e&&(this.doc=e),this.frm&&this.wrapper.find(".empty-form-alert").remove(),this.attach_doc_and_docfields(!0),this.frm&&this.frm.wrapper&&$(this.frm.wrapper).trigger("refresh-fields"),this.refresh_dependency(),this.refresh_sections(),this.frm&&this.refresh_section_collapse(),document.activeElement&&document.activeElement.tagName=="INPUT"&&this.is_numeric_field_active()&&document.activeElement.select()}is_numeric_field_active(){let t=($(document.activeElement).closest(".frappe-control").data()||{}).fieldtype;return frappe.model.numeric_fieldtypes.includes(t)}refresh_sections(){this.wrapper.find(".form-section:not(.hide-control)").each(function(){let e=$(this).removeClass("empty-section visible-section");e.find(".frappe-control:not(.hide-control)").length?e.addClass("visible-section"):(e.parent().hasClass("tab-pane")||e.parent().hasClass("form-page"))&&e.addClass("empty-section")}),this.is_tabbed_layout()&&this.refresh_tabs()}refresh_tabs(){for(let t of this.tabs)t.refresh();let e=this.tabs.filter(t=>!t.hidden);e&&e.length==1&&e[0].tab_link.toggleClass("hide show"),this.set_tab_as_active()}select_tab(e){var t;for(let s of this.tabs)if(s.label.toLowerCase()===e.toLowerCase()||((t=s.df.fieldname)==null?void 0:t.toLowerCase())===e.toLowerCase()){s.set_active();return}}set_tab_as_active(){var t,s;let e=(s=this==null?void 0:(t=this.frm).get_active_tab)==null?void 0:s.call(t);if(e)e.set_active();else if(this.tabs.length){let a=this.tabs.find(r=>!r.is_hidden());a&&a.set_active()}}refresh_fields(e){let t=e.map(s=>{if(s.fieldname)return s.fieldname});this.fields_list.map(s=>{t.includes(s.df.fieldname)&&(s.refresh(),s.df.default&&s.set_input(s.df.default))})}add_fields(e){this.render(e),this.refresh_fields(e)}refresh_section_collapse(){if(!!(this.sections&&this.sections.length))for(let e=0;e<this.sections.length;e++){let t=this.sections[e],s=t.df;if(s&&s.collapsible){let a=!0;s.collapsible_depends_on&&(a=!this.evaluate_depends_on_value(s.collapsible_depends_on)),a&&t.has_missing_mandatory()&&(a=!1),t.collapse(a)}}}attach_doc_and_docfields(e){let t=this;for(let s=0,a=this.fields_list.length;s<a;s++){let r=this.fields_list[s];t.doc&&(r.doc=t.doc,r.doctype=t.doc.doctype,r.docname=t.doc.name,r.df=frappe.meta.get_docfield(t.doc.doctype,r.df.fieldname,t.doc.name)||r.df),e&&r.df&&r.refresh&&r.refresh()}}refresh_section_count(){this.wrapper.find(".section-count-label:visible").each(function(e){$(this).html(e+1)})}setup_events(){let e=0,t=$(".form-tabs-list"),s=this.tabs_content[0];!t.length||($(window).scroll(frappe.utils.throttle(()=>{let a=document.documentElement.scrollTop;a>0&&e<=a?(t.removeClass("form-tabs-sticky-down"),t.addClass("form-tabs-sticky-up")):(t.removeClass("form-tabs-sticky-up"),t.addClass("form-tabs-sticky-down")),e=a},500)),this.tab_link_container.off("click").on("click",".nav-link",a=>{a.preventDefault(),a.stopImmediatePropagation(),$(a.currentTarget).tab("show"),s.getBoundingClientRect().top<100&&(s.scrollIntoView(),setTimeout(()=>{$(".page-head").css("top","-15px"),$(".form-tabs-list").removeClass("form-tabs-sticky-down"),$(".form-tabs-list").addClass("form-tabs-sticky-up")},3))}))}setup_tab_events(){this.wrapper.on("keydown",e=>{if(e.which==9){let t=$(e.target),s=t.attr("data-doctype"),a=t.attr("data-fieldname");if(s)return this.handle_tab(s,a,e.shiftKey)}})}setup_tooltip_events(){$(document).on("keydown",e=>{e.altKey&&this.wrapper.addClass("show-tooltip")}),$(document).on("keyup",e=>{e.altKey||this.wrapper.removeClass("show-tooltip")}),this.frm.page&&frappe.ui.keys.add_shortcut({shortcut:"alt+hover",page:this.frm.page,description:__("Show Fieldname (click to copy on clipboard)")})}handle_tab(e,t,s){let a=null,r=null,l=this.fields_list,n=!1;if(e!=this.doctype){if(a=this.get_open_grid_row(),!a||!a.layout)return;l=a.layout.fields_list}for(let o=0,c=l.length;o<c;o++){if(l[o].df.fieldname==t){if(s){r?this.set_focus(r):$(this.primary_button).focus();break}if(o<c-1&&(n=this.focus_on_next_field(o,l)),n)break}this.is_visible(l[o])&&(r=l[o])}return n||(a?a.doc.idx==a.grid.grid_rows.length?a.toggle_view(!1,function(){a.grid.frm.layout.handle_tab(a.grid.df.parent,a.grid.df.fieldname)}):a.grid.grid_rows[a.doc.idx].toggle_view(!0):s||$(this.primary_button).focus()),!1}focus_on_next_field(e,t){for(let s=e+1,a=t.length;s<a;s++){let r=t[s];if(this.is_visible(r)){if(r.df.fieldtype==="Table")return r.grid.grid_rows&&r.grid.grid_rows.length||r.grid.add_new_row(),r.grid.grid_rows[0].show_form(),!0;if(!frappe.model.no_value_type.includes(r.df.fieldtype))return this.set_focus(r),!0}}}is_visible(e){return e.disp_status==="Write"&&e.df&&"hidden"in e.df&&!e.df.hidden}set_focus(e){e.tab&&e.tab.set_active(),e.df.fieldtype=="Table"?e.grid.grid_rows.length?e.grid.grid_rows[0].toggle_view(!0):e.grid.add_new_row(1):e.editor?e.editor.set_focus():e.$input&&e.$input.focus()}get_open_grid_row(){return $(".grid-row-open").data("grid_row")}refresh_dependency(){let e=!1,t=this.fields_list.concat(this.tabs);for(let s in t){let a=t[s];if(a.df.depends_on||a.df.mandatory_depends_on||a.df.read_only_depends_on){e=!0;break}}if(!!e){for(let s=t.length-1;s>=0;s--){let a=t[s];a.guardian_has_value=!0,a.df.depends_on&&(a.guardian_has_value=this.evaluate_depends_on_value(a.df.depends_on),a.guardian_has_value?a.df.hidden_due_to_dependency&&(a.df.hidden_due_to_dependency=!1,a.refresh()):a.df.hidden_due_to_dependency||(a.df.hidden_due_to_dependency=!0,a.refresh())),a.df.mandatory_depends_on&&this.set_dependant_property(a.df.mandatory_depends_on,a.df.fieldname,"reqd"),a.df.read_only_depends_on&&this.set_dependant_property(a.df.read_only_depends_on,a.df.fieldname,"read_only")}this.refresh_section_count()}}set_dependant_property(e,t,s){let r=this.evaluate_depends_on_value(e)?1:0,l;this.frm?l=this.frm:(this.is_dialog||this.doctype==="Web Form")&&(l=this),l&&(this.doc&&this.doc.parent&&this.doc.parentfield?(l.setting_dependency=!0,l.set_df_property(this.doc.parentfield,s,r,this.doc.parent,t,this.doc.name),l.setting_dependency=!1,this.fields_dict[t]&&this.fields_dict[t].refresh()):l.set_df_property(t,s,r))}evaluate_depends_on_value(e){let t=null,s=this.doc;if(!s&&this.get_values&&(s=this.get_values(!0)),!s)return;let a=this.frm?this.frm.doc:this.doc||null;if(typeof e=="boolean")t=e;else if(typeof e=="function")t=e(s);else if(e.substr(0,5)=="eval:")try{t=frappe.utils.eval(e.substr(5),{doc:s,parent:a}),a&&a.istable&&e.includes("is_submittable")&&(t=!0)}catch(l){frappe.throw(__('Invalid "depends_on" expression'))}else if(e.substr(0,3)=="fn:"&&this.frm)t=this.frm.script_manager.trigger(e.substr(3),this.doctype,this.docname);else{var r=s[e];$.isArray(r)?t=!!r.length:t=!!r}return t}};frappe.provide("frappe.ui");frappe.ui.FieldGroup=class extends frappe.ui.form.Layout{constructor(e){super(e),this.dirty=!1,$.each(this.fields||[],function(t,s){!s.fieldname&&s.label&&(s.fieldname=s.label.replace(/ /g,"_").toLowerCase())}),this.values&&this.set_values(this.values)}make(){let e=this;this.fields&&(super.make(),this.refresh(),$.each(this.fields_list,function(t,s){if(s.df.default){let a=s.df.default;a=="Today"&&s.df.fieldtype=="Date"&&(a=frappe.datetime.get_today()),s.set_input(a),e.refresh_dependency()}}),this.no_submit_on_enter||this.catch_enter_as_submit(),$(this.wrapper).find("input, select").on("change awesomplete-selectcomplete",()=>{this.dirty=!0,frappe.run_serially([()=>frappe.timeout(.1),()=>e.refresh_dependency()])}))}focus_on_first_input(){this.no_focus||$.each(this.fields_list,function(e,t){if(!["Date","Datetime","Time","Check"].includes(t.df.fieldtype)&&t.set_focus)return t.set_focus(),!1})}catch_enter_as_submit(){let e=this;$(this.body).find('input[type="text"], input[type="password"], select').keypress(function(t){t.which==13&&e.has_primary_action&&(t.preventDefault(),e.get_primary_btn().trigger("click"))})}get_input(e){let t=this.fields_dict[e];return t?$(t.txt?t.txt:t.input):""}get_field(e){return this.fields_dict[e]}get_values(e,t){let s={},a=[],r=[];for(let l in this.fields_dict){let n=this.fields_dict[l];if(n.get_value){let o=n.get_value();n.df.reqd&&is_null(typeof o=="string"?strip_html(o):o)&&a.push(__(n.df.label)),n.df.reqd&&n.df.fieldtype==="Text Editor"&&is_null(strip_html(cstr(o)))&&a.push(__(n.df.label)),is_null(o)||(s[n.df.fieldname]=o)}this.is_dialog&&n.df.reqd&&!n.value&&n.refresh_input(),n.df.invalid&&r.push(__(n.df.label))}return a.length&&!e?(frappe.msgprint({title:__("Missing Values Required"),message:__("Following fields have missing values:")+"<br><br><ul><li>"+a.join("<li>")+"</ul>",indicator:"orange"}),null):r.length&&t?(frappe.msgprint({title:__("Inavlid Values"),message:__("Following fields have invalid values:")+"<br><br><ul><li>"+r.join("<li>")+"</ul>",indicator:"orange"}),null):s}get_value(e){let t=this.fields_dict[e];return t&&(t.get_value?t.get_value():null)}set_value(e,t){return new Promise(s=>{let a=this.fields_dict[e];a?a.set_value(t).then(()=>{var r;(r=a.set_input)==null||r.call(a,t),this.refresh_dependency(),s()}):s()})}has_field(e){return!!this.fields_dict[e]}set_input(e,t){return this.set_value(e,t)}set_values(e){let t=[];for(let s in e)this.fields_dict[s]&&t.push(this.set_value(s,e[s]));return Promise.all(t)}clear(){for(let e in this.fields_dict){let t=this.fields_dict[e];t&&t.set_input&&t.set_input(t.df.default||"")}}set_df_property(e,t,s){if(!e)return;let a=this.get_field(e);a.df[t]=s,a.refresh()}};frappe.ui.form.LinkSelector=class{constructor(e){$.extend(this,e);var t=this;this.doctype!="[Select]"?frappe.model.with_doctype(this.doctype,function(s){t.make()}):this.make()}make(){var e=this;this.start=0,this.page_length=10,this.dialog=new frappe.ui.Dialog({title:__("Select {0}",[this.doctype=="[Select]"?__("value"):__(this.doctype)]),fields:[{fieldtype:"Data",fieldname:"txt",label:__("Beginning with"),description:__("You can use wildcard %")},{fieldtype:"HTML",fieldname:"results"},{fieldtype:"Button",fieldname:"more",label:__("More"),click:()=>{e.start+=e.page_length,e.search()}}],primary_action_label:__("Search"),primary_action:function(){e.start=0,e.search()}}),this.txt&&this.dialog.fields_dict.txt.set_input(this.txt),this.dialog.get_input("txt").on("keypress",function(t){t.which===13&&(e.start=0,e.search())}),this.dialog.show(),this.search()}search(){var e={txt:this.dialog.fields_dict.txt.get_value(),searchfield:"name",start:this.start,page_length:this.page_length},t=this;this.target.set_custom_query&&this.target.set_custom_query(e),this.target.is_grid&&this.target.fieldinfo[this.fieldname]&&this.target.fieldinfo[this.fieldname].get_query&&$.extend(e,this.target.fieldinfo[this.fieldname].get_query(cur_frm.doc)),frappe.link_search(this.doctype,e,function(s){var a=t.dialog.fields_dict.results.$wrapper;if(e.start===0&&a.empty(),s.length)for(let n of s){var r=$(repl('<div class="row link-select-row">						<div class="col-xs-4">							<b><a href="#">%(name)s</a></b></div>						<div class="col-xs-8">							<span class="text-muted">%(values)s</span></div>						</div>',{name:n[0],values:n.splice(1).join(", ")})).appendTo(a);r.find("a").attr("data-value",n[0]).click(function(){var o=$(this).attr("data-value");return t.target.is_grid?t.set_in_grid(o).then(()=>t.search()):(t.target.doctype?t.target.parse_validate_and_set_in_model(o):(t.target.set_input(o),t.target.$input.trigger("change")),t.dialog.hide()),!1})}else $('<p><br><span class="text-muted">'+__("No Results")+"</span>"+(frappe.model.can_create(t.doctype)?'<br><br><a class="new-doc btn btn-default btn-sm">'+__("Create a new {0}",[__(t.doctype)])+"</a>":"")+"</p>").appendTo(a).find(".new-doc").click(function(){frappe.new_doc(t.doctype)});var l=t.dialog.fields_dict.more.$wrapper;s.length<t.page_length?l.hide():l.show()},this.dialog.get_primary_btn())}set_in_grid(e){return new Promise(t=>{if(this.qty_fieldname)frappe.prompt({fieldname:"qty",fieldtype:"Float",label:"Qty",default:1,reqd:1},s=>{if(!(this.target.frm.doc[this.target.df.fieldname]||[]).some(r=>{if(r[this.fieldname]===e)return frappe.model.set_value(r.doctype,r.name,this.qty_fieldname,s.qty).then(()=>{frappe.show_alert(__("Added {0} ({1})",[e,r[this.qty_fieldname]])),t()}),!0})){let r=null;frappe.run_serially([()=>r=this.target.add_new_row(),()=>frappe.timeout(.1),()=>{let l={};return l[this.fieldname]=e,l[this.qty_fieldname]=s.qty,frappe.model.set_value(r.doctype,r.name,l)},()=>frappe.show_alert(__("Added {0} ({1})",[e,s.qty])),()=>t()])}},__("Set Quantity"),__("Set Quantity"));else if(this.dynamic_link_field){let s=this.target.add_new_row();frappe.model.set_value(s.doctype,s.name,this.dynamic_link_field,this.dynamic_link_reference),frappe.model.set_value(s.doctype,s.name,this.fieldname,e).then(()=>{frappe.show_alert(__("{0} {1} added",[this.dynamic_link_reference,e])),t()})}else{let s=this.target.add_new_row();frappe.model.set_value(s.doctype,s.name,this.fieldname,e).then(()=>{frappe.show_alert(__("{0} added",[e])),t()})}})}};frappe.link_search=function(i,e,t,s){e||(e={txt:""}),e.doctype=i,e.searchfield||(e.searchfield="name"),frappe.call({method:"frappe.desk.search.search_widget",type:"GET",args:e,callback:function(a){t&&t(a.message)},btn:s})};frappe.ui.form.MultiSelectDialog=class{constructor(e){Object.assign(this,e),this.for_select=this.doctype=="[Select]",this.for_select?this.init():frappe.model.with_doctype(this.doctype,()=>this.init())}init(){this.page_length=20,this.child_page_length=20,this.fields=this.get_fields(),this.make()}get_fields(){let e=this.get_primary_filters(),t=this.get_result_fields(),s=this.get_data_fields(),a=this.get_child_selection_fields();return[...e,...t,...s,...a]}get_result_fields(){let e=()=>{this.page_length+=20,this.get_results()};return[{fieldtype:"HTML",fieldname:"results_area"},{fieldtype:"Button",fieldname:"more_btn",label:__("More"),click:e.bind(this)}]}get_data_fields(){return this.data_fields&&this.data_fields.length?[{fieldtype:"Section Break"},...this.data_fields]:[]}get_child_selection_fields(){let e=[];if(this.allow_child_item_selection&&this.child_fieldname){let t=()=>{this.child_page_length+=20,this.show_child_results()};e.push({fieldtype:"HTML",fieldname:"child_selection_area"}),e.push({fieldtype:"Button",fieldname:"more_child_btn",hidden:1,label:__("More"),click:t.bind(this)})}return e}make(){let e=__(this.doctype).plural(),t=__("Select {0}",[this.for_select?__("value"):e]);this.dialog=new frappe.ui.Dialog({title:t,fields:this.fields,size:this.size,primary_action_label:this.primary_action_label||__("Get Items"),secondary_action_label:__("Make {0}",[__(this.doctype)]),primary_action:()=>{let s=this.get_custom_filters(),a=cur_dialog.get_values(),r=this.get_selected_child_names(),l=[...this.get_checked_values(),...this.get_parent_name_of_selected_children()];this.action(l,f(d(d(d({},this.args),a),s),{filtered_children:r}))},secondary_action:this.make_new_document.bind(this)}),this.add_filters_group&&this.make_filter_area(),this.args={},this.setup_results(),this.bind_events(),this.get_results(),this.dialog.show()}make_new_document(e){e&&(this.set_route_options(),frappe.new_doc(this.doctype,!0))}set_route_options(){if(frappe.route_options={},Array.isArray(this.setters))for(let e of this.setters)frappe.route_options[e.fieldname]=this.dialog.fields_dict[e.fieldname].get_value()||void 0;else Object.keys(this.setters).forEach(e=>{frappe.route_options[e]=this.dialog.fields_dict[e].get_value()||void 0})}setup_results(){this.$parent=$(this.dialog.body),this.$wrapper=this.dialog.fields_dict.results_area.$wrapper.append(`<div class="results my-3"
			style="border: 1px solid #d1d8dd; border-radius: 3px; height: 300px; overflow: auto;"></div>`),this.$results=this.$wrapper.find(".results"),this.$results.append(this.make_list_row())}show_child_results(){this.get_child_result().then(e=>{this.child_results=e.message||[],this.render_child_datatable(),this.$wrapper.addClass("hidden"),this.$child_wrapper.removeClass("hidden"),this.dialog.fields_dict.more_btn.$wrapper.hide()})}is_child_selection_enabled(){var e;return(e=this.dialog.fields_dict.allow_child_item_selection)==null?void 0:e.get_value()}toggle_child_selection(){this.is_child_selection_enabled()?this.show_child_results():(this.child_results=[],this.get_results(),this.$wrapper.removeClass("hidden"),this.$child_wrapper.addClass("hidden"))}render_child_datatable(){this.child_datatable?setTimeout(()=>{this.child_datatable.rowmanager.checkMap=[],this.child_datatable.refresh(this.get_child_datatable_rows()),this.$child_wrapper.find(".dt-scrollable").css("height","300px"),this.$child_wrapper.find(".dt-scrollable").css("overflow-y","scroll")},500):this.setup_child_datatable()}get_child_datatable_columns(){return[this.doctype,...this.child_columns].map(t=>({name:frappe.unscrub(t),editable:!1}))}get_child_datatable_rows(){return this.child_results.length>this.child_page_length?this.dialog.fields_dict.more_child_btn.toggle(!0):this.dialog.fields_dict.more_child_btn.toggle(!1),this.child_results.slice(0,this.child_page_length).map(e=>Object.values(e).slice(1))}setup_child_datatable(){let e=this.get_child_datatable_columns(),t=this.get_child_datatable_rows();this.$child_wrapper=this.dialog.fields_dict.child_selection_area.$wrapper,this.$child_wrapper.addClass("my-3"),this.child_datatable=new frappe.DataTable(this.$child_wrapper.get(0),{columns:e,data:t,layout:"fluid",inlineFilters:!0,serialNoColumn:!1,checkboxColumn:!0,cellHeight:35,noDataMessage:__("No Data"),disableReorderColumn:!0}),this.$child_wrapper.find(".dt-scrollable").css("height","300px")}get_primary_filters(){let e=[],t=new Array(3);return t[0]=[{fieldtype:"Data",label:__("Name"),fieldname:"search_term"}],t[1]=[],t[2]=[],$.isArray(this.setters)?this.setters.forEach((s,a)=>{t[(a+1)%3].push(s)}):Object.keys(this.setters).forEach((s,a)=>{let r=frappe.meta.docfield_map[this.doctype][s];t[(a+1)%3].push({fieldtype:r.fieldtype,label:r.label,fieldname:s,options:r.options,default:this.setters[s]})}),Object.seal&&Object.seal(t),this.allow_child_item_selection&&(this.child_doctype=frappe.meta.get_docfield(this.doctype,this.child_fieldname).options,t[0].push({fieldtype:"Check",label:__("Select {0}",[__(this.child_doctype)]),fieldname:"allow_child_item_selection",onchange:this.toggle_child_selection.bind(this)})),e=[...t[0],{fieldtype:"Column Break"},...t[1],{fieldtype:"Column Break"},...t[2],{fieldtype:"Section Break",fieldname:"primary_filters_sb"}],this.add_filters_group&&e.push({fieldtype:"HTML",fieldname:"filter_area"}),e}make_filter_area(){this.filter_group=new frappe.ui.FilterGroup({parent:this.dialog.get_field("filter_area").$wrapper,doctype:this.doctype,on_change:()=>{this.is_child_selection_enabled()?this.show_child_results():this.get_results()}}),this.filter_group.wrapper.find(".apply-filters").hide()}get_custom_filters(){return this.add_filters_group&&this.filter_group?this.filter_group.get_filters().reduce((e,t)=>Object.assign(e,{[t[1]]:[t[2],t[3]]}),{}):{}}bind_events(){let e=this;this.$results.on("click",".list-item-container",function(t){!$(t.target).is(":checkbox")&&!$(t.target).is("a")&&$(this).find(":checkbox").trigger("click")}),this.$results.on("click",".list-item--head :checkbox",t=>{this.$results.find(".list-item-container .list-row-check").prop("checked",$(t.target).is(":checked"))}),this.$parent.find(".input-with-feedback").on("change",()=>{frappe.flags.auto_scroll=!1,this.is_child_selection_enabled()?this.show_child_results():this.get_results()}),this.$parent.find('[data-fieldtype="Data"]').on("input",()=>{var t=$(this);clearTimeout(t.data("timeout")),t.data("timeout",setTimeout(function(){frappe.flags.auto_scroll=!1,e.is_child_selection_enabled()?e.show_child_results():(e.empty_list(),e.get_results())},300))})}get_parent_name_of_selected_children(){return!this.child_datatable||!this.child_datatable.datamanager.rows.length?[]:this.child_datatable.rowmanager.checkMap.reduce((t,s,a)=>{if(s==1){let r=this.child_results[a].parent;t.includes(r)||t.push(r)}return t},[])}get_selected_child_names(){return!this.child_datatable||!this.child_datatable.datamanager.rows.length?[]:this.child_datatable.rowmanager.checkMap.reduce((t,s,a)=>{if(s==1){let r=this.child_results[a].name;t.push(r)}return t},[])}get_checked_values(){return this.$results.find(".list-item-container").map(function(){if($(this).find(".list-row-check:checkbox:checked").length>0)return $(this).attr("data-item-name")}).get()}get_checked_items(){let e=this.get_checked_values();return this.results.filter(t=>e.includes(t.name))}get_datatable_columns(){return this.get_query&&this.get_query().query&&this.columns?this.columns:Array.isArray(this.setters)?["name",...this.setters.map(e=>e.fieldname)]:["name",...Object.keys(this.setters)]}make_list_row(e={}){var t=this;let s=Object.keys(e).length===0,a="";this.get_datatable_columns().forEach(function(l){a+=`<div class="list-item__content ellipsis">
				${s?`<span class="ellipsis text-muted" title="${__(frappe.model.unscrub(l))}">${__(frappe.model.unscrub(l))}</span>`:l!=="name"?`<span class="ellipsis result-row" title="${__(e[l]||"")}">${__(e[l]||"")}</span>`:`<a href="${"/app/"+frappe.router.slug(t.doctype)+"/"+e[l]||""}" class="list-id ellipsis" title="${__(e[l]||"")}">
							${__(e[l]||"")}</a>`}
			</div>`});let r=$(`<div class="list-item">
			<div class="list-item__content" style="flex: 0 0 10px;">
				<input type="checkbox" class="list-row-check" data-item-name="${e.name}" ${e.checked?"checked":""}>
			</div>
			${a}
		</div>`);return s?r.addClass("list-item--head"):r=$(`<div class="list-item-container" data-item-name="${e.name}"></div>`).append(r),r}render_result_list(e,t=0,s=!0){var a=this,r=a.dialog.fields_dict.more_btn.$wrapper;if(!frappe.flags.auto_scroll&&s&&this.empty_list(),r.hide(),$(".modal-dialog .list-item--head").css("z-index",1),e.length===0)return;t&&r.show();let l=this.get_checked_values();e.filter(n=>!l.includes(n.name)).forEach(n=>{a.$results.append(a.make_list_row(n))}),this.$results.find(".list-item--head").css("z-index",1),frappe.flags.auto_scroll&&this.$results.animate({scrollTop:a.$results.prop("scrollHeight")},500)}empty_list(){let e=this.get_checked_items().map(t=>f(d({},t),{checked:!0}));this.$results.find(".list-item-container").remove(),this.render_result_list(e,0,!1)}get_filters_from_setters(){let e=this,t=(this.get_query?this.get_query().filters:{})||{},s=[];if($.isArray(this.setters))for(let a of this.setters)t[a.fieldname]=e.dialog.fields_dict[a.fieldname].get_value()||void 0,e.args[a.fieldname]=t[a.fieldname],s.push(a.fieldname);else Object.keys(this.setters).forEach(function(a){var r=e.dialog.fields_dict[a].get_value();e.dialog.fields_dict[a].df.fieldtype=="Data"&&r?t[a]=["like","%"+r+"%"]:(t[a]=r||void 0,e.args[a]=t[a],s.push(a))});return[t,s]}get_args_for_search(){let[e,t]=this.get_filters_from_setters(),s=this.get_custom_filters();return Object.assign(e,s),{doctype:this.doctype,txt:this.dialog.fields_dict.search_term.get_value(),filters:e,filter_fields:t,page_length:this.page_length+5,query:this.get_query?this.get_query().query:"",as_dict:1}}async perform_search(e){let t=await frappe.call({type:"GET",method:"frappe.desk.search.search_widget",no_spinner:!0,args:e}),s=t.message.length&&t.message.length>this.page_length?1:0;return[t.message,s]}async get_results(){let e=this.get_args_for_search(),[t,s]=await this.perform_search(e);s&&(t=t.splice(0,this.page_length)),this.results=[],t.length&&t.forEach(a=>{a.checked=0,this.results.push(a)}),this.render_result_list(this.results,s)}async get_filtered_parents_for_child_search(){let e=this.get_args_for_search();e.filter_fields=["name"];let[t,s]=await this.perform_search(e),a=[];return t.length&&(a=t.map(r=>r.name)),a}async add_parent_filters(e){let t=await this.get_filtered_parents_for_child_search();t.length&&e.push(["parent","in",t])}add_custom_child_filters(e){this.add_filters_group&&this.filter_group&&this.filter_group.get_filters().forEach(t=>{t[0]==this.child_doctype&&e.push([t[1],t[2],t[3]])})}async get_child_result(){let e=[["parentfield","=",this.child_fieldname]];return await this.add_parent_filters(e),this.add_custom_child_filters(e),frappe.call({method:"frappe.client.get_list",args:{doctype:this.child_doctype,filters:e,fields:["name","parent",...this.child_columns],parent:this.doctype,limit_page_length:this.child_page_length+5,order_by:"parent"}})}};frappe.provide("frappe.ui");window.cur_dialog=null;frappe.ui.open_dialogs=[];frappe.ui.Dialog=class extends frappe.ui.FieldGroup{constructor(e){super(),this.display=!1,this.is_dialog=!0,$.extend(this,{animate:!0,size:null},e),this.make()}make(){this.$wrapper=frappe.get_modal("",""),this.static&&(this.$wrapper.modal({backdrop:"static",keyboard:!1}),this.get_close_btn().hide()),this.size||this.set_modal_size(),this.wrapper=this.$wrapper.find(".modal-dialog").get(0),this.size=="small"?$(this.wrapper).addClass("modal-sm"):this.size=="large"?$(this.wrapper).addClass("modal-lg"):this.size=="extra-large"&&$(this.wrapper).addClass("modal-xl"),this.make_head(),this.modal_body=this.$wrapper.find(".modal-body"),this.$body=$("<div></div>").appendTo(this.modal_body),this.body=this.$body.get(0),this.$message=$('<div class="hide modal-message"></div>').appendTo(this.modal_body),this.header=this.$wrapper.find(".modal-header"),this.footer=this.$wrapper.find(".modal-footer"),this.standard_actions=this.footer.find(".standard-actions"),this.custom_actions=this.footer.find(".custom-actions"),this.set_indicator(),super.make(),this.refresh_section_collapse(),this.action=this.action||{primary:{},secondary:{}},(this.primary_action||this.action.primary&&this.action.primary.onsubmit)&&this.set_primary_action(this.primary_action_label||this.action.primary.label||__("Submit",null,"Primary action in dialog"),this.primary_action||this.action.primary.onsubmit),this.secondary_action&&this.set_secondary_action(this.secondary_action),(this.secondary_action_label||this.action.secondary&&this.action.secondary.label)&&this.set_secondary_action_label(this.secondary_action_label||this.action.secondary.label),this.minimizable&&(this.header.find(".title-section").click(()=>this.is_minimized&&this.toggle_minimize()),this.get_minimize_btn().removeClass("hide").on("click",()=>this.toggle_minimize()));var e=this;this.$wrapper.on("hide.bs.modal",function(){var t,s,a;e.display=!1,e.is_minimized=!1,e.hide_scrollbar(!1),(a=(s=(t=frappe.ui.form).get_open_grid_form)==null?void 0:s.call(t))==null||a.hide_form(),frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]===e&&(frappe.ui.open_dialogs.pop(),frappe.ui.open_dialogs.length?window.cur_dialog=frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]:window.cur_dialog=null),e.onhide&&e.onhide(),e.on_hide&&e.on_hide()}).on("shown.bs.modal",function(){e.display=!0,window.cur_dialog=e,frappe.ui.open_dialogs.push(e),e.focus_on_first_input(),e.hide_scrollbar(!0),e.on_page_show&&e.on_page_show(),$(document).trigger("frappe.ui.Dialog:shown"),$(document).off("focusin.modal")}).on("scroll",function(){var t=$("input:focus");t.length&&["Date","Datetime","Time"].includes(t.attr("data-fieldtype"))&&t.blur()})}set_modal_size(){if(!this.fields){this.size="";return}let e=0,t=0;this.fields.forEach(s=>{s.fieldtype=="Column Break"?(t++,t>e&&(e=t)):s.fieldtype=="Section Break"&&(t=0)}),this.size=e>=4?"extra-large":e>=2?"large":""}get_primary_btn(){return this.standard_actions.find(".btn-primary")}get_minimize_btn(){return this.$wrapper.find(".modal-header .btn-modal-minimize")}set_message(e){this.$message.removeClass("hide"),this.$body.addClass("hide"),this.$message.text(e)}clear_message(){this.$message.addClass("hide"),this.$body.removeClass("hide")}clear(){super.clear(),this.clear_message()}set_primary_action(e,t){this.footer.removeClass("hide"),this.has_primary_action=!0;var s=this;let a=this.get_primary_btn().removeClass("hide").html(e);return typeof t=="function"&&a.off("click").on("click",function(){s.primary_action_fulfilled=!0;var r=s.get_values();!r||t&&t.apply(s,[r])}),a}set_secondary_action(e){return this.footer.removeClass("hide"),this.get_secondary_btn().removeClass("hide").off("click").on("click",e)}set_secondary_action_label(e){this.get_secondary_btn().removeClass("hide").html(e)}disable_primary_action(){this.get_primary_btn().addClass("disabled")}enable_primary_action(){this.get_primary_btn().removeClass("disabled")}make_head(){this.set_title(this.title)}set_title(e){this.$wrapper.find(".modal-title").html(e)}set_indicator(){this.indicator&&this.header.find(".indicator").removeClass().addClass("indicator "+this.indicator)}show(){return this.animate?this.$wrapper.addClass("fade"):this.$wrapper.removeClass("fade"),this.$wrapper.modal("show"),this.$wrapper.removeClass("modal-minimize"),this.minimizable&&this.is_minimized&&($(".modal-backdrop").toggle(),this.is_minimized=!1),this.clear_message(),this.primary_action_fulfilled=!1,this.is_visible=!0,this}hide(){this.$wrapper.modal("hide"),this.is_visible=!1}get_close_btn(){return this.$wrapper.find(".btn-modal-close")}get_secondary_btn(){return this.standard_actions.find(".btn-modal-secondary")}no_cancel(){this.get_close_btn().toggle(!1)}cancel(){this.get_close_btn().trigger("click")}toggle_minimize(){$(".modal-backdrop").toggle();let e=this.$wrapper.closest(".modal").toggleClass("modal-minimize");e.attr("tabindex")?e.removeAttr("tabindex"):e.attr("tabindex",-1),this.is_minimized=!this.is_minimized;let t=this.is_minimized?"expand":"collapse";this.get_minimize_btn().html(frappe.utils.icon(t)),this.on_minimize_toggle&&this.on_minimize_toggle(this.is_minimized),this.header.find(".modal-title").toggleClass("cursor-pointer"),this.hide_scrollbar(!this.is_minimized)}hide_scrollbar(e){$("body").css("overflow",e?"hidden":"auto")}add_custom_action(e,t,s=null){this.footer.removeClass("hide");let a=$(`
			<button class="btn btn-secondary btn-sm ${s||""}">
				${e}
			</button>
		`);this.custom_actions.append(a),t&&a.click(t)}};frappe.ui.hide_open_dialog=()=>{window.cur_dialog&&(cur_dialog.minimizable?cur_dialog.is_minimized||cur_dialog.toggle_minimize():cur_dialog.hide())};})();
//# sourceMappingURL=dialog.bundle.45KOXPTL.js.map
