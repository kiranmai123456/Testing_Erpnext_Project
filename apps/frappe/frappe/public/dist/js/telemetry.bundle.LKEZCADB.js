(()=>{(function(l,e){var t,o,a,n;e.__SV||(window.posthog=e,e._i=[],e.init=function(d,h,s){function f(p,r){var _=r.split(".");_.length==2&&(p=p[_[0]],r=_[1]),p[r]=function(){p.push([r].concat(Array.prototype.slice.call(arguments,0)))}}(a=l.createElement("script")).type="text/javascript",a.async=!0,a.src=h.api_host+"/static/array.js",(n=l.getElementsByTagName("script")[0]).parentNode.insertBefore(a,n);var i=e;for(s!==void 0?i=e[s]=[]:s="posthog",i.people=i.people||[],i.toString=function(p){var r="posthog";return s!=="posthog"&&(r+="."+s),p||(r+=" (stub)"),r},i.people.toString=function(){return i.toString(1)+".people (stub)"},t="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags".split(" "),o=0;o<t.length;o++)f(i,t[o]);e._i.push([d,h,s])},e.__SV=1)})(document,window.posthog||[]);var c=class{constructor(){this.enabled=!1,this.project_id=frappe.boot.posthog_project_id,this.telemetry_host=frappe.boot.posthog_host,this.site_age=frappe.boot.telemetry_site_age,cint(frappe.boot.enable_telemetry)&&this.project_id&&this.telemetry_host&&(this.enabled=!0)}initialize(){if(!this.enabled)return;let e=!this.should_record_session();try{posthog.init(this.project_id,{api_host:this.telemetry_host,autocapture:!1,capture_pageview:!1,capture_pageleave:!1,advanced_disable_decide:e}),posthog.identify(frappe.boot.sitename),this.send_heartbeat(),this.register_pageview_handler()}catch(t){console.trace("Failed to initialize telemetry",t),this.enabled=!1}}capture(e,t,o){!this.enabled||posthog.capture(`${t}_${e}`,o)}disable(){this.enabled=!1}can_enable(){if(cint(navigator.doNotTrack))return!1;let e=Boolean(this.telemetry_host&&this.project_id),t=Boolean(frappe.boot.sentry_dsn);return e||t}send_heartbeat(){var a,n;let e="ph_last_heartbeat",t=frappe.datetime.system_datetime(!0),o=localStorage.getItem(e);(!o||moment(t).diff(moment(o),"hours")>12)&&(localStorage.setItem(e,t.toISOString()),this.capture("heartbeat","frappe",{frappe_version:(n=(a=frappe.boot)==null?void 0:a.versions)==null?void 0:n.frappe}))}register_pageview_handler(){this.site_age&&this.site_age>6||frappe.router.on("change",()=>{posthog.capture("$pageview")})}should_record_session(){let e=frappe.boot.sysdefaults.session_recording_start;if(!e)return;let t=frappe.datetime.str_to_obj(e),o=frappe.datetime.now_datetime();return frappe.datetime.get_minute_diff(o,t)<120}};frappe.telemetry=new c;frappe.telemetry.initialize();})();
//# sourceMappingURL=telemetry.bundle.LKEZCADB.js.map
