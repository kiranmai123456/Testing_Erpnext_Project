{
  "version": 3,
  "sources": ["frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/address_list.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/contact_list.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/form_dashboard.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/form_footer.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/form_links.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/form_sidebar.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/print_layout.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/report_links.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/set_sharing.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/timeline_message_box.html", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/frappe/frappe/public/js/frappe/form/templates/users_in_sidebar.html", "../../../../../apps/frappe/frappe/public/js/frappe/views/formview.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/quick_entry.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/linked_with.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/form_viewers.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/reminders.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/toolbar.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/section.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/dashboard.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/workflow.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/save.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/print_utils.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/success_action.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/script_manager.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/script_helpers.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/assign_to.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/attachments.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/share.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/review.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/document_follow.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/user_image.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/form_sidebar_users.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/version_timeline_content_builder.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/form_sidebar.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/base_timeline.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/form_timeline.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/footer.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/form_tour.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/undo_manager.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/form.js", "../../../../../apps/frappe/frappe/public/js/frappe/meta_tag.js", "../../../../../apps/frappe/frappe/public/js/frappe/doctype/index.js"],
  "sourcesContent": ["\n\tfrappe.templates['address_list'] = `<div class=\"clearfix\"></div>\n{% for (const addr of addr_list) { %}\n\t<div class=\"address-box\">\n\t\t<a\n\t\t\thref=\"{%= frappe.utils.get_form_link('Address', addr.name) %}\"\n\t\t\tclass=\"btn btn-xs btn-default edit-btn\"\n\t\t\ttitle=\"{%= __('Edit') %}\"\n\t\t>\n\t\t\t<svg class=\"icon icon-xs\">\n\t\t\t\t<use href=\"#icon-edit\"></use>\n\t\t\t</svg>\n\t\t</a>\n\t\t<p class=\"h6 flex flex-wrap\">\n\t\t\t<span>{%= addr.address_title %}</span>\n\t\t\t{% if (addr.address_type !== \"Other\") { %}\n\t\t\t\t&nbsp;&#183;&nbsp;\n\t\t\t\t<span class=\"text-muted\">{%= __(addr.address_type) %}</span>\n\t\t\t{% } %}\n\t\t\t{% if (addr.is_primary_address) { %}\n\t\t\t\t&nbsp;&#183;&nbsp;\n\t\t\t\t<span class=\"text-muted\">{%= __(\"Primary Address\") %}</span>\n\t\t\t{% } %}\n\t\t\t{% if (addr.is_shipping_address) { %}\n\t\t\t\t&nbsp;&#183;&nbsp;\n\t\t\t\t<span class=\"text-muted\">{%= __(\"Shipping Address\") %}</span>\n\t\t\t{% } %}\n\t\t\t{% if (addr.disabled) { %}\n\t\t\t\t&nbsp;&#183;&nbsp;\n\t\t\t\t<span class=\"text-muted\">{%= __(\"Disabled\") %}</span>\n\t\t\t{% } %}\n\t\t</p>\n\t\t<p>{%= addr.display %}</p>\n\t</div>\n{% } %}\n\n{% if (!addr_list.length) { %}\n\t<p class=\"text-muted small\">{%= __(\"No address added yet.\") %}</p>\n{% } %}\n\n<p>\n\t<button class=\"btn btn-xs btn-default btn-address\">\n\t\t{{ __(\"New Address\") }}\n\t</button>\n</p>\n`;\n", "\n\tfrappe.templates['contact_list'] = `<div class=\"clearfix\"></div>\n{% for (const contact of contact_list) { %}\n\t<div class=\"address-box\">\n\t\t<a\n\t\t\thref=\"{%= frappe.utils.get_form_link('Contact', contact.name) %}\"\n\t\t\tclass=\"btn btn-xs btn-default edit-btn\"\n\t\t\ttitle=\"{%= __('Edit') %}\"\n\t\t>\n\t\t\t<svg class=\"icon icon-xs\">\n\t\t\t\t<use href=\"#icon-edit\"></use>\n\t\t\t</svg>\n\t\t</a>\n\t\t<p class=\"h6 flex flex-wrap\">\n\t\t\t<span>{%= contact.first_name %} {%= contact.last_name %}</span>\n\t\t\t{% if (contact.is_primary_contact) { %}\n\t\t\t\t&nbsp;&#183;&nbsp;\n\t\t\t\t<span class=\"text-muted\">{%= __(\"Primary Contact\") %}</span>\n\t\t\t{% } %}\n\t\t\t{% if (contact.is_billing_contact) { %}\n\t\t\t\t&nbsp;&#183;&nbsp;\n\t\t\t\t<span class=\"text-muted\">{%= __(\"Billing Contact\") %}</span>\n\t\t\t{% } %}\n\t\t\t{% if (contact.designation){ %}\n\t\t\t\t&nbsp;&#183;&nbsp;\n\t\t\t\t<span class=\"text-muted\"> {%= contact.designation %}</span>\n\t\t\t{% } %}\n\t\t</p>\n\t\t{% if (contact.phone || contact.mobile_no || contact.phone_nos.length > 0) { %}\n\t\t<p>\n\t\t\t{% if (contact.phone) { %}\n\t\t\t\t<a href=\"tel:{%= frappe.utils.escape_html(contact.phone) %}\">\n\t\t\t\t\t{%= frappe.utils.escape_html(contact.phone) %}\n\t\t\t\t</a>\n\t\t\t\t&#183;\n\t\t\t\t<span class=\"text-muted\">{%= __(\"Primary Phone\") %}</span>\n\t\t\t\t<br>\n\t\t\t{% endif %}\n\t\t\t{% if (contact.mobile_no) { %}\n\t\t\t\t<a href=\"tel:{%= frappe.utils.escape_html(contact.mobile_no) %}\">\n\t\t\t\t\t{%= frappe.utils.escape_html(contact.mobile_no) %}\n\t\t\t\t</a>\n\t\t\t\t&#183;\n\t\t\t\t<span class=\"text-muted\">{%= __(\"Primary Mobile\") %}</span>\n\t\t\t\t<br>\n\t\t\t{% endif %}\n\t\t\t{% if (contact.phone_nos) { %}\n\t\t\t\t{% for (const phone_no of contact.phone_nos) { %}\n\t\t\t\t\t<a href=\"tel:{%= frappe.utils.escape_html(phone_no.phone) %}\">\n\t\t\t\t\t\t{%= frappe.utils.escape_html(phone_no.phone) %}\n\t\t\t\t\t</a>\n\t\t\t\t\t<br>\n\t\t\t\t{% } %}\n\t\t\t{% endif %}\n\t\t</p>\n\t\t{% endif %}\n\t\t{% if (contact.email_id || contact.email_ids.length > 0) { %}\n\t\t<p>\n\t\t\t{% if (contact.email_id) { %}\n\t\t\t\t<a href=\"mailto:{%= frappe.utils.escape_html(contact.email_id) %}\">\n\t\t\t\t\t{%= frappe.utils.escape_html(contact.email_id) %}\n\t\t\t\t</a>\n\t\t\t\t&#183;\n\t\t\t\t<span class=\"text-muted\">{%= __(\"Primary Email\") %}</span>\n\t\t\t\t<br>\n\t\t\t{% endif %}\n\t\t\t{% if (contact.email_ids) { %}\n\t\t\t\t{% for (const email_id of contact.email_ids) { %}\n\t\t\t\t\t<a href=\"mailto:{%= frappe.utils.escape_html(email_id.email_id) %}\">\n\t\t\t\t\t\t{%= frappe.utils.escape_html(email_id.email_id) %}\n\t\t\t\t\t</a>\n\t\t\t\t\t<br>\n\t\t\t\t{% } %}\n\t\t\t{% endif %}\n\t\t</p>\n\t\t{% endif %}\n\t\t{% if (contact.address) { %}\n\t\t<p>\n\t\t\t{%= contact.address %}\n\t\t</p>\n\t\t{% endif %}\n\t</div>\n{% } %}\n\n{% if (!contact_list.length) { %}\n\t<p class=\"text-muted small\">{%= __(\"No contacts added yet.\") %}</p>\n{% } %}\n\n<p>\n\t<button class=\"btn btn-xs btn-default btn-contact\">\n\t\t{{ __(\"New Contact\") }}\n\t</button>\n</p>\n`;\n", "\n\tfrappe.templates['form_dashboard'] = `<div class=\"form-dashboard-wrapper\">\n\t<div class=\"progress-area hidden form-dashboard-section\">\n\t</div>\n\t<div class=\"form-heatmap hidden form-dashboard-section\">\n\t\t<div class=\"section-head\">{{ __(\"Overview\") }}</div>\n\t\t<div id=\"heatmap-{{ frappe.model.scrub(frm.doctype) }}\" class=\"heatmap\"></div>\n\t\t<div class=\"text-muted small heatmap-message hidden\"></div>\n\t</div>\n\t<div class=\"form-graph form-dashboard-section hidden\">\n\t\t<div class=\"section-head\">{{ __(\"Graph\") }}</div>\n\t</div>\n\t<div class=\"form-stats form-dashboard-section hidden\">\n\t\t<div class=\"section-head\">{{ __(\"Stats\") }}</div>\n\t\t<div class=\"row\"></div>\n\t</div>\n\t<div class=\"form-links form-dashboard-section hidden\">\n\t\t<div class=\"section-head\">{{ __(\"Documents\") }}</div>\n\t\t<div class=\"transactions\"></div>\n\t</div>\n</div>`;\n", "\n\tfrappe.templates['form_footer'] = `<div class=\"form-footer\">\n\t<div class=\"after-save\">\n\t\t<div class=\"comment-box\"></div>\n\t\t<div class=\"timeline\"></div>\n\t</div>\n\t<button class=\"scroll-to-top btn btn-default icon-btn\" onclick=\"frappe.utils.scroll_to(0)\">\n\t\t<svg class=\"icon icon-xs\"><use href=\"#icon-up-line\"></use></svg>\n\t</button>\n</div>\n`;\n", "\n\tfrappe.templates['form_links'] = `<div class=\"form-documents\">\n\t{% for (let i=0; i < transactions.length; i++) { %}\n\t\t{% if (i % 3 === 0) { %}\n\t\t<div class=\"row\">\n\t\t{% } %}\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<div class=\"form-link-title\">\n\t\t\t\t\t<span>{{ __(transactions[i].label) }}</span>\n\t\t\t\t</div>\n\t\t\t\t{% for (let j=0; j < transactions[i].items.length; j++) { %}\n\t\t\t\t\t{% let doctype = transactions[i].items[j]; %}\n\t\t\t\t\t<div class=\"document-link\" data-doctype=\"{{ doctype }}\">\n\t\t\t\t\t\t<div class=\"document-link-badge\" data-doctype=\"{{ doctype }}\">\n\t\t\t\t\t\t\t<span class=\"count hidden\"></span>\n\t\t\t\t\t\t\t<a class=\"badge-link\">{{ __(doctype) }}</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"open-notification hidden\"\n\t\t\t\t\t\t\ttitle=\"{{ __(\"Open {0}\", [__(doctype)])}}\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t{% if !internal_links[doctype] %}\n\t\t\t\t\t\t\t<button class=\"btn btn-new btn-secondary btn-xs icon-btn hidden\"\n\t\t\t\t\t\t\t\tdata-doctype=\"{{ doctype }}\">\n\t\t\t\t\t\t\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-add\"></use></svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{% endif %}\n\t\t\t\t\t</div>\n\t\t\t\t{% } %}\n\t\t\t</div>\n\t\t{% if (i % 3 === 2 || i === (transactions.length - 1)) { %}\n\t\t</div>\n\t\t{% } %}\n\t{% } %}\n</div>\n`;\n", "\n\tfrappe.templates['form_sidebar'] = `<ul class=\"list-unstyled sidebar-menu user-actions hidden\"></ul>\n<ul class=\"list-unstyled sidebar-menu sidebar-image-section hide\">\n\t<li class=\"sidebar-image-wrapper\">\n\t\t<img class=\"sidebar-image\">\n\t\t<div class=\"sidebar-standard-image\">\n\t\t\t<div class=\"standard-image\"></div>\n\t\t</div>\n\t\t{% if can_write %}\n\t\t<div class=\"sidebar-image-actions\">\n\t\t\t<div class=\"dropdown\">\n\t\t\t\t<a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">{{ __(\"Change\") }}</a>\n\t\t\t\t<div class=\"dropdown-menu\" role=\"menu\">\n\t\t\t\t\t<a class=\"dropdown-item sidebar-image-change\">{{ __(\"Upload\") }}</a>\n\t\t\t\t\t<a class=\"dropdown-item sidebar-image-remove\">{{ __(\"Remove\") }}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t{% endif %}\n\t</li>\n</ul>\n{% if frm.meta.beta %}\n<div class=\"sidebar-menu\">\n\t<p><label class=\"indicator-pill yellow\" title=\"{{ __(\"This feature is brand new and still experimental\") }}\">{{ __(\"Experimental\") }}</label></p>\n\t<p><a class=\"small text-muted\" href=\"https://github.com/frappe/{{ frappe.boot.module_app[frappe.scrub(frm.meta.module)] }}/issues/new\"\n\t\t\ttarget=\"_blank\">\n\t\t{{ __(\"Click here to post bugs and suggestions\") }}</a></p>\n\n</div>\n{% endif %}\n<ul class=\"list-unstyled sidebar-menu sidebar-rating hide\">\n\t<li style=\"position: relative;\">\n\t\t<a class=\"strong badge-hover\">\n\t\t\t<span>{%= __(\"Feedback\") %}</span>\n\t\t</a>\n\t</li>\n\t<li class=\"rating-icons\"></li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu hidden\">\n\t{% if (frappe.help.has_help(doctype)) { %}\n\t<li><a class=\"help-link list-link\" data-doctype=\"{{ doctype }}\">{{ __(\"Help\") }}</a></li>\n\t{% } %}\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-assignments\">\n\t<li>\n\t\t<span class=\"form-sidebar-items\">\n\t\t\t<span class=\"add-assignment-label\">\n\t\t\t\t<svg class=\"es-icon ml-0 icon-sm\"><use href=\"#es-line-add-people\"></use></svg>\n\t\t\t\t<span class=\"ellipsis\">{%= __(\"Assigned To\") %}</span>\n\t\t\t</span>\n\t\t\t<button class=\"add-assignment-btn btn btn-link icon-btn\">\n\t\t\t\t<svg class=\"es-icon icon-sm\"><use href=\"#es-line-add\"></use></svg>\n\t\t\t</button>\n\t\t</span>\n\t\t<div class=\"assignments\"></div>\n\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-attachments\">\n\t<li class=\"attachments-actions\">\n\t\t<span class=\"form-sidebar-items\">\n\t\t\t<span>\n\t\t\t\t<svg class=\"es-icon ml-0 icon-sm\">\n\t\t\t\t\t<use href=\"#es-line-attachment\"></use>\n\t\t\t\t</svg>\n\t\t\t\t<a class=\"pill-label ellipsis explore-link\">\n\t\t\t\t\t{%= __(\"Attachments\") %}\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t\t<button class=\"add-attachment-btn btn btn-link icon-btn\">\n\t\t\t\t<svg class=\"es-icon icon-sm\"><use href=\"#es-line-add\"></use></svg>\n\t\t\t</button>\n\t\t</span>\n\t</li>\n\t<a class=\"show-all-btn hidden\" href=\"\">\n\t\t<svg class=\"es-icon icon-sm\">\n\t\t\t<use href=\"#es-line-preview\"></use>\n\t\t</svg>\n\t\t<span class=\"pill-label ellipsis\">\n\t\t\t{%= __(\"Show All\") %}\n\t\t</span>\n\t</a>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-reviews\">\n\t\t<li class=\"reviews\">\n\t\t\t<span class=\"form-sidebar-items\">\n\t\t\t\t<span>\n\t\t\t\t\t<svg class=\"es-icon ml-0 icon-sm\"><use href=\"#es-line-star\"></use></svg>\n\t\t\t\t\t<span class=\"ellipsis\">{%= __(\"Reviews\") %}</span>\n\t\t\t\t</span>\n\t\t\t\t<button class=\"add-review-btn btn btn-link icon-btn\">\n\t\t\t\t\t<svg class=\"es-icon icon-sm\"><use href=\"#es-line-add\"></use></svg>\n\t\t\t\t</button>\n\t\t\t</span>\n\t\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-tags\">\n\t\t<li>\n\t\t\t<span class=\"form-sidebar-items\">\n\t\t\t\t<span>\n\t\t\t\t\t<svg class=\"es-icon ml-0 icon-sm\"><use href=\"#es-line-tag\"></use></svg>\n\t\t\t\t\t<span class=\"tags-label ellipsis\">{%= __(\"Tags\") %}</span>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-shared\">\n\t<li>\n\t\t<span class=\"form-sidebar-items\">\n\t\t\t<span class=\"share-label\">\n\t\t\t\t<svg class=\"es-icon ml-0 icon-sm\"><use href=\"#es-line-add-people\"></use></svg>\n\t\t\t\t<span class=\"ellipsis\">{%= __(\"Share\") %}</span>\n\t\t\t</span>\n\t\t\t<button class=\"share-doc-btn btn btn-link icon-btn\">\n\t\t\t\t<svg class=\"es-icon icon-sm\"><use href=\"#es-line-add\"></use></svg>\n\t\t\t</button>\n\t\t</span>\n\t\t<div class=\"shares\"></div>\n\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu followed-by-section\">\n\t<li class=\"sidebar-label followed-by-label hidden\">\n\t\t<svg class=\"icon icon-sm\">\n\t\t\t<use href=\"#icon-link-url\" class=\"like-icon\"></use>\n\t\t</svg>\n\t\t{%= __(\"Followed by\") %}\n\t</li>\n\t<li class=\"followed-by\"></li>\n\t<li class=\"document-follow\">\n\t\t<a class=\"badge-hover follow-document-link hidden\">\n\t\t\t{%= __(\"Follow\") %}\n\t\t</a>\n\t\t<a class=\"badge-hover unfollow-document-link hidden\">\n\t\t\t{%= __(\"Unfollow\") %}\n\t\t</a>\n\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu\">\n\t<a><li class=\"auto-repeat-status\"><li></a>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-sidebar-stats\">\n\t<li class=\"flex\">\n\t\t<div class=\"form-stats d-flex\">\n\t\t\t<span class=\"form-stats-likes\">\n\t\t\t\t<span class=\"liked-by like-action d-flex align-items-center\">\n\t\t\t\t\t<svg class=\"es-icon icon-sm\">\n\t\t\t\t\t\t<use href=\"#es-solid-heart\" class=\"like-icon\"></use>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"like-count ml-2\"></span>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span class=\"mx-2\">\u00B7</span>\n\t\t\t<a class=\"comments d-flex align-items-center\">\n\t\t\t\t<svg class=\"es-icon icon-sm\">\n\t\t\t\t\t<use href=\"#es-line-chat-alt\" class=\"comment-icon\"></use>\n\t\t\t\t</svg>\n\t\t\t\t<span class=\"comments-count ml-2\"></span>\n\t\t\t</a>\n\t\t</div>\n\t\t<a class=\"form-follow text-sm\">\n\t\t\tFollow\n\t\t</a>\n\t</li>\n</ul>\n<hr>\n<!-- <ul class=\"list-unstyled sidebar-menu\">\n\t<li class=\"liked-by-parent\">\n\t\t<span class=\"liked-by like-action\">\n\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t<use href=\"#icon-heart\" class=\"like-icon\"></use>\n\t\t\t</svg>\n\t\t\t<span class=\"likes-count\"></span>\n\t\t</span>\n\t</li>\n</ul> -->\n<ul class=\"list-unstyled sidebar-menu text-muted\">\n\t<li class=\"pageview-count\"></li>\n\t<li class=\"modified-by\"></li>\n\t<li class=\"created-by\"></li>\n</ul>\n{% if(frappe.get_form_sidebar_extension) { %}\n\t{{ frappe.get_form_sidebar_extension() }}\n{% } %}\n`;\n", "\n\tfrappe.templates['print_layout'] = `<!-- <div class=\"form-print-wrapper frappe-card\">\n\t<div class=\"print-toolbar row\">\n\t\t<div class=\"col-xs-3\">\n\t\t\t<div class=\"flex\">\n\t\t\t\t<select class=\"print-preview-select input-sm form-control\"></select>\n\t\t\t\t<button class=\"btn btn-default btn-sm border print-preview-refresh\" type=\"button\">{%= __(\"Refresh\") %}</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"col-xs-2\">\n\t\t\t<select class=\"languages input-sm form-control\"\n\t\t\t\tplaceholder=\"{{ __(\"Language\") }}\"></select></div>\n\t\t<div class=\"col-xs-2\">\n\t\t\t<div class=\"checkbox small\" style=\"margin-top: 7px; margin-bottom: 0px;\">\n\t\t\t\t<label>\n\t\t\t\t\t<input type=\"checkbox\" class=\"print-letterhead text-muted\"/>\n\t\t\t\t\t{%= __(\"Letter Head\") %}</label>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"col-xs-5 text-right\">\n\t\t\t<a class=\"close btn-print-close\" style=\"margin-top: 2px; margin-left: 10px;\">&times;</a>\n\t\t\t<div class=\"btn-group\">\n\t\t\t\t<a class=\"btn btn-default btn-sm\"\n\t\t\t\t\tstyle=\"border-top-right-radius:0px; border-bottom-right-radius: 0px;\"\n\t\t\t\t\tdata-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t\t<span>{%= __(\"Settings\") %}</span>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<svg class=\"icon icon-xs\">\n\t\t\t\t\t\t\t<use href=\"#icon-select\"></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\t\t\t\t<ul class=\"dropdown-menu print-format-dropdown\" style=\"max-height: 300px;\n\t\t\t\t\toverflow-y: auto; left: auto;\">\n\t\t\t\t\t<li><a class=\"dropdown-item\" href=\"/app/Form/Print Settings\">\n\t\t\t\t\t\t{%= __(\"Print Settings\") %}</a></li>\n\t\t\t\t\t<li><a class=\"btn-printer-setting dropdown-item\" style=\"display: none;\">\n\t\t\t\t\t\t{%= __(\"Raw Printing Settings\") %}</a></li>\n\t\t\t\t\t<li><a class=\"btn-print-edit dropdown-item\">\n\t\t\t\t\t\t{%= __(\"Customize\") %}</a></li>\n\t\t\t\t</ul>\n\t\t\t\t<a class=\"btn-print-preview btn-sm btn btn-default\">\n\t\t\t\t\t{%= __(\"Full Page\") %}</a>\n\t\t\t\t<a class=\"btn-download-pdf btn-sm btn btn-default\">\n\t\t\t\t\t{%= __(\"PDF\") %}</a>\n\t\t\t\t<a class=\"btn-print-print btn-sm btn btn-default\">\n\t\t\t\t\t<strong>{%= __(\"Print\") %}</strong></a>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class=\"print-preview-wrapper\">\n\t\t<div class=\"print-preview\">\n\t\t\t<div class=\"print-format\"></div>\n\t\t</div>\n\t\t<div class=\"page-break-message text-muted text-center text-medium margin-top\"></div>\n\t</div>\n</div> -->\n`;\n", "\n\tfrappe.templates['report_links'] = `<div class=\"form-documents\">\n\t{% for (var i=0; i < reports.length; i++) { %}\n\t\t{% if (i % 3 === 0) { %}\n\t\t<div class=\"row\">\n\t\t{% } %}\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<div class=\"form-link-title\">\n\t\t\t\t\t<span>{{ __(reports[i].label) }}</span>\n\t\t\t\t</div>\n\t\t\t\t{% for (let j=0; j < reports[i].items.length; j++) { %}\n\t\t\t\t\t{% let report = reports[i].items[j]; %}\n\t\t\t\t\t<div class=\"document-link\" data-report=\"{{ report }}\">\n\t\t\t\t\t\t<div class=\"report-link-badge\" data-report=\"{{ report }}\">\n\t\t\t\t\t\t\t<a class=\"report-link\">{{ __(report) }}</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{% } %}\n\t\t\t</div>\n\t\t{% if (i % 3 === 2 || i === (reports.length - 1)) { %}\n\t\t</div>\n\t\t{% } %}\n\t{% } %}\n</div>\n`;\n", "\n\tfrappe.templates['set_sharing'] = `<div>\n\t<div class=\"row\">\n\t\t<div class=\"col-xs-4\"><h6>{%= __(\"User\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Read\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Write\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Submit\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Share\") %}</h6></div>\n\t</div>\n\n\t<div class=\"row shared-user\" data-everyone=1>\n\t\t<div class=\"col-xs-4 share-all\"><b>{{ __(\"Everyone\") }}</b></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"read\"\n\t\t\t{% if(cint(everyone.read)) { %}checked{% } %} class=\"edit-share\"></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"write\"\n\t\t\tclass=\"edit-share\"\n\t\t\t{% if(cint(everyone.write)) { %}checked{% } %}\n\t\t\t{% if (!frm.perm[0].write){ %} disabled=\"disabled\"{% } %}>\n\t\t</div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"submit\"\n\t\t\tclass=\"edit-share\"\n\t\t\t{% if(cint(everyone.submit)) { %}checked{% } %}\n\t\t\t{% if (!frm.perm[0].submit){ %} disabled=\"disabled\"{% } %}>\n\t\t</div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"share\"\n\t\t\t{% if(cint(everyone.share)) { %}checked{% } %} class=\"edit-share\"></div>\n\t</div>\n\n\t{% for (var i=0, l=shared.length; i < l; i++) {\n\t\tvar s = shared[i]; %}\n\t\t{% if(s && !s.everyone) { %}\n\t\t<div class=\"row shared-user\" data-user=\"{%= s.user %}\" data-name=\"{%= s.name %}\">\n\t\t\t<div class=\"col-xs-4\">{%= s.user %}</div>\n\t\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"read\"\n\t\t\t\t{% if(cint(s.read)) { %}checked{% } %} class=\"edit-share\"></div>\n\t\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"write\"\n\t\t\t\t{% if(cint(s.write)) { %}checked{% } %} class=\"edit-share\"{% if (!frm.perm[0].write){ %} disabled=\"disabled\"{% } %}></div>\n\t\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"submit\"\n\t\t\t\t{% if(cint(s.submit)) { %}checked{% } %} class=\"edit-share\"{% if (!frm.perm[0].submit){ %} disabled=\"disabled\"{% } %}></div>\n\t\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"share\"\n\t\t\t\t{% if(cint(s.share)) { %}checked{% } %} class=\"edit-share\"></div>\n\t\t</div>\n\t\t{% } %}\n\t{% } %}\n\n\t{% if(frappe.model.can_share(null, frm)) { %}\n\t<hr>\n\n\t<div class=\"row\">\n\t\t<div class=\"col-xs-4\"><h6>{%= __(\"Share this document with\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Read\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Write\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Submit\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Share\") %}</h6></div>\n\t</div>\n\n\t<div class=\"row\">\n\t\t<div class=\"col-xs-4 input-wrapper-add-share\"></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-flex-start mt-2\"><input type=\"checkbox\" class=\"add-share-read\" name=\"read\"></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-flex-start mt-2\"><input type=\"checkbox\" class=\"add-share-write\" name=\"write\"\n\t\t\t{% if (!frm.perm[0].write){ %} disabled=\"disabled\"{% } %}>\n\t\t</div>\n\t\t<div class=\"col-xs-2 flex justify-center align-flex-start mt-2\"><input type=\"checkbox\" class=\"add-share-submit\" name=\"submit\"\n\t\t\t{% if (!frm.perm[0].submit){ %} disabled=\"disabled\"{% } %}>\n\t\t</div>\n\t\t<div class=\"col-xs-2 flex justify-center align-flex-start mt-2\"><input type=\"checkbox\" class=\"add-share-share\" name=\"share\"></div>\n\t</div>\n\t<div>\n\t\t<button class=\"btn btn-primary btn-sm btn-add-share mt-3\">{{ __(\"Add\") }}</button>\n\t</div>\n\t{% endif %}\n</div>`;\n", "\n\tfrappe.templates['timeline_message_box'] = `<div class=\"timeline-message-box\" data-communication-type=\"{{ doc.communication_type }}\">\n\t<span class=\"flex justify-between m-1 mb-3\">\n\t\t<span class=\"text-color flex\">\n\t\t\t{% if (doc.communication_type && doc.communication_type == \"Automated Message\") { %}\n\t\t\t\t<span>\n\t\t\t\t\t<!-- Display maximum of 3 users-->\n\t\t\t\t\t{{ __(\"Notification sent to\") }}\n\t\t\t\t\t{% var recipients = (doc.recipients && doc.recipients.split(\",\")) || [] %}\n\t\t\t\t\t{% var cc = (doc.cc && doc.cc.split(\",\")) || [] %}\n\t\t\t\t\t{% var bcc = (doc.bcc && doc.bcc.split(\",\")) || [] %}\n\t\t\t\t\t{% var emails = recipients.concat(cc, bcc) %}\n\t\t\t\t\t{% var display_emails_len = Math.min(emails.length, 3) %}\n\n\t\t\t\t\t{% for (var i=0, len=display_emails_len; i<len; i++) { var email = emails[i]; %}\n\t\t\t\t\t\t{{ frappe.user_info(email).fullname || email }}\n\t\t\t\t\t\t{% if (len > i+1) { %}\n\t\t\t\t\t\t\t{{ \",\" }}\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t{% } %}\n\n\t\t\t\t\t{% if (emails.length > display_emails_len) { %}\n\t\t\t\t\t\t{{ \"...\" }}\n\t\t\t\t\t{% } %}\n\n\t\t\t\t\t<div class=\"text-muted\">\n\t\t\t\t\t\t{{ comment_when(doc.creation) }}\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t{% } else if (doc.comment_type && doc.comment_type == \"Comment\") { %}\n\t\t\t\t<span>\n\t\t\t\t\t{{ frappe.avatar(doc.owner, \"avatar-medium\") }}\n\t\t\t\t\t<span class=\"ml-2\" style=\"font-size: var(--text-base);\">{{ doc.user_full_name || frappe.user.full_name(doc.owner) }}</span>\n\t\t\t\t\t<span class=\"text-muted\">{{ __(\"commented\") }}</span>\n\t\t\t\t\t<span> . </span>\n\t\t\t\t\t<span class=\"margin-left text-muted\">\n\t\t\t\t\t\t{{ comment_when(doc.creation) }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t{% } else { %}\n\t\t\t\t<span class=\"margin-right\">\n\t\t\t\t\t{{ frappe.avatar(doc.owner, \"avatar-medium\") }}\n\t\t\t\t</span>\n\t\t\t\t<div>\n\t\t\t\t\t{{ doc.user_full_name || frappe.user.full_name(doc.owner) }}\n\t\t\t\t\t<span> . </span>\n\t\t\t\t\t<span class=\"text-muted\">\n\t\t\t\t\t\t{{ comment_when(doc.creation) }}\n\t\t\t\t\t</span>\n\t\t\t\t\t{% if (doc.subject) { %}\n\t\t\t\t\t\t<div class=\"text-muted my-1\">{{doc.subject}}</div>\n\t\t\t\t\t{% } %}\n\t\t\t\t</div>\n\t\t\t{% } %}\n\t\t</span>\n\t\t<span class=\"actions\" style=\"flex-shrink: 0\">\n\t\t\t{% if (doc._doc_status && doc._doc_status_indicator) { %}\n\t\t\t<span class=\"indicator-pill {%= doc._doc_status_indicator %}\"\n\t\t\t\ttitle=\"{%= __(doc._doc_status) %}\"\n\t\t\t\tstyle=\"order: -1\">\n\t\t\t\t<span class=\"hidden-xs small\">\n\t\t\t\t\t{%= __(doc._doc_status) %}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t{% } %}\n\n\t\t\t{% if (doc._url) { %}\n\t\t\t<a class=\"action-btn\" href=\"{{ doc._url }}\" title=\"{{ __(\"Open Communication\") }}\">\n\t\t\t\t<svg class=\"es-icon icon-sm\">\n\t\t\t\t\t<use href=\"#es-line-link\"></use>\n\t\t\t\t</svg>\n\t\t\t</a>\n\t\t\t{% } %}\n\t\t\t<div class=\"custom-actions\"></div>\n\t\t\t<div class=\"more-actions\">\n\t\t\t\t<a type=\"button\" class=\"action-btn\"\n\t\t\t\t\tdata-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t<use href=\"#icon-dot-horizontal\"></use>\n\t\t\t\t\t</svg>\n\t\t\t\t</a>\n\t\t\t\t<ul class=\"dropdown-menu small\">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a class=\"dropdown-item\" data-action=\"copy_link\">{{ __('Copy Link') }}</a>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</span>\n\t</span>\n\t<div class=\"content\">\n\t\t{{ doc.content }}\n\t</div>\n\t{% if (doc.attachments && doc.attachments.length) { %}\n\t<div style=\"margin-top: 10px\">\n\t{% $.each(doc.attachments, function(i, a) { %}\n\t<div class=\"ellipsis flex\">\n\t\t<a href=\"{%= encodeURI(a.file_url).replace(/#/g, \\'%23\\') %}\"\n\t\t\tclass=\"text-muted small\" target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t<svg viewBox=\"0 0 16 16\" class=\"icon icon-xs\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M14 7.66625L8.68679 12.8875C7.17736 14.3708 4.64151 14.3708 3.13208 12.8875C1.62264 11.4042 1.62264 8.91224 3.13208 7.42892L7.84151 2.80099C8.9283 1.733 10.6189 1.733 11.7057 2.80099C12.7925 3.86897 12.7925 5.53028 11.7057 6.59827L7.35849 10.8109C6.75472 11.4042 5.78868 11.4042 5.24528 10.8109C4.64151 10.2176 4.64151 9.26823 5.24528 8.73424L8.86792 5.17429\" stroke=\"currentColor\" stroke-miterlimit=\"10\" stroke-linecap=\"round\"/>\n\t\t\t</svg>\n\t\t\t{%= a.file_url.split(\"/\").slice(-1)[0] %}\n\t\t\t{% if (a.is_private) { %}\n\t\t\t\t<svg class=\"icon icon-xs\" style=\"color: var(--yellow-300)\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\">\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.077 1.45h-.055a3.356 3.356 0 00-3.387 3.322v.35H3.75a2 2 0 00-2 2v5.391a2 2 0 002 2h8.539a2 2 0 002-2V7.122a2 2 0 00-2-2h-.885v-.285A3.356 3.356 0 008.082 1.45h-.005zm2.327 3.672V4.83a2.356 2.356 0 00-2.33-2.38h-.06a2.356 2.356 0 00-2.38 2.33v.342h4.77zm-6.654 1a1 1 0 00-1 1v5.391a1 1 0 001 1h8.539a1 1 0 001-1V7.122a1 1 0 00-1-1H3.75zm4.27 4.269a.573.573 0 100-1.147.573.573 0 000 1.147zm1.573-.574a1.573 1.573 0 11-3.147 0 1.573 1.573 0 013.147 0z\" fill=\"currentColor\" stroke=\"currentColor\"></path>\n\t\t\t\t</svg>\n\t\t\t{% } %}\n\t\t</a>\n\t</div>\n\t{% }); %}\n\t</div>\n\t{% } %}\n</div>\n`;\n", "\n\tfrappe.templates['users_in_sidebar'] = `{% for (var i=0, l=users.length; i < l; i++) {\n\tvar u = users[i];\n%}\n\t<span class=\"avatar avatar-small {{ u.avatar_class || \"\" }}\" title=\"{{ u.title }}\">\n\t{% if (u.icon) { %}\n\t\t<i class=\"{{ u.icon }}\"></i>\n\t{% } else if(u.image) { %}\n\t\t<img class=\"media-object\" src=\"{{ u.image }}\" alt=\"{{ u.fullname }}\">\n\t{% } else { %}\n\t\t<div class=\"standard-image\" style=\"background-color: {{ u.color }};\">{{ u.abbr.substr(0,1) }}</div>\n\t{% } %}\n\t</span>\n{% } %}\n`;\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.views.formview\");\n\nfrappe.views.FormFactory = class FormFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tvar doctype = route[1],\n\t\t\tdoctype_layout = frappe.router.doctype_layout || doctype;\n\n\t\tif (!frappe.views.formview[doctype_layout]) {\n\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\tthis.page = frappe.container.add_page(doctype_layout);\n\t\t\t\tfrappe.views.formview[doctype_layout] = this.page;\n\t\t\t\tthis.make_and_show(doctype, route);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.show_doc(route);\n\t\t}\n\n\t\tthis.setup_events();\n\t}\n\n\tmake_and_show(doctype, route) {\n\t\tif (frappe.router.doctype_layout) {\n\t\t\tfrappe.model.with_doc(\"DocType Layout\", frappe.router.doctype_layout, () => {\n\t\t\t\tthis.make_form(doctype);\n\t\t\t\tthis.show_doc(route);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make_form(doctype);\n\t\t\tthis.show_doc(route);\n\t\t}\n\t}\n\n\tmake_form(doctype) {\n\t\tthis.page.frm = new frappe.ui.form.Form(\n\t\t\tdoctype,\n\t\t\tthis.page,\n\t\t\ttrue,\n\t\t\tfrappe.router.doctype_layout\n\t\t);\n\t}\n\n\tsetup_events() {\n\t\tif (!this.initialized) {\n\t\t\t$(document).on(\"page-change\", function () {\n\t\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\t});\n\t\t}\n\t\tthis.initialized = true;\n\t}\n\n\tshow_doc(route) {\n\t\tvar doctype = route[1],\n\t\t\tdoctype_layout = frappe.router.doctype_layout || doctype,\n\t\t\tname = route.slice(2).join(\"/\");\n\n\t\tif (frappe.model.new_names[name]) {\n\t\t\t// document has been renamed, reroute\n\t\t\tname = frappe.model.new_names[name];\n\t\t\tfrappe.set_route(\"Form\", doctype_layout, name);\n\t\t\treturn;\n\t\t}\n\n\t\tconst doc = frappe.get_doc(doctype, name);\n\t\tif (\n\t\t\tdoc &&\n\t\t\tfrappe.model.get_docinfo(doctype, name) &&\n\t\t\t(doc.__islocal || frappe.model.is_fresh(doc))\n\t\t) {\n\t\t\t// is document available and recent?\n\t\t\tthis.render(doctype_layout, name);\n\t\t} else {\n\t\t\tthis.fetch_and_render(doctype, name, doctype_layout);\n\t\t}\n\t}\n\n\tfetch_and_render(doctype, name, doctype_layout) {\n\t\tfrappe.model.with_doc(doctype, name, (name, r) => {\n\t\t\tif (r && r[\"403\"]) return; // not permitted\n\n\t\t\tif (!(locals[doctype] && locals[doctype][name])) {\n\t\t\t\tif (name && name.substr(0, 3) === \"new\") {\n\t\t\t\t\tthis.render_new_doc(doctype, name, doctype_layout);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_not_found();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render(doctype_layout, name);\n\t\t});\n\t}\n\n\trender_new_doc(doctype, name, doctype_layout) {\n\t\tconst new_name = frappe.model.make_new_doc_and_get_name(doctype, true);\n\t\tif (new_name === name) {\n\t\t\tthis.render(doctype_layout, name);\n\t\t} else {\n\t\t\tfrappe.route_flags.replace_route = true;\n\t\t\tfrappe.set_route(\"Form\", doctype_layout, new_name);\n\t\t}\n\t}\n\n\trender(doctype_layout, name) {\n\t\tfrappe.container.change_to(doctype_layout);\n\t\tfrappe.views.formview[doctype_layout].frm.refresh(name);\n\t}\n};\n", "frappe.provide(\"frappe.ui.form\");\n\nfrappe.quick_edit = function (doctype, name) {\n\tfrappe.db.get_doc(doctype, name).then((doc) => {\n\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, doc);\n\t});\n};\n\nfrappe.ui.form.make_quick_entry = (doctype, after_insert, init_callback, doc, force) => {\n\tvar trimmed_doctype = doctype.replace(/ /g, \"\");\n\tvar controller_name = \"QuickEntryForm\";\n\n\tif (frappe.ui.form[trimmed_doctype + \"QuickEntryForm\"]) {\n\t\tcontroller_name = trimmed_doctype + \"QuickEntryForm\";\n\t}\n\n\tfrappe.quick_entry = new frappe.ui.form[controller_name](\n\t\tdoctype,\n\t\tafter_insert,\n\t\tinit_callback,\n\t\tdoc,\n\t\tforce\n\t);\n\treturn frappe.quick_entry.setup();\n};\n\nfrappe.ui.form.QuickEntryForm = class QuickEntryForm {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tthis.doctype = doctype;\n\t\tthis.after_insert = after_insert;\n\t\tthis.init_callback = init_callback;\n\t\tthis.doc = doc;\n\t\tthis.force = force ? force : false;\n\t}\n\n\tsetup() {\n\t\treturn new Promise((resolve) => {\n\t\t\tfrappe.model.with_doctype(this.doctype, () => {\n\t\t\t\tthis.check_quick_entry_doc();\n\t\t\t\tthis.set_meta_and_mandatory_fields();\n\t\t\t\tif (this.is_quick_entry() || this.force) {\n\t\t\t\t\tthis.render_dialog();\n\t\t\t\t\tresolve(this);\n\t\t\t\t} else {\n\t\t\t\t\t// no quick entry, open full form\n\t\t\t\t\tfrappe.quick_entry = null;\n\t\t\t\t\tfrappe\n\t\t\t\t\t\t.set_route(\"Form\", this.doctype, this.doc.name)\n\t\t\t\t\t\t.then(() => resolve(this));\n\t\t\t\t\t// call init_callback for consistency\n\t\t\t\t\tif (this.init_callback) {\n\t\t\t\t\t\tthis.init_callback(this.doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tset_meta_and_mandatory_fields() {\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tlet fields = this.meta.fields;\n\n\t\tthis.mandatory = fields.filter((df) => {\n\t\t\treturn (df.reqd || df.allow_in_quick_entry) && !df.read_only && !df.is_virtual;\n\t\t});\n\t}\n\n\tcheck_quick_entry_doc() {\n\t\tif (!this.doc) {\n\t\t\tthis.doc = frappe.model.get_new_doc(this.doctype, null, null, true);\n\t\t}\n\t}\n\n\tis_quick_entry() {\n\t\tif (this.meta.quick_entry != 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.validate_for_prompt_autoname();\n\n\t\tif (this.has_child_table() || !this.mandatory.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\ttoo_many_mandatory_fields() {\n\t\tif (this.mandatory.length > 7) {\n\t\t\t// too many fields, show form\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\thas_child_table() {\n\t\tif (\n\t\t\t$.map(this.mandatory, function (d) {\n\t\t\t\treturn d.fieldtype === \"Table\" ? d : null;\n\t\t\t}).length\n\t\t) {\n\t\t\t// has mandatory table, quit!\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvalidate_for_prompt_autoname() {\n\t\tif (this.meta.autoname && this.meta.autoname.toLowerCase() === \"prompt\") {\n\t\t\tthis.mandatory = [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"__newname\",\n\t\t\t\t\tlabel: __(\"{0} Name\", [__(this.meta.name)]),\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t},\n\t\t\t].concat(this.mandatory);\n\t\t}\n\t}\n\n\trender_dialog() {\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [__(this.doctype)]),\n\t\t\tfields: this.mandatory,\n\t\t\tdoc: this.doc,\n\t\t});\n\n\t\tthis.register_primary_action();\n\t\t!this.force && this.render_edit_in_full_page_link();\n\t\t// ctrl+enter to save\n\t\tthis.dialog.wrapper.keydown(function (e) {\n\t\t\tif ((e.ctrlKey || e.metaKey) && e.which == 13) {\n\t\t\t\tif (!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tme.dialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.dialog.onhide = () => (frappe.quick_entry = null);\n\t\tthis.dialog.show();\n\n\t\tthis.dialog.refresh_dependency();\n\t\tthis.set_defaults();\n\n\t\tif (this.init_callback) {\n\t\t\tthis.init_callback(this.dialog);\n\t\t}\n\t}\n\n\tregister_primary_action() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__(\"Save\"), function () {\n\t\t\tif (me.dialog.working) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar data = me.dialog.get_values();\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tme.dialog.set_message(__(\"Saving...\"));\n\t\t\t\tme.insert().then(() => {\n\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tinsert() {\n\t\tlet me = this;\n\t\treturn new Promise((resolve) => {\n\t\t\tme.update_doc();\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.save\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.dialog.doc,\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (frappe.model.is_submittable(me.doctype)) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => (me.dialog.working = true),\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tme.dialog.set_primary_action(__(\"Submit\"), function () {\n\t\t\t\t\t\t\t\t\tme.submit(r.message);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t// delete the old doc\n\t\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function () {\n\t\t\t\t\tif (!me.skip_redirect_on_error) {\n\t\t\t\t\t\tme.open_doc(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\talways: function () {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tsubmit(doc) {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.submit\",\n\t\t\targs: {\n\t\t\t\tdoc: doc,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tme.dialog.hide();\n\t\t\t\t// delete the old doc\n\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t} else {\n\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcur_frm && cur_frm.reload_doc();\n\t\t\t},\n\t\t});\n\t}\n\n\topen_form_if_not_list() {\n\t\tlet route = frappe.get_route();\n\t\tlet doc = this.dialog.doc;\n\t\tif (route && !(route[0] === \"List\" && route[1] === doc.doctype)) {\n\t\t\tfrappe.run_serially([() => frappe.set_route(\"Form\", doc.doctype, doc.name)]);\n\t\t}\n\t}\n\n\tupdate_doc() {\n\t\tvar me = this;\n\t\tvar data = this.dialog.get_values(true);\n\t\t$.each(data, function (key, value) {\n\t\t\tif (!is_null(value)) {\n\t\t\t\tme.dialog.doc[key] = value;\n\t\t\t}\n\t\t});\n\t\treturn this.dialog.doc;\n\t}\n\n\topen_doc(set_hooks) {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (set_hooks && this.after_insert) {\n\t\t\tfrappe.route_options = frappe.route_options || {};\n\t\t\tfrappe.route_options.after_save = (frm) => {\n\t\t\t\tthis.after_insert(frm);\n\t\t\t};\n\t\t}\n\t\tfrappe.set_route(\"Form\", this.doctype, this.doc.name);\n\t}\n\n\trender_edit_in_full_page_link() {\n\t\tvar me = this;\n\t\tthis.dialog.add_custom_action(__(\"Edit Full Form\"), () => me.open_doc(true));\n\t}\n\n\tset_defaults() {\n\t\tvar me = this;\n\t\t// set defaults\n\t\t$.each(this.dialog.fields_dict, function (fieldname, field) {\n\t\t\tfield.doctype = me.doc.doctype;\n\t\t\tfield.docname = me.doc.name;\n\n\t\t\tif (!is_null(me.doc[fieldname])) {\n\t\t\t\tfield.set_input(me.doc[fieldname]);\n\t\t\t}\n\t\t});\n\t}\n};\n", "// Copyright (c) 2022, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See LICENSE\n\nfrappe.ui.form.LinkedWith = class LinkedWith {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tshow() {\n\t\tif (!this.dialog) this.make_dialog();\n\n\t\t$(this.dialog.body).html(\n\t\t\t`<div class=\"text-muted text-center\" style=\"padding: 30px 0px\">\n\t\t\t\t${__(\"Loading\")}...\n\t\t\t</div>`\n\t\t);\n\n\t\tthis.dialog.show();\n\t}\n\n\tmake_dialog() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Linked With\"),\n\t\t});\n\n\t\tthis.dialog.on_page_show = () => {\n\t\t\tfrappe\n\t\t\t\t.xcall(\"frappe.desk.form.linked_with.get\", {\n\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\tdocname: this.frm.docname,\n\t\t\t\t})\n\t\t\t\t.then((r) => {\n\t\t\t\t\tthis.frm.__linked_docs = r;\n\t\t\t\t})\n\t\t\t\t.then(() => this.make_html());\n\t\t};\n\t}\n\n\tmake_html() {\n\t\tlet html = \"\";\n\t\tconst linked_docs = this.frm.__linked_docs;\n\t\tconst linked_doctypes = Object.keys(linked_docs);\n\n\t\tif (linked_doctypes.length === 0) {\n\t\t\thtml = __(\"Not Linked to any record\");\n\t\t} else {\n\t\t\thtml = linked_doctypes\n\t\t\t\t.map((doctype) => {\n\t\t\t\t\tconst docs = linked_docs[doctype];\n\t\t\t\t\treturn `\n\t\t\t\t\t<div class=\"list-item-table margin-bottom\">\n\t\t\t\t\t\t${this.make_doc_head(doctype)}\n\t\t\t\t\t\t${docs.map((doc) => this.make_doc_row(doc, doctype)).join(\"\")}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\t})\n\t\t\t\t.join(\"\");\n\t\t}\n\n\t\t$(this.dialog.body).html(html);\n\t}\n\n\tmake_doc_head(heading) {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div>${__(heading)}</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tmake_doc_row(doc, doctype) {\n\t\treturn `<div class=\"list-row-container\">\n\t\t\t<div class=\"level list-row small\">\n\t\t\t\t<div class=\"level-left bold\">\n\t\t\t\t\t<a href=\"/app/${frappe.router.slug(doctype)}/${doc.name}\">${doc.name}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n};\n", "frappe.ui.form.FormViewers = class FormViewers {\n\tconstructor({ frm, parent }) {\n\t\tthis.frm = frm;\n\t\tthis.parent = parent;\n\t\tthis.parent.tooltip({ title: __(\"Currently Viewing\") });\n\n\t\tthis._past_users = {};\n\t\tthis._active_users = {};\n\t\tthis.setup_events();\n\t}\n\n\tget past_users() {\n\t\treturn this._past_users[this.frm?.doc?.name] || [];\n\t}\n\n\tset past_users(users) {\n\t\tconst docname = this.frm?.doc?.name;\n\t\tif (!docname) return;\n\n\t\tthis._past_users[docname] = users;\n\t}\n\n\tget active_users() {\n\t\treturn this._active_users[this.frm?.doc?.name] || [];\n\t}\n\n\tset active_users(users) {\n\t\tconst docname = this.frm?.doc?.name;\n\t\tif (!docname) return;\n\n\t\tthis._active_users[docname] = users;\n\t}\n\n\trefresh() {\n\t\tif (!this.active_users.length) {\n\t\t\tthis.parent.empty();\n\t\t\treturn;\n\t\t}\n\t\tlet avatar_group = frappe.avatar_group(this.active_users, 5, {\n\t\t\talign: \"left\",\n\t\t\toverlap: true,\n\t\t});\n\t\tthis.parent.empty().append(avatar_group);\n\t}\n\n\tsetup_events() {\n\t\tlet me = this;\n\t\tfrappe.realtime.off(\"doc_viewers\");\n\t\tfrappe.realtime.on(\"doc_viewers\", function (data) {\n\t\t\tme.update_users(data);\n\t\t});\n\t}\n\n\tasync update_users({ doctype, docname, users = [] }) {\n\t\tusers = users.filter((u) => u != frappe.session.user);\n\n\t\tconst added_users = users.filter((user) => !this.past_users.includes(user));\n\t\tconst removed_users = this.past_users.filter((user) => !users.includes(user));\n\t\tconst changed_users = [...added_users, ...removed_users];\n\n\t\tif (changed_users.length === 0) return;\n\n\t\tawait this.fetch_user_info(users);\n\n\t\tthis.active_users = users;\n\t\tthis.past_users = users;\n\n\t\tif (this.frm?.doc?.doctype === doctype && this.frm?.doc?.name == docname) {\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\tasync fetch_user_info(users) {\n\t\tlet unknown_users = [];\n\t\tfor (let user of users) {\n\t\t\tif (!frappe.boot.user_info[user]) unknown_users.push(user);\n\t\t}\n\t\tif (!unknown_users.length) return;\n\n\t\tconst data = await frappe.xcall(\"frappe.desk.form.load.get_user_info_for_viewers\", {\n\t\t\tusers: unknown_users,\n\t\t});\n\t\tObject.assign(frappe.boot.user_info, data);\n\t}\n};\n", "export class ReminderManager {\n\tconstructor({ frm }) {\n\t\tthis.frm = frm; // can be optional if not setting for document.\n\t}\n\n\tshow() {\n\t\tlet me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Create a Reminder\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\tlabel: __(\"Remind Me In\"),\n\t\t\t\t\tfieldname: \"remind_me_in\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ label: __(\"30 minutes\"), value: \"30_minutes\" },\n\t\t\t\t\t\t{ label: __(\"1 hour\"), value: \"1_hour\" },\n\t\t\t\t\t\t{ label: __(\"4 hours\"), value: \"4_hours\" },\n\t\t\t\t\t\t{ label: __(\"1 Day\"), value: \"1_day\" },\n\t\t\t\t\t\t{ label: __(\"Custom\"), value: \"custom\" },\n\t\t\t\t\t],\n\t\t\t\t\tdefault: \"1_hour\",\n\t\t\t\t\tonchange: () => {\n\t\t\t\t\t\tme._update_datetime_selector();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\t\tfieldname: \"col_break_1\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Datetime\",\n\t\t\t\t\tlabel: __(\"Remind At\"),\n\t\t\t\t\tfieldname: \"remind_at\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\t\tfieldname: \"divider_between_message_and_time\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\t\tlabel: __(\"Description\"),\n\t\t\t\t\tfieldname: \"description\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __(\"Create\"),\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.create_reminder();\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t\tsecondary_action_label: __(\"Cancel\"),\n\t\t\tsecondary_action: () => {\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t});\n\t\tthis._update_datetime_selector();\n\t\tthis.dialog.show();\n\t}\n\n\t_update_datetime_selector() {\n\t\tthis._convert_period_to_absolute_time();\n\t\tthis.dialog.fields_dict.remind_at.df.read_only =\n\t\t\tthis.dialog.get_value(\"remind_me_in\") != \"custom\";\n\t\tthis.dialog.fields_dict.remind_at.refresh();\n\t\tthis.dialog.fields_dict.remind_at.datepicker?.update({\n\t\t\tminDate: frappe.datetime.str_to_obj(frappe.datetime.now_datetime()),\n\t\t});\n\t}\n\n\t_convert_period_to_absolute_time() {\n\t\tconst period = this.dialog.get_value(\"remind_me_in\");\n\t\tif (!period || period == \"custom\") return;\n\n\t\tconst now_time = frappe.datetime.str_to_obj(frappe.datetime.now_datetime());\n\t\tlet [magnitude, unit] = period.split(\"_\");\n\n\t\tlet time_to_set = moment(now_time)\n\t\t\t.add(magnitude, unit)\n\t\t\t.format(frappe.defaultDatetimeFormat);\n\t\tthis.dialog.set_value(\"remind_at\", time_to_set);\n\t}\n\n\tcreate_reminder() {\n\t\tfrappe\n\t\t\t.xcall(\"frappe.automation.doctype.reminder.reminder.create_new_reminder\", {\n\t\t\t\tremind_at: this.dialog.get_value(\"remind_at\"),\n\t\t\t\tdescription: this.dialog.get_value(\"description\"),\n\t\t\t\treminder_doctype: this.frm?.doc.doctype,\n\t\t\t\treminder_docname: this.frm?.doc.name,\n\t\t\t})\n\t\t\t.then((reminder) => {\n\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t__(\"Reminder set at {0}\", [frappe.datetime.str_to_user(reminder.remind_at)])\n\t\t\t\t);\n\t\t\t});\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport \"./linked_with\";\nimport \"./form_viewers\";\nimport { ReminderManager } from \"./reminders\";\n\nfrappe.ui.form.Toolbar = class Toolbar {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.refresh();\n\t\tthis.add_update_button_on_dirty();\n\t\tthis.setup_editable_title();\n\t}\n\trefresh() {\n\t\tthis.make_menu();\n\t\tthis.set_title();\n\t\tthis.page.clear_user_actions();\n\t\tthis.show_title_as_dirty();\n\t\tthis.set_primary_action();\n\n\t\tif (this.frm.meta.hide_toolbar) {\n\t\t\tthis.page.hide_menu();\n\t\t} else {\n\t\t\tif (this.frm.doc.__islocal) {\n\t\t\t\tthis.page.hide_menu();\n\t\t\t\tthis.print_icon && this.print_icon.addClass(\"hide\");\n\t\t\t} else {\n\t\t\t\tthis.page.show_menu();\n\t\t\t\tthis.print_icon && this.print_icon.removeClass(\"hide\");\n\t\t\t}\n\t\t}\n\t}\n\tset_title() {\n\t\tlet title;\n\t\tif (this.frm.is_new()) {\n\t\t\ttitle = __(\"New {0}\", [__(this.frm.meta.name)]);\n\t\t} else if (this.frm.meta.title_field) {\n\t\t\tlet title_field = (this.frm.doc[this.frm.meta.title_field] || \"\").toString().trim();\n\t\t\ttitle = strip_html(title_field || this.frm.docname);\n\t\t\tif (\n\t\t\t\tthis.frm.doc.__islocal ||\n\t\t\t\ttitle === this.frm.docname ||\n\t\t\t\tthis.frm.meta.autoname === \"hash\"\n\t\t\t) {\n\t\t\t\tthis.page.set_title_sub(\"\");\n\t\t\t} else {\n\t\t\t\tthis.page.set_title_sub(this.frm.docname);\n\t\t\t\tthis.page.$sub_title_area.css(\"cursor\", \"copy\");\n\t\t\t\tthis.page.$sub_title_area.on(\"click\", (event) => {\n\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\tfrappe.utils.copy_to_clipboard(this.frm.docname);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\ttitle = this.frm.docname;\n\t\t}\n\n\t\tvar me = this;\n\t\ttitle = __(title);\n\t\tthis.page.set_title(title);\n\t\tif (this.frm.meta.title_field) {\n\t\t\tfrappe.utils.set_title(title + \" - \" + this.frm.docname);\n\t\t}\n\t\tthis.page.$title_area.toggleClass(\n\t\t\t\"editable-title\",\n\t\t\t!!(this.is_title_editable() || this.can_rename())\n\t\t);\n\n\t\tthis.set_indicator();\n\t}\n\tis_title_editable() {\n\t\tlet title_field = this.frm.meta.title_field;\n\t\tlet doc_field = this.frm.get_docfield(title_field);\n\n\t\tif (\n\t\t\ttitle_field &&\n\t\t\tthis.frm.perm[0].write &&\n\t\t\t!this.frm.doc.__islocal &&\n\t\t\tdoc_field.fieldtype === \"Data\" &&\n\t\t\t!doc_field.read_only\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tcan_rename() {\n\t\treturn this.frm.perm[0].write && this.frm.meta.allow_rename && !this.frm.doc.__islocal;\n\t}\n\tshow_unchanged_document_alert() {\n\t\tfrappe.show_alert({\n\t\t\tindicator: \"info\",\n\t\t\tmessage: __(\"Unchanged\"),\n\t\t});\n\t}\n\trename_document_title(input_name, input_title, merge = false) {\n\t\tlet confirm_message = null;\n\t\tconst docname = this.frm.doc.name;\n\t\tconst title_field = this.frm.meta.title_field || \"\";\n\t\tconst doctype = this.frm.doctype;\n\t\tlet queue;\n\t\tif (this.frm.__rename_queue) {\n\t\t\tqueue = this.frm.__rename_queue;\n\t\t}\n\n\t\tif (input_name) {\n\t\t\tconst warning = __(\"This cannot be undone\");\n\t\t\tconst message = __(\"Are you sure you want to merge {0} with {1}?\", [\n\t\t\t\tdocname.bold(),\n\t\t\t\tinput_name.bold(),\n\t\t\t]);\n\t\t\tconfirm_message = `${message}<br><b>${warning}<b>`;\n\t\t}\n\n\t\tlet rename_document = () => {\n\t\t\tif (input_name != docname) frappe.realtime.doctype_subscribe(doctype, input_name);\n\t\t\treturn frappe\n\t\t\t\t.xcall(\"frappe.model.rename_doc.update_document_title\", {\n\t\t\t\t\tdoctype,\n\t\t\t\t\tdocname,\n\t\t\t\t\tname: input_name,\n\t\t\t\t\ttitle: input_title,\n\t\t\t\t\tenqueue: true,\n\t\t\t\t\tmerge,\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tfreeze_message: __(\"Updating related fields...\"),\n\t\t\t\t\tqueue,\n\t\t\t\t})\n\t\t\t\t.then((new_docname) => {\n\t\t\t\t\tconst reload_form = (input_name) => {\n\t\t\t\t\t\t$(document).trigger(\"rename\", [doctype, docname, input_name]);\n\t\t\t\t\t\tif (locals[doctype] && locals[doctype][docname])\n\t\t\t\t\t\t\tdelete locals[doctype][docname];\n\t\t\t\t\t\tthis.frm.reload_doc();\n\t\t\t\t\t};\n\n\t\t\t\t\t// handle document renaming queued action\n\t\t\t\t\tif (input_name != docname) {\n\t\t\t\t\t\tfrappe.realtime.on(\"list_update\", (data) => {\n\t\t\t\t\t\t\tif (data.doctype == doctype && data.name == input_name) {\n\t\t\t\t\t\t\t\treload_form(input_name);\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: __(\"Document renamed from {0} to {1}\", [\n\t\t\t\t\t\t\t\t\t\tdocname.bold(),\n\t\t\t\t\t\t\t\t\t\tinput_name.bold(),\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\tindicator: \"success\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t__(\"Document renaming from {0} to {1} has been queued\", [\n\t\t\t\t\t\t\t\tdocname.bold(),\n\t\t\t\t\t\t\t\tinput_name.bold(),\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// handle document sync rename action\n\t\t\t\t\tif (input_name && (new_docname || input_name) != docname) {\n\t\t\t\t\t\treload_form(new_docname || input_name);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (input_title === this.frm.doc[title_field] && input_name === docname) {\n\t\t\t\tthis.show_unchanged_document_alert();\n\t\t\t\tresolve();\n\t\t\t} else if (merge) {\n\t\t\t\tfrappe.confirm(\n\t\t\t\t\tconfirm_message,\n\t\t\t\t\t() => {\n\t\t\t\t\t\trename_document().then(resolve).catch(reject);\n\t\t\t\t\t},\n\t\t\t\t\treject\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\trename_document().then(resolve).catch(reject);\n\t\t\t}\n\t\t});\n\t}\n\tsetup_editable_title() {\n\t\tlet me = this;\n\n\t\tthis.page.$title_area.find(\".title-text\").on(\"click\", () => {\n\t\t\tlet fields = [];\n\t\t\tlet docname = me.frm.doc.name;\n\t\t\tlet title_field = me.frm.meta.title_field || \"\";\n\n\t\t\t// check if title is updatable\n\t\t\tif (me.is_title_editable()) {\n\t\t\t\tlet title_field_label = me.frm.get_docfield(title_field).label;\n\n\t\t\t\tfields.push({\n\t\t\t\t\tlabel: __(\"New {0}\", [__(title_field_label)]),\n\t\t\t\t\tfieldname: \"title\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdefault: me.frm.doc[title_field],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// check if docname is updatable\n\t\t\tif (me.can_rename()) {\n\t\t\t\tlet label = __(\"New Name\");\n\t\t\t\tif (me.frm.meta.autoname && me.frm.meta.autoname.startsWith(\"field:\")) {\n\t\t\t\t\tlet fieldname = me.frm.meta.autoname.split(\":\")[1];\n\t\t\t\t\tlabel = __(\"New {0}\", [me.frm.get_docfield(fieldname).label]);\n\t\t\t\t}\n\n\t\t\t\tfields.push(\n\t\t\t\t\t...[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: label,\n\t\t\t\t\t\t\tfieldname: \"name\",\n\t\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\t\tdefault: docname,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __(\"Merge with existing\"),\n\t\t\t\t\t\t\tfieldname: \"merge\",\n\t\t\t\t\t\t\tfieldtype: \"Check\",\n\t\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// create dialog\n\t\t\tif (fields.length > 0) {\n\t\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __(\"Rename\"),\n\t\t\t\t\tfields: fields,\n\t\t\t\t});\n\t\t\t\td.show();\n\t\t\t\td.set_primary_action(__(\"Rename\"), (values) => {\n\t\t\t\t\td.disable_primary_action();\n\t\t\t\t\td.hide();\n\t\t\t\t\tthis.rename_document_title(values.name, values.title, values.merge)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\td.enable_primary_action();\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tget_dropdown_menu(label) {\n\t\treturn this.page.add_dropdown(label);\n\t}\n\tset_indicator() {\n\t\tvar indicator = frappe.get_indicator(this.frm.doc);\n\t\tif (\n\t\t\tthis.frm.save_disabled &&\n\t\t\tindicator &&\n\t\t\t[__(\"Saved\"), __(\"Not Saved\")].includes(indicator[0])\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tif (indicator) {\n\t\t\tthis.page.set_indicator(indicator[0], indicator[1]);\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t}\n\tmake_menu() {\n\t\tthis.page.clear_icons();\n\t\tthis.page.clear_menu();\n\n\t\tif (frappe.boot.desk_settings.form_sidebar) {\n\t\t\tthis.make_navigation();\n\t\t\tthis.make_menu_items();\n\t\t}\n\t}\n\n\tmake_navigation() {\n\t\t// Navigate\n\t\tif (!this.frm.is_new() && !this.frm.meta.issingle) {\n\t\t\tthis.page.add_action_icon(\n\t\t\t\t\"es-line-left-chevron\",\n\t\t\t\t() => {\n\t\t\t\t\tthis.frm.navigate_records(1);\n\t\t\t\t},\n\t\t\t\t\"prev-doc\",\n\t\t\t\t__(\"Previous Document\")\n\t\t\t);\n\t\t\tthis.page.add_action_icon(\n\t\t\t\t\"es-line-right-chevron\",\n\t\t\t\t() => {\n\t\t\t\t\tthis.frm.navigate_records(0);\n\t\t\t\t},\n\t\t\t\t\"next-doc\",\n\t\t\t\t__(\"Next Document\")\n\t\t\t);\n\t\t}\n\t}\n\n\tmake_menu_items() {\n\t\t// Print\n\t\tconst me = this;\n\t\tconst p = this.frm.perm[0];\n\t\tconst docstatus = cint(this.frm.doc.docstatus);\n\t\tconst is_submittable = frappe.model.is_submittable(this.frm.doc.doctype);\n\n\t\tconst print_settings = frappe.model.get_doc(\":Print Settings\", \"Print Settings\");\n\t\tconst allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tconst allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\tif (\n\t\t\t!is_submittable ||\n\t\t\tdocstatus == 1 ||\n\t\t\t(allow_print_for_cancelled && docstatus == 2) ||\n\t\t\t(allow_print_for_draft && docstatus == 0)\n\t\t) {\n\t\t\tif (frappe.model.can_print(null, me.frm) && !this.frm.meta.issingle) {\n\t\t\t\tthis.page.add_menu_item(\n\t\t\t\t\t__(\"Print\"),\n\t\t\t\t\tfunction () {\n\t\t\t\t\t\tme.frm.print_doc();\n\t\t\t\t\t},\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t\tthis.print_icon = this.page.add_action_icon(\n\t\t\t\t\t\"printer\",\n\t\t\t\t\tfunction () {\n\t\t\t\t\t\tme.frm.print_doc();\n\t\t\t\t\t},\n\t\t\t\t\t\"\",\n\t\t\t\t\t__(\"Print\")\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// email\n\t\tif (frappe.model.can_email(null, me.frm) && me.frm.doc.docstatus < 2) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Email\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.email_doc();\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{\n\t\t\t\t\tshortcut: \"Ctrl+E\",\n\t\t\t\t\tcondition: () => !this.frm.is_new(),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\t// go to field modal\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Jump to field\"),\n\t\t\tfunction () {\n\t\t\t\tme.show_jump_to_field_dialog();\n\t\t\t},\n\t\t\ttrue,\n\t\t\t\"Ctrl+J\"\n\t\t);\n\n\t\t// Linked With\n\t\tif (!me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Links\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.show_linked_with();\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\t// duplicate\n\t\tif (frappe.boot.user.can_create.includes(me.frm.doctype) && !me.frm.meta.allow_copy) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Duplicate\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.copy_doc();\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t\"Shift+D\"\n\t\t\t);\n\t\t}\n\n\t\t// copy doc to clipboard\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Copy to Clipboard\"),\n\t\t\tfunction () {\n\t\t\t\tfrappe.utils.copy_to_clipboard(JSON.stringify(me.frm.doc));\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\t// rename\n\t\tif (this.can_rename()) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Rename\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.rename_doc();\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\t// reload\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Reload\"),\n\t\t\tfunction () {\n\t\t\t\tme.frm.reload_doc();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\t// delete\n\t\tif (\n\t\t\tcint(me.frm.doc.docstatus) != 1 &&\n\t\t\t!me.frm.doc.__islocal &&\n\t\t\t!frappe.model.is_single(me.frm.doctype) &&\n\t\t\tfrappe.model.can_delete(me.frm.doctype)\n\t\t) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Delete\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.savetrash();\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{\n\t\t\t\t\tshortcut: \"Shift+Ctrl+D\",\n\t\t\t\t\tcondition: () => !this.frm.is_new(),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Remind Me\"),\n\t\t\t() => {\n\t\t\t\tlet reminder_maanger = new ReminderManager({ frm: this.frm });\n\t\t\t\treminder_maanger.show();\n\t\t\t},\n\t\t\ttrue,\n\t\t\t{\n\t\t\t\tshortcut: \"Shift+R\",\n\t\t\t\tcondition: () => !this.frm.is_new(),\n\t\t\t}\n\t\t);\n\t\t//\n\t\t// Undo and redo\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Undo\"),\n\t\t\t() => {\n\t\t\t\tthis.frm.undo_manager.undo();\n\t\t\t},\n\t\t\ttrue,\n\t\t\t{\n\t\t\t\tshortcut: \"ctrl+z\",\n\t\t\t\tcondition: () => !this.frm.is_form_builder(),\n\t\t\t\tdescription: __(\"Undo last action\"),\n\t\t\t}\n\t\t);\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Redo\"),\n\t\t\t() => {\n\t\t\t\tthis.frm.undo_manager.redo();\n\t\t\t},\n\t\t\ttrue,\n\t\t\t{\n\t\t\t\tshortcut: \"ctrl+y\",\n\t\t\t\tcondition: () => !this.frm.is_form_builder(),\n\t\t\t\tdescription: __(\"Redo last action\"),\n\t\t\t}\n\t\t);\n\n\t\tthis.make_customize_buttons();\n\n\t\t// Auto Repeat\n\t\tif (this.can_repeat()) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Repeat\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.utils.new_auto_repeat_prompt(me.frm);\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\t// New\n\t\tif (p[CREATE] && !this.frm.meta.issingle && !this.frm.meta.in_create) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"New {0}\", [__(me.frm.doctype)]),\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.new_doc(me.frm.doctype, true);\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{\n\t\t\t\t\tshortcut: \"Ctrl+B\",\n\t\t\t\t\tcondition: () => !this.frm.is_new(),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tmake_customize_buttons() {\n\t\tlet is_doctype_form = this.frm.doctype === \"DocType\";\n\t\tif (\n\t\t\tfrappe.model.can_create(\"Custom Field\") &&\n\t\t\tfrappe.model.can_create(\"Property Setter\")\n\t\t) {\n\t\t\tlet doctype = is_doctype_form ? this.frm.docname : this.frm.doctype;\n\t\t\tlet is_doctype_custom = is_doctype_form ? this.frm.doc.custom : false;\n\n\t\t\tif (doctype != \"DocType\" && !is_doctype_custom && this.frm.meta.issingle === 0) {\n\t\t\t\tthis.page.add_menu_item(\n\t\t\t\t\t__(\"Customize\"),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tif (this.frm.meta && this.frm.meta.custom) {\n\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"DocType\", doctype);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Customize Form\", {\n\t\t\t\t\t\t\t\tdoc_type: doctype,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (frappe.model.can_create(\"DocType\")) {\n\t\t\tif (frappe.boot.developer_mode === 1 && !is_doctype_form) {\n\t\t\t\t// edit doctype\n\t\t\t\tthis.page.add_menu_item(\n\t\t\t\t\t__(\"Edit DocType\"),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrappe.set_route(\"Form\", \"DocType\", this.frm.doctype);\n\t\t\t\t\t},\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tcan_repeat() {\n\t\treturn this.frm.meta.allow_auto_repeat && !this.frm.is_new() && !this.frm.doc.auto_repeat;\n\t}\n\tcan_save() {\n\t\treturn this.get_docstatus() === 0;\n\t}\n\tcan_submit() {\n\t\treturn (\n\t\t\tthis.get_docstatus() === 0 &&\n\t\t\t!this.frm.doc.__islocal &&\n\t\t\t!this.frm.doc.__unsaved &&\n\t\t\tthis.frm.perm[0].submit &&\n\t\t\t!this.has_workflow()\n\t\t);\n\t}\n\tcan_update() {\n\t\treturn (\n\t\t\tthis.get_docstatus() === 1 &&\n\t\t\t!this.frm.doc.__islocal &&\n\t\t\tthis.frm.perm[0].submit &&\n\t\t\tthis.frm.doc.__unsaved\n\t\t);\n\t}\n\tcan_cancel() {\n\t\treturn this.get_docstatus() === 1 && this.frm.perm[0].cancel && !this.read_only;\n\t}\n\tcan_amend() {\n\t\treturn this.get_docstatus() === 2 && this.frm.perm[0].amend && !this.read_only;\n\t}\n\thas_workflow() {\n\t\tif (this._has_workflow === undefined)\n\t\t\tthis._has_workflow = frappe.get_list(\"Workflow\", {\n\t\t\t\tdocument_type: this.frm.doctype,\n\t\t\t}).length;\n\t\treturn this._has_workflow;\n\t}\n\tget_docstatus() {\n\t\treturn cint(this.frm.doc.docstatus);\n\t}\n\tshow_linked_with() {\n\t\tif (!this.frm.linked_with) {\n\t\t\tthis.frm.linked_with = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm,\n\t\t\t});\n\t\t}\n\t\tthis.frm.linked_with.show();\n\t}\n\tset_primary_action(dirty) {\n\t\tif (!dirty) {\n\t\t\t// don't clear actions menu if dirty\n\t\t\tthis.page.clear_user_actions();\n\t\t}\n\n\t\tvar status = this.get_action_status();\n\t\tif (status) {\n\t\t\t// When moving from a page with status amend to another page with status amend\n\t\t\t// We need to check if document is already amend specifically and hide\n\t\t\t// or clear the menu actions accordingly\n\n\t\t\tif (status !== this.current_status && status === \"Amend\") {\n\t\t\t\tlet doc = this.frm.doc;\n\t\t\t\tfrappe\n\t\t\t\t\t.xcall(\"frappe.client.is_document_amended\", {\n\t\t\t\t\t\tdoctype: doc.doctype,\n\t\t\t\t\t\tdocname: doc.name,\n\t\t\t\t\t})\n\t\t\t\t\t.then((is_amended) => {\n\t\t\t\t\t\tif (is_amended) {\n\t\t\t\t\t\t\tthis.page.clear_actions();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.set_page_actions(status);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.set_page_actions(status);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.page.clear_actions();\n\t\t\tthis.current_status = null;\n\t\t}\n\t}\n\tget_action_status() {\n\t\tvar status = null;\n\t\tif (this.frm.page.current_view_name === \"print\" || this.frm.hidden) {\n\t\t\tstatus = \"Edit\";\n\t\t} else if (this.can_submit()) {\n\t\t\tstatus = \"Submit\";\n\t\t} else if (this.can_save()) {\n\t\t\tif (!this.frm.save_disabled) {\n\t\t\t\t//Show the save button if there is no workflow or if there is a workflow and there are changes\n\t\t\t\tif (this.has_workflow() ? this.frm.doc.__unsaved : true) {\n\t\t\t\t\tstatus = \"Save\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this.can_update()) {\n\t\t\tstatus = \"Update\";\n\t\t} else if (this.can_cancel()) {\n\t\t\tstatus = \"Cancel\";\n\t\t} else if (this.can_amend()) {\n\t\t\tstatus = \"Amend\";\n\t\t}\n\t\treturn status;\n\t}\n\tset_page_actions(status) {\n\t\tvar me = this;\n\t\tthis.page.clear_actions();\n\n\t\tif (status !== \"Edit\") {\n\t\t\tvar perm_to_check = this.frm.action_perm_type_map[status];\n\t\t\tif (!this.frm.perm[0][perm_to_check]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (status === \"Edit\") {\n\t\t\tthis.page.set_primary_action(\n\t\t\t\t__(\"Edit\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.page.set_view(\"main\");\n\t\t\t\t},\n\t\t\t\t\"edit\"\n\t\t\t);\n\t\t} else if (status === \"Cancel\") {\n\t\t\tlet add_cancel_button = () => {\n\t\t\t\tthis.page.set_secondary_action(__(status), function () {\n\t\t\t\t\tme.frm.savecancel(this);\n\t\t\t\t});\n\t\t\t};\n\t\t\tif (this.has_workflow()) {\n\t\t\t\tfrappe\n\t\t\t\t\t.xcall(\"frappe.model.workflow.can_cancel_document\", {\n\t\t\t\t\t\tdoctype: this.frm.doc.doctype,\n\t\t\t\t\t})\n\t\t\t\t\t.then((can_cancel) => {\n\t\t\t\t\t\tif (can_cancel) {\n\t\t\t\t\t\t\tadd_cancel_button();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tadd_cancel_button();\n\t\t\t}\n\t\t} else {\n\t\t\tvar click = {\n\t\t\t\tSave: function () {\n\t\t\t\t\treturn me.frm.save(\"Save\", null, this);\n\t\t\t\t},\n\t\t\t\tSubmit: function () {\n\t\t\t\t\treturn me.frm.savesubmit(this);\n\t\t\t\t},\n\t\t\t\tUpdate: function () {\n\t\t\t\t\treturn me.frm.save(\"Update\", null, this);\n\t\t\t\t},\n\t\t\t\tAmend: function () {\n\t\t\t\t\treturn me.frm.amend_doc();\n\t\t\t\t},\n\t\t\t}[status];\n\n\t\t\tvar icon = {\n\t\t\t\tUpdate: \"edit\",\n\t\t\t}[status];\n\n\t\t\tthis.page.set_primary_action(__(status), click, icon);\n\t\t}\n\n\t\tthis.current_status = status;\n\t}\n\tadd_update_button_on_dirty() {\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).on(\"dirty\", function () {\n\t\t\tme.show_title_as_dirty();\n\n\t\t\t// clear workflow actions\n\t\t\tme.frm.page.clear_actions_menu();\n\n\t\t\t// enable save action\n\t\t\tif (!me.frm.save_disabled) {\n\t\t\t\tme.set_primary_action(true);\n\t\t\t}\n\t\t});\n\t}\n\tshow_title_as_dirty() {\n\t\tif (this.frm.save_disabled && !this.frm.set_dirty) return;\n\n\t\tif (this.frm.is_dirty()) {\n\t\t\tthis.page.set_indicator(__(\"Not Saved\"), \"orange\");\n\t\t}\n\n\t\t$(this.frm.wrapper).attr(\"data-state\", this.frm.is_dirty() ? \"dirty\" : \"clean\");\n\t}\n\n\tshow_jump_to_field_dialog() {\n\t\tlet visible_fields_filter = (f) =>\n\t\t\t![\"Section Break\", \"Column Break\", \"Tab Break\"].includes(f.df.fieldtype) &&\n\t\t\t!f.df.hidden &&\n\t\t\tf.disp_status !== \"None\";\n\n\t\tlet fields = this.frm.fields\n\t\t\t.filter(visible_fields_filter)\n\t\t\t.map((f) => ({ label: __(f.df.label), value: f.df.fieldname }));\n\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Jump to field\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Autocomplete\",\n\t\t\t\t\tfieldname: \"fieldname\",\n\t\t\t\t\tlabel: __(\"Select Field\"),\n\t\t\t\t\toptions: fields,\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __(\"Go\"),\n\t\t\tprimary_action: ({ fieldname }) => {\n\t\t\t\tdialog.hide();\n\t\t\t\tthis.frm.scroll_to_field(fieldname);\n\t\t\t},\n\t\t\tanimate: false,\n\t\t});\n\n\t\tdialog.show();\n\t}\n};\n", "export default class Section {\n\tconstructor(parent, df, card_layout, layout) {\n\t\tthis.layout = layout;\n\t\tthis.card_layout = card_layout;\n\t\tthis.parent = parent;\n\t\tthis.df = df || {};\n\t\tthis.columns = [];\n\t\tthis.fields_list = [];\n\t\tthis.fields_dict = {};\n\n\t\tthis.make();\n\n\t\tif (\n\t\t\tthis.df.label &&\n\t\t\tthis.df.collapsible &&\n\t\t\tlocalStorage.getItem(df.css_class + \"-closed\")\n\t\t) {\n\t\t\tthis.collapse();\n\t\t}\n\n\t\tthis.row = {\n\t\t\twrapper: this.wrapper,\n\t\t};\n\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\tlet make_card = this.card_layout;\n\t\tthis.wrapper = $(`<div class=\"row\n\t\t\t\t${this.df.is_dashboard_section ? \"form-dashboard-section\" : \"form-section\"}\n\t\t\t\t${make_card ? \"card-section\" : \"\"}\" data-fieldname=\"${this.df.fieldname}\">\n\t\t\t`).appendTo(this.parent);\n\n\t\tif (this.df) {\n\t\t\tif (this.df.label) {\n\t\t\t\tthis.make_head();\n\t\t\t}\n\t\t\tif (this.df.description) {\n\t\t\t\tthis.description_wrapper = $(\n\t\t\t\t\t`<div class=\"col-sm-12 form-section-description\">\n\t\t\t\t\t\t${__(this.df.description)}\n\t\t\t\t\t</div>`\n\t\t\t\t);\n\n\t\t\t\tthis.wrapper.append(this.description_wrapper);\n\t\t\t}\n\t\t\tif (this.df.css_class) {\n\t\t\t\tthis.wrapper.addClass(this.df.css_class);\n\t\t\t}\n\t\t\tif (this.df.hide_border) {\n\t\t\t\tthis.wrapper.toggleClass(\"hide-border\", true);\n\t\t\t}\n\t\t}\n\n\t\tthis.body = $('<div class=\"section-body\">').appendTo(this.wrapper);\n\n\t\tif (this.df.body_html) {\n\t\t\tthis.body.append(this.df.body_html);\n\t\t}\n\t}\n\n\tmake_head() {\n\t\tthis.head = $(`\n\t\t\t<div class=\"section-head\">\n\t\t\t\t${__(this.df.label)}\n\t\t\t\t<span class=\"ml-2 collapse-indicator mb-1\"></span>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.head.appendTo(this.wrapper);\n\t\tthis.indicator = this.head.find(\".collapse-indicator\");\n\t\tthis.indicator.hide();\n\n\t\tif (this.df.collapsible) {\n\t\t\tthis.head.addClass(\"collapsible\");\n\t\t\t// show / hide based on status\n\t\t\tthis.collapse_link = this.head.on(\"click\", () => {\n\t\t\t\tthis.collapse();\n\t\t\t});\n\t\t\tthis.set_icon();\n\t\t\tthis.indicator.show();\n\t\t}\n\t}\n\n\treplace_field(fieldname, fieldobj) {\n\t\tif (this.fields_dict[fieldname]?.df) {\n\t\t\tconst olfldobj = this.fields_dict[fieldname];\n\t\t\tconst idx = this.fields_list.findIndex((e) => e == olfldobj);\n\t\t\tthis.fields_list.splice(idx, 1, fieldobj);\n\t\t\tthis.fields_dict[fieldname] = fieldobj;\n\t\t\tfieldobj.section = this;\n\t\t}\n\t}\n\n\tadd_field(fieldobj) {\n\t\tthis.fields_list.push(fieldobj);\n\t\tthis.fields_dict[fieldobj.df.fieldname] = fieldobj;\n\t\tfieldobj.section = this;\n\t}\n\n\trefresh(hide) {\n\t\tif (!this.df) return;\n\t\t// hide if explicitly hidden\n\t\thide = hide || this.df.hidden || this.df.hidden_due_to_dependency;\n\t\tthis.wrapper.toggleClass(\"hide-control\", !!hide);\n\t}\n\n\tcollapse(hide) {\n\t\t// unknown edge case\n\t\tif (!(this.head && this.body)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (hide === undefined) {\n\t\t\thide = !this.body.hasClass(\"hide\");\n\t\t}\n\n\t\tthis.body.toggleClass(\"hide\", hide);\n\t\tthis.head && this.head.toggleClass(\"collapsed\", hide);\n\n\t\tthis.set_icon(hide);\n\n\t\tthis.fields_list.forEach((f) => f.on_section_collapse && f.on_section_collapse(hide));\n\n\t\t// save state for next reload ('' is falsy)\n\t\tif (this.df.css_class)\n\t\t\tlocalStorage.setItem(this.df.css_class + \"-closed\", hide ? \"1\" : \"\");\n\t}\n\n\tset_icon(hide) {\n\t\tlet indicator_icon = hide ? \"es-line-down\" : \"es-line-up\";\n\t\tthis.indicator && this.indicator.html(frappe.utils.icon(indicator_icon, \"sm\", \"mb-1\"));\n\t}\n\n\tis_collapsed() {\n\t\treturn this.body.hasClass(\"hide\");\n\t}\n\n\thas_missing_mandatory() {\n\t\tlet missing_mandatory = false;\n\t\tfor (let j = 0, l = this.fields_list.length; j < l; j++) {\n\t\t\tconst section_df = this.fields_list[j].df;\n\t\t\tif (section_df.reqd && this.layout.doc[section_df.fieldname] == null) {\n\t\t\t\tmissing_mandatory = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn missing_mandatory;\n\t}\n\n\thide() {\n\t\tthis.on_section_toggle(false);\n\t}\n\n\tshow() {\n\t\tthis.on_section_toggle(true);\n\t}\n\n\ton_section_toggle(show) {\n\t\tthis.wrapper.toggleClass(\"hide-control\", !show);\n\t\t// this.on_section_toggle && this.on_section_toggle(show);\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nimport Section from \"./section.js\";\n\nfrappe.ui.form.Dashboard = class FormDashboard {\n\tconstructor(parent, frm) {\n\t\tthis.parent = parent;\n\t\tthis.frm = frm;\n\t\tthis.setup_dashboard_sections();\n\t}\n\n\tsetup_dashboard_sections() {\n\t\tthis.progress_area = this.make_section({\n\t\t\tcss_class: \"progress-area\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t});\n\n\t\tthis.heatmap_area = this.make_section({\n\t\t\tlabel: __(\"Activity\"),\n\t\t\tcss_class: \"form-heatmap\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t\tbody_html: `\n\t\t\t\t<div id=\"heatmap-${frappe.model.scrub(this.frm.doctype)}\" class=\"heatmap\"></div>\n\t\t\t\t<div class=\"text-muted small heatmap-message hidden\"></div>\n\t\t\t`,\n\t\t});\n\n\t\tthis.chart_area = this.make_section({\n\t\t\tlabel: __(\"Graph\"),\n\t\t\tcss_class: \"form-graph\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t});\n\n\t\tthis.stats_area_row = $(`<div class=\"row\"></div>`);\n\t\tthis.stats_area = this.make_section({\n\t\t\tlabel: __(\"Stats\"),\n\t\t\tcss_class: \"form-stats\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t\tbody_html: this.stats_area_row,\n\t\t});\n\n\t\tthis.transactions_area = $(`<div class=\"transactions\"></div>`);\n\n\t\tthis.links_area = this.make_section({\n\t\t\tlabel: __(\"Connections\"),\n\t\t\tcss_class: \"form-links\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t\tbody_html: this.transactions_area,\n\t\t});\n\t}\n\n\tmake_section(df) {\n\t\treturn new Section(this.parent, df);\n\t}\n\n\treset() {\n\t\t// clear progress\n\t\tthis.progress_area.body.empty();\n\t\tthis.progress_area.hide();\n\n\t\t// clear heatmap\n\t\tthis.heatmap_area.hide();\n\n\t\t// clear chart\n\t\tthis.chart_area.hide();\n\n\t\t// clear links\n\t\tthis.links_area.body.find(\".count, .open-notification\").addClass(\"hidden\");\n\t\tthis.links_area.hide();\n\n\t\t// clear stats\n\t\tthis.stats_area_row.empty();\n\t\tthis.stats_area.hide();\n\n\t\t// clear custom\n\t\tthis.parent.find(\".custom\").remove();\n\t\t// this.hide();\n\t}\n\n\tadd_section(body_html, label = null, css_class = \"custom\", hidden = false) {\n\t\tlet options = {\n\t\t\tlabel,\n\t\t\tcss_class,\n\t\t\thidden,\n\t\t\tbody_html,\n\t\t\tmake_card: true,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t};\n\t\treturn new Section(this.parent, options).body;\n\t}\n\n\tadd_progress(title, percent, message) {\n\t\tlet progress_chart = this.make_progress_chart(title);\n\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\n\t\tlet progress = $('<div class=\"progress\"></div>').appendTo(progress_chart);\n\n\t\t$.each(percent, function (i, opts) {\n\t\t\t$(\n\t\t\t\t`<div class=\"progress-bar ${opts.progress_class}\" style=\"width: ${opts.width}\" title=\"${opts.title}\"></div>`\n\t\t\t).appendTo(progress);\n\t\t});\n\n\t\tif (!message) message = \"\";\n\t\t$(`<p class=\"progress-message text-muted small\">${message}</p>`).appendTo(progress_chart);\n\n\t\tthis.show();\n\n\t\treturn progress_chart;\n\t}\n\n\tshow_progress(title, percent, message) {\n\t\tthis._progress_map = this._progress_map || {};\n\t\tlet progress_chart = this._progress_map[title];\n\t\t// create a new progress chart if it doesnt exist\n\t\t// or the previous one got detached from the DOM\n\t\tif (!progress_chart || progress_chart.parent().length == 0) {\n\t\t\tprogress_chart = this.add_progress(title, percent, message);\n\t\t\tthis._progress_map[title] = progress_chart;\n\t\t}\n\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\t\tprogress_chart.find(\".progress-bar\").each((i, progress_bar) => {\n\t\t\tconst { progress_class, width } = percent[i];\n\t\t\t$(progress_bar)\n\t\t\t\t.css(\"width\", width)\n\t\t\t\t.removeClass(\"progress-bar-danger progress-bar-success\")\n\t\t\t\t.addClass(progress_class);\n\t\t});\n\n\t\tif (!message) message = \"\";\n\t\tprogress_chart.find(\".progress-message\").text(message);\n\t}\n\n\thide_progress(title) {\n\t\tif (title) {\n\t\t\tthis._progress_map[title].remove();\n\t\t\tdelete this._progress_map[title];\n\t\t} else {\n\t\t\tthis._progress_map = {};\n\t\t\tthis.progress_area.hide();\n\t\t}\n\t}\n\n\tformat_percent(title, percent) {\n\t\tconst percentage = cint(percent);\n\t\tconst width = percentage < 0 ? 100 : percentage;\n\t\tconst progress_class = percentage < 0 ? \"progress-bar-danger\" : \"progress-bar-success\";\n\n\t\treturn [\n\t\t\t{\n\t\t\t\ttitle: title,\n\t\t\t\twidth: width + \"%\",\n\t\t\t\tprogress_class: progress_class,\n\t\t\t},\n\t\t];\n\t}\n\n\tmake_progress_chart(title) {\n\t\tthis.progress_area.show();\n\t\treturn $('<div class=\"progress-chart\" title=\"' + (title || \"\") + '\"></div>').appendTo(\n\t\t\tthis.progress_area.body\n\t\t);\n\t}\n\n\trefresh() {\n\t\tthis.reset();\n\t\tif (this.frm.doc.__islocal || !frappe.boot.desk_settings.dashboard) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tlet show = false;\n\n\t\tif (\n\t\t\tthis.data &&\n\t\t\t((this.data.transactions || []).length || (this.data.reports || []).length)\n\t\t) {\n\t\t\tif (this.data.docstatus && this.frm.doc.docstatus !== this.data.docstatus) {\n\t\t\t\t// limited docstatus\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render_links();\n\t\t\tshow = true;\n\t\t}\n\n\t\tthis._fetched_counts = false;\n\n\t\tif (this.data.heatmap) {\n\t\t\tthis.render_heatmap();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif (this.data.graph) {\n\t\t\tthis.setup_graph();\n\t\t\t// show = true;\n\t\t}\n\n\t\tif (show) {\n\t\t\tthis.show();\n\t\t}\n\t}\n\n\tafter_refresh() {\n\t\t// show / hide new buttons (if allowed)\n\t\tthis.links_area.body.find(\".btn-new\").each((i, el) => {\n\t\t\tif (this.frm.can_create($(el).attr(\"data-doctype\"))) {\n\t\t\t\t$(el).removeClass(\"hidden\");\n\t\t\t}\n\t\t});\n\t\tthis.observe_link_render();\n\t}\n\n\tobserve_link_render() {\n\t\tlet me = this;\n\t\tlet element = this.links_area.wrapper[0];\n\n\t\tnew IntersectionObserver((entries, observer) => {\n\t\t\tentries.forEach((entry) => {\n\t\t\t\tif (entry.intersectionRatio > 0) {\n\t\t\t\t\tme.set_open_count();\n\t\t\t\t\tobserver.disconnect(); // only required for first load.\n\t\t\t\t}\n\t\t\t});\n\t\t}).observe(element);\n\t}\n\n\tinit_data() {\n\t\tthis.data = this.frm.meta.__dashboard || {};\n\t\tif (!this.data.transactions) this.data.transactions = [];\n\t\tif (!this.data.internal_links) this.data.internal_links = {};\n\t\tif (!this.data.internal_and_external_links) this.data.internal_and_external_links = {};\n\t\tthis.filter_permissions();\n\t}\n\n\tadd_transactions(opts) {\n\t\t// add additional data on dashboard\n\t\tlet group_added = [];\n\n\t\tif (!Array.isArray(opts)) opts = [opts];\n\n\t\tif (!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tif (this.data && (this.data.transactions || []).length) {\n\t\t\t// check if label already exists, add items to it\n\t\t\tthis.data.transactions.map((group) => {\n\t\t\t\topts.map((d) => {\n\t\t\t\t\tif (d.label == group.label) {\n\t\t\t\t\t\tgroup_added.push(d.label);\n\t\t\t\t\t\tgroup.items.push(...d.items);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// if label not already present, add new label and items under it\n\t\t\topts.map((d) => {\n\t\t\t\tif (!group_added.includes(d.label)) {\n\t\t\t\t\tthis.data.transactions.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.filter_permissions();\n\t\t}\n\t}\n\n\tfilter_permissions() {\n\t\t// filter out transactions for which the user\n\t\t// does not have permission\n\t\tlet transactions = [];\n\t\t(this.data.transactions || []).forEach(function (group) {\n\t\t\tlet items = [];\n\t\t\tgroup.items.forEach(function (doctype) {\n\t\t\t\tif (frappe.model.can_read(doctype)) {\n\t\t\t\t\titems.push(doctype);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// only add this group, if there is at-least\n\t\t\t// one item with permission\n\t\t\tif (items.length) {\n\t\t\t\tgroup.items = items;\n\t\t\t\ttransactions.push(group);\n\t\t\t}\n\t\t});\n\t\tthis.data.transactions = transactions;\n\t}\n\n\trender_links() {\n\t\tlet me = this;\n\t\tthis.links_area.show();\n\t\tthis.links_area.body.find(\".btn-new\").addClass(\"hidden\");\n\t\tif (this.data_rendered) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.data.frm = this.frm;\n\n\t\tlet transactions_area_body = this.transactions_area;\n\n\t\t$(frappe.render_template(\"form_links\", this.data)).appendTo(transactions_area_body);\n\n\t\tthis.render_report_links();\n\n\t\t// bind links\n\t\ttransactions_area_body.find(\".badge-link\").on(\"click\", function () {\n\t\t\tme.open_document_list($(this).closest(\".document-link\"));\n\t\t});\n\n\t\t// bind open notifications\n\t\ttransactions_area_body.find(\".open-notification\").on(\"click\", function () {\n\t\t\tme.open_document_list($(this).parent(), true);\n\t\t});\n\n\t\t// bind new\n\t\ttransactions_area_body.find(\".btn-new\").on(\"click\", function () {\n\t\t\tme.frm.make_new($(this).attr(\"data-doctype\"));\n\t\t});\n\n\t\tthis.data_rendered = true;\n\t}\n\n\trender_report_links() {\n\t\tlet parent = this.transactions_area;\n\t\tif (this.data.reports && this.data.reports.length) {\n\t\t\t$(frappe.render_template(\"report_links\", this.data)).appendTo(parent);\n\t\t\t// bind reports\n\t\t\tparent.find(\".report-link\").on(\"click\", (e) => {\n\t\t\t\tthis.open_report($(e.target).parent());\n\t\t\t});\n\t\t}\n\t}\n\n\topen_report($link) {\n\t\tlet report = $link.attr(\"data-report\");\n\n\t\tlet fieldname = this.data.non_standard_fieldnames\n\t\t\t? this.data.non_standard_fieldnames[report] || this.data.fieldname\n\t\t\t: this.data.fieldname;\n\n\t\tfrappe.provide(\"frappe.route_options\");\n\t\tfrappe.route_options[fieldname] = this.frm.doc.name;\n\t\tfrappe.set_route(\"query-report\", report);\n\t}\n\n\topen_document_list($link, show_open) {\n\t\t// show document list with filters\n\t\tlet doctype = $link.attr(\"data-doctype\"),\n\t\t\tnames = $link.attr(\"data-names\") || [];\n\n\t\tif (\n\t\t\tthis.internal_links_found &&\n\t\t\tthis.internal_links_found.find((d) => d.doctype === doctype)\n\t\t) {\n\t\t\tif (names.length) {\n\t\t\t\tfrappe.route_options = { name: [\"in\", names] };\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if (this.data.fieldname) {\n\t\t\tfrappe.route_options = this.get_document_filter(doctype);\n\t\t\tif (show_open && frappe.ui.notifications) {\n\t\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t\t}\n\t\t}\n\n\t\tfrappe.set_route(\"List\", doctype, \"List\");\n\t}\n\n\tget_document_filter(doctype) {\n\t\t// return the default filter for the given document\n\t\t// like {\"customer\": frm.doc.name}\n\t\tlet filter = {};\n\t\tlet fieldname = this.data.non_standard_fieldnames\n\t\t\t? this.data.non_standard_fieldnames[doctype] || this.data.fieldname\n\t\t\t: this.data.fieldname;\n\n\t\tif (this.data.dynamic_links && this.data.dynamic_links[fieldname]) {\n\t\t\tlet dynamic_fieldname = this.data.dynamic_links[fieldname][1];\n\t\t\tfilter[dynamic_fieldname] = this.data.dynamic_links[fieldname][0];\n\t\t}\n\n\t\tfilter[fieldname] = this.frm.doc.name;\n\t\treturn filter;\n\t}\n\n\tset_open_count() {\n\t\tif (\n\t\t\t!this.data ||\n\t\t\t!this.data.transactions ||\n\t\t\t!this.data.fieldname ||\n\t\t\tthis.frm.is_new() ||\n\t\t\tthis._fetched_counts\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\t// list all items from the transaction list\n\t\tlet items = [],\n\t\t\tme = this;\n\n\t\tthis.data.transactions.forEach(function (group) {\n\t\t\tgroup.items.forEach(function (item) {\n\t\t\t\titems.push(item);\n\t\t\t});\n\t\t});\n\n\t\tlet method = this.data.method || \"frappe.desk.notifications.get_open_count\";\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\titems: items,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message.timeline_data) {\n\t\t\t\t\tme.update_heatmap(r.message.timeline_data);\n\t\t\t\t}\n\n\t\t\t\tme.update_badges(r.message.count);\n\n\t\t\t\tme.frm.dashboard_data = r.message;\n\t\t\t\tme._fetched_counts = true;\n\t\t\t\tme.frm.trigger(\"dashboard_update\");\n\t\t\t},\n\t\t});\n\t}\n\n\tupdate_badges(count) {\n\t\tlet me = this;\n\n\t\tthis.internal_links_found = count.internal_links_found;\n\n\t\t$.each(count.internal_links_found, function (i, d) {\n\t\t\tme.frm.dashboard.set_badge_count_for_internal_link(\n\t\t\t\td.doctype,\n\t\t\t\tcint(d.open_count),\n\t\t\t\tcint(d.count),\n\t\t\t\td.names\n\t\t\t);\n\t\t});\n\n\t\t$.each(count.external_links_found, function (i, d) {\n\t\t\tme.frm.dashboard.set_badge_count_for_external_link(\n\t\t\t\td.doctype,\n\t\t\t\tcint(d.open_count),\n\t\t\t\tcint(d.count)\n\t\t\t);\n\t\t});\n\t}\n\n\tset_badge_count_for_external_link(doctype, open_count, count) {\n\t\tlet $link = $(this.transactions_area).find(\n\t\t\t'.document-link[data-doctype=\"' + doctype + '\"]'\n\t\t);\n\n\t\tthis.set_badge_count_common(open_count, count, $link);\n\t}\n\n\tset_badge_count_for_internal_link(doctype, open_count, count, names) {\n\t\tlet $link = $(this.transactions_area).find(\n\t\t\t'.document-link[data-doctype=\"' + doctype + '\"]'\n\t\t);\n\n\t\tthis.set_badge_count_common(open_count, count, $link);\n\n\t\tif (names && names.length) {\n\t\t\t$link.attr(\"data-names\", names ? names.join(\",\") : \"\");\n\t\t} else {\n\t\t\t$link.find(\"a\").attr(\"disabled\", true);\n\t\t}\n\t}\n\n\tset_badge_count_common(open_count, count, $link) {\n\t\tif (open_count) {\n\t\t\t$link\n\t\t\t\t.find(\".open-notification\")\n\t\t\t\t.removeClass(\"hidden\")\n\t\t\t\t.html(open_count > 99 ? \"99+\" : open_count);\n\t\t}\n\n\t\tif (count) {\n\t\t\t$link\n\t\t\t\t.find(\".count\")\n\t\t\t\t.removeClass(\"hidden\")\n\t\t\t\t.text(count > 99 ? \"99+\" : count);\n\t\t}\n\t}\n\n\tupdate_heatmap(data) {\n\t\tif (this.heatmap) {\n\t\t\tthis.heatmap.update({ dataPoints: data });\n\t\t}\n\t}\n\n\t// heatmap\n\trender_heatmap() {\n\t\tthis.heatmap = new frappe.Chart(\"#heatmap-\" + frappe.model.scrub(this.frm.doctype), {\n\t\t\ttype: \"heatmap\",\n\t\t\tstart: new Date(moment().subtract(1, \"year\").toDate()),\n\t\t\tcount_label: \"interactions\",\n\t\t\tdiscreteDomains: 1,\n\t\t\tradius: 3,\n\t\t\tdata: {},\n\t\t});\n\n\t\t// center the heatmap\n\t\tthis.heatmap_area.show();\n\t\tthis.heatmap_area.body.find(\"svg\").css({ margin: \"auto\" });\n\n\t\t// message\n\t\tlet heatmap_message = this.heatmap_area.body.find(\".heatmap-message\");\n\t\tif (this.data.heatmap_message) {\n\t\t\theatmap_message.removeClass(\"hidden\").html(this.data.heatmap_message);\n\t\t} else {\n\t\t\theatmap_message.addClass(\"hidden\");\n\t\t}\n\t}\n\n\tadd_indicator(label, color) {\n\t\tthis.show();\n\t\tthis.stats_area.show();\n\n\t\t// set colspan\n\t\tlet indicators = this.stats_area_row.find(\".indicator-column\");\n\t\tlet n_indicators = indicators.length + 1;\n\t\tlet colspan;\n\t\tif (n_indicators > 4) {\n\t\t\tcolspan = 3;\n\t\t} else {\n\t\t\tcolspan = 12 / n_indicators;\n\t\t}\n\n\t\t// reset classes in existing indicators\n\t\tif (indicators.length) {\n\t\t\tindicators\n\t\t\t\t.removeClass()\n\t\t\t\t.addClass(\"col-sm-\" + colspan)\n\t\t\t\t.addClass(\"indicator-column\");\n\t\t}\n\n\t\treturn $(\n\t\t\t'<div class=\"col-sm-' +\n\t\t\t\tcolspan +\n\t\t\t\t' indicator-column\"><span class=\"indicator ' +\n\t\t\t\tcolor +\n\t\t\t\t'\">' +\n\t\t\t\tlabel +\n\t\t\t\t\"</span></div>\"\n\t\t).appendTo(this.stats_area_row);\n\t}\n\n\t// graphs\n\tsetup_graph() {\n\t\tlet me = this;\n\t\tlet method = this.data.graph_method;\n\t\tlet args = {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.doc.name,\n\t\t};\n\t\t$.extend(args, this.data.graph_method_args);\n\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: args,\n\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tme.render_graph(r.message);\n\t\t\t\t\tme.show();\n\t\t\t\t} else {\n\t\t\t\t\tme.hide();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\trender_graph(args) {\n\t\tthis.chart_area.show();\n\t\tthis.chart_area.body.empty();\n\t\t$.extend(args, {\n\t\t\ttype: args.type || \"line\",\n\t\t\tcolors: args.colors || [\"green\"],\n\t\t\ttruncateLegends: 1,\n\t\t\taxisOptions: {\n\t\t\t\tshortenYAxisNumbers: 1,\n\t\t\t\tnumberFormatter: frappe.utils.format_chart_axis_number,\n\t\t\t},\n\t\t});\n\t\tthis.show();\n\n\t\tthis.chart = new frappe.Chart(\".form-graph\", args);\n\t\tif (!this.chart) {\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tshow() {\n\t\tthis.toggle_visibility(true);\n\t}\n\n\thide() {\n\t\tthis.toggle_visibility(false);\n\t}\n\n\ttoggle_visibility(show) {\n\t\tthis.parent.toggleClass(\"visible-section\", show);\n\t\tthis.parent.toggleClass(\"empty-section\", !show);\n\t}\n\n\t// TODO: Review! code related to headline should be the part of layout/form\n\tset_headline(html, color) {\n\t\tthis.frm.layout.show_message(html, color);\n\t}\n\n\tclear_headline() {\n\t\tthis.frm.layout.show_message();\n\t}\n\n\tadd_comment(text, alert_class, permanent) {\n\t\tthis.set_headline_alert(text, alert_class);\n\t\tif (!permanent) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.clear_headline();\n\t\t\t}, 10000);\n\t\t}\n\t}\n\n\tclear_comment() {\n\t\tthis.clear_headline();\n\t}\n\n\tset_headline_alert(text, color) {\n\t\tif (text) {\n\t\t\tthis.set_headline(`<div>${text}</div>`, color);\n\t\t} else {\n\t\t\tthis.clear_headline();\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.States = class FormStates {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.frm.doctype);\n\n\t\t// no workflow?\n\t\tif (!this.state_fieldname) return;\n\n\t\tthis.update_fields = frappe.workflow.get_update_fields(this.frm.doctype);\n\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).bind(\"render_complete\", function () {\n\t\t\tme.refresh();\n\t\t});\n\t}\n\n\tsetup_help() {\n\t\tvar me = this;\n\t\tthis.frm.page.add_action_item(\n\t\t\t__(\"Help\"),\n\t\t\tfunction () {\n\t\t\t\tfrappe.workflow.setup(me.frm.doctype);\n\t\t\t\tvar state = me.get_state();\n\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: \"Workflow: \" + frappe.workflow.workflows[me.frm.doctype].name,\n\t\t\t\t});\n\n\t\t\t\tfrappe.workflow.get_transitions(me.frm.doc).then((transitions) => {\n\t\t\t\t\tconst next_actions =\n\t\t\t\t\t\t$.map(\n\t\t\t\t\t\t\ttransitions,\n\t\t\t\t\t\t\t(d) => `${d.action.bold()} ${__(\"by Role\")} ${d.allowed}`\n\t\t\t\t\t\t).join(\", \") || __(\"None: End of Workflow\").bold();\n\n\t\t\t\t\tconst document_editable_by = frappe.workflow\n\t\t\t\t\t\t.get_document_state_roles(me.frm.doctype, state)\n\t\t\t\t\t\t.map((role) => role.bold())\n\t\t\t\t\t\t.join(\", \");\n\n\t\t\t\t\t$(d.body)\n\t\t\t\t\t\t.html(\n\t\t\t\t\t\t\t`\n\t\t\t\t\t<p>${__(\"Current status\")}: ${state.bold()}</p>\n\t\t\t\t\t<p>${__(\"Document is only editable by users with role\")}: ${document_editable_by}</p>\n\t\t\t\t\t<p>${__(\"Next actions\")}: ${next_actions}</p>\n\t\t\t\t\t<p>${__(\"{0}: Other permission rules may also apply\", [__(\"Note\").bold()])}</p>\n\t\t\t\t`\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.css({ padding: \"15px\" });\n\n\t\t\t\t\td.show();\n\t\t\t\t});\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t}\n\n\trefresh() {\n\t\t// hide if its not yet saved\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.set_default_state();\n\t\t\treturn;\n\t\t}\n\n\t\t// state text\n\t\tconst state = this.get_state();\n\n\t\tif (state) {\n\t\t\t// show actions from that state\n\t\t\tthis.show_actions(state);\n\t\t}\n\t}\n\n\tshow_actions() {\n\t\tvar added = false;\n\t\tvar me = this;\n\n\t\t// if the loaded doc is dirty, don't show workflow buttons\n\t\tif (this.frm.doc.__unsaved === 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction has_approval_access(transition) {\n\t\t\tlet approval_access = false;\n\t\t\tconst user = frappe.session.user;\n\t\t\tif (\n\t\t\t\tuser === \"Administrator\" ||\n\t\t\t\ttransition.allow_self_approval ||\n\t\t\t\tuser !== me.frm.doc.owner\n\t\t\t) {\n\t\t\t\tapproval_access = true;\n\t\t\t}\n\t\t\treturn approval_access;\n\t\t}\n\n\t\tfrappe.workflow.get_transitions(this.frm.doc).then((transitions) => {\n\t\t\tthis.frm.page.clear_actions_menu();\n\t\t\ttransitions.forEach((d) => {\n\t\t\t\tif (frappe.user_roles.includes(d.allowed) && has_approval_access(d)) {\n\t\t\t\t\tadded = true;\n\t\t\t\t\tme.frm.page.add_action_item(__(d.action), function () {\n\t\t\t\t\t\t// set the workflow_action for use in form scripts\n\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\tme.frm.selected_workflow_action = d.action;\n\t\t\t\t\t\tme.frm.script_manager.trigger(\"before_workflow_action\").then(() => {\n\t\t\t\t\t\t\tfrappe\n\t\t\t\t\t\t\t\t.xcall(\"frappe.model.workflow.apply_workflow\", {\n\t\t\t\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\t\t\t\taction: d.action,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then((doc) => {\n\t\t\t\t\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\t\t\t\t\tme.frm.refresh();\n\t\t\t\t\t\t\t\t\tme.frm.selected_workflow_action = null;\n\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger(\"after_workflow_action\");\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.setup_btn(added);\n\t\t});\n\t}\n\n\tsetup_btn(action_added) {\n\t\tif (action_added) {\n\t\t\tthis.frm.page.btn_primary.addClass(\"hide\");\n\t\t\tthis.frm.page.btn_secondary.addClass(\"hide\");\n\t\t\tthis.frm.toolbar.current_status = \"\";\n\t\t\tthis.setup_help();\n\t\t}\n\t}\n\n\tset_default_state() {\n\t\tvar default_state = frappe.workflow.get_default_state(\n\t\t\tthis.frm.doctype,\n\t\t\tthis.frm.doc.docstatus\n\t\t);\n\t\tif (default_state) {\n\t\t\tthis.frm.set_value(this.state_fieldname, default_state);\n\t\t}\n\t}\n\n\tget_state() {\n\t\tif (!this.frm.doc[this.state_fieldname]) {\n\t\t\tthis.set_default_state();\n\t\t}\n\t\treturn this.frm.doc[this.state_fieldname];\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.save = function (frm, action, callback, btn) {\n\t$(btn).prop(\"disabled\", true);\n\n\t// specified here because there are keyboard shortcuts to save\n\tconst working_label = {\n\t\tSave: __(\"Saving\", null, \"Freeze message while saving a document\"),\n\t\tSubmit: __(\"Submitting\", null, \"Freeze message while submitting a document\"),\n\t\tUpdate: __(\"Updating\", null, \"Freeze message while updating a document\"),\n\t\tAmend: __(\"Amending\", null, \"Freeze message while amending a document\"),\n\t\tCancel: __(\"Cancelling\", null, \"Freeze message while cancelling a document\"),\n\t}[toTitle(action)];\n\n\tvar freeze_message = working_label ? __(working_label) : \"\";\n\n\tvar save = function () {\n\t\tremove_empty_rows();\n\n\t\t$(frm.wrapper).addClass(\"validated-form\");\n\t\tif ((action !== \"Save\" || frm.is_dirty()) && check_mandatory()) {\n\t\t\t_call({\n\t\t\t\tmethod: \"frappe.desk.form.save.savedocs\",\n\t\t\t\targs: { doc: frm.doc, action: action },\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\terror: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\tbtn: btn,\n\t\t\t\tfreeze_message: freeze_message,\n\t\t\t});\n\t\t} else {\n\t\t\t!frm.is_dirty() &&\n\t\t\t\tfrappe.show_alert({ message: __(\"No changes in document\"), indicator: \"orange\" });\n\t\t\t$(btn).prop(\"disabled\", false);\n\t\t}\n\t};\n\n\tvar remove_empty_rows = function () {\n\t\t/*\n\t\t\tThis function removes empty rows. Note that in this function, a row is considered\n\t\t\tempty if the fields with `in_list_view: 1` are undefined or falsy because that's\n\t\t\twhat users also consider to be an empty row\n\t\t*/\n\t\tconst docs = frappe.model.get_all_docs(frm.doc);\n\n\t\t// we should only worry about table data\n\t\tconst tables = docs.filter((d) => {\n\t\t\treturn frappe.model.is_table(d.doctype);\n\t\t});\n\n\t\tlet modified_table_fields = [];\n\n\t\ttables.map((doc) => {\n\t\t\tconst cells = frappe.meta.docfield_list[doc.doctype] || [];\n\n\t\t\tconst in_list_view_cells = cells.filter((df) => {\n\t\t\t\treturn cint(df.in_list_view) === 1;\n\t\t\t});\n\n\t\t\tconst is_empty_row = function (cells) {\n\t\t\t\tfor (let i = 0; i < cells.length; i++) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tlocals[doc.doctype][doc.name] &&\n\t\t\t\t\t\tlocals[doc.doctype][doc.name][cells[i].fieldname]\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\tif (is_empty_row(in_list_view_cells)) {\n\t\t\t\tfrappe.model.clear_doc(doc.doctype, doc.name);\n\t\t\t\tmodified_table_fields.push(doc.parentfield);\n\t\t\t}\n\t\t});\n\n\t\tmodified_table_fields.forEach((field) => {\n\t\t\tfrm.refresh_field(field);\n\t\t});\n\t};\n\n\tvar cancel = function () {\n\t\tvar args = {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tname: frm.doc.name,\n\t\t};\n\n\t\t// update workflow state value if workflow exists\n\t\tvar workflow_state_fieldname = frappe.workflow.get_state_fieldname(frm.doctype);\n\t\tif (workflow_state_fieldname) {\n\t\t\t$.extend(args, {\n\t\t\t\tworkflow_state_fieldname: workflow_state_fieldname,\n\t\t\t\tworkflow_state: frm.doc[workflow_state_fieldname],\n\t\t\t});\n\t\t}\n\n\t\t_call({\n\t\t\tmethod: \"frappe.desk.form.save.cancel\",\n\t\t\targs: args,\n\t\t\tcallback: function (r) {\n\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\tcallback(r);\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tfreeze_message: freeze_message,\n\t\t});\n\t};\n\n\tvar check_mandatory = function () {\n\t\tvar has_errors = false;\n\t\tfrm.scroll_set = false;\n\n\t\tif (frm.doc.docstatus == 2) return true; // don't check for cancel\n\n\t\t$.each(frappe.model.get_all_docs(frm.doc), function (i, doc) {\n\t\t\tvar error_fields = [];\n\t\t\tvar folded = false;\n\n\t\t\t$.each(frappe.meta.docfield_list[doc.doctype] || [], function (i, docfield) {\n\t\t\t\tif (docfield.fieldname) {\n\t\t\t\t\tconst df = frappe.meta.get_docfield(doc.doctype, docfield.fieldname, doc.name);\n\n\t\t\t\t\tif (df.fieldtype === \"Fold\") {\n\t\t\t\t\t\tfolded = frm.layout.folded;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tis_docfield_mandatory(doc, df) &&\n\t\t\t\t\t\t!frappe.model.has_value(doc.doctype, doc.name, df.fieldname)\n\t\t\t\t\t) {\n\t\t\t\t\t\thas_errors = true;\n\t\t\t\t\t\terror_fields[error_fields.length] = __(df.label);\n\t\t\t\t\t\t// scroll to field\n\t\t\t\t\t\tif (!frm.scroll_set) {\n\t\t\t\t\t\t\tscroll_to(doc.parentfield || df.fieldname);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (folded) {\n\t\t\t\t\t\t\tfrm.layout.unfold();\n\t\t\t\t\t\t\tfolded = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (frm.is_new() && frm.meta.autoname === \"Prompt\" && !frm.doc.__newname) {\n\t\t\t\thas_errors = true;\n\t\t\t\terror_fields = [__(\"Name\"), ...error_fields];\n\t\t\t}\n\n\t\t\tif (error_fields.length) {\n\t\t\t\tlet meta = frappe.get_meta(doc.doctype);\n\t\t\t\tlet message;\n\t\t\t\tif (meta.istable) {\n\t\t\t\t\tconst table_field = frappe.meta.docfield_map[doc.parenttype][doc.parentfield];\n\n\t\t\t\t\tconst table_label = __(\n\t\t\t\t\t\ttable_field.label || frappe.unscrub(table_field.fieldname)\n\t\t\t\t\t).bold();\n\n\t\t\t\t\tmessage = __(\"Mandatory fields required in table {0}, Row {1}\", [\n\t\t\t\t\t\ttable_label,\n\t\t\t\t\t\tdoc.idx,\n\t\t\t\t\t]);\n\t\t\t\t} else {\n\t\t\t\t\tmessage = __(\"Mandatory fields required in {0}\", [__(doc.doctype)]);\n\t\t\t\t}\n\t\t\t\tmessage = message + \"<br><br><ul><li>\" + error_fields.join(\"</li><li>\") + \"</ul>\";\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\ttitle: __(\"Missing Fields\"),\n\t\t\t\t});\n\t\t\t\tfrm.refresh();\n\t\t\t}\n\t\t});\n\n\t\treturn !has_errors;\n\t};\n\n\tlet is_docfield_mandatory = function (doc, df) {\n\t\tif (df.reqd) return true;\n\t\tif (!df.mandatory_depends_on || !doc) return;\n\n\t\tlet out = null;\n\t\tlet expression = df.mandatory_depends_on;\n\t\tlet parent = frappe.get_meta(df.parent);\n\n\t\tif (typeof expression === \"boolean\") {\n\t\t\tout = expression;\n\t\t} else if (typeof expression === \"function\") {\n\t\t\tout = expression(doc);\n\t\t} else if (expression.substr(0, 5) == \"eval:\") {\n\t\t\ttry {\n\t\t\t\tout = frappe.utils.eval(expression.substr(5), { doc, parent });\n\t\t\t\tif (parent && parent.istable && expression.includes(\"is_submittable\")) {\n\t\t\t\t\tout = true;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tfrappe.throw(__('Invalid \"mandatory_depends_on\" expression'));\n\t\t\t}\n\t\t} else {\n\t\t\tvar value = doc[expression];\n\t\t\tif ($.isArray(value)) {\n\t\t\t\tout = !!value.length;\n\t\t\t} else {\n\t\t\t\tout = !!value;\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t};\n\n\tconst scroll_to = (fieldname) => {\n\t\tfrm.scroll_to_field(fieldname);\n\t\tfrm.scroll_set = true;\n\t};\n\n\tvar _call = function (opts) {\n\t\t// opts = {\n\t\t// \tmethod: \"some server method\",\n\t\t// \targs: {args to be passed},\n\t\t// \tcallback: callback,\n\t\t// \tbtn: btn\n\t\t// }\n\n\t\tif (frappe.ui.form.is_saving) {\n\t\t\t// this is likely to happen if the user presses the shortcut cmd+s for a longer duration or uses double click\n\t\t\t// no need to show this to user, as they can see \"Saving\" in freeze message\n\t\t\tconsole.log(\"Already saving. Please wait a few moments.\");\n\t\t\tthrow \"saving\";\n\t\t}\n\n\t\t// ensure we remove new docs routes ONLY\n\t\tif (frm.is_new()) {\n\t\t\tfrappe.ui.form.remove_old_form_route();\n\t\t}\n\t\tfrappe.ui.form.is_saving = true;\n\n\t\treturn frappe.call({\n\t\t\tfreeze: true,\n\t\t\t// freeze_message: opts.freeze_message,\n\t\t\tmethod: opts.method,\n\t\t\targs: opts.args,\n\t\t\tbtn: opts.btn,\n\t\t\tcallback: function (r) {\n\t\t\t\topts.callback && opts.callback(r);\n\t\t\t},\n\t\t\terror: opts.error,\n\t\t\talways: function (r) {\n\t\t\t\t$(btn).prop(\"disabled\", false);\n\t\t\t\tfrappe.ui.form.is_saving = false;\n\n\t\t\t\tif (r) {\n\t\t\t\t\tvar doc = r.docs && r.docs[0];\n\t\t\t\t\tif (doc) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t};\n\n\tif (action === \"cancel\") {\n\t\tcancel();\n\t} else {\n\t\tsave();\n\t}\n};\n\nfrappe.ui.form.remove_old_form_route = () => {\n\tlet current_route = frappe.get_route().join(\"/\");\n\tfrappe.route_history = frappe.route_history.filter(\n\t\t(route) => route.join(\"/\") !== current_route\n\t);\n};\n\nfrappe.ui.form.update_calling_link = (newdoc) => {\n\tif (!frappe._from_link) return;\n\tvar doc = frappe.get_doc(frappe._from_link.doctype, frappe._from_link.docname);\n\n\tlet is_valid_doctype = () => {\n\t\tif (frappe._from_link.df.fieldtype === \"Link\") {\n\t\t\treturn newdoc.doctype === frappe._from_link.df.options;\n\t\t} else {\n\t\t\t// dynamic link, type is dynamic\n\t\t\treturn newdoc.doctype === doc[frappe._from_link.df.options];\n\t\t}\n\t};\n\n\tif (is_valid_doctype()) {\n\t\tfrappe.model.with_doctype(newdoc.doctype, () => {\n\t\t\tlet meta = frappe.get_meta(newdoc.doctype);\n\t\t\t// set value\n\t\t\tif (doc && doc.parentfield) {\n\t\t\t\t//update values for child table\n\t\t\t\t$.each(\n\t\t\t\t\tfrappe._from_link.frm.fields_dict[doc.parentfield].grid.grid_rows,\n\t\t\t\t\tfunction (index, field) {\n\t\t\t\t\t\tif (field.doc && field.doc.name === frappe._from_link.docname) {\n\t\t\t\t\t\t\tif (meta.title_field && meta.show_title_field_in_link) {\n\t\t\t\t\t\t\t\tfrappe.utils.add_link_title(\n\t\t\t\t\t\t\t\t\tnewdoc.doctype,\n\t\t\t\t\t\t\t\t\tnewdoc.name,\n\t\t\t\t\t\t\t\t\tnewdoc[meta.title_field]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tif (meta.title_field && meta.show_title_field_in_link) {\n\t\t\t\t\tfrappe.utils.add_link_title(\n\t\t\t\t\t\tnewdoc.doctype,\n\t\t\t\t\t\tnewdoc.name,\n\t\t\t\t\t\tnewdoc[meta.title_field]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t}\n\n\t\t\t// refresh field\n\t\t\tfrappe._from_link.refresh();\n\n\t\t\t// if from form, switch\n\t\t\tif (frappe._from_link.frm) {\n\t\t\t\tfrappe\n\t\t\t\t\t.set_route(\n\t\t\t\t\t\t\"Form\",\n\t\t\t\t\t\tfrappe._from_link.frm.doctype,\n\t\t\t\t\t\tfrappe._from_link.frm.docname\n\t\t\t\t\t)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tfrappe.utils.scroll_to(frappe._from_link_scrollY);\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tfrappe._from_link = null;\n\t\t});\n\t}\n};\n", "frappe.ui.get_print_settings = function (pdf, callback, letter_head, pick_columns) {\n\tvar print_settings = locals[\":Print Settings\"][\"Print Settings\"];\n\n\tvar default_letter_head =\n\t\tlocals[\":Company\"] && frappe.defaults.get_default(\"company\")\n\t\t\t? locals[\":Company\"][frappe.defaults.get_default(\"company\")][\"default_letter_head\"]\n\t\t\t: \"\";\n\n\tvar columns = [\n\t\t{\n\t\t\tfieldtype: \"Check\",\n\t\t\tfieldname: \"with_letter_head\",\n\t\t\tlabel: __(\"With Letter head\"),\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Select\",\n\t\t\tfieldname: \"letter_head\",\n\t\t\tlabel: __(\"Letter Head\"),\n\t\t\tdepends_on: \"with_letter_head\",\n\t\t\toptions: Object.keys(frappe.boot.letter_heads),\n\t\t\tdefault: letter_head || default_letter_head,\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Select\",\n\t\t\tfieldname: \"orientation\",\n\t\t\tlabel: __(\"Orientation\"),\n\t\t\toptions: [\n\t\t\t\t{ value: \"Landscape\", label: __(\"Landscape\") },\n\t\t\t\t{ value: \"Portrait\", label: __(\"Portrait\") },\n\t\t\t],\n\t\t\tdefault: \"Landscape\",\n\t\t},\n\t];\n\n\tif (pick_columns) {\n\t\tcolumns.push(\n\t\t\t{\n\t\t\t\tlabel: __(\"Pick Columns\"),\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tfieldname: \"pick_columns\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Select Columns\"),\n\t\t\t\tfieldtype: \"MultiCheck\",\n\t\t\t\tfieldname: \"columns\",\n\t\t\t\tdepends_on: \"pick_columns\",\n\t\t\t\tcolumns: 2,\n\t\t\t\tselect_all: true,\n\t\t\t\toptions: pick_columns.map((df) => ({\n\t\t\t\t\tlabel: __(df.label),\n\t\t\t\t\tvalue: df.fieldname,\n\t\t\t\t})),\n\t\t\t}\n\t\t);\n\t}\n\n\treturn frappe.prompt(\n\t\tcolumns,\n\t\tfunction (data) {\n\t\t\tdata = $.extend(print_settings, data);\n\t\t\tif (!data.with_letter_head) {\n\t\t\t\tdata.letter_head = null;\n\t\t\t}\n\t\t\tif (data.letter_head) {\n\t\t\t\tdata.letter_head = frappe.boot.letter_heads[print_settings.letter_head];\n\t\t\t}\n\t\t\tcallback(data);\n\t\t},\n\t\t__(\"Print Settings\")\n\t);\n};\n\n// qz tray connection wrapper\n//  - allows active and inactive connections to resolve regardless\n//  - try to connect once before firing the mimetype launcher\n//  - if connection fails, catch the reject, fire the mimetype launcher\n//  - after mimetype launcher is fired, try to connect 3 more times\n//  - display success/fail message to user\nfrappe.ui.form.qz_connect = function () {\n\treturn new Promise(function (resolve, reject) {\n\t\tfrappe.ui.form.qz_init().then(() => {\n\t\t\tif (qz.websocket.isActive()) {\n\t\t\t\t// if already active, resolve immediately\n\t\t\t\t// frappe.show_alert({message: __('QZ Tray Connection Active!'), indicator: 'green'});\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\t// try to connect once before firing the mimetype launcher\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Attempting Connection to QZ Tray...\"),\n\t\t\t\t\tindicator: \"blue\",\n\t\t\t\t});\n\t\t\t\tqz.websocket.connect().then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Connected to QZ Tray!\"),\n\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\tfunction retry(err) {\n\t\t\t\t\t\tif (err.message === \"Unable to establish connection with QZ\") {\n\t\t\t\t\t\t\t// if a connect was not successful, launch the mimetype, try 3 more times\n\t\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmessage: __(\"Attempting to launch QZ Tray...\"),\n\t\t\t\t\t\t\t\t\tindicator: \"blue\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t14\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\twindow.location.assign(\"qz:launch\");\n\t\t\t\t\t\t\tqz.websocket\n\t\t\t\t\t\t\t\t.connect({\n\t\t\t\t\t\t\t\t\tretries: 3,\n\t\t\t\t\t\t\t\t\tdelay: 1,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\t\tmessage: __(\"Connected to QZ Tray!\"),\n\t\t\t\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\t\t\t'Error connecting to QZ Tray Application...<br><br> You need to have QZ Tray application installed and running, to use the Raw Print feature.<br><br><a target=\"_blank\" href=\"https://qz.io/download/\">Click here to Download and install QZ Tray</a>.<br> <a target=\"_blank\" href=\"https://erpnext.com/docs/user/manual/en/setting-up/print/raw-printing\">Click here to learn more about Raw Printing</a>.'\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmessage: \"QZ Tray \" + err.toString(),\n\t\t\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t14\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t});\n};\n\nfrappe.ui.form.qz_init = function () {\n\t// Initializing qz tray library\n\treturn new Promise((resolve) => {\n\t\tif (typeof qz === \"object\" && typeof qz.version === \"string\") {\n\t\t\t// resolve immediately if already Initialized\n\t\t\tresolve();\n\t\t} else {\n\t\t\tlet qz_required_assets = [\n\t\t\t\t\"/assets/frappe/node_modules/js-sha256/build/sha256.min.js\",\n\t\t\t\t\"/assets/frappe/node_modules/qz-tray/qz-tray.js\",\n\t\t\t];\n\t\t\tfrappe.require(qz_required_assets, () => {\n\t\t\t\tqz.api.setPromiseType(function promise(resolver) {\n\t\t\t\t\treturn new Promise(resolver);\n\t\t\t\t});\n\t\t\t\tqz.api.setSha256Type(function (data) {\n\t\t\t\t\t// Codacy fix\n\t\t\t\t\t/*global sha256*/\n\t\t\t\t\treturn sha256(data);\n\t\t\t\t});\n\t\t\t\tresolve();\n\t\t\t});\n\t\t\t// note 'frappe.require' does not have callback on fail. Hence, any failure cannot be communicated to the user.\n\t\t}\n\t});\n};\n\nfrappe.ui.form.qz_get_printer_list = function () {\n\t// returns the list of printers that are available to the QZ Tray\n\treturn frappe.ui.form\n\t\t.qz_connect()\n\t\t.then(function () {\n\t\t\treturn qz.printers.find();\n\t\t})\n\t\t.then((data) => {\n\t\t\treturn data;\n\t\t})\n\t\t.catch((err) => {\n\t\t\tfrappe.ui.form.qz_fail(err);\n\t\t});\n};\n\nfrappe.ui.form.qz_success = function () {\n\t// notify qz successful print\n\tfrappe.show_alert({\n\t\tmessage: __(\"Print Sent to the printer!\"),\n\t\tindicator: \"green\",\n\t});\n};\n\nfrappe.ui.form.qz_fail = function (e) {\n\t// notify qz errors\n\tfrappe.show_alert(\n\t\t{\n\t\t\tmessage: __(\"QZ Tray Failed: \") + e.toString(),\n\t\t\tindicator: \"red\",\n\t\t},\n\t\t20\n\t);\n};\n", "frappe.provide(\"frappe.ui.form\");\nfrappe.provide(\"frappe.success_action\");\n\nfrappe.ui.form.SuccessAction = class SuccessAction {\n\tconstructor(form) {\n\t\tthis.form = form;\n\t\tthis.load_setting();\n\t}\n\n\tload_setting() {\n\t\tthis.setting = frappe.boot.success_action.find(\n\t\t\t(setting) => setting.ref_doctype === this.form.doctype\n\t\t);\n\t}\n\n\tshow() {\n\t\tif (!this.setting) return;\n\t\tif (this.form.doc.docstatus === 0 && !this.is_first_creation()) return;\n\n\t\tthis.prepare_dom();\n\t\tthis.show_alert();\n\t}\n\n\tprepare_dom() {\n\t\tthis.container = $(document.body).find(\".success-container\");\n\t\tif (!this.container.length) {\n\t\t\tthis.container = $('<div class=\"success-container\">').appendTo(document.body);\n\t\t}\n\t}\n\n\tshow_alert() {\n\t\tfrappe.db.get_list(this.form.doctype, { limit: 2 }).then((result) => {\n\t\t\tconst count = result.length;\n\t\t\tconst setting = this.setting;\n\t\t\tlet message = count === 1 ? setting.first_success_message : setting.message;\n\n\t\t\tconst $buttons = this.get_actions().map((action) => {\n\t\t\t\tconst $btn = $(\n\t\t\t\t\t`<button class=\"next-action\"><span>${__(action.label)}</span></button>`\n\t\t\t\t);\n\t\t\t\t$btn.click(() => action.action(this.form));\n\t\t\t\treturn $btn;\n\t\t\t});\n\n\t\t\tconst next_action_container = $(`<div class=\"next-action-container\"></div>`);\n\t\t\tnext_action_container.append($buttons);\n\t\t\tconst html = next_action_container;\n\n\t\t\tfrappe.show_alert(\n\t\t\t\t{\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tbody: html,\n\t\t\t\t\tindicator: \"green\",\n\t\t\t\t},\n\t\t\t\tsetting.action_timeout || 7\n\t\t\t);\n\t\t});\n\t}\n\n\tget_actions() {\n\t\tconst actions = [];\n\t\tconst checked_actions = this.setting.next_actions.split(\"\\n\");\n\t\tchecked_actions.forEach((action) => {\n\t\t\tif (typeof action === \"string\" && this.default_actions[action]) {\n\t\t\t\tactions.push(this.default_actions[action]);\n\t\t\t} else if (typeof action === \"object\") {\n\t\t\t\tactions.push(action);\n\t\t\t}\n\t\t});\n\n\t\treturn actions;\n\t}\n\n\tget default_actions() {\n\t\treturn {\n\t\t\tnew: {\n\t\t\t\tlabel: __(\"New\"),\n\t\t\t\taction: (frm) => frappe.new_doc(frm.doctype),\n\t\t\t},\n\t\t\tprint: {\n\t\t\t\tlabel: __(\"Print\"),\n\t\t\t\taction: (frm) => frm.print_doc(),\n\t\t\t},\n\t\t\temail: {\n\t\t\t\tlabel: __(\"Email\"),\n\t\t\t\taction: (frm) => frm.email_doc(),\n\t\t\t},\n\t\t\tlist: {\n\t\t\t\tlabel: __(\"View All\"),\n\t\t\t\taction: (frm) => {\n\t\t\t\t\tfrappe.set_route(\"List\", frm.doctype);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tis_first_creation() {\n\t\tlet { modified, creation } = this.form.doc;\n\n\t\t// strip out milliseconds\n\t\tmodified = modified.split(\".\")[0];\n\t\tcreation = creation.split(\".\")[0];\n\n\t\treturn modified === creation;\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form.handlers\");\n\nwindow.extend_cscript = (cscript, controller_object) => {\n\t$.extend(cscript, controller_object);\n\tif (cscript && controller_object) {\n\t\tcscript.__proto__ = controller_object.__proto__;\n\t}\n\treturn cscript;\n};\n\nfrappe.ui.form.get_event_handler_list = function (doctype, fieldname) {\n\tif (!frappe.ui.form.handlers[doctype]) {\n\t\tfrappe.ui.form.handlers[doctype] = {};\n\t}\n\tif (!frappe.ui.form.handlers[doctype][fieldname]) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\treturn frappe.ui.form.handlers[doctype][fieldname];\n};\n\nfrappe.ui.form.on = frappe.ui.form.on_change = function (doctype, fieldname, handler) {\n\tvar add_handler = function (fieldname, handler) {\n\t\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\n\t\tlet _handler = (...args) => {\n\t\t\ttry {\n\t\t\t\treturn handler(...args);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(handler);\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t};\n\n\t\thandler_list.push(_handler);\n\n\t\t// add last handler to events so it can be called as\n\t\t// frm.events.handler(frm)\n\t\tif (cur_frm && cur_frm.doctype === doctype) {\n\t\t\tcur_frm.events[fieldname] = _handler;\n\t\t}\n\t};\n\n\tif (!handler && $.isPlainObject(fieldname)) {\n\t\t// a dict of handlers {fieldname: handler, ...}\n\t\tfor (var key in fieldname) {\n\t\t\tvar fn = fieldname[key];\n\t\t\tif (typeof fn === \"function\") {\n\t\t\t\tadd_handler(key, fn);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tadd_handler(fieldname, handler);\n\t}\n};\n\n// remove standard event handlers\nfrappe.ui.form.off = function (doctype, fieldname, handler) {\n\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\tif (handler_list.length) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\n\tif (cur_frm && cur_frm.doctype === doctype && cur_frm.events[fieldname]) {\n\t\tdelete cur_frm.events[fieldname];\n\t}\n\n\tif (cur_frm && cur_frm.cscript && cur_frm.cscript[fieldname]) {\n\t\tdelete cur_frm.cscript[fieldname];\n\t}\n};\n\nfrappe.ui.form.trigger = function (doctype, fieldname) {\n\tcur_frm.script_manager.trigger(fieldname, doctype);\n};\n\nfrappe.ui.form.ScriptManager = class ScriptManager {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\tmake(ControllerClass) {\n\t\tthis.frm.cscript = extend_cscript(\n\t\t\tthis.frm.cscript,\n\t\t\tnew ControllerClass({ frm: this.frm })\n\t\t);\n\t}\n\ttrigger(event_name, doctype, name) {\n\t\t// trigger all the form level events that\n\t\t// are bound to this event_name\n\t\tlet me = this;\n\t\tdoctype = doctype || this.frm.doctype;\n\t\tname = name || this.frm.docname;\n\n\t\tlet tasks = [];\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\n\t\t// helper for child table\n\t\tthis.frm.selected_doc = frappe.get_doc(doctype, name);\n\n\t\tlet runner = (_function, is_old_style) => {\n\t\t\tlet _promise = null;\n\t\t\tif (is_old_style) {\n\t\t\t\t// old style arguments (doc, cdt, cdn)\n\t\t\t\t_promise = me.frm.cscript[_function](me.frm.doc, doctype, name);\n\t\t\t} else {\n\t\t\t\t// new style (frm, doctype, name)\n\t\t\t\t_promise = _function(me.frm, doctype, name);\n\t\t\t}\n\n\t\t\t// if the trigger returns a promise, return it,\n\t\t\t// or use the default promise frappe.after_ajax\n\t\t\tif (_promise && _promise.then) {\n\t\t\t\treturn _promise;\n\t\t\t} else {\n\t\t\t\treturn frappe.after_server_call();\n\t\t\t}\n\t\t};\n\n\t\t// make list of functions to be run serially\n\t\thandlers.new_style.forEach((_function) => {\n\t\t\tif (event_name === \"setup\") {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, false);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, false));\n\t\t\t}\n\t\t});\n\n\t\thandlers.old_style.forEach((_function) => {\n\t\t\tif (event_name === \"setup\") {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, true);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, true));\n\t\t\t}\n\t\t});\n\n\t\t// run them serially\n\t\treturn frappe.run_serially(tasks);\n\t}\n\thas_handlers(event_name, doctype) {\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\t\treturn handlers && (handlers.old_style.length || handlers.new_style.length);\n\t}\n\tget_handlers(event_name, doctype) {\n\t\t// returns list of all functions to be called (old style and new style)\n\t\tlet me = this;\n\t\tlet handlers = {\n\t\t\told_style: [],\n\t\t\tnew_style: [],\n\t\t};\n\t\tif (frappe.ui.form.handlers[doctype] && frappe.ui.form.handlers[doctype][event_name]) {\n\t\t\t$.each(frappe.ui.form.handlers[doctype][event_name], function (i, fn) {\n\t\t\t\thandlers.new_style.push(fn);\n\t\t\t});\n\t\t}\n\t\tif (this.frm.cscript[event_name]) {\n\t\t\thandlers.old_style.push(event_name);\n\t\t}\n\t\tif (this.frm.cscript[\"custom_\" + event_name]) {\n\t\t\thandlers.old_style.push(\"custom_\" + event_name);\n\t\t}\n\t\treturn handlers;\n\t}\n\tsetup() {\n\t\tconst doctype = this.frm.meta;\n\t\tconst me = this;\n\t\tlet client_script = doctype.__js;\n\n\t\t// append the custom script for this form's layout\n\t\tif (this.frm.doctype_layout?.client_script) {\n\t\t\t// add a newline to avoid conflict with doctype JS\n\t\t\tclient_script += `\\n${this.frm.doctype_layout.client_script}`;\n\t\t}\n\n\t\tif (client_script) {\n\t\t\tnew Function(client_script)();\n\t\t}\n\n\t\tif (!this.frm.doctype_layout && doctype.__custom_js) {\n\t\t\ttry {\n\t\t\t\tnew Function(doctype.__custom_js)();\n\t\t\t} catch (e) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __(\"Error in Client Script\"),\n\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t\tmessage: '<pre class=\"small\"><code>' + e.stack + \"</code></pre>\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setup_add_fetch(df) {\n\t\t\tlet is_read_only_field =\n\t\t\t\t[\n\t\t\t\t\t\"Data\",\n\t\t\t\t\t\"Read Only\",\n\t\t\t\t\t\"Text\",\n\t\t\t\t\t\"Small Text\",\n\t\t\t\t\t\"Currency\",\n\t\t\t\t\t\"Check\",\n\t\t\t\t\t\"Text Editor\",\n\t\t\t\t\t\"Attach Image\",\n\t\t\t\t\t\"Code\",\n\t\t\t\t\t\"Link\",\n\t\t\t\t\t\"Float\",\n\t\t\t\t\t\"Int\",\n\t\t\t\t\t\"Date\",\n\t\t\t\t\t\"Select\",\n\t\t\t\t\t\"Duration\",\n\t\t\t\t].includes(df.fieldtype) ||\n\t\t\t\tdf.read_only == 1 ||\n\t\t\t\tdf.is_virtual == 1;\n\n\t\t\tif (is_read_only_field && df.fetch_from && df.fetch_from.indexOf(\".\") != -1) {\n\t\t\t\tvar parts = df.fetch_from.split(\".\");\n\t\t\t\tme.frm.add_fetch(parts[0], parts[1], df.fieldname, df.parent);\n\t\t\t}\n\t\t}\n\n\t\t// setup add fetch\n\t\t$.each(this.frm.fields, function (i, field) {\n\t\t\tsetup_add_fetch(field.df);\n\t\t\tif (frappe.model.table_fields.includes(field.df.fieldtype)) {\n\t\t\t\t$.each(\n\t\t\t\t\tfrappe.meta.get_docfields(field.df.options, me.frm.docname),\n\t\t\t\t\tfunction (i, df) {\n\t\t\t\t\t\tsetup_add_fetch(df);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\t// css\n\t\tdoctype.__css && frappe.dom.set_style(doctype.__css);\n\n\t\tthis.trigger(\"setup\");\n\t}\n\tlog_error(caller, e) {\n\t\tfrappe.show_alert({ message: __(\"Error in Client Script.\"), indicator: \"error\" });\n\t\tconsole.group && console.group();\n\t\tconsole.log(\"----- error in client script -----\");\n\t\tconsole.log(\"method: \" + caller);\n\t\tconsole.log(e);\n\t\tconsole.log(\"error message: \" + e.message);\n\t\tconsole.trace && console.trace();\n\t\tconsole.log(\"----- end of error message -----\");\n\t\tconsole.group && console.groupEnd();\n\t}\n\tcopy_from_first_row(parentfield, current_row, fieldnames) {\n\t\tvar data = this.frm.doc[parentfield];\n\t\tif (data.length === 1 || data[0] === current_row) return;\n\n\t\tif (typeof fieldnames === \"string\") {\n\t\t\tfieldnames = [fieldnames];\n\t\t}\n\n\t\t$.each(fieldnames, function (i, fieldname) {\n\t\t\tfrappe.model.set_value(\n\t\t\t\tcurrent_row.doctype,\n\t\t\t\tcurrent_row.name,\n\t\t\t\tfieldname,\n\t\t\t\tdata[0][fieldname]\n\t\t\t);\n\t\t});\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nwindow.refresh_many = function (flist, dn, table_field) {\n\tfor (var i in flist) {\n\t\tif (table_field) refresh_field(flist[i], dn, table_field);\n\t\telse refresh_field(flist[i]);\n\t}\n};\n\nwindow.refresh_field = function (n, docname, table_field) {\n\t// multiple\n\tif (typeof n == typeof []) refresh_many(n, docname, table_field);\n\n\tif (n && typeof n === \"string\" && table_field) {\n\t\tvar grid = cur_frm.fields_dict[table_field].grid,\n\t\t\tfield = frappe.utils.filter_dict(grid.docfields, { fieldname: n }),\n\t\t\tgrid_row = grid.grid_rows_by_docname[docname];\n\n\t\tif (field && field.length) {\n\t\t\tfield = field[0];\n\t\t\tvar meta = frappe.meta.get_docfield(field.parent, field.fieldname, docname);\n\t\t\t$.extend(field, meta);\n\t\t\tif (grid_row) {\n\t\t\t\tgrid_row.refresh_field(n);\n\t\t\t} else {\n\t\t\t\tgrid.refresh();\n\t\t\t}\n\t\t}\n\t} else if (cur_frm) {\n\t\tcur_frm.refresh_field(n);\n\t}\n};\n\nwindow.set_field_options = function (n, txt) {\n\tcur_frm.set_df_property(n, \"options\", txt);\n};\n\nwindow.toggle_field = function (n, hidden) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif (df) {\n\t\tdf.hidden = hidden;\n\t\trefresh_field(n);\n\t} else {\n\t\tconsole.log((hidden ? \"hide_field\" : \"unhide_field\") + \" cannot find field \" + n);\n\t}\n};\n\nwindow.hide_field = function (n) {\n\tif (cur_frm) {\n\t\tif (n.substr) toggle_field(n, 1);\n\t\telse {\n\t\t\tfor (var i in n) toggle_field(n[i], 1);\n\t\t}\n\t}\n};\n\nwindow.unhide_field = function (n) {\n\tif (cur_frm) {\n\t\tif (n.substr) toggle_field(n, 0);\n\t\telse {\n\t\t\tfor (var i in n) toggle_field(n[i], 0);\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.AssignTo = class AssignTo {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.btn = this.parent.find(\".add-assignment-btn\").on(\"click\", () => this.add());\n\t\tthis.btn_wrapper = this.btn.parent();\n\n\t\tthis.refresh();\n\t}\n\trefresh() {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.render(this.frm.get_docinfo().assignments);\n\t}\n\trender(assignments) {\n\t\tthis.frm.get_docinfo().assignments = assignments;\n\n\t\tlet assignments_wrapper = this.parent.find(\".assignments\");\n\n\t\tassignments_wrapper.empty();\n\t\tlet assigned_users = assignments.map((d) => d.owner);\n\n\t\tif (!assigned_users.length) {\n\t\t\tassignments_wrapper.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tlet avatar_group = frappe.avatar_group(assigned_users, 5, {\n\t\t\talign: \"left\",\n\t\t\toverlap: true,\n\t\t});\n\n\t\tassignments_wrapper.show();\n\t\tassignments_wrapper.append(avatar_group);\n\t\tavatar_group.click(() => {\n\t\t\tnew frappe.ui.form.AssignmentDialog({\n\t\t\t\tassignments: assigned_users,\n\t\t\t\tfrm: this.frm,\n\t\t\t});\n\t\t});\n\t}\n\tadd() {\n\t\tvar me = this;\n\n\t\tif (this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!me.assign_to) {\n\t\t\tme.assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tmethod: \"frappe.desk.form.assign_to.add\",\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tdocname: me.frm.docname,\n\t\t\t\tfrm: me.frm,\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tme.render(r.message);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tme.assign_to.dialog.clear();\n\t\tme.assign_to.dialog.show();\n\t}\n\tremove(owner) {\n\t\tif (this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before removing assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\treturn frappe\n\t\t\t.xcall(\"frappe.desk.form.assign_to.remove\", {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\tassign_to: owner,\n\t\t\t})\n\t\t\t.then((assignments) => {\n\t\t\t\tthis.render(assignments);\n\t\t\t});\n\t}\n};\n\nfrappe.ui.form.AssignToDialog = class AssignToDialog {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.make();\n\t\tthis.set_description_from_doc();\n\t}\n\tmake() {\n\t\tlet me = this;\n\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Add to ToDo\"),\n\t\t\tfields: me.get_fields(),\n\t\t\tprimary_action_label: __(\"Add\"),\n\t\t\tprimary_action: function () {\n\t\t\t\tlet args = me.dialog.get_values();\n\n\t\t\t\tif (args && args.assign_to) {\n\t\t\t\t\tme.dialog.set_message(\"Assigning...\");\n\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: me.method,\n\t\t\t\t\t\targs: $.extend(args, {\n\t\t\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\t\t\tname: me.docname,\n\t\t\t\t\t\t\tassign_to: args.assign_to,\n\t\t\t\t\t\t\tbulk_assign: me.bulk_assign || false,\n\t\t\t\t\t\t\tre_assign: me.re_assign || false,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tbtn: me.dialog.get_primary_btn(),\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tif (me.callback) {\n\t\t\t\t\t\t\t\t\tme.callback(r);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tme.dialog && me.dialog.hide();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\tassign_to_me() {\n\t\tlet me = this;\n\t\tlet assign_to = [];\n\n\t\tif (me.dialog.get_value(\"assign_to_me\")) {\n\t\t\tassign_to.push(frappe.session.user);\n\t\t}\n\n\t\tme.dialog.set_value(\"assign_to\", assign_to);\n\t}\n\tset_description_from_doc() {\n\t\tlet me = this;\n\n\t\tif (me.frm && me.frm.meta.title_field) {\n\t\t\tme.dialog.set_value(\"description\", me.frm.doc[me.frm.meta.title_field]);\n\t\t}\n\t}\n\tget_fields() {\n\t\tlet me = this;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tlabel: __(\"Assign to me\"),\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tfieldname: \"assign_to_me\",\n\t\t\t\tdefault: 0,\n\t\t\t\tonchange: () => me.assign_to_me(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"MultiSelectPills\",\n\t\t\t\tfieldname: \"assign_to\",\n\t\t\t\tlabel: __(\"Assign To\"),\n\t\t\t\treqd: true,\n\t\t\t\tget_data: function (txt) {\n\t\t\t\t\treturn frappe.db.get_link_options(\"User\", txt, {\n\t\t\t\t\t\tuser_type: \"System User\",\n\t\t\t\t\t\tenabled: 1,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Complete By\"),\n\t\t\t\tfieldtype: \"Date\",\n\t\t\t\tfieldname: \"date\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Priority\"),\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\tfieldname: \"priority\",\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: \"Low\",\n\t\t\t\t\t\tlabel: __(\"Low\"),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: \"Medium\",\n\t\t\t\t\t\tlabel: __(\"Medium\"),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: \"High\",\n\t\t\t\t\t\tlabel: __(\"High\"),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t// Pick up priority from the source document, if it exists and is available in ToDo\n\t\t\t\tdefault: [\"Low\", \"Medium\", \"High\"].includes(\n\t\t\t\t\tme.frm && me.frm.doc.priority ? me.frm.doc.priority : \"Medium\"\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Comment\"),\n\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\tfieldname: \"description\",\n\t\t\t},\n\t\t];\n\t}\n};\n\nfrappe.ui.form.AssignmentDialog = class {\n\tconstructor(opts) {\n\t\tthis.frm = opts.frm;\n\t\tthis.assignments = opts.assignments;\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Assignments\"),\n\t\t\tsize: \"small\",\n\t\t\tno_focus: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Assign a user\"),\n\t\t\t\t\tfieldname: \"user\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"User\",\n\t\t\t\t\tchange: () => {\n\t\t\t\t\t\tlet value = this.dialog.get_value(\"user\");\n\t\t\t\t\t\tif (value && !this.assigning) {\n\t\t\t\t\t\t\tthis.assigning = true;\n\t\t\t\t\t\t\tthis.dialog.set_df_property(\"user\", \"read_only\", 1);\n\t\t\t\t\t\t\tthis.dialog.set_df_property(\"user\", \"description\", __(\"Assigning...\"));\n\t\t\t\t\t\t\tthis.add_assignment(value)\n\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tthis.dialog.set_value(\"user\", null);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\t\tthis.dialog.set_df_property(\"user\", \"description\", null);\n\t\t\t\t\t\t\t\t\tthis.dialog.set_df_property(\"user\", \"read_only\", 0);\n\t\t\t\t\t\t\t\t\tthis.assigning = false;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\t\tfieldname: \"assignment_list\",\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.assignment_list = $(this.dialog.get_field(\"assignment_list\").wrapper);\n\t\tthis.assignment_list.removeClass(\"frappe-control\");\n\n\t\tthis.assignments.forEach((assignment) => {\n\t\t\tthis.update_assignment(assignment);\n\t\t});\n\t\tthis.dialog.show();\n\t}\n\trender(assignments) {\n\t\tthis.frm && this.frm.assign_to.render(assignments);\n\t}\n\tadd_assignment(assignment) {\n\t\treturn frappe\n\t\t\t.xcall(\"frappe.desk.form.assign_to.add\", {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\tassign_to: [assignment],\n\t\t\t})\n\t\t\t.then((assignments) => {\n\t\t\t\tthis.update_assignment(assignment);\n\t\t\t\tthis.render(assignments);\n\t\t\t});\n\t}\n\tremove_assignment(assignment) {\n\t\treturn frappe.xcall(\"frappe.desk.form.assign_to.remove\", {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tname: this.frm.docname,\n\t\t\tassign_to: assignment,\n\t\t});\n\t}\n\tclose_assignment(assignment) {\n\t\treturn frappe.xcall(\"frappe.desk.form.assign_to.close\", {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tname: this.frm.docname,\n\t\t\tassign_to: assignment,\n\t\t});\n\t}\n\tupdate_assignment(assignment) {\n\t\tconst in_the_list = this.assignment_list.find(`[data-user=\"${assignment}\"]`).length;\n\t\tif (!in_the_list) {\n\t\t\tthis.assignment_list.append(this.get_assignment_row(assignment));\n\t\t}\n\t}\n\tget_assignment_row(assignment) {\n\t\tconst row = $(`\n\t\t\t<div class=\"dialog-assignment-row\" data-user=\"${assignment}\">\n\t\t\t\t<div class=\"assignee\">\n\t\t\t\t\t${frappe.avatar(assignment)}\n\t\t\t\t\t${frappe.user.full_name(assignment)}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"btn-group btn-group-sm\" role=\"group\" aria-label=\"Actions\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tconst btn_group = row.find(\".btn-group\");\n\n\t\tif (assignment === frappe.session.user) {\n\t\t\tbtn_group.append(`\n\t\t\t\t<button type=\"button\" class=\"btn btn-default complete-btn\" title=\"${__(\"Done\")}\">\n\t\t\t\t\t${frappe.utils.icon(\"tick\", \"xs\")}\n\t\t\t\t</button>\n\t\t\t`);\n\t\t\tbtn_group.find(\".complete-btn\").click(() => {\n\t\t\t\tthis.close_assignment(assignment).then((assignments) => {\n\t\t\t\t\trow.remove();\n\t\t\t\t\tthis.render(assignments);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (assignment === frappe.session.user || this.frm.perm[0].write) {\n\t\t\tbtn_group.append(`\n\t\t\t\t<button type=\"button\" class=\"btn btn-default remove-btn\" title=\"${__(\"Cancel\")}\">\n\t\t\t\t${frappe.utils.icon(\"close\")}\n\t\t\t\t</button>\n\t\t\t`);\n\t\t\tbtn_group.find(\".remove-btn\").click(() => {\n\t\t\t\tthis.remove_assignment(assignment).then((assignments) => {\n\t\t\t\t\trow.remove();\n\t\t\t\t\tthis.render(assignments);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn row;\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nfrappe.ui.form.Attachments = class Attachments {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.attachments_page_length = 10; // show n attachments initially\n\t\tthis.show_all_attachments = false;\n\n\t\tthis.make();\n\t}\n\tmake() {\n\t\tvar me = this;\n\t\tthis.parent.find(\".add-attachment-btn\").click(function () {\n\t\t\tme.new_attachment();\n\t\t});\n\n\t\tthis.parent.find(\".explore-link\").click(() => {\n\t\t\tif (!this.frm.attachments.get_attachments()?.length) return;\n\t\t\tfrappe.open_in_new_tab = true;\n\t\t\tfrappe.set_route(\"List\", \"File\", {\n\t\t\t\tattached_to_doctype: this.frm.doctype,\n\t\t\t\tattached_to_name: this.frm.docname,\n\t\t\t});\n\t\t});\n\n\t\tthis.add_attachment_wrapper = this.parent.find(\".attachments-actions\");\n\t\tthis.attachments_label = this.parent.find(\".attachments-label\");\n\t}\n\tmax_reached(raise_exception = false) {\n\t\tconst attachment_count = Object.keys(this.get_attachments()).length;\n\t\tconst attachment_limit = this.frm.meta.max_attachments;\n\t\tif (attachment_limit && attachment_count >= attachment_limit) {\n\t\t\tif (raise_exception) {\n\t\t\t\tfrappe.throw({\n\t\t\t\t\ttitle: __(\"Attachment Limit Reached\"),\n\t\t\t\t\tmessage: __(\"Maximum attachment limit of {0} has been reached.\", [\n\t\t\t\t\t\tcstr(attachment_limit).bold(),\n\t\t\t\t\t]),\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\trefresh() {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.parent.find(\".attachment-row\").remove();\n\n\t\tvar max_reached = this.max_reached();\n\t\tthis.add_attachment_wrapper.find(\".add-attachment-btn\").toggle(!max_reached);\n\n\t\t// add attachment objects\n\t\tvar attachments = this.get_attachments();\n\t\tthis.render_attachments(attachments);\n\t\tthis.setup_show_all_button(attachments);\n\t}\n\n\tsetup_show_all_button(attachments) {\n\t\t// show button if there is more to show and user has not clicked on \"Show All\"\n\t\tlet is_slicable = attachments.length > this.attachments_page_length;\n\t\tlet show = !this.show_all_attachments && is_slicable;\n\n\t\tlet show_all_btn = this.parent.find(\".show-all-btn\");\n\t\tif (!show) {\n\t\t\tshow_all_btn.addClass(\"hidden\");\n\t\t\treturn;\n\t\t}\n\n\t\tshow_all_btn.removeClass(\"hidden\");\n\t\tshow_all_btn.click(() => {\n\t\t\tshow_all_btn.addClass(\"hidden\");\n\t\t\tthis.show_all_attachments = true;\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tget_attachments() {\n\t\treturn this.frm.get_docinfo().attachments || [];\n\t}\n\n\trender_attachments(attachments) {\n\t\tvar me = this;\n\t\tlet attachments_to_render = attachments;\n\n\t\tlet is_slicable = attachments.length > this.attachments_page_length;\n\t\tif (!this.show_all_attachments && is_slicable) {\n\t\t\t// render last n attachments as they are at the top\n\t\t\tlet start = attachments.length - this.attachments_page_length;\n\t\t\tattachments_to_render = attachments.slice(start, attachments.length);\n\t\t}\n\n\t\tif (attachments_to_render.length) {\n\t\t\tlet exists = {};\n\t\t\tlet unique_attachments = attachments_to_render.filter((attachment) => {\n\t\t\t\treturn Object.prototype.hasOwnProperty.call(exists, attachment.file_name)\n\t\t\t\t\t? false\n\t\t\t\t\t: (exists[attachment.file_name] = true);\n\t\t\t});\n\t\t\tunique_attachments.forEach((attachment) => {\n\t\t\t\tme.add_attachment(attachment);\n\t\t\t});\n\t\t}\n\n\t\tif (!attachments.length) {\n\t\t\t// If no attachments in totality\n\t\t\tthis.attachments_label.removeClass(\"has-attachments\");\n\t\t}\n\t}\n\n\tadd_attachment(attachment) {\n\t\tvar file_name = attachment.file_name;\n\t\tvar file_url = this.get_file_url(attachment);\n\t\tvar fileid = attachment.name;\n\t\tif (!file_name) {\n\t\t\tfile_name = file_url;\n\t\t}\n\n\t\tvar me = this;\n\n\t\tlet file_label = `\n\t\t\t<a href=\"${file_url}\" target=\"_blank\" title=\"${frappe.utils.escape_html(file_name)}\"\n\t\t\t\tclass=\"ellipsis\" style=\"max-width: calc(100% - 43px);\"\n\t\t\t>\n\t\t\t\t<span>${file_name}</span>\n\t\t\t</a>`;\n\n\t\tlet remove_action = null;\n\t\tif (frappe.model.can_write(this.frm.doctype, this.frm.name)) {\n\t\t\tremove_action = function (target_id) {\n\t\t\t\tfrappe.confirm(__(\"Are you sure you want to delete the attachment?\"), function () {\n\t\t\t\t\tlet target_attachment = me\n\t\t\t\t\t\t.get_attachments()\n\t\t\t\t\t\t.find((attachment) => attachment.name === target_id);\n\t\t\t\t\tlet to_be_removed = me\n\t\t\t\t\t\t.get_attachments()\n\t\t\t\t\t\t.filter(\n\t\t\t\t\t\t\t(attachment) => attachment.file_name === target_attachment.file_name\n\t\t\t\t\t\t);\n\t\t\t\t\tto_be_removed.forEach((attachment) => me.remove_attachment(attachment.name));\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tconst icon = `<a href=\"/app/file/${fileid}\">\n\t\t\t\t${frappe.utils.icon(attachment.is_private ? \"es-line-lock\" : \"es-line-unlock\", \"sm ml-0\")}\n\t\t\t</a>`;\n\n\t\t$(`<li class=\"attachment-row\">`)\n\t\t\t.append(frappe.get_data_pill(file_label, fileid, remove_action, icon))\n\t\t\t.insertAfter(this.add_attachment_wrapper);\n\t}\n\n\tget_file_url(attachment) {\n\t\tvar file_url = attachment.file_url;\n\t\tif (!file_url) {\n\t\t\tif (attachment.file_name.indexOf(\"files/\") === 0) {\n\t\t\t\tfile_url = \"/\" + attachment.file_name;\n\t\t\t} else {\n\t\t\t\tfile_url = \"/files/\" + attachment.file_name;\n\t\t\t}\n\t\t}\n\t\t// hash is not escaped, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\n\t\treturn encodeURI(file_url).replace(/#/g, \"%23\");\n\t}\n\tget_file_id_from_file_url(file_url) {\n\t\tvar fid;\n\t\t$.each(this.get_attachments(), function (i, attachment) {\n\t\t\tif (attachment.file_url === file_url) {\n\t\t\t\tfid = attachment.name;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn fid;\n\t}\n\tremove_attachment_by_filename(filename, callback) {\n\t\tthis.remove_attachment(this.get_file_id_from_file_url(filename), callback);\n\t}\n\tremove_attachment(fileid, callback) {\n\t\tif (!fileid) {\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.utils.remove_attach\",\n\t\t\ttype: \"DELETE\",\n\t\t\targs: {\n\t\t\t\tfid: fileid,\n\t\t\t\tdt: me.frm.doctype,\n\t\t\t\tdn: me.frm.docname,\n\t\t\t},\n\t\t\tcallback: function (r, rt) {\n\t\t\t\tif (r.exc) {\n\t\t\t\t\tif (!r._server_messages) frappe.msgprint(__(\"There were errors\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.remove_fileid(fileid);\n\t\t\t\tme.frm.sidebar.reload_docinfo();\n\t\t\t\tif (callback) callback();\n\t\t\t},\n\t\t});\n\t}\n\tnew_attachment(fieldname) {\n\t\tif (this.dialog) {\n\t\t\t// remove upload dialog\n\t\t\tthis.dialog.$wrapper.remove();\n\t\t}\n\n\t\tconst restrictions = {};\n\t\tif (this.frm.meta.max_attachments) {\n\t\t\trestrictions.max_number_of_files =\n\t\t\t\tthis.frm.meta.max_attachments - this.frm.attachments.get_attachments().length;\n\t\t}\n\n\t\tnew frappe.ui.FileUploader({\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t\tfrm: this.frm,\n\t\t\tfolder: \"Home/Attachments\",\n\t\t\ton_success: (file_doc) => {\n\t\t\t\tthis.attachment_uploaded(file_doc);\n\t\t\t},\n\t\t\trestrictions,\n\t\t\tmake_attachments_public: this.frm.meta.make_attachments_public,\n\t\t});\n\t}\n\tget_args() {\n\t\treturn {\n\t\t\tfrom_form: 1,\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t};\n\t}\n\tattachment_uploaded(attachment) {\n\t\tthis.dialog && this.dialog.hide();\n\t\tthis.update_attachment(attachment);\n\t\tthis.frm.sidebar.reload_docinfo();\n\n\t\tif (this.fieldname) {\n\t\t\tthis.frm.set_value(this.fieldname, attachment.file_url);\n\t\t}\n\t}\n\tupdate_attachment(attachment) {\n\t\tif (attachment.name) {\n\t\t\tthis.add_to_attachments(attachment);\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\tadd_to_attachments(attachment) {\n\t\tvar form_attachments = this.get_attachments();\n\t\tfor (var i in form_attachments) {\n\t\t\t// prevent duplicate\n\t\t\tif (form_attachments[i][\"name\"] === attachment.name) return;\n\t\t}\n\t\tform_attachments.push(attachment);\n\t}\n\tremove_fileid(fileid) {\n\t\tvar attachments = this.get_attachments();\n\t\tvar new_attachments = [];\n\t\t$.each(attachments, function (i, attachment) {\n\t\t\tif (attachment.name != fileid) {\n\t\t\t\tnew_attachments.push(attachment);\n\t\t\t}\n\t\t});\n\t\tthis.frm.get_docinfo().attachments = new_attachments;\n\t\tthis.refresh();\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Share = class Share {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.shares = this.parent.find(\".shares\");\n\t}\n\trefresh() {\n\t\tthis.render_sidebar();\n\t}\n\trender_sidebar() {\n\t\tconst shared = this.shared || this.frm.get_docinfo().shared;\n\t\tconst shared_users = shared.filter(Boolean).map((s) => s.user);\n\n\t\tif (this.frm.is_new()) {\n\t\t\tthis.parent.find(\".share-doc-btn\").hide();\n\t\t}\n\n\t\tthis.parent\n\t\t\t.find(\".share-doc-btn\")\n\t\t\t.off(\"click\")\n\t\t\t.on(\"click\", () => {\n\t\t\t\tthis.frm.share_doc();\n\t\t\t});\n\n\t\tthis.shares.empty();\n\n\t\tif (!shared_users.length) {\n\t\t\tthis.shares.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.shares.show();\n\t\tlet avatar_group = frappe.avatar_group(shared_users, 5, { align: \"left\", overlap: true });\n\t\tavatar_group.on(\"click\", () => {\n\t\t\tthis.frm.share_doc();\n\t\t});\n\t\t// REDESIGN-TODO: handle \"shared with everyone\"\n\t\tthis.shares.append(avatar_group);\n\t}\n\tshow() {\n\t\tvar me = this;\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Share {0} with\", [this.frm.doc.name]),\n\t\t});\n\n\t\tthis.dialog = d;\n\t\tthis.dirty = false;\n\n\t\t$(d.body).html('<p class=\"text-muted\">' + __(\"Loading...\") + \"</p>\");\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.share.get_users\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tme.render_shared(r.message || []);\n\t\t\t},\n\t\t});\n\n\t\td.onhide = function () {\n\t\t\t// reload comments\n\t\t\tif (me.dirty) me.frm.sidebar.reload_docinfo();\n\t\t};\n\n\t\td.show();\n\t}\n\trender_shared(shared) {\n\t\tif (shared) this.shared = shared;\n\t\tvar d = this.dialog;\n\t\t$(d.body).empty();\n\n\t\tvar everyone = {};\n\t\t$.each(this.shared, function (i, s) {\n\t\t\t// pullout everyone record from shared list\n\t\t\tif (s && s.everyone) {\n\t\t\t\teveryone = s;\n\t\t\t}\n\t\t});\n\n\t\t$(\n\t\t\tfrappe.render_template(\"set_sharing\", {\n\t\t\t\tfrm: this.frm,\n\t\t\t\tshared: this.shared,\n\t\t\t\teveryone: everyone,\n\t\t\t})\n\t\t).appendTo(d.body);\n\n\t\tif (frappe.model.can_share(null, this.frm)) {\n\t\t\tthis.make_user_input();\n\t\t\tthis.add_share_button();\n\t\t\tthis.set_edit_share_events();\n\t\t} else {\n\t\t\t// if cannot share, disable sharing settings.\n\t\t\t$(d.body).find(\".edit-share\").prop(\"disabled\", true);\n\t\t}\n\t}\n\tmake_user_input() {\n\t\t// make add-user input\n\t\tthis.dialog.share_with = frappe.ui.form.make_control({\n\t\t\tparent: $(this.dialog.body).find(\".input-wrapper-add-share\"),\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Share With\"),\n\t\t\t\tfieldname: \"share_with\",\n\t\t\t\toptions: \"User\",\n\t\t\t\tfilters: {\n\t\t\t\t\tuser_type: \"System User\",\n\t\t\t\t\tname: [\"!=\", frappe.session.user],\n\t\t\t\t},\n\t\t\t},\n\t\t\tonly_input: true,\n\t\t\trender_input: true,\n\t\t});\n\t}\n\tadd_share_button() {\n\t\tvar me = this,\n\t\t\td = this.dialog;\n\t\t$(d.body)\n\t\t\t.find(\".btn-add-share\")\n\t\t\t.on(\"click\", function () {\n\t\t\t\tvar user = d.share_with.get_value();\n\t\t\t\tif (!user) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.share.add\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\tuser: user,\n\t\t\t\t\t\tread: $(d.body).find(\".add-share-read\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\t\twrite: $(d.body).find(\".add-share-write\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\t\tsubmit: $(d.body).find(\".add-share-submit\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\t\tshare: $(d.body).find(\".add-share-share\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\t\tnotify: 1,\n\t\t\t\t\t},\n\t\t\t\t\tbtn: this,\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t$.each(me.shared, function (i, s) {\n\t\t\t\t\t\t\tif (s && s.user === r.message.user) {\n\t\t\t\t\t\t\t\t// re-adding / remove the old share rule.\n\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme.dirty = true;\n\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t\tme.render_shared();\n\t\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t}\n\tset_edit_share_events() {\n\t\tvar me = this,\n\t\t\td = this.dialog;\n\t\t$(d.body)\n\t\t\t.find(\".edit-share\")\n\t\t\t.on(\"click\", function () {\n\t\t\t\tvar user = $(this).parents(\".shared-user:first\").attr(\"data-user\") || \"\",\n\t\t\t\t\tvalue = $(this).prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tproperty = $(this).attr(\"name\"),\n\t\t\t\t\teveryone = cint($(this).parents(\".shared-user:first\").attr(\"data-everyone\"));\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.share.set_permission\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\tuser: user,\n\t\t\t\t\t\tpermission_to: property,\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\teveryone: everyone,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tvar found = null;\n\t\t\t\t\t\t$.each(me.shared, function (i, s) {\n\t\t\t\t\t\t\t// update shared object\n\t\t\t\t\t\t\tif (s && (s.user === user || (everyone && s.everyone === 1))) {\n\t\t\t\t\t\t\t\tif (!r.message) {\n\t\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tme.shared[i] = $.extend(s, r.message);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (!found) {\n\t\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.dirty = true;\n\t\t\t\t\t\tme.render_shared();\n\t\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t}\n};\n", "// Copyright (c) 2019, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Review = class Review {\n\tconstructor({ parent, frm }) {\n\t\tthis.parent = parent;\n\t\tthis.frm = frm;\n\t\tthis.points = frappe.boot.points;\n\t\tthis.reviews = this.parent.find(\".reviews\");\n\t\tthis.setup_add_review_button();\n\t\tthis.update_reviewers();\n\t}\n\tupdate_points() {\n\t\treturn frappe\n\t\t\t.xcall(\"frappe.social.doctype.energy_point_log.energy_point_log.get_energy_points\", {\n\t\t\t\tuser: frappe.session.user,\n\t\t\t})\n\t\t\t.then((data) => {\n\t\t\t\tfrappe.boot.points = data;\n\t\t\t\tthis.points = data;\n\t\t\t});\n\t}\n\tsetup_add_review_button() {\n\t\tconst review_button = this.reviews.find(\".add-review-btn\");\n\n\t\tif (!this.points.review_points) {\n\t\t\treview_button.click(false);\n\t\t\treview_button.popover({\n\t\t\t\ttrigger: \"hover\",\n\t\t\t\tcontent: () => {\n\t\t\t\t\treturn `<div class=\"text-medium\">\n\t\t\t\t\t\t${__(\"You do not have enough review points\")}\n\t\t\t\t\t</div>`;\n\t\t\t\t},\n\t\t\t\thtml: true,\n\t\t\t});\n\t\t} else {\n\t\t\treview_button.click(() => this.show_review_dialog());\n\t\t}\n\t}\n\n\tshow_review_dialog() {\n\t\tconst user_options = this.frm.get_involved_users();\n\t\tconst review_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Add Review\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"to_user\",\n\t\t\t\t\tfieldtype: \"Autocomplete\",\n\t\t\t\t\tlabel: __(\"To User\"),\n\t\t\t\t\treqd: 1,\n\t\t\t\t\toptions: user_options,\n\t\t\t\t\tignore_validation: 1,\n\t\t\t\t\tdescription: __(\"Only users involved in the document are listed\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"review_type\",\n\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\tlabel: __(\"Action\"),\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __(\"Appreciate\"),\n\t\t\t\t\t\t\tvalue: \"Appreciation\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __(\"Criticize\"),\n\t\t\t\t\t\t\tvalue: \"Criticism\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tdefault: \"Appreciation\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"points\",\n\t\t\t\t\tfieldtype: \"Int\",\n\t\t\t\t\tlabel: __(\"Points\"),\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdescription: __(\"Currently you have {0} review points\", [\n\t\t\t\t\t\tthis.points.review_points,\n\t\t\t\t\t]),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\t\tfieldname: \"reason\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tlabel: __(\"Reason\"),\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action: (values) => {\n\t\t\t\treview_dialog.disable_primary_action();\n\t\t\t\tif (values.points > this.points.review_points) {\n\t\t\t\t\treturn frappe.msgprint(__(\"You do not have enough points\"));\n\t\t\t\t}\n\t\t\t\tfrappe\n\t\t\t\t\t.xcall(\"frappe.social.doctype.energy_point_log.energy_point_log.review\", {\n\t\t\t\t\t\tdoc: {\n\t\t\t\t\t\t\tdoctype: this.frm.doc.doctype,\n\t\t\t\t\t\t\tname: this.frm.doc.name,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tto_user: values.to_user,\n\t\t\t\t\t\tpoints: values.points,\n\t\t\t\t\t\treview_type: values.review_type,\n\t\t\t\t\t\treason: values.reason,\n\t\t\t\t\t})\n\t\t\t\t\t.then((review) => {\n\t\t\t\t\t\treview_dialog.hide();\n\t\t\t\t\t\treview_dialog.clear();\n\t\t\t\t\t\tthis.frm.get_docinfo().energy_point_logs.unshift(review);\n\t\t\t\t\t\tthis.frm.timeline.refresh();\n\t\t\t\t\t\tthis.update_reviewers();\n\t\t\t\t\t\tthis.update_points();\n\t\t\t\t\t})\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\treview_dialog.enable_primary_action();\n\t\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Submit\"),\n\t\t});\n\t\treview_dialog.show();\n\t}\n\tupdate_reviewers() {\n\t\tconst review_logs = this.frm\n\t\t\t.get_docinfo()\n\t\t\t.energy_point_logs.filter((log) => [\"Appreciation\", \"Criticism\"].includes(log.type));\n\n\t\tthis.reviews.find(\".review\").remove();\n\t\treview_logs.forEach((log) => {\n\t\t\tlet review_pill = $(`\n\t\t\t\t<div class=\"review ${log.points < 0 ? \"criticism\" : \"appreciation\"} cursor-pointer\">\n\t\t\t\t\t${frappe.avatar(log.owner)}\n\t\t\t\t\t<span class=\"review-points\">\n\t\t\t\t\t\t${log.points > 0 ? \"+\" : \"\"}${log.points}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.reviews.append(review_pill);\n\t\t\tthis.setup_detail_popover(review_pill, log);\n\t\t});\n\t}\n\tsetup_detail_popover(el, data) {\n\t\tlet subject = \"\";\n\t\tlet fullname = frappe.user.full_name(data.user);\n\t\tlet timestamp = `<span class=\"text-muted\">${frappe.datetime.comment_when(\n\t\t\tdata.creation\n\t\t)}</span>`;\n\t\tlet message_parts = [Math.abs(data.points), fullname, timestamp];\n\t\tif (data.type === \"Appreciation\") {\n\t\t\tif (data.points == 1) {\n\t\t\t\tsubject = __(\"{0} appreciation point for {1}\", message_parts);\n\t\t\t} else {\n\t\t\t\tsubject = __(\"{0} appreciation points for {1}\", message_parts);\n\t\t\t}\n\t\t} else {\n\t\t\tif (data.points == -1) {\n\t\t\t\tsubject = __(\"{0} criticism point for {1}\", message_parts);\n\t\t\t} else {\n\t\t\t\tsubject = __(\"{0} criticism points for {1}\", message_parts);\n\t\t\t}\n\t\t}\n\n\t\tel.popover({\n\t\t\tanimation: true,\n\t\t\ttrigger: \"hover\",\n\t\t\tdelay: 500,\n\t\t\tplacement: \"top\",\n\t\t\ttemplate: `\n\t\t\t\t<div class=\"review-popover popover\" role=\"tooltip\">\n\t\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t\t<h3 class=\"popover-header\"></h3>\n\t\t\t\t\t<div class=\"popover-body\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>'\n\t\t\t`,\n\t\t\tcontent: () => {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"text-medium\">\n\t\t\t\t\t\t<div class=\"body\">\n\t\t\t\t\t\t\t<div>${data.reason}</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"subject\">\n\t\t\t\t\t\t\t${frappe.utils.icon(\"review\")}\n\t\t\t\t\t\t\t${subject}\n\n\t\t\t\t\t\t\t<p class=\"mt-1\">\n\t\t\t\t\t\t\t\t<!-- ${frappe.avatar(\"shivam@example.com\", \"avatar-xs\")} -->\n\t\t\t\t\t\t\t\t<span>${frappe.user.full_name(data.owner)}</span> - ${timestamp}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t},\n\t\t\thtml: true,\n\t\t\tcontainer: \"body\",\n\t\t});\n\n\t\treturn el;\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.DocumentFollow = class DocumentFollow {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tif (!frappe.boot.user.document_follow_notify) {\n\t\t\tthis.hide_follow_section();\n\t\t\treturn;\n\t\t}\n\t\tthis.follow_document_link = this.parent.find(\".follow-document-link\");\n\t\tthis.unfollow_document_link = this.parent.find(\".unfollow-document-link\");\n\t\tthis.follow_span = this.parent.find(\".anchor-document-follow > span\");\n\t\tthis.followed_by = this.parent.find(\".followed-by\");\n\t\tthis.followed_by_label = this.parent.find(\".followed-by-label\");\n\t}\n\n\trefresh() {\n\t\tthis.set_followers();\n\t\tthis.render_sidebar();\n\t}\n\n\trender_sidebar() {\n\t\tconst docinfo = this.frm.get_docinfo();\n\t\tconst document_follow_enabled = frappe.boot.user.document_follow_notify;\n\t\tconst document_can_be_followed = frappe.get_meta(this.frm.doctype).track_changes;\n\t\tif (\n\t\t\tfrappe.session.user === \"Administrator\" ||\n\t\t\t!document_follow_enabled ||\n\t\t\t!document_can_be_followed\n\t\t) {\n\t\t\tthis.hide_follow_section();\n\t\t\treturn;\n\t\t}\n\t\tthis.bind_events();\n\n\t\tconst is_followed = docinfo && docinfo.is_document_followed;\n\n\t\tif (is_followed > 0) {\n\t\t\tthis.unfollow_document_link.removeClass(\"hidden\");\n\t\t\tthis.follow_document_link.addClass(\"hidden\");\n\t\t} else {\n\t\t\tthis.followed_by_label.addClass(\"hidden\");\n\t\t\tthis.followed_by.addClass(\"hidden\");\n\t\t\tthis.unfollow_document_link.addClass(\"hidden\");\n\t\t\tthis.follow_document_link.removeClass(\"hidden\");\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.follow_document_link.on(\"click\", () => {\n\t\t\tthis.follow_document_link.addClass(\"text-muted disable-click\");\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.form.document_follow.follow_document\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\tdoc_name: this.frm.doc.name,\n\t\t\t\t\tuser: frappe.session.user,\n\t\t\t\t\tforce: true,\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tthis.follow_action();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tthis.unfollow_document_link.on(\"click\", () => {\n\t\t\tthis.unfollow_document_link.addClass(\"text-muted disable-click\");\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.form.document_follow.unfollow_document\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\tdoc_name: this.frm.doc.name,\n\t\t\t\t\tuser: frappe.session.user,\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tthis.unfollow_action();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\thide_follow_section() {\n\t\tthis.parent.hide();\n\t}\n\n\tset_followers() {\n\t\tthis.followed_by.removeClass(\"hidden\");\n\t\tthis.followed_by_label.removeClass(\"hidden\");\n\t\tthis.followed_by.empty();\n\t\tthis.get_followed_user().then((user) => {\n\t\t\t$(user).appendTo(this.followed_by);\n\t\t});\n\t}\n\n\tget_followed_user() {\n\t\tvar html = \"\";\n\t\treturn new Promise((resolve) => {\n\t\t\tfrappe\n\t\t\t\t.call({\n\t\t\t\t\tmethod: \"frappe.desk.form.document_follow.get_follow_users\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\t\tdoc_name: this.frm.doc.name,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((r) => {\n\t\t\t\t\tthis.count_others = 0;\n\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\tthis.count_others++;\n\t\t\t\t\t\tif (this.count_others < 4) {\n\t\t\t\t\t\t\thtml += frappe.avatar(r.message[d].user, \"avatar-small\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.count_others === 0) {\n\t\t\t\t\t\t\tthis.followed_by.addClass(\"hidden\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresolve(html);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tfollow_action() {\n\t\tfrappe.show_alert({\n\t\t\tmessage: __(\n\t\t\t\t\"You are now following this document. You will receive daily updates via email. You can change this in User Settings.\"\n\t\t\t),\n\t\t\tindicator: \"orange\",\n\t\t});\n\t\tthis.follow_document_link.removeClass(\"text-muted disable-click\");\n\t\tthis.follow_document_link.addClass(\"hidden\");\n\t\tthis.unfollow_document_link.removeClass(\"hidden\");\n\t\tthis.set_followers();\n\t}\n\n\tunfollow_action() {\n\t\tfrappe.show_alert({\n\t\t\tmessage: __(\"You unfollowed this document\"),\n\t\t\tindicator: \"red\",\n\t\t});\n\t\tthis.unfollow_document_link.removeClass(\"text-muted disable-click\");\n\t\tthis.unfollow_document_link.addClass(\"hidden\");\n\t\tthis.follow_document_link.removeClass(\"hidden\");\n\t\tthis.followed_by.addClass(\"hidden\");\n\t\tthis.followed_by_label.addClass(\"hidden\");\n\t}\n};\n", "frappe.ui.form.set_user_image = function (frm) {\n\tvar image_section = frm.sidebar.image_section;\n\tvar image_field = frm.meta.image_field;\n\tvar image = frm.doc[image_field];\n\tvar title_image = frm.page.$title_area.find(\".title-image\");\n\tvar image_actions = frm.sidebar.image_wrapper.find(\".sidebar-image-actions\");\n\n\timage_section.toggleClass(\"hide\", image_field ? false : true);\n\ttitle_image.toggleClass(\"hide\", image_field ? false : true);\n\n\tif (!image_field) {\n\t\treturn;\n\t}\n\n\t// if image field has value\n\tif (image) {\n\t\timage = window.cordova && image.indexOf(\"http\") === -1 ? frappe.base_url + image : image;\n\n\t\timage_section.find(\".sidebar-image\").attr(\"src\", image).removeClass(\"hide\");\n\n\t\timage_section.find(\".sidebar-standard-image\").addClass(\"hide\");\n\n\t\ttitle_image.css(\"background-image\", `url(\"${image}\")`).html(\"\");\n\n\t\timage_actions.find(\".sidebar-image-change, .sidebar-image-remove\").show();\n\t} else {\n\t\timage_section.find(\".sidebar-image\").attr(\"src\", null).addClass(\"hide\");\n\n\t\tvar title = frm.get_title();\n\n\t\timage_section\n\t\t\t.find(\".sidebar-standard-image\")\n\t\t\t.removeClass(\"hide\")\n\t\t\t.find(\".standard-image\")\n\t\t\t.html(frappe.get_abbr(title));\n\n\t\ttitle_image.css(\"background-image\", \"\").html(frappe.get_abbr(title));\n\n\t\timage_actions.find(\".sidebar-image-change\").show();\n\t\timage_actions.find(\".sidebar-image-remove\").hide();\n\t}\n};\n\nfrappe.ui.form.setup_user_image_event = function (frm) {\n\t// re-draw image on change of user image\n\tif (frm.meta.image_field) {\n\t\tfrappe.ui.form.on(frm.doctype, frm.meta.image_field, function (frm) {\n\t\t\tfrappe.ui.form.set_user_image(frm);\n\t\t});\n\t}\n\n\tif (frm.meta.image_field && !frm.fields_dict[frm.meta.image_field].df.read_only) {\n\t\tfrm.sidebar.image_wrapper.on(\"click\", \":not(.sidebar-image-actions)\", (e) => {\n\t\t\tlet $target = $(e.currentTarget);\n\t\t\tif ($target.is(\"a.dropdown-toggle, .dropdown\")) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet dropdown = frm.sidebar.image_wrapper.find(\".sidebar-image-actions .dropdown\");\n\t\t\tdropdown.toggleClass(\"open\");\n\t\t\te.stopPropagation();\n\t\t});\n\t}\n\n\t// bind click on image_wrapper\n\tfrm.sidebar.image_wrapper.on(\n\t\t\"click\",\n\t\t\".sidebar-image-change, .sidebar-image-remove\",\n\t\tfunction (e) {\n\t\t\tlet $target = $(e.currentTarget);\n\t\t\tvar field = frm.get_field(frm.meta.image_field);\n\t\t\tif ($target.is(\".sidebar-image-change\")) {\n\t\t\t\tif (!field.$input) {\n\t\t\t\t\tfield.make_input();\n\t\t\t\t}\n\t\t\t\tfield.$input.trigger(\"attach_doc_image\");\n\t\t\t\t// close sidebar\n\t\t\t\tfrm.page.close_sidebar?.();\n\t\t\t} else {\n\t\t\t\t/// on remove event for a sidebar image wrapper remove attach file.\n\t\t\t\tfrm.attachments.remove_attachment_by_filename(\n\t\t\t\t\tfrm.doc[frm.meta.image_field],\n\t\t\t\t\tfunction () {\n\t\t\t\t\t\tfield.set_value(\"\").then(() => frm.save());\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t);\n};\n", "frappe.ui.form.SidebarUsers = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tget_users(type) {\n\t\tlet docinfo = this.frm.get_docinfo();\n\t\treturn docinfo ? docinfo[type] || null : null;\n\t}\n\n\trefresh(data_updated, type) {\n\t\tthis.parent =\n\t\t\ttype == \"viewers\"\n\t\t\t\t? this.$wrapper.find(\".form-viewers\")\n\t\t\t\t: this.$wrapper.find(\".form-typers\");\n\t\tthis.parent.empty();\n\n\t\tconst users = this.get_users(type);\n\t\tusers && this.show_in_sidebar(users, type, data_updated);\n\t}\n\n\tshow_in_sidebar(users, type, show_alert) {\n\t\tlet sidebar_users = [];\n\t\tlet new_users = [];\n\t\tlet current_users = [];\n\n\t\tconst message = type == \"viewers\" ? \"viewing this document\" : \"composing an email\";\n\n\t\tusers.current.forEach((username) => {\n\t\t\tif (username === frappe.session.user) {\n\t\t\t\t// current user\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar user_info = frappe.user_info(username);\n\t\t\tsidebar_users.push({\n\t\t\t\timage: user_info.image,\n\t\t\t\tfullname: user_info.fullname,\n\t\t\t\tabbr: user_info.abbr,\n\t\t\t\tcolor: user_info.color,\n\t\t\t\ttitle: __(\"{0} is currently {1}\", [user_info.fullname, message]),\n\t\t\t});\n\n\t\t\tif (users.new.indexOf(username) !== -1) {\n\t\t\t\tnew_users.push(user_info.fullname);\n\t\t\t}\n\n\t\t\tcurrent_users.push(user_info.fullname);\n\t\t});\n\n\t\tif (sidebar_users.length) {\n\t\t\tthis.parent.parent().removeClass(\"hidden\");\n\t\t\tthis.parent.append(\n\t\t\t\tfrappe.render_template(\"users_in_sidebar\", { users: sidebar_users })\n\t\t\t);\n\t\t} else {\n\t\t\tthis.parent.parent().addClass(\"hidden\");\n\t\t}\n\n\t\t// For typers always show the alert\n\t\t// For viewers show the alert to new user viewing this document\n\t\tconst alert_users = type == \"viewers\" ? new_users : current_users;\n\t\tshow_alert && this.show_alert(alert_users, message);\n\t}\n\n\tshow_alert(users, message) {\n\t\tif (users.length) {\n\t\t\tif (users.length === 1) {\n\t\t\t\tfrappe.show_alert(__(\"{0} is currently {1}\", [users[0], message]));\n\t\t\t} else {\n\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t__(\"{0} are currently {1}\", [frappe.utils.comma_and(users), message])\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n};\n", "// REDESIGN-TODO: Review\n\nfunction get_version_timeline_content(version_doc, frm) {\n\tif (!version_doc.data) return [];\n\tconst data = JSON.parse(version_doc.data);\n\n\t// comment\n\tif (data.comment) {\n\t\treturn [get_version_comment(version_doc, data.comment)];\n\t}\n\n\tlet out = [];\n\n\tlet updater_reference_link = null;\n\tlet updater_reference = data.updater_reference;\n\tif (!$.isEmptyObject(updater_reference)) {\n\t\tlet label = updater_reference.label || __(\"via {0}\", [updater_reference.doctype]);\n\t\tlet { doctype, docname } = updater_reference;\n\t\tif (doctype && docname) {\n\t\t\tupdater_reference_link = frappe.utils.get_form_link(doctype, docname, true, label);\n\t\t} else {\n\t\t\tupdater_reference_link = label;\n\t\t}\n\t}\n\n\t// value changed in parent\n\tif (data.changed && data.changed.length) {\n\t\tvar parts = [];\n\t\tdata.changed.every(function (p) {\n\t\t\tif (p[0] === \"docstatus\") {\n\t\t\t\tif (p[2] === 1) {\n\t\t\t\t\tlet message = updater_reference_link\n\t\t\t\t\t\t? get_user_message(\n\t\t\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"You submitted this document {0}\",\n\t\t\t\t\t\t\t\t\t[updater_reference_link],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"{0} submitted this document {1}\",\n\t\t\t\t\t\t\t\t\t[get_user_link(version_doc.owner), updater_reference_link],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: get_user_message(\n\t\t\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t\t\t__(\"You submitted this document\", null, \"Form timeline\"),\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"{0} submitted this document\",\n\t\t\t\t\t\t\t\t\t[get_user_link(version_doc.owner)],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t  );\n\n\t\t\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t\t\t} else if (p[2] === 2) {\n\t\t\t\t\tlet message = updater_reference_link\n\t\t\t\t\t\t? get_user_message(\n\t\t\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"You cancelled this document {1}\",\n\t\t\t\t\t\t\t\t\t[updater_reference_link],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"{0} cancelled this document {1}\",\n\t\t\t\t\t\t\t\t\t[get_user_link(version_doc.owner), updater_reference_link],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: get_user_message(\n\t\t\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t\t\t__(\"You cancelled this document\", null, \"Form timeline\"),\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"{0} cancelled this document\",\n\t\t\t\t\t\t\t\t\t[get_user_link(version_doc.owner)],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t  );\n\n\t\t\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst df = frappe.meta.get_docfield(frm.doctype, p[0], frm.docname);\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tconst field_display_status = frappe.perm.get_field_display_status(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfrm.perm\n\t\t\t\t\t);\n\t\t\t\t\tif (field_display_status === \"Read\" || field_display_status === \"Write\") {\n\t\t\t\t\t\tparts.push(\n\t\t\t\t\t\t\t__(\"{0} from {1} to {2}\", [\n\t\t\t\t\t\t\t\t__(df.label),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[1]),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[2]),\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn parts.length < 3;\n\t\t});\n\t\tif (parts.length) {\n\t\t\tlet message = updater_reference_link\n\t\t\t\t? get_user_message(\n\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t__(\"You changed the value of {0} {1}\", [\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t__(\"{0} changed the value of {1} {2}\", [\n\t\t\t\t\t\t\tget_user_link(version_doc.owner),\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t])\n\t\t\t\t  )\n\t\t\t\t: get_user_message(\n\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t__(\"You changed the value of {0}\", [parts.join(\", \")]),\n\t\t\t\t\t\t__(\"{0} changed the value of {1}\", [\n\t\t\t\t\t\t\tget_user_link(version_doc.owner),\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t])\n\t\t\t\t  );\n\n\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t}\n\t}\n\n\t// value changed in table field\n\tif (data.row_changed && data.row_changed.length) {\n\t\tlet parts = [];\n\t\tdata.row_changed.every(function (row) {\n\t\t\trow[3].every(function (p) {\n\t\t\t\tvar df =\n\t\t\t\t\tfrm.fields_dict[row[0]] &&\n\t\t\t\t\tfrappe.meta.get_docfield(\n\t\t\t\t\t\tfrm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\tp[0],\n\t\t\t\t\t\tfrm.docname\n\t\t\t\t\t);\n\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfrm.perm\n\t\t\t\t\t);\n\n\t\t\t\t\tif (field_display_status === \"Read\" || field_display_status === \"Write\") {\n\t\t\t\t\t\tparts.push(\n\t\t\t\t\t\t\t__(\"{0} from {1} to {2} in row #{3}\", [\n\t\t\t\t\t\t\t\tfrappe.meta.get_label(frm.fields_dict[row[0]].grid.doctype, p[0]),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[1]),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[2]),\n\t\t\t\t\t\t\t\trow[1],\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn parts.length < 3;\n\t\t\t});\n\t\t\treturn parts.length < 3;\n\t\t});\n\t\tif (parts.length) {\n\t\t\tlet message = updater_reference_link\n\t\t\t\t? get_user_message(\n\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t__(\"You changed the values for {0} {1}\", [\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t__(\"{0} changed the values for {1} {2}\", [\n\t\t\t\t\t\t\tget_user_link(version_doc.owner),\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t])\n\t\t\t\t  )\n\t\t\t\t: get_user_message(\n\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t__(\"You changed the values for {0}\", [parts.join(\", \")]),\n\t\t\t\t\t\t__(\"{0} changed the values for {1}\", [\n\t\t\t\t\t\t\tget_user_link(version_doc.owner),\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t])\n\t\t\t\t  );\n\n\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t}\n\t}\n\n\t// rows added / removed\n\t// __('added'), __('removed') # for translation, don't remove\n\t[\"added\", \"removed\"].forEach(function (key) {\n\t\tif (data[key] && data[key].length) {\n\t\t\tlet parts = (data[key] || []).map(function (p) {\n\t\t\t\tvar df = frappe.meta.get_docfield(frm.doctype, p[0], frm.docname);\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfrm.perm\n\t\t\t\t\t);\n\n\t\t\t\t\tif (field_display_status === \"Read\" || field_display_status === \"Write\") {\n\t\t\t\t\t\treturn __(frappe.meta.get_label(frm.doctype, p[0]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tparts = parts.filter(function (p) {\n\t\t\t\treturn p;\n\t\t\t});\n\t\t\tif (parts.length) {\n\t\t\t\tlet message = \"\";\n\n\t\t\t\tif (key === \"added\") {\n\t\t\t\t\tmessage = __(\"added rows for {0}\", [parts.join(\", \")]);\n\t\t\t\t} else if (key === \"removed\") {\n\t\t\t\t\tmessage = __(\"removed rows for {0}\", [parts.join(\", \")]);\n\t\t\t\t}\n\n\t\t\t\tlet version_comment = get_version_comment(version_doc, message);\n\t\t\t\tlet user_link = get_user_link(version_doc.owner);\n\t\t\t\tout.push(`${user_link} ${version_comment}`);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn out;\n}\n\nfunction get_version_comment(version_doc, text) {\n\t// TODO: Replace with a better solution\n\tif (text.includes(\"<a\")) {\n\t\t// if text already has linked content in it\n\t\t// then just add a version link to unlinked content\n\t\tlet version_comment = \"\";\n\t\tlet unlinked_content = \"\";\n\n\t\ttry {\n\t\t\ttext += \"</>\";\n\t\t\tArray.from($(text)).forEach((element) => {\n\t\t\t\tif ($(element).is(\"a\")) {\n\t\t\t\t\tversion_comment += unlinked_content\n\t\t\t\t\t\t? frappe.utils.get_form_link(\n\t\t\t\t\t\t\t\t\"Version\",\n\t\t\t\t\t\t\t\tversion_doc.name,\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\tunlinked_content\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: \"\";\n\t\t\t\t\tunlinked_content = \"\";\n\t\t\t\t\tversion_comment += element.outerHTML;\n\t\t\t\t} else {\n\t\t\t\t\tunlinked_content += element.outerHTML || element.textContent;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (unlinked_content) {\n\t\t\t\tversion_comment += frappe.utils.get_form_link(\n\t\t\t\t\t\"Version\",\n\t\t\t\t\tversion_doc.name,\n\t\t\t\t\ttrue,\n\t\t\t\t\tunlinked_content\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn version_comment;\n\t\t} catch (e) {\n\t\t\t// pass\n\t\t}\n\t}\n\treturn frappe.utils.get_form_link(\"Version\", version_doc.name, true, text);\n}\n\nfunction format_content_for_timeline(content) {\n\t// text to HTML\n\t// limits content to 40 characters\n\t// escapes HTML\n\t// and makes it bold\n\tcontent = frappe.ellipsis(content, 40) || '\"\"';\n\tcontent = frappe.utils.escape_html(content);\n\treturn content.bold();\n}\n\nfunction get_user_link(user) {\n\tconst user_display_text = frappe.user_info(user).fullname || \"\";\n\treturn frappe.utils.get_form_link(\"User\", user, true, user_display_text);\n}\n\nfunction get_user_message(user, message_self, message_other) {\n\treturn frappe.utils.is_current_user(user) ? message_self : message_other;\n}\n\nexport { get_version_timeline_content, get_user_link, get_user_message };\n", "import \"./assign_to\";\nimport \"./attachments\";\nimport \"./share\";\nimport \"./review\";\nimport \"./document_follow\";\nimport \"./user_image\";\nimport \"./form_sidebar_users\";\nimport { get_user_link, get_user_message } from \"../footer/version_timeline_content_builder\";\n\nfrappe.ui.form.Sidebar = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tmake() {\n\t\tvar sidebar_content = frappe.render_template(\"form_sidebar\", {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tfrm: this.frm,\n\t\t\tcan_write: frappe.model.can_write(this.frm.doctype, this.frm.docname),\n\t\t});\n\n\t\tthis.sidebar = $('<div class=\"form-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.comments = this.sidebar.find(\".form-sidebar-stats .comments\");\n\t\tthis.user_actions = this.sidebar.find(\".user-actions\");\n\t\tthis.image_section = this.sidebar.find(\".sidebar-image-section\");\n\t\tthis.image_wrapper = this.image_section.find(\".sidebar-image-wrapper\");\n\t\tthis.make_assignments();\n\t\tthis.make_attachments();\n\t\tthis.make_review();\n\t\tthis.make_shared();\n\n\t\tthis.make_tags();\n\t\tthis.make_like();\n\t\tthis.make_follow();\n\n\t\tthis.bind_events();\n\t\tthis.setup_keyboard_shortcuts();\n\t\tthis.show_auto_repeat_status();\n\t\tfrappe.ui.form.setup_user_image_event(this.frm);\n\n\t\tthis.refresh();\n\t}\n\n\tbind_events() {\n\t\tvar me = this;\n\n\t\t// scroll to comments\n\t\tthis.comments.on(\"click\", function () {\n\t\t\tfrappe.utils.scroll_to(me.frm.footer.wrapper.find(\".comment-box\"), true);\n\t\t});\n\n\t\tthis.like_icon.on(\"click\", function () {\n\t\t\tfrappe.ui.toggle_like(me.like_wrapper, me.frm.doctype, me.frm.doc.name, function () {\n\t\t\t\tme.refresh_like();\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_keyboard_shortcuts() {\n\t\t// add assignment shortcut\n\t\tlet assignment_link = this.sidebar.find(\".add-assignment\");\n\t\tfrappe.ui.keys.get_shortcut_group(this.page).add(assignment_link);\n\t}\n\n\trefresh() {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.sidebar.toggle(false);\n\t\t\tthis.page.sidebar.addClass(\"hide-sidebar\");\n\t\t} else {\n\t\t\tthis.page.sidebar.removeClass(\"hide-sidebar\");\n\t\t\tthis.sidebar.toggle(true);\n\t\t\tthis.frm.assign_to.refresh();\n\t\t\tthis.frm.attachments.refresh();\n\t\t\tthis.frm.shared.refresh();\n\n\t\t\tthis.frm.tags && this.frm.tags.refresh(this.frm.get_docinfo().tags);\n\n\t\t\tif (this.frm.doc.route && cint(frappe.boot.website_tracking_enabled)) {\n\t\t\t\tlet route = this.frm.doc.route;\n\t\t\t\tfrappe.utils.get_page_view_count(route).then((res) => {\n\t\t\t\t\tthis.sidebar\n\t\t\t\t\t\t.find(\".pageview-count\")\n\t\t\t\t\t\t.html(__(\"{0} Web page views\", [String(res.message).bold()]));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.sidebar\n\t\t\t\t.find(\".modified-by\")\n\t\t\t\t.html(\n\t\t\t\t\tget_user_message(\n\t\t\t\t\t\tthis.frm.doc.modified_by,\n\t\t\t\t\t\t__(\"You last edited this\", null),\n\t\t\t\t\t\t__(\"{0} last edited this\", [get_user_link(this.frm.doc.modified_by)])\n\t\t\t\t\t) +\n\t\t\t\t\t\t\" \u00B7 \" +\n\t\t\t\t\t\tcomment_when(this.frm.doc.modified)\n\t\t\t\t);\n\t\t\tthis.sidebar\n\t\t\t\t.find(\".created-by\")\n\t\t\t\t.html(\n\t\t\t\t\tget_user_message(\n\t\t\t\t\t\tthis.frm.doc.owner,\n\t\t\t\t\t\t__(\"You created this\", null),\n\t\t\t\t\t\t__(\"{0} created this\", [get_user_link(this.frm.doc.owner)])\n\t\t\t\t\t) +\n\t\t\t\t\t\t\" \u00B7 \" +\n\t\t\t\t\t\tcomment_when(this.frm.doc.creation)\n\t\t\t\t);\n\n\t\t\tthis.refresh_like();\n\t\t\tthis.refresh_follow();\n\t\t\tthis.refresh_comments_count();\n\t\t\tfrappe.ui.form.set_user_image(this.frm);\n\t\t}\n\t}\n\n\tshow_auto_repeat_status() {\n\t\tif (this.frm.meta.allow_auto_repeat && this.frm.doc.auto_repeat) {\n\t\t\tconst me = this;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Auto Repeat\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\tname: this.frm.doc.auto_repeat,\n\t\t\t\t\t},\n\t\t\t\t\tfieldname: [\"frequency\"],\n\t\t\t\t},\n\t\t\t\tcallback: function (res) {\n\t\t\t\t\tme.sidebar\n\t\t\t\t\t\t.find(\".auto-repeat-status\")\n\t\t\t\t\t\t.html(__(\"Repeats {0}\", [__(res.message.frequency)]));\n\t\t\t\t\tme.sidebar.find(\".auto-repeat-status\").on(\"click\", function () {\n\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Auto Repeat\", me.frm.doc.auto_repeat);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_tags() {\n\t\tif (this.frm.meta.issingle) {\n\t\t\tthis.sidebar.find(\".form-tags\").toggle(false);\n\t\t\treturn;\n\t\t}\n\n\t\tlet tags_parent = this.sidebar.find(\".form-tags\");\n\n\t\tthis.frm.tags = new frappe.ui.TagEditor({\n\t\t\tparent: tags_parent,\n\t\t\tadd_button: tags_parent.find(\".add-tags-btn\"),\n\t\t\tfrm: this.frm,\n\t\t\ton_change: function (user_tags) {\n\t\t\t\tthis.frm.tags && this.frm.tags.refresh(user_tags);\n\t\t\t},\n\t\t});\n\t}\n\n\tmake_attachments() {\n\t\tvar me = this;\n\t\tthis.frm.attachments = new frappe.ui.form.Attachments({\n\t\t\tparent: me.sidebar.find(\".form-attachments\"),\n\t\t\tfrm: me.frm,\n\t\t});\n\t}\n\n\tmake_assignments() {\n\t\tthis.frm.assign_to = new frappe.ui.form.AssignTo({\n\t\t\tparent: this.sidebar.find(\".form-assignments\"),\n\t\t\tfrm: this.frm,\n\t\t});\n\t}\n\n\tmake_shared() {\n\t\tthis.frm.shared = new frappe.ui.form.Share({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-shared\"),\n\t\t});\n\t}\n\n\tadd_user_action(label, click) {\n\t\treturn $(\"<a>\")\n\t\t\t.html(label)\n\t\t\t.appendTo(\n\t\t\t\t$('<li class=\"user-action-row\">').appendTo(this.user_actions.removeClass(\"hidden\"))\n\t\t\t)\n\t\t\t.on(\"click\", click);\n\t}\n\n\tclear_user_actions() {\n\t\tthis.user_actions.addClass(\"hidden\");\n\t\tthis.user_actions.find(\".user-action-row\").remove();\n\t}\n\n\tmake_like() {\n\t\tthis.like_wrapper = this.sidebar.find(\".liked-by\");\n\t\tthis.like_icon = this.sidebar.find(\".liked-by .like-icon\");\n\t\tthis.like_count = this.sidebar.find(\".liked-by .like-count\");\n\t\tfrappe.ui.setup_like_popover(this.sidebar.find(\".form-stats-likes\"), \".like-icon\");\n\t}\n\n\tmake_follow() {\n\t\tthis.follow_button = this.sidebar.find(\".form-sidebar-stats .form-follow\");\n\n\t\tthis.follow_button.on(\"click\", () => {\n\t\t\tlet is_followed = this.frm.get_docinfo().is_document_followed;\n\t\t\tfrappe\n\t\t\t\t.call(\"frappe.desk.form.document_follow.update_follow\", {\n\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\tdoc_name: this.frm.doc.name,\n\t\t\t\t\tfollowing: !is_followed,\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.model.set_docinfo(\n\t\t\t\t\t\tthis.frm.doctype,\n\t\t\t\t\t\tthis.frm.doc.name,\n\t\t\t\t\t\t\"is_document_followed\",\n\t\t\t\t\t\t!is_followed\n\t\t\t\t\t);\n\t\t\t\t\tthis.refresh_follow(!is_followed);\n\t\t\t\t});\n\t\t});\n\t}\n\n\trefresh_follow(follow) {\n\t\tif (follow == null) {\n\t\t\tfollow = this.frm.get_docinfo().is_document_followed;\n\t\t}\n\t\tthis.follow_button.text(follow ? __(\"Unfollow\") : __(\"Follow\"));\n\t}\n\n\trefresh_like() {\n\t\tif (!this.like_icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.like_wrapper.attr(\"data-liked-by\", this.frm.doc._liked_by);\n\t\tconst liked = frappe.ui.is_liked(this.frm.doc);\n\t\tthis.like_wrapper\n\t\t\t.toggleClass(\"not-liked\", !liked)\n\t\t\t.toggleClass(\"liked\", liked)\n\t\t\t.attr(\"data-doctype\", this.frm.doctype)\n\t\t\t.attr(\"data-name\", this.frm.doc.name);\n\n\t\tthis.like_count && this.like_count.text(JSON.parse(this.frm.doc._liked_by || \"[]\").length);\n\t}\n\n\trefresh_comments_count() {\n\t\tlet count = (this.frm.get_docinfo().comments || []).length;\n\t\tthis.comments.find(\".comments-count\").html(count);\n\t}\n\n\trefresh_image() {}\n\n\tmake_review() {\n\t\tconst review_wrapper = this.sidebar.find(\".form-reviews\");\n\t\tif (frappe.boot.energy_points_enabled && !this.frm.is_new()) {\n\t\t\tthis.frm.reviews = new frappe.ui.form.Review({\n\t\t\t\tparent: review_wrapper,\n\t\t\t\tfrm: this.frm,\n\t\t\t});\n\t\t} else {\n\t\t\treview_wrapper.remove();\n\t\t}\n\t}\n\n\treload_docinfo(callback) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.form.load.get_docinfo\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\t// docinfo will be synced\n\t\t\t\tif (callback) callback(r.docinfo);\n\t\t\t\tthis.frm.timeline && this.frm.timeline.refresh();\n\t\t\t\tthis.frm.assign_to.refresh();\n\t\t\t\tthis.frm.attachments.refresh();\n\t\t\t},\n\t\t});\n\t}\n};\n", "// Copyright (c) 2020, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nclass BaseTimeline {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.timeline_wrapper = $(`<div class=\"new-timeline\">`);\n\t\tthis.wrapper = this.timeline_wrapper;\n\t\tthis.timeline_items_wrapper = $(`<div class=\"timeline-items\">`);\n\t\tthis.timeline_actions_wrapper = $(`\n\t\t\t<div class=\"timeline-items timeline-actions\">\n\t\t\t\t<div class=\"timeline-item\">\n\t\t\t\t\t<div class=\"timeline-content action-buttons\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.timeline_wrapper.append(this.timeline_actions_wrapper);\n\t\tthis.timeline_actions_wrapper.hide();\n\t\tthis.timeline_wrapper.append(this.timeline_items_wrapper);\n\n\t\tthis.parent.replaceWith(this.timeline_wrapper);\n\t\tthis.timeline_items = [];\n\t}\n\n\trefresh() {\n\t\tthis.render_timeline_items();\n\t}\n\n\tadd_action_button(label, action, icon = null, btn_class = null) {\n\t\tlet icon_element = icon ? frappe.utils.icon(icon, \"xs\") : null;\n\t\tthis.timeline_actions_wrapper.show();\n\t\tlet action_btn = $(`<button class=\"btn btn-xs ${btn_class || \"btn-default\"} action-btn\">\n\t\t\t${icon_element}\n\t\t\t${label}\n\t\t</button>`);\n\t\taction_btn.click(action);\n\t\tthis.timeline_actions_wrapper.find(\".action-buttons\").append(action_btn);\n\t\treturn action_btn;\n\t}\n\n\trender_timeline_items() {\n\t\tthis.timeline_items_wrapper.empty();\n\t\tthis.timeline_items = [];\n\t\tthis.doc_info = (this.frm && this.frm.get_docinfo()) || {};\n\t\tlet response = this.prepare_timeline_contents();\n\t\tif (response instanceof Promise) {\n\t\t\tresponse.then(() => {\n\t\t\t\tthis.timeline_items.sort(\n\t\t\t\t\t(item1, item2) => new Date(item2.creation) - new Date(item1.creation)\n\t\t\t\t);\n\t\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t\t});\n\t\t} else {\n\t\t\tthis.timeline_items.sort(\n\t\t\t\t(item1, item2) => new Date(item2.creation) - new Date(item1.creation)\n\t\t\t);\n\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t}\n\t}\n\n\tprepare_timeline_contents() {\n\t\t//\n\t}\n\n\tadd_timeline_item(item, append_at_the_end = false) {\n\t\tlet timeline_item = this.get_timeline_item(item);\n\t\tif (append_at_the_end) {\n\t\t\tthis.timeline_items_wrapper.append(timeline_item);\n\t\t} else {\n\t\t\tthis.timeline_items_wrapper.prepend(timeline_item);\n\t\t}\n\t\treturn timeline_item;\n\t}\n\n\tadd_timeline_items(items, append_at_the_end = false) {\n\t\titems.forEach((item) => this.add_timeline_item(item, append_at_the_end));\n\t}\n\n\tadd_timeline_items_based_on_creation(items) {\n\t\titems.forEach((item) => {\n\t\t\tthis.timeline_items_wrapper.find(\".timeline-item\").each((i, el) => {\n\t\t\t\tlet creation = $(el).attr(\"data-timestamp\");\n\t\t\t\tif (creation && new Date(creation) < new Date(item.creation)) {\n\t\t\t\t\t$(el).before(this.get_timeline_item(item));\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_timeline_item(item) {\n\t\t// item can have content*, creation*,\n\t\t// timeline_badge, icon, icon_size,\n\t\t// hide_timestamp, is_card\n\t\tconst timeline_item = $(`<div class=\"timeline-item\">`);\n\n\t\tif (item.name == \"load-more\") {\n\t\t\ttimeline_item.append(\n\t\t\t\t`<div class=\"timeline-load-more\">\n\t\t\t\t\t<button class=\"btn btn-default btn-sm btn-load-more\">\n\t\t\t\t\t\t<span>${item.content}</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>`\n\t\t\t);\n\t\t\ttimeline_item.find(\".btn-load-more\").on(\"click\", async () => {\n\t\t\t\tlet more_items = await this.get_more_communication_timeline_contents();\n\t\t\t\ttimeline_item.remove();\n\t\t\t\tthis.add_timeline_items_based_on_creation(more_items);\n\t\t\t});\n\t\t\treturn timeline_item;\n\t\t}\n\n\t\ttimeline_item.attr({\n\t\t\t\"data-doctype\": item.doctype,\n\t\t\t\"data-name\": item.name,\n\t\t\t\"data-timestamp\": item.creation,\n\t\t});\n\t\tif (item.icon) {\n\t\t\ttimeline_item.append(`\n\t\t\t\t<div class=\"timeline-badge\" title='${item.title || frappe.utils.to_title_case(item.icon)}'>\n\t\t\t\t\t${frappe.utils.icon(item.icon, item.icon_size || \"md\", item.icon_class || \"\")}\n\t\t\t\t</div>\n\t\t\t`);\n\t\t} else if (item.timeline_badge) {\n\t\t\ttimeline_item.append(item.timeline_badge);\n\t\t} else {\n\t\t\ttimeline_item.append(`<div class=\"timeline-dot\">`);\n\t\t}\n\n\t\ttimeline_item.append(\n\t\t\t`<div class=\"timeline-content ${item.is_card ? \"frappe-card\" : \"\"}\">`\n\t\t);\n\t\tlet timeline_content = timeline_item.find(\".timeline-content\");\n\t\ttimeline_content.append(item.content);\n\t\tif (!item.hide_timestamp && !item.is_card) {\n\t\t\ttimeline_content.append(`<span> \u00B7 ${comment_when(item.creation)}</span>`);\n\t\t}\n\t\tif (item.id) {\n\t\t\ttimeline_content.attr(\"id\", item.id);\n\t\t}\n\n\t\treturn timeline_item;\n\t}\n}\n\nexport default BaseTimeline;\n", "// Copyright (c) 2020, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport BaseTimeline from \"./base_timeline\";\nimport {\n\tget_version_timeline_content,\n\tget_user_link,\n\tget_user_message,\n} from \"./version_timeline_content_builder\";\n\nclass FormTimeline extends BaseTimeline {\n\tmake() {\n\t\tsuper.make();\n\t\tthis.setup_timeline_actions();\n\t\tthis.render_timeline_items();\n\t\tthis.setup_activity_toggle();\n\t}\n\n\trefresh() {\n\t\tsuper.refresh();\n\t\tthis.frm.trigger(\"timeline_refresh\");\n\t\tthis.setup_document_email_link();\n\t}\n\n\tsetup_timeline_actions() {\n\t\tthis.add_action_button(\n\t\t\t__(\"New Email\"),\n\t\t\t() => this.compose_mail(),\n\t\t\t\"es-line-add\",\n\t\t\t\"btn-secondary\"\n\t\t);\n\t\tthis.setup_new_event_button();\n\t}\n\n\tsetup_new_event_button() {\n\t\tif (this.frm.meta.allow_events_in_timeline) {\n\t\t\tlet create_event = () => {\n\t\t\t\tconst args = {\n\t\t\t\t\tdoc: this.frm.doc,\n\t\t\t\t\tfrm: this.frm,\n\t\t\t\t\trecipients: this.get_recipient(),\n\t\t\t\t\ttxt: frappe.markdown(this.frm.comment_box.get_value()),\n\t\t\t\t};\n\t\t\t\treturn new frappe.views.InteractionComposer(args);\n\t\t\t};\n\t\t\tthis.add_action_button(__(\"New Event\"), create_event, \"calendar\");\n\t\t}\n\t}\n\n\tsetup_activity_toggle() {\n\t\tlet doc_info = this.doc_info || this.frm.get_docinfo();\n\t\tlet has_communications = () => {\n\t\t\tlet communications = doc_info.communications;\n\t\t\tlet comments = doc_info.comments;\n\t\t\treturn (communications || []).length || (comments || []).length;\n\t\t};\n\t\tlet me = this;\n\t\tthis.timeline_wrapper.remove(this.timeline_actions_wrapper);\n\t\tthis.timeline_wrapper.prepend(`\n\t\t\t\t<div class=\"timeline-item activity-title\">\n\t\t\t\t<h4>${__(\"Activity\")}</h4>\n\t\t\t\t</div>\n\t\t\t`);\n\t\tif (has_communications()) {\n\t\t\tthis.timeline_wrapper\n\t\t\t\t.find(\".timeline-item.activity-title\")\n\t\t\t\t.append(\n\t\t\t\t\t`\n\t\t\t\t\t<div class=\"d-flex align-items-center show-all-activity\">\n\t\t\t\t\t\t<span style=\"color: var(--text-light); margin:0px 6px;\">${__(\"Show all activity\")}</span>\n\t\t\t\t\t\t<label class=\"switch\">\n\t\t\t\t\t\t\t<input type=\"checkbox\">\n\t\t\t\t\t\t\t<span class=\"slider round\"></span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t\t)\n\t\t\t\t.find(\"input[type=checkbox]\")\n\t\t\t\t.prop(\"checked\", !me.only_communication)\n\t\t\t\t.on(\"click\", function (e) {\n\t\t\t\t\tme.only_communication = !this.checked;\n\t\t\t\t\tme.render_timeline_items();\n\t\t\t\t\t$(this).tab(\"show\");\n\t\t\t\t});\n\t\t}\n\t\tthis.timeline_wrapper\n\t\t\t.find(\".timeline-item.activity-title\")\n\t\t\t.append(this.timeline_actions_wrapper);\n\t}\n\n\tsetup_document_email_link() {\n\t\tlet doc_info = this.doc_info || this.frm.get_docinfo();\n\n\t\tthis.document_email_link_wrapper && this.document_email_link_wrapper.remove();\n\n\t\tif (doc_info.document_email) {\n\t\t\tconst link = `<a class=\"document-email-link\">${doc_info.document_email}</a>`;\n\t\t\tconst message = __(\"Add to this activity by mailing to {0}\", [link.bold()]);\n\n\t\t\tthis.document_email_link_wrapper = $(`\n\t\t\t\t<div class=\"timeline-item\">\n\t\t\t\t\t<div class=\"timeline-dot\"></div>\n\t\t\t\t\t<div class=\"timeline-content\">\n\t\t\t\t\t\t<span>${message}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.timeline_items_wrapper.before(this.document_email_link_wrapper);\n\n\t\t\tthis.document_email_link_wrapper.find(\".document-email-link\").on(\"click\", (e) => {\n\t\t\t\tlet text = $(e.target).text();\n\t\t\t\tfrappe.utils.copy_to_clipboard(text);\n\t\t\t});\n\t\t}\n\t}\n\n\trender_timeline_items() {\n\t\tsuper.render_timeline_items();\n\t\tthis.add_web_page_view_count();\n\t\tfrappe.utils.bind_actions_with_object(this.timeline_items_wrapper, this);\n\t}\n\n\tadd_web_page_view_count() {\n\t\tif (this.frm.doc.route && cint(frappe.boot.website_tracking_enabled)) {\n\t\t\tfrappe.utils.get_page_view_count(this.frm.doc.route).then((res) => {\n\t\t\t\tthis.add_timeline_item({\n\t\t\t\t\tcontent: __(\"{0} Web page views\", [res.message]),\n\t\t\t\t\thide_timestamp: true,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tget_creation_message() {\n\t\treturn {\n\t\t\tcreation: this.frm.doc.creation,\n\t\t\tcontent: get_user_message(\n\t\t\t\tthis.frm.doc.owner,\n\t\t\t\t__(\"You created this\"),\n\t\t\t\t__(\"{0} created this\", [get_user_link(this.frm.doc.owner)])\n\t\t\t),\n\t\t};\n\t}\n\n\tget_modified_message() {\n\t\treturn {\n\t\t\tcreation: this.frm.doc.modified,\n\t\t\tcontent: get_user_message(\n\t\t\t\tthis.frm.doc.modified_by,\n\t\t\t\t__(\"You last edited this\"),\n\t\t\t\t__(\"{0} last edited this\", [get_user_link(this.frm.doc.modified_by)])\n\t\t\t),\n\t\t};\n\t}\n\n\tprepare_timeline_contents() {\n\t\tthis.timeline_items.push(this.get_creation_message());\n\t\tthis.timeline_items.push(this.get_modified_message());\n\t\tthis.timeline_items.push(...this.get_communication_timeline_contents());\n\t\tthis.timeline_items.push(...this.get_comment_timeline_contents());\n\t\tif (!this.only_communication) {\n\t\t\tthis.timeline_items.push(...this.get_view_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_energy_point_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_version_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_share_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_workflow_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_like_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_custom_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_assignment_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_attachment_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_info_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_milestone_timeline_contents());\n\t\t}\n\t}\n\n\tget_view_timeline_contents() {\n\t\tlet view_timeline_contents = [];\n\t\t(this.doc_info.views || []).forEach((view) => {\n\t\t\tview_timeline_contents.push({\n\t\t\t\tcreation: view.creation,\n\t\t\t\tcontent: get_user_message(\n\t\t\t\t\tview.owner,\n\t\t\t\t\t__(\"You viewed this\"),\n\t\t\t\t\t__(\"{0} viewed this\", [get_user_link(view.owner)])\n\t\t\t\t),\n\t\t\t});\n\t\t});\n\n\t\treturn view_timeline_contents;\n\t}\n\n\tget_communication_timeline_contents(more_communications, more_automated_messages) {\n\t\tlet email_communications =\n\t\t\tthis.get_email_communication_timeline_contents(more_communications);\n\t\tlet automated_messages = this.get_auto_messages_timeline_contents(more_automated_messages);\n\t\tlet all_communications = email_communications.concat(automated_messages);\n\n\t\tif (all_communications.length > 20) {\n\t\t\tall_communications.pop();\n\n\t\t\tif (more_communications || more_automated_messages) {\n\t\t\t\tall_communications.forEach((message) => {\n\t\t\t\t\tif (message.communication_type == \"Automated Message\") {\n\t\t\t\t\t\tthis.doc_info.automated_messages.push(message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.doc_info.communications.push(message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet last_communication_time =\n\t\t\t\tall_communications[all_communications.length - 1].creation;\n\t\t\tlet load_more_button = {\n\t\t\t\tcreation: last_communication_time,\n\t\t\t\tcontent: __(\"Load More Communications\", null, \"Form timeline\"),\n\t\t\t\tname: \"load-more\",\n\t\t\t};\n\t\t\tall_communications.push(load_more_button);\n\t\t}\n\n\t\treturn all_communications;\n\t}\n\n\tget_email_communication_timeline_contents(more_items) {\n\t\tlet communication_timeline_contents = [];\n\t\tlet icon_set = {\n\t\t\tEmail: \"mail\",\n\t\t\tPhone: \"call\",\n\t\t\tMeeting: \"calendar\",\n\t\t\tOther: \"dot-horizontal\",\n\t\t};\n\t\tlet items = more_items ? more_items : this.doc_info.communications || [];\n\t\titems.forEach((communication) => {\n\t\t\tlet medium = communication.communication_medium;\n\t\t\tcommunication_timeline_contents.push({\n\t\t\t\ticon: icon_set[medium],\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: communication.creation,\n\t\t\t\tis_card: true,\n\t\t\t\tcontent: this.get_communication_timeline_content(communication),\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tid: `communication-${communication.name}`,\n\t\t\t\tname: communication.name,\n\t\t\t});\n\t\t});\n\n\t\treturn communication_timeline_contents;\n\t}\n\n\tasync get_more_communication_timeline_contents() {\n\t\tlet more_items = [];\n\t\tlet start =\n\t\t\tthis.doc_info.communications.length + this.doc_info.automated_messages.length - 1;\n\t\tlet response = await frappe.call({\n\t\t\tmethod: \"frappe.desk.form.load.get_communications\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.doc_info.doctype,\n\t\t\t\tname: this.doc_info.name,\n\t\t\t\tstart: start,\n\t\t\t\tlimit: 21,\n\t\t\t},\n\t\t});\n\t\tif (response.message) {\n\t\t\tlet email_communications = [];\n\t\t\tlet automated_messages = [];\n\t\t\tresponse.message.forEach((message) => {\n\t\t\t\tif (message.communication_type == \"Automated Message\") {\n\t\t\t\t\tautomated_messages.push(message);\n\t\t\t\t} else {\n\t\t\t\t\temail_communications.push(message);\n\t\t\t\t}\n\t\t\t});\n\t\t\tmore_items = this.get_communication_timeline_contents(\n\t\t\t\temail_communications,\n\t\t\t\tautomated_messages\n\t\t\t);\n\t\t}\n\t\treturn more_items;\n\t}\n\n\tget_communication_timeline_content(doc, allow_reply = true) {\n\t\tdoc._url = frappe.utils.get_form_link(\"Communication\", doc.name);\n\t\tthis.set_communication_doc_status(doc);\n\t\tif (doc.attachments && typeof doc.attachments === \"string\") {\n\t\t\tdoc.attachments = JSON.parse(doc.attachments);\n\t\t}\n\t\tdoc.owner = doc.sender;\n\t\tdoc.user_full_name = doc.sender_full_name;\n\t\tdoc.content = frappe.dom.remove_script_and_style(doc.content);\n\t\tlet communication_content = $(frappe.render_template(\"timeline_message_box\", { doc }));\n\t\tif (allow_reply) {\n\t\t\tthis.setup_reply(communication_content, doc);\n\t\t}\n\t\treturn communication_content;\n\t}\n\n\tset_communication_doc_status(doc) {\n\t\tlet indicator_color = \"red\";\n\t\tif ([\"Sent\", \"Clicked\"].includes(doc.delivery_status)) {\n\t\t\tindicator_color = \"green\";\n\t\t} else if ([\"Sending\", \"Scheduled\"].includes(doc.delivery_status)) {\n\t\t\tindicator_color = \"orange\";\n\t\t} else if ([\"Opened\", \"Read\"].includes(doc.delivery_status)) {\n\t\t\tindicator_color = \"blue\";\n\t\t} else if (doc.delivery_status == \"Error\") {\n\t\t\tindicator_color = \"red\";\n\t\t}\n\t\tdoc._doc_status = doc.delivery_status;\n\t\tdoc._doc_status_indicator = indicator_color;\n\t}\n\n\tget_auto_messages_timeline_contents(more_items) {\n\t\tlet auto_messages_timeline_contents = [];\n\t\tlet items = more_items ? more_items : this.doc_info.automated_messages || [];\n\t\titems.forEach((message) => {\n\t\t\tauto_messages_timeline_contents.push({\n\t\t\t\ticon: \"notification\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: message.creation,\n\t\t\t\tis_card: true,\n\t\t\t\tcontent: this.get_communication_timeline_content(message, false),\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tname: message.name,\n\t\t\t});\n\t\t});\n\t\treturn auto_messages_timeline_contents;\n\t}\n\n\tget_comment_timeline_contents() {\n\t\tlet comment_timeline_contents = [];\n\t\t(this.doc_info.comments || []).forEach((comment) => {\n\t\t\tcomment_timeline_contents.push(this.get_comment_timeline_item(comment));\n\t\t});\n\t\treturn comment_timeline_contents;\n\t}\n\n\tget_comment_timeline_item(comment) {\n\t\treturn {\n\t\t\ticon: \"es-line-chat-alt\",\n\t\t\ticon_size: \"sm\",\n\t\t\tcreation: comment.creation,\n\t\t\tis_card: true,\n\t\t\tdoctype: \"Comment\",\n\t\t\tid: `comment-${comment.name}`,\n\t\t\tname: comment.name,\n\t\t\tcontent: this.get_comment_timeline_content(comment),\n\t\t};\n\t}\n\n\tget_comment_timeline_content(doc) {\n\t\tdoc.content = frappe.dom.remove_script_and_style(doc.content);\n\t\tconst comment_content = $(frappe.render_template(\"timeline_message_box\", { doc }));\n\t\tthis.setup_comment_actions(comment_content, doc);\n\t\treturn comment_content;\n\t}\n\n\tget_version_timeline_contents() {\n\t\tlet version_timeline_contents = [];\n\t\t(this.doc_info.versions || []).forEach((version) => {\n\t\t\tconst contents = get_version_timeline_content(version, this.frm);\n\t\t\tcontents.forEach((content) => {\n\t\t\t\tversion_timeline_contents.push({\n\t\t\t\t\tcreation: version.creation,\n\t\t\t\t\tcontent: content,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\treturn version_timeline_contents;\n\t}\n\n\tget_share_timeline_contents() {\n\t\tlet share_timeline_contents = [];\n\t\t(this.doc_info.share_logs || []).forEach((share_log) => {\n\t\t\tshare_timeline_contents.push({\n\t\t\t\tcreation: share_log.creation,\n\t\t\t\tcontent: share_log.content,\n\t\t\t});\n\t\t});\n\t\treturn share_timeline_contents;\n\t}\n\n\tget_assignment_timeline_contents() {\n\t\tlet assignment_timeline_contents = [];\n\t\t(this.doc_info.assignment_logs || []).forEach((assignment_log) => {\n\t\t\tassignment_timeline_contents.push({\n\t\t\t\tcreation: assignment_log.creation,\n\t\t\t\tcontent: assignment_log.content,\n\t\t\t});\n\t\t});\n\t\treturn assignment_timeline_contents;\n\t}\n\n\tget_info_timeline_contents() {\n\t\tlet info_timeline_contents = [];\n\t\t(this.doc_info.info_logs || []).forEach((info_log) => {\n\t\t\tinfo_timeline_contents.push({\n\t\t\t\tcreation: info_log.creation,\n\t\t\t\tcontent: `${get_user_link(info_log.owner)} ${info_log.content}`,\n\t\t\t});\n\t\t});\n\t\treturn info_timeline_contents;\n\t}\n\n\tget_attachment_timeline_contents() {\n\t\tlet attachment_timeline_contents = [];\n\n\t\t(this.doc_info.attachment_logs || []).forEach((attachment_log) => {\n\t\t\tconst is_file_upload = attachment_log.comment_type == \"Attachment\";\n\t\t\tconst user_link = get_user_link(attachment_log.owner);\n\t\t\tconst filename = attachment_log.content;\n\t\t\tconst timeline_content = is_file_upload\n\t\t\t\t? get_user_message(\n\t\t\t\t\t\tattachment_log.owner,\n\t\t\t\t\t\t__(\"You attached {0}\", [filename], \"Form timeline\"),\n\t\t\t\t\t\t__(\"{0} attached {1}\", [user_link, filename], \"Form timeline\")\n\t\t\t\t  )\n\t\t\t\t: get_user_message(\n\t\t\t\t\t\tattachment_log.owner,\n\t\t\t\t\t\t__(\"You removed attachment {0}\", [filename], \"Form timeline\"),\n\t\t\t\t\t\t__(\"{0} removed attachment {1}\", [user_link, filename], \"Form timeline\")\n\t\t\t\t  );\n\n\t\t\tattachment_timeline_contents.push({\n\t\t\t\ticon: is_file_upload ? \"es-line-attachment\" : \"es-line-delete\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: attachment_log.creation,\n\t\t\t\tcontent: timeline_content,\n\t\t\t});\n\t\t});\n\n\t\treturn attachment_timeline_contents;\n\t}\n\n\tget_milestone_timeline_contents() {\n\t\tlet milestone_timeline_contents = [];\n\n\t\t(this.doc_info.milestones || []).forEach((milestone_log) => {\n\t\t\tconst field = frappe.meta.get_label(this.frm.doctype, milestone_log.track_field);\n\t\t\tconst value = milestone_log.value.bold();\n\t\t\tconst user_link = get_user_link(milestone_log.owner);\n\t\t\tconst timeline_content = get_user_message(\n\t\t\t\tmilestone_log.owner,\n\t\t\t\t__(\"You changed {0} to {1}\", [field, value], \"Form timeline\"),\n\t\t\t\t__(\"{0} changed {1} to {2}\", [user_link, field, value], \"Form timeline\")\n\t\t\t);\n\n\t\t\tmilestone_timeline_contents.push({\n\t\t\t\ticon: \"milestone\",\n\t\t\t\tcreation: milestone_log.creation,\n\t\t\t\tcontent: timeline_content,\n\t\t\t});\n\t\t});\n\n\t\treturn milestone_timeline_contents;\n\t}\n\n\tget_like_timeline_contents() {\n\t\tlet like_timeline_contents = [];\n\n\t\t(this.doc_info.like_logs || []).forEach((like_log) => {\n\t\t\tconst timeline_content = get_user_message(\n\t\t\t\tlike_log.owner,\n\t\t\t\t__(\"You Liked\"),\n\t\t\t\t__(\"{0} Liked\", [get_user_link(like_log.owner)])\n\t\t\t);\n\n\t\t\tlike_timeline_contents.push({\n\t\t\t\ticon: \"es-line-like\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: like_log.creation,\n\t\t\t\tcontent: timeline_content,\n\t\t\t\ttitle: \"Like\",\n\t\t\t});\n\t\t});\n\n\t\treturn like_timeline_contents;\n\t}\n\n\tget_workflow_timeline_contents() {\n\t\tlet workflow_timeline_contents = [];\n\t\t(this.doc_info.workflow_logs || []).forEach((workflow_log) => {\n\t\t\tworkflow_timeline_contents.push({\n\t\t\t\ticon: \"branch\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: workflow_log.creation,\n\t\t\t\tcontent: `${get_user_link(workflow_log.owner)} ${__(workflow_log.content)}`,\n\t\t\t\ttitle: \"Workflow\",\n\t\t\t});\n\t\t});\n\t\treturn workflow_timeline_contents;\n\t}\n\n\tget_custom_timeline_contents() {\n\t\tlet custom_timeline_contents = [];\n\t\t(this.doc_info.additional_timeline_content || []).forEach((custom_item) => {\n\t\t\tcustom_timeline_contents.push({\n\t\t\t\ticon: custom_item.icon,\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tis_card: custom_item.is_card,\n\t\t\t\tcreation: custom_item.creation,\n\t\t\t\tcontent:\n\t\t\t\t\tcustom_item.content ||\n\t\t\t\t\tfrappe.render_template(custom_item.template, custom_item.template_data),\n\t\t\t});\n\t\t});\n\t\treturn custom_timeline_contents;\n\t}\n\n\tget_energy_point_timeline_contents() {\n\t\tlet energy_point_timeline_contents = [];\n\t\t(this.doc_info.energy_point_logs || []).forEach((log) => {\n\t\t\tlet timeline_badge = `\n\t\t\t<div class=\"timeline-badge ${log.points > 0 ? \"appreciation\" : \"criticism\"} bold\">\n\t\t\t\t${log.points}\n\t\t\t</div>`;\n\n\t\t\tenergy_point_timeline_contents.push({\n\t\t\t\ttimeline_badge: timeline_badge,\n\t\t\t\tcreation: log.creation,\n\t\t\t\tcontent: frappe.energy_points.format_form_log(log),\n\t\t\t});\n\t\t});\n\t\treturn energy_point_timeline_contents;\n\t}\n\n\tsetup_reply(communication_box, communication_doc) {\n\t\tlet actions = communication_box.find(\".custom-actions\");\n\t\tlet reply = $(`<a class=\"action-btn reply\">${frappe.utils.icon(\"reply\", \"md\")}</a>`).click(\n\t\t\t() => {\n\t\t\t\tthis.compose_mail(communication_doc);\n\t\t\t}\n\t\t);\n\t\tlet reply_all = $(\n\t\t\t`<a class=\"action-btn reply-all\">${frappe.utils.icon(\"reply-all\", \"md\")}</a>`\n\t\t).click(() => {\n\t\t\tthis.compose_mail(communication_doc, true);\n\t\t});\n\t\tactions.append(reply);\n\t\tactions.append(reply_all);\n\t}\n\n\tcompose_mail(communication_doc = null, reply_all = false) {\n\t\tconst args = {\n\t\t\tdoc: this.frm.doc,\n\t\t\tfrm: this.frm,\n\t\t\trecipients:\n\t\t\t\tcommunication_doc && communication_doc.sender != frappe.session.user_email\n\t\t\t\t\t? communication_doc.sender\n\t\t\t\t\t: this.get_recipient(),\n\t\t\tis_a_reply: Boolean(communication_doc),\n\t\t\ttitle: communication_doc ? __(\"Reply\") : null,\n\t\t\tlast_email: communication_doc,\n\t\t\tsubject: communication_doc && communication_doc.subject,\n\t\t\treply_all: reply_all,\n\t\t};\n\n\t\tconst email_accounts = frappe.boot.email_accounts\n\t\t\t.filter((account) => {\n\t\t\t\treturn (\n\t\t\t\t\t![\"All Accounts\", \"Sent\", \"Spam\", \"Trash\"].includes(account.email_account) &&\n\t\t\t\t\taccount.enable_outgoing\n\t\t\t\t);\n\t\t\t})\n\t\t\t.map((e) => e.email_id);\n\n\t\tif (communication_doc && args.is_a_reply) {\n\t\t\targs.cc = \"\";\n\t\t\tif (\n\t\t\t\temail_accounts.includes(frappe.session.user_email) &&\n\t\t\t\tcommunication_doc.sender != frappe.session.user_email\n\t\t\t) {\n\t\t\t\t// add recipients to cc if replying sender is different from last email\n\t\t\t\tconst recipients = communication_doc.recipients.split(\",\").map((r) => r.trim());\n\t\t\t\targs.cc =\n\t\t\t\t\trecipients.filter((r) => r != frappe.session.user_email).join(\", \") + \", \";\n\t\t\t}\n\t\t\tif (reply_all) {\n\t\t\t\t// if reply_all then add cc and bcc as well.\n\t\t\t\targs.cc += communication_doc.cc;\n\t\t\t\targs.bcc = communication_doc.bcc;\n\t\t\t}\n\t\t}\n\n\t\tif (this.frm.doctype === \"Communication\") {\n\t\t\targs.message = \"\";\n\t\t\targs.last_email = this.frm.doc;\n\t\t\targs.recipients = this.frm.doc.sender;\n\t\t\targs.subject = __(\"Re: {0}\", [this.frm.doc.subject]);\n\t\t} else {\n\t\t\tconst comment_value = frappe.markdown(this.frm.comment_box.get_value());\n\t\t\targs.message = strip_html(comment_value) ? comment_value : \"\";\n\t\t}\n\n\t\tnew frappe.views.CommunicationComposer(args);\n\t}\n\n\tget_recipient() {\n\t\tif (this.frm.email_field) {\n\t\t\treturn this.frm.doc[this.frm.email_field];\n\t\t} else {\n\t\t\treturn this.frm.doc.email_id || this.frm.doc.email || \"\";\n\t\t}\n\t}\n\n\tsetup_comment_actions(comment_wrapper, doc) {\n\t\tlet edit_wrapper = $(`<div class=\"comment-edit-box\">`).hide();\n\t\tlet edit_box = this.make_editable(edit_wrapper);\n\t\tlet content_wrapper = comment_wrapper.find(\".content\");\n\t\tlet more_actions_wrapper = comment_wrapper.find(\".more-actions\");\n\t\tif (\n\t\t\tfrappe.model.can_delete(\"Comment\") &&\n\t\t\t(frappe.session.user == doc.owner || frappe.user.has_role(\"System Manager\"))\n\t\t) {\n\t\t\tconst delete_option = $(`\n\t\t\t\t<li>\n\t\t\t\t\t<a class=\"dropdown-item\">\n\t\t\t\t\t\t${__(\"Delete\")}\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t`).click(() => this.delete_comment(doc.name));\n\t\t\tmore_actions_wrapper.find(\".dropdown-menu\").append(delete_option);\n\t\t}\n\n\t\tlet dismiss_button = $(`\n\t\t\t<button class=\"btn btn-link action-btn\">\n\t\t\t\t${__(\"Dismiss\")}\n\t\t\t</button>\n\t\t`).click(() => edit_button.toggle_edit_mode());\n\t\tdismiss_button.hide();\n\n\t\tedit_box.set_value(doc.content);\n\n\t\tedit_box.on_submit = (value) => {\n\t\t\tcontent_wrapper.empty();\n\t\t\tcontent_wrapper.append(value);\n\t\t\tedit_button.prop(\"disabled\", true);\n\t\t\tedit_box.quill.enable(false);\n\n\t\t\tdoc.content = value;\n\t\t\tthis.update_comment(doc.name, value)\n\t\t\t\t.then(edit_button.toggle_edit_mode)\n\t\t\t\t.finally(() => {\n\t\t\t\t\tedit_button.prop(\"disabled\", false);\n\t\t\t\t\tedit_box.quill.enable(true);\n\t\t\t\t});\n\t\t};\n\n\t\tcontent_wrapper.after(edit_wrapper);\n\n\t\tlet edit_button = $();\n\t\tlet current_user = frappe.session.user;\n\t\tif ([\"Administrator\", doc.owner].includes(current_user)) {\n\t\t\tedit_button = $(`<button class=\"btn btn-link action-btn\">${__(\"Edit\")}</a>`).click(\n\t\t\t\t() => {\n\t\t\t\t\tedit_button.edit_mode ? edit_box.submit() : edit_button.toggle_edit_mode();\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tedit_button.toggle_edit_mode = () => {\n\t\t\tedit_button.edit_mode = !edit_button.edit_mode;\n\t\t\tedit_button.text(edit_button.edit_mode ? __(\"Save\") : __(\"Edit\"));\n\t\t\tmore_actions_wrapper.toggle(!edit_button.edit_mode);\n\t\t\tdismiss_button.toggle(edit_button.edit_mode);\n\t\t\tedit_wrapper.toggle(edit_button.edit_mode);\n\t\t\tcontent_wrapper.toggle(!edit_button.edit_mode);\n\t\t};\n\t\tlet actions_wrapper = comment_wrapper.find(\".custom-actions\");\n\t\tactions_wrapper.append(edit_button);\n\t\tactions_wrapper.append(dismiss_button);\n\t}\n\n\tmake_editable(container) {\n\t\treturn frappe.ui.form.make_control({\n\t\t\tparent: container,\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Comment\",\n\t\t\t\tfieldname: \"comment\",\n\t\t\t\tlabel: \"Comment\",\n\t\t\t},\n\t\t\tenable_mentions: true,\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tno_wrapper: true,\n\t\t});\n\t}\n\n\tupdate_comment(name, content) {\n\t\treturn frappe\n\t\t\t.xcall(\"frappe.desk.form.utils.update_comment\", { name, content })\n\t\t\t.then(() => {\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t});\n\t}\n\n\tget_last_email(from_recipient) {\n\t\t/**\n\t\t * Return the latest email communication.\n\t\t *\n\t\t * @param {boolean} from_recipient If true, only considers emails where current form's recipient is the sender.\n\t\t * @returns {object|null} The latest email communication, or null if no communication is found.\n\t\t */\n\n\t\tconst communications = this.frm.get_docinfo().communications || [];\n\t\tconst recipient = this.get_recipient();\n\n\t\tconst filtered_records = communications\n\t\t\t.filter(\n\t\t\t\t(record) =>\n\t\t\t\t\trecord.communication_type === \"Communication\" &&\n\t\t\t\t\trecord.communication_medium === \"Email\" &&\n\t\t\t\t\t(!from_recipient || record.sender === recipient)\n\t\t\t)\n\t\t\t.sort((a, b) => b.creation - a.creation);\n\n\t\treturn filtered_records[0] || null;\n\t}\n\n\tdelete_comment(comment_name) {\n\t\tfrappe.confirm(__(\"Delete comment?\"), () => {\n\t\t\treturn frappe\n\t\t\t\t.xcall(\"frappe.client.delete\", {\n\t\t\t\t\tdoctype: \"Comment\",\n\t\t\t\t\tname: comment_name,\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.utils.play_sound(\"delete\");\n\t\t\t\t});\n\t\t});\n\t}\n\n\tcopy_link(ev) {\n\t\tlet doc_link = frappe.urllib.get_full_url(\n\t\t\tfrappe.utils.get_form_link(this.frm.doctype, this.frm.docname)\n\t\t);\n\t\tlet element_id = $(ev.currentTarget).closest(\".timeline-content\").attr(\"id\");\n\t\tfrappe.utils.copy_to_clipboard(`${doc_link}#${element_id}`);\n\t}\n}\n\nexport default FormTimeline;\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport FormTimeline from \"./form_timeline\";\nfrappe.ui.form.Footer = class FormFooter {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.make_comment_box();\n\t\tthis.make_timeline();\n\t\t// render-complete\n\t\t$(this.frm.wrapper).on(\"render_complete\", () => {\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\tmake() {\n\t\tthis.wrapper = $(frappe.render_template(\"form_footer\", {})).appendTo(this.parent);\n\t\tthis.wrapper.find(\".btn-save\").click(() => {\n\t\t\tthis.frm.save(\"Save\", null, this);\n\t\t});\n\t}\n\tmake_comment_box() {\n\t\tthis.frm.comment_box = frappe.ui.form.make_control({\n\t\t\tparent: this.wrapper.find(\".comment-box\"),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tenable_mentions: true,\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Comment\",\n\t\t\t\tfieldname: \"comment\",\n\t\t\t},\n\t\t\ton_submit: (comment) => {\n\t\t\t\tif (strip_html(comment).trim() != \"\" || comment.includes(\"img\")) {\n\t\t\t\t\tthis.frm.comment_box.disable();\n\t\t\t\t\tfrappe\n\t\t\t\t\t\t.xcall(\"frappe.desk.form.utils.add_comment\", {\n\t\t\t\t\t\t\treference_doctype: this.frm.doctype,\n\t\t\t\t\t\t\treference_name: this.frm.docname,\n\t\t\t\t\t\t\tcontent: comment,\n\t\t\t\t\t\t\tcomment_email: frappe.session.user,\n\t\t\t\t\t\t\tcomment_by: frappe.session.user_fullname,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then((comment) => {\n\t\t\t\t\t\t\tlet comment_item =\n\t\t\t\t\t\t\t\tthis.frm.timeline.get_comment_timeline_item(comment);\n\t\t\t\t\t\t\tthis.frm.comment_box.set_value(\"\");\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t\t\t\t\tthis.frm.timeline.add_timeline_item(comment_item);\n\t\t\t\t\t\t\tthis.frm.sidebar.refresh_comments_count &&\n\t\t\t\t\t\t\t\tthis.frm.sidebar.refresh_comments_count();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\tthis.frm.comment_box.enable();\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\tmake_timeline() {\n\t\tthis.frm.timeline = new FormTimeline({\n\t\t\tparent: this.wrapper.find(\".timeline\"),\n\t\t\tfrm: this.frm,\n\t\t});\n\t}\n\trefresh() {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.parent.addClass(\"hide\");\n\t\t} else {\n\t\t\tthis.parent.removeClass(\"hide\");\n\t\t\tthis.frm.timeline.refresh();\n\t\t}\n\t}\n};\n", "frappe.ui.form.FormTour = class FormTour {\n\tconstructor({ frm }) {\n\t\tthis.frm = frm;\n\t\tthis.driver_steps = [];\n\t}\n\n\tinit_driver() {\n\t\tthis.driver = new frappe.Driver({\n\t\t\tclassName: \"frappe-driver\",\n\t\t\tallowClose: false,\n\t\t\tpadding: 10,\n\t\t\toverlayClickNext: true,\n\t\t\tkeyboardControl: true,\n\t\t\tnextBtnText: \"Next\",\n\t\t\tprevBtnText: \"Previous\",\n\t\t\topacity: 0.25,\n\t\t\tonHighlighted: (step) => {\n\t\t\t\t// if last step is to save, then attach a listener to save button\n\t\t\t\tif (step.options.is_save_step) {\n\t\t\t\t\t$(step.options.element).one(\"click\", () => this.driver.reset());\n\t\t\t\t\tthis.driver.overlay.refresh();\n\t\t\t\t}\n\n\t\t\t\t// focus on input\n\t\t\t\tconst $input = $(step.node).find(\"input\").get(0);\n\t\t\t\tif ($input) frappe.utils.sleep(200).then(() => $input.focus());\n\t\t\t},\n\t\t});\n\n\t\tfrappe.router.on(\"change\", () => this.driver.reset());\n\t\tthis.frm.layout.sections.forEach((section) => section.collapse(false));\n\t}\n\n\tasync init({ tour_name, on_finish }) {\n\t\tif (tour_name) {\n\t\t\tthis.tour = await frappe.db.get_doc(\"Form Tour\", tour_name);\n\t\t} else {\n\t\t\tconst doctype_tour_exists = await frappe.db.exists(\"Form Tour\", this.frm.doctype);\n\t\t\tif (doctype_tour_exists) {\n\t\t\t\tthis.tour = await frappe.db.get_doc(\"Form Tour\", this.frm.doctype);\n\t\t\t} else {\n\t\t\t\tthis.tour = { steps: frappe.tour[this.frm.doctype] };\n\t\t\t}\n\t\t}\n\n\t\tif (!this.tour.steps) return;\n\n\t\tif (on_finish) this.on_finish = on_finish;\n\n\t\tthis.init_driver();\n\t\tif (this.tour.include_name_field) this.include_name_field();\n\t\tthis.build_steps();\n\t\tthis.update_driver_steps();\n\t}\n\n\tinclude_name_field() {\n\t\tconst name_step = {\n\t\t\tdescription: __(\"Enter a name for this {0}\", [this.frm.doctype]),\n\t\t\tfieldname: \"__newname\",\n\t\t\ttitle: __(\"Document Name\"),\n\t\t\tposition: \"right\",\n\t\t\tis_table_field: 0,\n\t\t};\n\t\tthis.tour.steps.unshift(name_step);\n\t}\n\n\tbuild_steps() {\n\t\tthis.driver_steps = [];\n\t\tthis.tour.steps.forEach((step) => {\n\t\t\tconst on_next = () => {\n\t\t\t\tif (!this.is_next_condition_satisfied(step)) {\n\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t}\n\n\t\t\t\tif (!this.driver.hasNextStep()) {\n\t\t\t\t\tthis.on_finish && this.on_finish();\n\t\t\t\t}\n\t\t\t\tlet field = this.get_next_step()?.options.element.fieldobj;\n\t\t\t\tif (field?.tab && !field.tab.is_active()) {\n\t\t\t\t\tfield.tab.set_active();\n\t\t\t\t\tthis.driver.reset(true);\n\t\t\t\t\tfrappe.utils.sleep(200).then(() => {\n\t\t\t\t\t\tthis.start(step.idx);\n\t\t\t\t\t\tthis.driver.overlay.refresh();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst on_prev = () => {\n\t\t\t\tif (!this.driver.hasPreviousStep()) return;\n\t\t\t\tlet field =\n\t\t\t\t\tthis.driver.steps[this.driver.currentStep - 1]?.options.element.fieldobj;\n\t\t\t\tif (field?.tab && !field.tab.is_active()) {\n\t\t\t\t\tfield.tab.set_active();\n\t\t\t\t\tthis.driver.reset(true);\n\t\t\t\t\tfrappe.utils.sleep(200).then(() => {\n\t\t\t\t\t\tthis.start(step.idx - 2);\n\t\t\t\t\t\tthis.driver.overlay.refresh();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst driver_step = this.get_step(step, on_next, on_prev);\n\t\t\tthis.driver_steps.push(driver_step);\n\n\t\t\tif (step.fieldtype == \"Table\") this.handle_table_step(step);\n\t\t\tif (step.is_table_field) this.handle_child_table_step(step);\n\t\t\tif (step.fieldtype == \"Attach Image\") this.handle_attach_image_steps(step);\n\t\t});\n\n\t\tif (this.tour.save_on_complete && this.frm.is_dirty()) {\n\t\t\tthis.add_step_to_save();\n\t\t}\n\t}\n\n\tis_next_condition_satisfied(step) {\n\t\tconst form = step.is_table_field ? this.frm.cur_grid.grid_form : this.frm;\n\t\treturn form.layout.evaluate_depends_on_value(step.next_step_condition || true);\n\t}\n\n\tget_step(step_info, on_next, on_prev) {\n\t\tconst { name, fieldname, title, description, position, is_table_field } = step_info;\n\t\tlet element = `.frappe-control[data-fieldname='${fieldname}']`;\n\n\t\tconst field = this.frm.get_field(fieldname);\n\t\tif (field) {\n\t\t\t// wrapper for section breaks returns in a list\n\t\t\telement = field.wrapper[0] ? field.wrapper[0] : field.wrapper;\n\t\t}\n\n\t\tif (is_table_field) {\n\t\t\t// TODO: fix wrapper for grid sections\n\t\t\telement = `.grid-row-open .frappe-control[data-fieldname='${fieldname}']`;\n\t\t}\n\n\t\treturn {\n\t\t\telement,\n\t\t\tname,\n\t\t\tpopover: { title, description, position: frappe.router.slug(position || \"Bottom\") },\n\t\t\tonNext: on_next,\n\t\t\tonPrevious: on_prev,\n\t\t};\n\t}\n\n\tupdate_driver_steps(steps = []) {\n\t\tif (steps.length == 0) {\n\t\t\tsteps = this.driver_steps;\n\t\t}\n\t\tthis.driver.defineSteps(steps);\n\t}\n\n\tstart(idx = 0) {\n\t\tif (this.driver_steps.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis.driver.start(idx);\n\t}\n\n\tget_next_step() {\n\t\t// returns the next step only if driver is active\n\t\tif (this.driver.isActivated & this.driver.hasNextStep()) {\n\t\t\tconst current_step = this.driver.currentStep;\n\t\t\treturn this.driver.steps[current_step + 1];\n\t\t}\n\t\treturn;\n\t}\n\n\thandle_table_step(step_info) {\n\t\tconst is_last_step = step_info.idx == this.tour.steps.length;\n\n\t\tif (!is_last_step) {\n\t\t\t// if next step field is inside currently highlighted table field\n\t\t\t// then check if there is a row -> if not, then prompt to add row\n\t\t\t// then edit the first row and hightlight next step\n\n\t\t\tconst curr_step = step_info;\n\t\t\tconst next_step = this.tour.steps[curr_step.idx];\n\t\t\tconst is_next_field_in_curr_table = next_step.parent_fieldname == curr_step.fieldname;\n\n\t\t\tif (!is_next_field_in_curr_table) return;\n\n\t\t\tconst rows = this.frm.doc[curr_step.fieldname];\n\t\t\tconst table_has_rows = rows && rows.length > 0;\n\t\t\tif (table_has_rows) {\n\t\t\t\t// table already has rows\n\t\t\t\t// then just edit the first one on next step\n\t\t\t\tconst curr_driver_step = this.driver_steps.find((s) => s.name == curr_step.name);\n\t\t\t\tcurr_driver_step.onNext = () => {\n\t\t\t\t\tif (this.is_next_condition_satisfied(curr_step)) {\n\t\t\t\t\t\tthis.expand_row_and_proceed(curr_step, curr_step.idx);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.update_driver_steps();\n\t\t\t} else {\n\t\t\t\tthis.add_new_row_step(curr_step);\n\t\t\t}\n\t\t}\n\t}\n\n\tadd_new_row_step(step) {\n\t\tconst $add_row = `.frappe-control[data-fieldname='${step.fieldname}'] .grid-add-row`;\n\t\tconst add_row_step = {\n\t\t\telement: $add_row,\n\t\t\tpopover: { title: __(\"Add a Row\"), description: \"\" },\n\t\t\tonNext: () => {\n\t\t\t\tif (!cur_frm.cur_grid) {\n\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t\tthis.driver_steps.push(add_row_step);\n\n\t\t// setup a listener on add row button\n\t\t// so, once the row is added, move to next step automatically\n\t\t$($add_row).one(\"click\", () => {\n\t\t\tthis.expand_row_and_proceed(step, step.idx + 1); // +1 since add row step is added\n\t\t});\n\t}\n\n\texpand_row_and_proceed(step, start_from) {\n\t\tthis.open_first_row_of(step.fieldname);\n\t\tthis.update_driver_steps(); // need to define again, since driver.js only considers steps which are inside DOM\n\t\tfrappe.utils.sleep(300).then(() => this.driver.start(start_from));\n\t}\n\n\topen_first_row_of(fieldname) {\n\t\tthis.frm.fields_dict[fieldname].grid.grid_rows[0].toggle_view();\n\n\t\t// setup a listener on close row button\n\t\t// so, once the row is closed, move to next step automatically\n\t\tconst $close_row = \".grid-row-open .grid-collapse-row\";\n\t\t$($close_row).one(\"click\", () => {\n\t\t\tconst next_step = this.get_next_step();\n\t\t\tconst next_element = next_step.options.is_save_step ? null : next_step.node;\n\n\t\t\tfrappe.utils.scroll_to(next_element, true, 150, null, () => {\n\t\t\t\tthis.driver.moveNext();\n\t\t\t\tfrappe.flags.disable_auto_scroll = false;\n\t\t\t});\n\t\t\tfrappe.flags.disable_auto_scroll = true;\n\t\t});\n\t}\n\n\thandle_child_table_step(step_info) {\n\t\tconst is_last_step = step_info.idx == this.tour.steps.length;\n\n\t\tif (!is_last_step) {\n\t\t\tconst curr_step = step_info;\n\t\t\tconst next_step = this.tour.steps[curr_step.idx];\n\t\t\tconst field = this.frm.get_field(next_step.fieldname);\n\n\t\t\tif (!field) return;\n\n\t\t\t// next step highlights parent field\n\t\t\t// so, add a step to prompt user to collapse grid form\n\t\t\tthis.add_collapse_row_step();\n\t\t} else if (this.tour.save_on_complete) {\n\t\t\t// if last step & save on complete is checked\n\t\t\t// add a step to prompt user to collapse grid form\n\t\t\t// to be able to save as a last step\n\t\t\tthis.add_collapse_row_step();\n\t\t}\n\t}\n\n\tadd_collapse_row_step() {\n\t\tconst $close_row = \".grid-row-open .grid-collapse-row\";\n\t\tconst close_row_step = {\n\t\t\telement: $close_row,\n\t\t\tpopover: { title: __(\"Collapse\"), description: \"\", position: \"left\" },\n\t\t\tonNext: () => {\n\t\t\t\tif (cur_frm.cur_grid) {\n\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t\tthis.driver_steps.push(close_row_step);\n\t}\n\n\tadd_step_to_save() {\n\t\tconst page_id = `[id=\"page-${this.frm.doctype}\"]`;\n\t\tconst $save_btn = `${page_id} .standard-actions .primary-action`;\n\t\tconst save_step = {\n\t\t\telement: $save_btn,\n\t\t\tis_save_step: true,\n\t\t\tallowClose: false,\n\t\t\toverlayClickNext: false,\n\t\t\tpopover: {\n\t\t\t\ttitle: __(\"Save the document.\"),\n\t\t\t\tdescription: \"\",\n\t\t\t\tposition: \"left\",\n\t\t\t\tshowButtons: false,\n\t\t\t},\n\t\t\tonNext: () => {\n\t\t\t\tthis.frm.save();\n\t\t\t},\n\t\t};\n\t\tthis.driver_steps.push(save_step);\n\t\tfrappe.ui.form.on(\n\t\t\tthis.frm.doctype,\n\t\t\t\"after_save\",\n\t\t\t() => this.on_finish && this.on_finish()\n\t\t);\n\t}\n\n\thandle_attach_image_steps() {\n\t\t$(\".btn-attach\").one(\"click\", () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst modal_element = $(\".file-uploader\").closest(\".modal-content\");\n\t\t\t\tconst attach_dialog_step = {\n\t\t\t\t\telement: modal_element[0],\n\t\t\t\t\tallowClose: false,\n\t\t\t\t\toverlayClickNext: false,\n\t\t\t\t\tpopover: {\n\t\t\t\t\t\ttitle: __(\"Select an Image\"),\n\t\t\t\t\t\tdescription: \"\",\n\t\t\t\t\t\tposition: \"left\",\n\t\t\t\t\t\tdoneBtnText: __(\"Next\"),\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tthis.driver_steps.splice(this.driver.currentStep + 1, 0, attach_dialog_step);\n\t\t\t\tthis.update_driver_steps(); // need to define again, since driver.js only considers steps which are inside DOM\n\t\t\t\tthis.driver.moveNext();\n\t\t\t\tthis.driver.overlay.refresh();\n\n\t\t\t\tmodal_element.closest(\".modal\").on(\"hidden.bs.modal\", () => {\n\t\t\t\t\tthis.driver.moveNext();\n\t\t\t\t});\n\t\t\t}, 500);\n\t\t});\n\t}\n};\n", "export class UndoManager {\n\tconstructor({ frm }) {\n\t\tthis.frm = frm;\n\t\tthis.undo_stack = [];\n\t\tthis.redo_stack = [];\n\t}\n\trecord_change({ fieldname, old_value, new_value, doctype, docname, is_child }) {\n\t\tif (old_value == new_value) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.undo_stack.push({\n\t\t\tfieldname,\n\t\t\told_value,\n\t\t\tnew_value,\n\t\t\tdoctype,\n\t\t\tdocname,\n\t\t\tis_child,\n\t\t});\n\t}\n\n\terase_history() {\n\t\tthis.undo_stack = [];\n\t\tthis.redo_stack = [];\n\t}\n\n\tundo() {\n\t\tconst change = this.undo_stack.pop();\n\t\tif (change) {\n\t\t\tthis._apply_change(change);\n\t\t\tthis._push_reverse_entry(change, this.redo_stack);\n\t\t} else {\n\t\t\tthis._show_alert(__(\"Nothing left to undo\"));\n\t\t}\n\t}\n\n\tredo() {\n\t\tconst change = this.redo_stack.pop();\n\t\tif (change) {\n\t\t\tthis._apply_change(change);\n\t\t\tthis._push_reverse_entry(change, this.undo_stack);\n\t\t} else {\n\t\t\tthis._show_alert(__(\"Nothing left to redo\"));\n\t\t}\n\t}\n\n\t_push_reverse_entry(change, stack) {\n\t\tstack.push({\n\t\t\t...change,\n\t\t\tnew_value: change.old_value,\n\t\t\told_value: change.new_value,\n\t\t});\n\t}\n\n\t_apply_change(change) {\n\t\tif (change.is_child) {\n\t\t\tfrappe.model.set_value(\n\t\t\t\tchange.doctype,\n\t\t\t\tchange.docname,\n\t\t\t\tchange.fieldname,\n\t\t\t\tchange.old_value\n\t\t\t);\n\t\t} else {\n\t\t\tthis.frm.set_value(change.fieldname, change.old_value);\n\t\t\tthis.frm.scroll_to_field(change.fieldname, false);\n\t\t}\n\t}\n\n\t_show_alert(msg) {\n\t\t// reduce duration\n\t\t// keyboard interactions shouldn't have long running annoying toasts\n\t\tfrappe.show_alert(msg, 3);\n\t}\n}\n", "frappe.provide(\"frappe.ui.form\");\nfrappe.provide(\"frappe.model.docinfo\");\n\nimport \"./quick_entry\";\nimport \"./toolbar\";\nimport \"./dashboard\";\nimport \"./workflow\";\nimport \"./save\";\nimport \"./print_utils\";\nimport \"./success_action\";\nimport \"./script_manager\";\nimport \"./script_helpers\";\nimport \"./sidebar/form_sidebar\";\nimport \"./footer/footer\";\nimport \"./form_tour\";\nimport { UndoManager } from \"./undo_manager\";\n\nfrappe.ui.form.Controller = class FormController {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n};\n\nfrappe.ui.form.Form = class FrappeForm {\n\tconstructor(doctype, parent, in_form, doctype_layout_name) {\n\t\tthis.docname = \"\";\n\t\tthis.doctype = doctype;\n\t\tthis.doctype_layout_name = doctype_layout_name;\n\t\tthis.in_form = in_form ? true : false;\n\n\t\tthis.hidden = false;\n\t\tthis.refresh_if_stale_for = 120;\n\t\tthis.opendocs = {};\n\t\tthis.custom_buttons = {};\n\t\tthis.sections = [];\n\t\tthis.grids = [];\n\t\tthis.cscript = new frappe.ui.form.Controller({ frm: this });\n\t\tthis.events = {};\n\t\tthis.fetch_dict = {};\n\t\tthis.parent = parent;\n\t\tthis.doctype_layout = frappe.get_doc(\"DocType Layout\", doctype_layout_name);\n\t\tthis.undo_manager = new UndoManager({ frm: this });\n\t\tthis.setup_meta(doctype);\n\t\tthis.debounced_reload_doc = frappe.utils.debounce(this.reload_doc.bind(this), 1000);\n\n\t\tthis.beforeUnloadListener = (event) => {\n\t\t\tevent.preventDefault();\n\t\t\t// A String is returned for compatability with older Browsers. Return Value has to be truthy to trigger \"Leave Site\" Dialog\n\t\t\treturn (event.returnValue =\n\t\t\t\t\"There are unsaved changes, are you sure you want to exit?\");\n\t\t};\n\t}\n\n\tsetup_meta() {\n\t\tthis.meta = frappe.get_doc(\"DocType\", this.doctype);\n\n\t\tif (this.meta.istable) {\n\t\t\tthis.meta.in_dialog = 1;\n\t\t}\n\n\t\tthis.perm = frappe.perm.get_perm(this.doctype); // for create\n\t\tthis.action_perm_type_map = {\n\t\t\tCreate: \"create\",\n\t\t\tSave: \"write\",\n\t\t\tSubmit: \"submit\",\n\t\t\tUpdate: \"submit\",\n\t\t\tCancel: \"cancel\",\n\t\t\tAmend: \"amend\",\n\t\t\tDelete: \"delete\",\n\t\t};\n\t}\n\n\tsetup() {\n\t\tthis.fields = [];\n\t\tthis.fields_dict = {};\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\n\t\t// wrapper\n\t\tthis.wrapper = this.parent;\n\t\tthis.$wrapper = $(this.wrapper);\n\n\t\tlet is_single_column = this.doctype === \"DocType\" ? true : this.meta.hide_toolbar;\n\n\t\tfrappe.ui.make_app_page({\n\t\t\tparent: this.wrapper,\n\t\t\tsingle_column: is_single_column,\n\t\t});\n\t\tthis.page = this.wrapper.page;\n\t\tthis.layout_main = this.page.main.get(0);\n\n\t\tthis.$wrapper.on(\"hide\", () => {\n\t\t\tthis.script_manager.trigger(\"on_hide\");\n\t\t});\n\n\t\tthis.toolbar = new frappe.ui.form.Toolbar({\n\t\t\tfrm: this,\n\t\t\tpage: this.page,\n\t\t});\n\n\t\tthis.viewers = new frappe.ui.form.FormViewers({\n\t\t\tfrm: this,\n\t\t\tparent: $('<div class=\"form-viewers d-flex\"></div>').prependTo(this.page.page_actions),\n\t\t});\n\n\t\t// navigate records keyboard shortcuts\n\t\tthis.add_form_keyboard_shortcuts();\n\n\t\t// 2 column layout\n\t\tthis.setup_std_layout();\n\n\t\t// client script must be called after \"setup\" - there are no fields_dict attached to the frm otherwise\n\t\tthis.script_manager = new frappe.ui.form.ScriptManager({\n\t\t\tfrm: this,\n\t\t});\n\t\tthis.script_manager.setup();\n\t\tthis.watch_model_updates();\n\n\t\tif (!this.meta.hide_toolbar && frappe.boot.desk_settings.timeline) {\n\t\t\t// this.footer_tab = new frappe.ui.form.Tab(this.layout, {\n\t\t\t// \tlabel: __(\"Activity\"),\n\t\t\t// \tfieldname: 'timeline'\n\t\t\t// });\n\n\t\t\tthis.footer = new frappe.ui.form.Footer({\n\t\t\t\tfrm: this,\n\t\t\t\tparent: $(\"<div>\").appendTo(this.page.main.parent()),\n\t\t\t});\n\t\t\t$(\"body\").attr(\"data-sidebar\", 1);\n\t\t}\n\t\tthis.setup_file_drop();\n\t\tthis.setup_doctype_actions();\n\t\tthis.setup_notify_on_rename();\n\n\t\tthis.setup_done = true;\n\t}\n\n\tadd_form_keyboard_shortcuts() {\n\t\t// Navigate to next record\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"shift+ctrl+>\",\n\t\t\taction: () => this.navigate_records(0),\n\t\t\tpage: this.page,\n\t\t\tdescription: __(\"Go to next record\"),\n\t\t\tignore_inputs: true,\n\t\t\tcondition: () => !this.is_new(),\n\t\t});\n\n\t\t// Navigate to previous record\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"shift+ctrl+<\",\n\t\t\taction: () => this.navigate_records(1),\n\t\t\tpage: this.page,\n\t\t\tdescription: __(\"Go to previous record\"),\n\t\t\tignore_inputs: true,\n\t\t\tcondition: () => !this.is_new(),\n\t\t});\n\n\t\t// Alternate for redo, main shortcut are present in toolbar.js\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"shift+ctrl+z\",\n\t\t\taction: () => this.undo_manager.redo(),\n\t\t\tpage: this.page,\n\t\t\tdescription: __(\"Redo last action\"),\n\t\t\tcondition: () => !this.is_form_builder(),\n\t\t});\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+p\",\n\t\t\taction: () => this.print_doc(),\n\t\t\tdescription: __(\"Print document\"),\n\t\t});\n\n\t\tlet grid_shortcut_keys = [\n\t\t\t{\n\t\t\t\tshortcut: \"Up Arrow\",\n\t\t\t\tdescription: __(\"Move cursor to above row\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Down Arrow\",\n\t\t\t\tdescription: __(\"Move cursor to below row\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"tab\",\n\t\t\t\tdescription: __(\"Move cursor to next column\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"shift+tab\",\n\t\t\t\tdescription: __(\"Move cursor to previous column\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Ctrl+up\",\n\t\t\t\tdescription: __(\"Add a row above the current row\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Ctrl+down\",\n\t\t\t\tdescription: __(\"Add a row below the current row\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Ctrl+shift+up\",\n\t\t\t\tdescription: __(\"Add a row at the top\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Ctrl+shift+down\",\n\t\t\t\tdescription: __(\"Add a row at the bottom\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"shift+alt+down\",\n\t\t\t\tdescription: __(\"Duplicate current row\"),\n\t\t\t},\n\t\t];\n\n\t\tgrid_shortcut_keys.forEach((row) => {\n\t\t\tfrappe.ui.keys.add_shortcut({\n\t\t\t\tshortcut: row.shortcut,\n\t\t\t\tpage: this.page,\n\t\t\t\tdescription: __(row.description),\n\t\t\t\tignore_inputs: true,\n\t\t\t\tcondition: () => !this.is_new(),\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_std_layout() {\n\t\tthis.form_wrapper = $(\"<div></div>\").appendTo(this.layout_main);\n\t\tthis.body = $('<div class=\"std-form-layout\"></div>').appendTo(this.form_wrapper);\n\n\t\t// only tray\n\t\tthis.meta.section_style = \"Simple\"; // always simple!\n\n\t\t// layout\n\t\tthis.layout = new frappe.ui.form.Layout({\n\t\t\tparent: this.body,\n\t\t\tdoctype: this.doctype,\n\t\t\tdoctype_layout: this.doctype_layout,\n\t\t\tfrm: this,\n\t\t\twith_dashboard: true,\n\t\t\tcard_layout: true,\n\t\t});\n\n\t\tthis.layout.make();\n\n\t\tthis.fields_dict = this.layout.fields_dict;\n\t\tthis.fields = this.layout.fields_list;\n\n\t\tlet dashboard_parent = $('<div class=\"form-dashboard\">');\n\t\tlet dashboard_added = false;\n\n\t\tif (this.layout.tabs.length) {\n\t\t\tthis.layout.tabs.every((tab) => {\n\t\t\t\tif (tab.df.show_dashboard) {\n\t\t\t\t\ttab.wrapper.prepend(dashboard_parent);\n\t\t\t\t\tdashboard_added = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t\tif (!dashboard_added) {\n\t\t\t\tthis.layout.tabs[0].wrapper.prepend(dashboard_parent);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.layout.wrapper.find(\".form-page\").prepend(dashboard_parent);\n\t\t}\n\n\t\tthis.dashboard = new frappe.ui.form.Dashboard(dashboard_parent, this);\n\n\t\tthis.tour = new frappe.ui.form.FormTour({\n\t\t\tfrm: this,\n\t\t});\n\n\t\t// workflow state\n\t\tthis.states = new frappe.ui.form.States({\n\t\t\tfrm: this,\n\t\t});\n\t}\n\n\twatch_model_updates() {\n\t\t// watch model updates\n\t\tvar me = this;\n\n\t\t// on main doc\n\t\tfrappe.model.on(\n\t\t\tme.doctype,\n\t\t\t\"*\",\n\t\t\tfunction (fieldname, value, doc, skip_dirty_trigger = false) {\n\t\t\t\t// set input\n\t\t\t\tif (doc.name == me.docname) {\n\t\t\t\t\tif (!skip_dirty_trigger) {\n\t\t\t\t\t\tme.dirty();\n\t\t\t\t\t}\n\n\t\t\t\t\tlet field = me.fields_dict[fieldname];\n\t\t\t\t\tfield && field.refresh(fieldname);\n\n\t\t\t\t\t// Validate value for link field explicitly\n\t\t\t\t\tfield &&\n\t\t\t\t\t\t[\"Link\", \"Dynamic Link\"].includes(field.df.fieldtype) &&\n\t\t\t\t\t\tfield.validate &&\n\t\t\t\t\t\tfield.validate(value);\n\n\t\t\t\t\tme.layout.refresh_dependency();\n\t\t\t\t\tme.layout.refresh_sections();\n\t\t\t\t\treturn me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\t// on table fields\n\t\tvar table_fields = frappe.get_children(\"DocType\", me.doctype, \"fields\", {\n\t\t\tfieldtype: [\"in\", frappe.model.table_fields],\n\t\t});\n\n\t\t// using $.each to preserve df via closure\n\t\t$.each(table_fields, function (i, df) {\n\t\t\tfrappe.model.on(df.options, \"*\", function (fieldname, value, doc) {\n\t\t\t\tif (doc.parent == me.docname && doc.parentfield === df.fieldname) {\n\t\t\t\t\tme.dirty();\n\t\t\t\t\tme.fields_dict[df.fieldname].grid.set_value(fieldname, value, doc);\n\t\t\t\t\treturn me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_notify_on_rename() {\n\t\t$(document).on(\"rename\", (ev, dt, old_name, new_name) => {\n\t\t\tif (dt == this.doctype) this.rename_notify(dt, old_name, new_name);\n\t\t});\n\t}\n\n\tsetup_file_drop() {\n\t\tvar me = this;\n\t\tthis.$wrapper.on(\"dragenter dragover\", false).on(\"drop\", function (e) {\n\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (me.doc.__islocal) {\n\t\t\t\tfrappe.msgprint(__(\"Please save before attaching.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tdocname: me.docname,\n\t\t\t\tfrm: me,\n\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\tfolder: \"Home/Attachments\",\n\t\t\t\ton_success(file_doc) {\n\t\t\t\t\tme.attachments.attachment_uploaded(file_doc);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_image_autocompletions_in_markdown() {\n\t\tthis.fields.map((field) => {\n\t\t\tif (field.df.fieldtype === \"Markdown Editor\") {\n\t\t\t\tthis.set_df_property(field.df.fieldname, \"autocompletions\", () => {\n\t\t\t\t\tlet attachments = this.attachments.get_attachments();\n\t\t\t\t\treturn attachments\n\t\t\t\t\t\t.filter((file) => frappe.utils.is_image_file(file.file_url))\n\t\t\t\t\t\t.map((file) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tcaption: \"image: \" + file.file_name,\n\t\t\t\t\t\t\t\tvalue: `![](${file.file_url})`,\n\t\t\t\t\t\t\t\tmeta: \"image\",\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t// REFRESH\n\n\trefresh(docname) {\n\t\tvar switched = docname ? true : false;\n\n\t\tremoveEventListener(\"beforeunload\", this.beforeUnloadListener, { capture: true });\n\n\t\tif (docname) {\n\t\t\tthis.switch_doc(docname);\n\t\t}\n\n\t\tcur_frm = this;\n\n\t\tthis.undo_manager.erase_history();\n\n\t\tif (this.docname) {\n\t\t\t// document to show\n\t\t\tthis.save_disabled = false;\n\t\t\t// set the doc\n\t\t\tthis.doc = frappe.get_doc(this.doctype, this.docname);\n\n\t\t\t// check permissions\n\t\t\tthis.fetch_permissions();\n\t\t\tif (!this.has_read_permission()) {\n\t\t\t\tfrappe.show_not_permitted(__(this.doctype) + \" \" + __(cstr(this.docname)));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// update grids with new permissions\n\t\t\tthis.grids.forEach((table) => {\n\t\t\t\ttable.grid.refresh();\n\t\t\t});\n\n\t\t\t// read only (workflow)\n\t\t\tthis.read_only = frappe.workflow.is_read_only(this.doctype, this.docname);\n\t\t\tif (this.read_only) {\n\t\t\t\tthis.set_read_only(true);\n\t\t\t\tfrappe.show_alert(__(\"This form is not editable due to a Workflow.\"));\n\t\t\t}\n\n\t\t\t// check if doctype is already open\n\t\t\tif (!this.opendocs[this.docname]) {\n\t\t\t\tthis.check_doctype_conflict(this.docname);\n\t\t\t} else {\n\t\t\t\tif (this.check_reload()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// do setup\n\t\t\tif (!this.setup_done) {\n\t\t\t\tthis.setup();\n\t\t\t}\n\n\t\t\t// load the record for the first time, if not loaded (call 'onload')\n\t\t\tthis.trigger_onload(switched);\n\n\t\t\t// if print format is shown, refresh the format\n\t\t\t// if(this.print_preview.wrapper.is(\":visible\")) {\n\t\t\t// \tthis.print_preview.preview();\n\t\t\t// }\n\n\t\t\tif (switched) {\n\t\t\t\tif (this.show_print_first && this.doc.docstatus === 1) {\n\t\t\t\t\t// show print view\n\t\t\t\t\tthis.print_doc();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set status classes\n\t\t\tthis.$wrapper\n\t\t\t\t.removeClass(\"validated-form\")\n\t\t\t\t.toggleClass(\"editable-form\", this.doc.docstatus === 0)\n\t\t\t\t.toggleClass(\"submitted-form\", this.doc.docstatus === 1)\n\t\t\t\t.toggleClass(\"cancelled-form\", this.doc.docstatus === 2);\n\n\t\t\tthis.show_conflict_message();\n\t\t\tthis.show_submission_queue_banner();\n\n\t\t\tif (frappe.boot.read_only) {\n\t\t\t\tthis.disable_form();\n\t\t\t}\n\t\t}\n\t}\n\n\t// sets up the refresh event for custom buttons\n\t// added via configuration\n\tsetup_doctype_actions() {\n\t\tif (this.meta.actions) {\n\t\t\tfor (let action of this.meta.actions) {\n\t\t\t\tfrappe.ui.form.on(this.doctype, \"refresh\", () => {\n\t\t\t\t\tif (!this.is_new()) {\n\t\t\t\t\t\tif (!action.hidden) {\n\t\t\t\t\t\t\tthis.add_custom_button(\n\t\t\t\t\t\t\t\taction.label,\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis.execute_action(action);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\taction.group\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\texecute_action(action) {\n\t\tif (typeof action === \"string\") {\n\t\t\t// called by label - maybe via custom script\n\t\t\t// frm.execute_action('Action')\n\t\t\tfor (let _action of this.meta.actions) {\n\t\t\t\tif (_action.label === action) {\n\t\t\t\t\taction = _action;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof action === \"string\") {\n\t\t\t\tfrappe.throw(`Action ${action} not found`);\n\t\t\t}\n\t\t}\n\t\tif (action.action_type === \"Server Action\") {\n\t\t\treturn frappe.xcall(action.action, { doc: this.doc }).then((doc) => {\n\t\t\t\tif (doc.doctype) {\n\t\t\t\t\t// document is returned by the method,\n\t\t\t\t\t// apply the changes locally and refresh\n\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\n\t\t\t\t// feedback\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: __(\"{} Complete\", [action.label]),\n\t\t\t\t\talert: true,\n\t\t\t\t});\n\t\t\t});\n\t\t} else if (action.action_type === \"Route\") {\n\t\t\treturn frappe.set_route(action.action);\n\t\t}\n\t}\n\n\tswitch_doc(docname) {\n\t\t// reset visible columns, since column headings can change in different docs\n\t\tthis.grids.forEach((grid_obj) => {\n\t\t\tgrid_obj.grid.visible_columns = null;\n\t\t\t// reset page number to 1\n\t\t\tgrid_obj.grid.grid_pagination.go_to_page(1, true);\n\t\t});\n\t\tfrappe.ui.form.close_grid_form();\n\t\tthis.viewers && this.viewers.parent.empty();\n\t\tthis.docname = docname;\n\t\tthis.setup_docinfo_change_listener();\n\t}\n\n\tcheck_reload() {\n\t\tif (\n\t\t\tthis.doc &&\n\t\t\t!this.doc.__unsaved &&\n\t\t\tthis.doc.__last_sync_on &&\n\t\t\tnew Date() - this.doc.__last_sync_on > this.refresh_if_stale_for * 1000\n\t\t) {\n\t\t\tthis.debounced_reload_doc();\n\t\t\treturn true;\n\t\t}\n\t}\n\n\ttrigger_onload(switched) {\n\t\tthis.cscript.is_onload = false;\n\t\tif (!this.opendocs[this.docname]) {\n\t\t\tvar me = this;\n\t\t\tthis.cscript.is_onload = true;\n\t\t\tthis.initialize_new_doc();\n\t\t\t$(document).trigger(\"form-load\", [this]);\n\t\t\t$(this.page.wrapper).on(\"hide\", function () {\n\t\t\t\t$(document).trigger(\"form-unload\", [me]);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.render_form(switched);\n\t\t\tif (this.doc.localname) {\n\t\t\t\t// trigger form-rename and remove .localname\n\t\t\t\tdelete this.doc.localname;\n\t\t\t\t$(document).trigger(\"form-rename\", [this]);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitialize_new_doc() {\n\t\tvar me = this;\n\n\t\t// hide any open grid\n\t\tthis.script_manager.trigger(\"before_load\", this.doctype, this.docname).then(() => {\n\t\t\tme.script_manager.trigger(\"onload\");\n\t\t\tme.opendocs[me.docname] = true;\n\t\t\tme.render_form();\n\n\t\t\tfrappe.after_ajax(function () {\n\t\t\t\tme.trigger_link_fields();\n\t\t\t});\n\n\t\t\tfrappe.breadcrumbs.add(me.meta.module, me.doctype);\n\t\t});\n\n\t\t// update seen\n\t\tif (this.meta.track_seen) {\n\t\t\t$('.list-id[data-name=\"' + me.docname + '\"]').addClass(\"seen\");\n\t\t}\n\t}\n\n\trender_form(switched) {\n\t\tif (!this.meta.istable) {\n\t\t\tthis.layout.doc = this.doc;\n\t\t\tthis.layout.attach_doc_and_docfields();\n\n\t\t\tif (frappe.boot.desk_settings.form_sidebar) {\n\t\t\t\tthis.sidebar = new frappe.ui.form.Sidebar({\n\t\t\t\t\tfrm: this,\n\t\t\t\t\tpage: this.page,\n\t\t\t\t});\n\t\t\t\tthis.sidebar.make();\n\t\t\t}\n\n\t\t\t// clear layout message\n\t\t\tthis.layout.show_message();\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t// header must be refreshed before client methods\n\t\t\t\t// because add_custom_button\n\t\t\t\t() => this.refresh_header(switched),\n\t\t\t\t// trigger global trigger\n\t\t\t\t// to use this\n\t\t\t\t() => $(document).trigger(\"form-refresh\", [this]),\n\t\t\t\t// fields\n\t\t\t\t() => this.refresh_fields(),\n\t\t\t\t// call trigger\n\t\t\t\t() => this.script_manager.trigger(\"refresh\"),\n\t\t\t\t// call onload post render for callbacks to be fired\n\t\t\t\t() => {\n\t\t\t\t\tif (this.cscript.is_onload) {\n\t\t\t\t\t\tthis.onload_post_render();\n\t\t\t\t\t\treturn this.script_manager.trigger(\"onload_post_render\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t() => this.cscript.is_onload && this.is_new() && this.focus_on_first_input(),\n\t\t\t\t() => this.run_after_load_hook(),\n\t\t\t\t() => this.dashboard.after_refresh(),\n\t\t\t]);\n\t\t} else {\n\t\t\tthis.refresh_header(switched);\n\t\t}\n\n\t\tthis.$wrapper.trigger(\"render_complete\");\n\n\t\tfrappe.after_ajax(() => {\n\t\t\t$(document).ready(() => {\n\t\t\t\tthis.scroll_to_element();\n\t\t\t});\n\t\t});\n\t}\n\n\tonload_post_render() {\n\t\tthis.setup_image_autocompletions_in_markdown();\n\t}\n\n\tfocus_on_first_input() {\n\t\tconst layout_wrapper = this.layout.wrapper;\n\n\t\t// dont do anything if the current active element is inside the form\n\t\t// user must have clicked on some element before this function trigerred\n\t\tif (!layout_wrapper || layout_wrapper.has(\":focus\").length) {\n\t\t\treturn;\n\t\t}\n\n\t\tlayout_wrapper\n\t\t\t.find(\":input:visible:first\")\n\t\t\t.not(\"[data-fieldtype^='Date']\")\n\t\t\t.trigger(\"focus\");\n\t}\n\n\trun_after_load_hook() {\n\t\tif (frappe.route_hooks.after_load) {\n\t\t\tlet route_callback = frappe.route_hooks.after_load;\n\t\t\tdelete frappe.route_hooks.after_load;\n\n\t\t\troute_callback(this);\n\t\t}\n\t}\n\n\trefresh_fields() {\n\t\tthis.layout.refresh(this.doc);\n\t\tthis.layout.primary_button = this.$wrapper.find(\".btn-primary\");\n\n\t\t// cleanup activities after refresh\n\t\tthis.cleanup_refresh(this);\n\t}\n\n\tcleanup_refresh() {\n\t\tif (this.fields_dict[\"amended_from\"]) {\n\t\t\tif (this.doc.amended_from) {\n\t\t\t\tunhide_field(\"amended_from\");\n\t\t\t\tif (this.fields_dict[\"amendment_date\"]) unhide_field(\"amendment_date\");\n\t\t\t} else {\n\t\t\t\thide_field(\"amended_from\");\n\t\t\t\tif (this.fields_dict[\"amendment_date\"]) hide_field(\"amendment_date\");\n\t\t\t}\n\t\t}\n\n\t\tif (this.fields_dict[\"trash_reason\"]) {\n\t\t\tif (this.doc.trash_reason && this.doc.docstatus == 2) {\n\t\t\t\tunhide_field(\"trash_reason\");\n\t\t\t} else {\n\t\t\t\thide_field(\"trash_reason\");\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tthis.meta.autoname &&\n\t\t\tthis.meta.autoname.substr(0, 6) == \"field:\" &&\n\t\t\t!this.doc.__islocal\n\t\t) {\n\t\t\tvar fn = this.meta.autoname.substr(6);\n\n\t\t\tif (this.doc[fn]) {\n\t\t\t\tthis.toggle_display(fn, false);\n\t\t\t}\n\t\t}\n\n\t\tif (this.meta.autoname == \"naming_series:\" && !this.doc.__islocal) {\n\t\t\tthis.toggle_display(\"naming_series\", false);\n\t\t}\n\t}\n\n\trefresh_header(switched) {\n\t\t// set title\n\t\t// main title\n\t\tif (!this.meta.in_dialog || this.in_form) {\n\t\t\tfrappe.utils.set_title(this.meta.issingle ? this.doctype : this.docname);\n\t\t}\n\n\t\t// show / hide buttons\n\t\tif (this.toolbar) {\n\t\t\tif (switched) {\n\t\t\t\tthis.toolbar.current_status = undefined;\n\t\t\t}\n\t\t\tthis.toolbar.refresh();\n\t\t}\n\t\tthis.viewers.refresh();\n\n\t\tthis.dashboard.refresh();\n\t\tfrappe.breadcrumbs.update();\n\n\t\tthis.show_submit_message();\n\t\tthis.clear_custom_buttons();\n\t\tthis.show_web_link();\n\t}\n\n\t// SAVE\n\n\tsave_or_update() {\n\t\tif (this.save_disabled) return;\n\n\t\tif (this.doc.docstatus === 0) {\n\t\t\tthis.save();\n\t\t} else if (this.doc.docstatus === 1 && this.doc.__unsaved) {\n\t\t\tthis.save(\"Update\");\n\t\t}\n\t}\n\n\tsave(save_action, callback, btn, on_error) {\n\t\tlet me = this;\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tbtn && $(btn).prop(\"disabled\", true);\n\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\tme.validate_and_save(save_action, callback, btn, on_error, resolve, reject);\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tme.show_success_action();\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconsole.error(e);\n\t\t\t});\n\t}\n\n\tvalidate_and_save(save_action, callback, btn, on_error, resolve, reject) {\n\t\tvar me = this;\n\t\tif (!save_action) save_action = \"Save\";\n\t\tthis.validate_form_action(save_action, resolve);\n\n\t\tvar after_save = function (r) {\n\t\t\t// to remove hash from URL to avoid scroll after save\n\t\t\thistory.replaceState(null, null, \" \");\n\t\t\tif (!r.exc) {\n\t\t\t\tif ([\"Save\", \"Update\", \"Amend\"].indexOf(save_action) !== -1) {\n\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t\t}\n\n\t\t\t\tme.script_manager.trigger(\"after_save\");\n\n\t\t\t\tif (frappe.route_hooks.after_save) {\n\t\t\t\t\tlet route_callback = frappe.route_hooks.after_save;\n\t\t\t\t\tdelete frappe.route_hooks.after_save;\n\n\t\t\t\t\troute_callback(me);\n\t\t\t\t}\n\t\t\t\t// submit comment if entered\n\t\t\t\tif (me.comment_box) {\n\t\t\t\t\tme.comment_box.submit();\n\t\t\t\t}\n\t\t\t\tme.refresh();\n\t\t\t} else {\n\t\t\t\tif (on_error) {\n\t\t\t\t\ton_error();\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t}\n\t\t\tcallback && callback(r);\n\t\t\tresolve();\n\t\t};\n\n\t\tvar fail = (e) => {\n\t\t\tif (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t\tbtn && $(btn).prop(\"disabled\", false);\n\t\t\tif (on_error) {\n\t\t\t\ton_error();\n\t\t\t\treject();\n\t\t\t}\n\t\t};\n\n\t\tif (save_action != \"Update\") {\n\t\t\t// validate\n\t\t\tfrappe.validated = true;\n\t\t\tfrappe\n\t\t\t\t.run_serially([\n\t\t\t\t\t() => this.script_manager.trigger(\"validate\"),\n\t\t\t\t\t() => this.script_manager.trigger(\"before_save\"),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tif (!frappe.validated) {\n\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t\t.catch(fail);\n\t\t} else {\n\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t}\n\t}\n\n\tsavesubmit(btn, callback, on_error) {\n\t\tvar me = this;\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.validate_form_action(\"Submit\");\n\t\t\tfrappe.confirm(\n\t\t\t\t__(\"Permanently Submit {0}?\", [this.docname]),\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.validated = true;\n\t\t\t\t\tme.script_manager.trigger(\"before_submit\").then(function () {\n\t\t\t\t\t\tif (!frappe.validated) {\n\t\t\t\t\t\t\treturn me.handle_save_fail(btn, on_error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.save(\n\t\t\t\t\t\t\t\"Submit\",\n\t\t\t\t\t\t\tfunction (r) {\n\t\t\t\t\t\t\t\tif (r.exc) {\n\t\t\t\t\t\t\t\t\tme.handle_save_fail(btn, on_error);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\t\t\t\tme.script_manager\n\t\t\t\t\t\t\t\t\t\t.trigger(\"on_submit\")\n\t\t\t\t\t\t\t\t\t\t.then(() => resolve(me))\n\t\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\t\tif (frappe.route_hooks.after_submit) {\n\t\t\t\t\t\t\t\t\t\t\t\tlet route_callback =\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.route_hooks.after_submit;\n\t\t\t\t\t\t\t\t\t\t\t\tdelete frappe.route_hooks.after_submit;\n\t\t\t\t\t\t\t\t\t\t\t\troute_callback(me);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbtn,\n\t\t\t\t\t\t\t() => me.handle_save_fail(btn, on_error),\n\t\t\t\t\t\t\tresolve\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t() => me.handle_save_fail(btn, on_error)\n\t\t\t);\n\t\t});\n\t}\n\n\tsavecancel(btn, callback, on_error) {\n\t\tconst me = this;\n\t\tthis.validate_form_action(\"Cancel\");\n\t\tme.ignore_doctypes_on_cancel_all = me.ignore_doctypes_on_cancel_all || [];\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: \"frappe.desk.form.linked_with.get_submitted_linked_docs\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.doc.doctype,\n\t\t\t\t\tname: me.doc.name,\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tlet doctypes_to_cancel = (r.message.docs || [])\n\t\t\t\t\t\t.map((value) => {\n\t\t\t\t\t\t\treturn value.doctype;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.filter((value) => {\n\t\t\t\t\t\t\treturn !me.ignore_doctypes_on_cancel_all.includes(value);\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (doctypes_to_cancel.length) {\n\t\t\t\t\t\treturn me._cancel_all(r, btn, callback, on_error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn me._cancel(btn, callback, on_error, false);\n\t\t\t});\n\t}\n\n\t_cancel_all(r, btn, callback, on_error) {\n\t\tconst me = this;\n\n\t\t// add confirmation message for cancelling all linked docs\n\t\tlet links_text = \"\";\n\t\tlet links = r.message.docs;\n\t\tconst doctypes = Array.from(new Set(links.map((link) => link.doctype)));\n\n\t\tme.ignore_doctypes_on_cancel_all = me.ignore_doctypes_on_cancel_all || [];\n\n\t\tfor (let doctype of doctypes) {\n\t\t\tif (!me.ignore_doctypes_on_cancel_all.includes(doctype)) {\n\t\t\t\tlet docnames = links\n\t\t\t\t\t.filter((link) => link.doctype == doctype)\n\t\t\t\t\t.map((link) => frappe.utils.get_form_link(link.doctype, link.name, true))\n\t\t\t\t\t.join(\", \");\n\t\t\t\tlinks_text += `<li><strong>${__(doctype)}</strong>: ${docnames}</li>`;\n\t\t\t}\n\t\t}\n\t\tlinks_text = `<ul>${links_text}</ul>`;\n\n\t\tlet confirm_message = __(\"{0} {1} is linked with the following submitted documents: {2}\", [\n\t\t\t__(me.doc.doctype).bold(),\n\t\t\tme.doc.name,\n\t\t\tlinks_text,\n\t\t]);\n\n\t\tlet can_cancel = links.every((link) => frappe.model.can_cancel(link.doctype));\n\t\tif (can_cancel) {\n\t\t\tconfirm_message += __(\"Do you want to cancel all linked documents?\");\n\t\t} else {\n\t\t\tconfirm_message += __(\"You do not have permissions to cancel all linked documents.\");\n\t\t}\n\n\t\t// generate dialog box to cancel all linked docs\n\t\tlet d = new frappe.ui.Dialog(\n\t\t\t{\n\t\t\t\ttitle: __(\"Cancel All Documents\"),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\t\t\toptions: `<p class=\"frappe-confirm-message\">${confirm_message}</p>`,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t() => me.handle_save_fail(btn, on_error)\n\t\t);\n\n\t\t// if user can cancel all linked docs, add action to the dialog\n\t\tif (can_cancel) {\n\t\t\td.set_primary_action(__(\"Cancel All\"), () => {\n\t\t\t\td.hide();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.desk.form.linked_with.cancel_all_linked_docs\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdocs: links,\n\t\t\t\t\t\tignore_doctypes_on_cancel_all: me.ignore_doctypes_on_cancel_all || [],\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: (resp) => {\n\t\t\t\t\t\tif (!resp.exc) {\n\t\t\t\t\t\t\tme.reload_doc();\n\t\t\t\t\t\t\tme._cancel(btn, callback, on_error, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\td.show();\n\t}\n\n\t_cancel(btn, callback, on_error, skip_confirm) {\n\t\tconst me = this;\n\t\tconst cancel_doc = () => {\n\t\t\tfrappe.validated = true;\n\t\t\tme.script_manager.trigger(\"before_cancel\").then(() => {\n\t\t\t\tif (!frappe.validated) {\n\t\t\t\t\treturn me.handle_save_fail(btn, on_error);\n\t\t\t\t}\n\n\t\t\t\tvar after_cancel = function (r) {\n\t\t\t\t\tif (r.exc) {\n\t\t\t\t\t\tme.handle_save_fail(btn, on_error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\tme.script_manager.trigger(\"after_cancel\");\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tfrappe.ui.form.save(me, \"cancel\", after_cancel, btn);\n\t\t\t});\n\t\t};\n\n\t\tif (skip_confirm) {\n\t\t\tcancel_doc();\n\t\t} else {\n\t\t\tfrappe.confirm(\n\t\t\t\t__(\"Permanently Cancel {0}?\", [this.docname]),\n\t\t\t\tcancel_doc,\n\t\t\t\tme.handle_save_fail(btn, on_error)\n\t\t\t);\n\t\t}\n\t}\n\n\tsavetrash() {\n\t\tthis.validate_form_action(\"Delete\");\n\t\tfrappe.model.delete_doc(this.doctype, this.docname, function () {\n\t\t\twindow.history.back();\n\t\t});\n\t}\n\n\tamend_doc() {\n\t\tif (!this.fields_dict[\"amended_from\"]) {\n\t\t\tfrappe.msgprint(__('\"amended_from\" field must be present to do an amendment.'));\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe\n\t\t\t.xcall(\"frappe.client.is_document_amended\", {\n\t\t\t\tdoctype: this.doc.doctype,\n\t\t\t\tdocname: this.doc.name,\n\t\t\t})\n\t\t\t.then((is_amended) => {\n\t\t\t\tif (is_amended) {\n\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t__(\"This document is already amended, you cannot ammend it again\")\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthis.validate_form_action(\"Amend\");\n\t\t\t\tvar me = this;\n\t\t\t\tvar fn = function (newdoc) {\n\t\t\t\t\tnewdoc.amended_from = me.docname;\n\t\t\t\t\tif (me.fields_dict && me.fields_dict[\"amendment_date\"])\n\t\t\t\t\t\tnewdoc.amendment_date = frappe.datetime.obj_to_str(new Date());\n\t\t\t\t};\n\t\t\t\tthis.copy_doc(fn, 1);\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t});\n\t}\n\n\tvalidate_form_action(action, resolve) {\n\t\tvar perm_to_check = this.action_perm_type_map[action];\n\t\tvar allowed_for_workflow = false;\n\t\tvar perms = frappe.perm.get_perm(this.doc.doctype)[0];\n\n\t\t// Allow submit, write, cancel and create permissions for read only documents that are assigned by\n\t\t// workflows if the user already have those permissions. This is to allow for users to\n\t\t// continue through the workflow states and to allow execution of functions like Duplicate.\n\t\tif (\n\t\t\t(frappe.workflow.is_read_only(this.doctype, this.docname) &&\n\t\t\t\t(perms[\"write\"] || perms[\"create\"] || perms[\"submit\"] || perms[\"cancel\"])) ||\n\t\t\t!frappe.workflow.is_read_only(this.doctype, this.docname)\n\t\t) {\n\t\t\tallowed_for_workflow = true;\n\t\t}\n\n\t\tif (!this.perm[0][perm_to_check] && !allowed_for_workflow) {\n\t\t\tif (resolve) {\n\t\t\t\t// re-enable buttons\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tfrappe.throw(\n\t\t\t\t__(\n\t\t\t\t\t\"No permission to '{0}' {1}\",\n\t\t\t\t\t[__(action), __(this.doc.doctype)],\n\t\t\t\t\t\"{0} = verb, {1} = object\"\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\t// HELPERS\n\n\tenable_save() {\n\t\tthis.save_disabled = false;\n\t\tthis.toolbar.set_primary_action();\n\t}\n\n\tdisable_save(set_dirty = false) {\n\t\t// IMPORTANT: this function should be called in refresh event\n\t\tthis.save_disabled = true;\n\t\tthis.toolbar.current_status = null;\n\t\t// field changes should make form dirty\n\t\tthis.set_dirty = set_dirty;\n\t\tthis.page.clear_primary_action();\n\t}\n\n\tdisable_form() {\n\t\tthis.set_read_only();\n\t\tthis.fields.forEach((field) => {\n\t\t\tthis.set_df_property(field.df.fieldname, \"read_only\", \"1\");\n\t\t});\n\t\tthis.disable_save();\n\t}\n\n\thandle_save_fail(btn, on_error) {\n\t\t$(btn).prop(\"disabled\", false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t}\n\n\ttrigger_link_fields() {\n\t\t// trigger link fields which have default values set\n\t\tif (this.is_new() && this.doc.__run_link_triggers) {\n\t\t\t$.each(this.fields_dict, function (fieldname, field) {\n\t\t\t\tif (field.df.fieldtype == \"Link\" && this.doc[fieldname]) {\n\t\t\t\t\t// triggers add fetch, sets value in model and runs triggers\n\t\t\t\t\tfield.set_value(this.doc[fieldname], true);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete this.doc.__run_link_triggers;\n\t\t}\n\t}\n\n\tshow_conflict_message() {\n\t\tif (this.doc.__needs_refresh) {\n\t\t\tif (this.doc.__unsaved) {\n\t\t\t\tthis.dashboard.clear_headline();\n\t\t\t\tthis.dashboard.set_headline_alert(\n\t\t\t\t\t__(\"This form has been modified after you have loaded it\") +\n\t\t\t\t\t\t'<button class=\"btn btn-xs btn-primary pull-right\" onclick=\"cur_frm.reload_doc()\">' +\n\t\t\t\t\t\t__(\"Refresh\") +\n\t\t\t\t\t\t\"</button>\",\n\t\t\t\t\t\"alert-warning\"\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.debounced_reload_doc();\n\t\t\t}\n\t\t}\n\t}\n\n\tshow_submit_message() {\n\t\tif (\n\t\t\tthis.meta.is_submittable &&\n\t\t\tthis.perm[0] &&\n\t\t\tthis.perm[0].submit &&\n\t\t\t!this.is_dirty() &&\n\t\t\t!this.is_new() &&\n\t\t\t!frappe.model.has_workflow(this.doctype) && // show only if no workflow\n\t\t\tthis.doc.docstatus === 0\n\t\t) {\n\t\t\tthis.dashboard.add_comment(__(\"Submit this document to confirm\"), \"blue\", true);\n\t\t}\n\t}\n\n\tshow_web_link() {\n\t\tif (!this.doc.__islocal && this.doc.__onload && this.doc.__onload.is_website_generator) {\n\t\t\tthis.web_link && this.web_link.remove();\n\t\t\tif (this.doc.__onload.published) {\n\t\t\t\tthis.add_web_link(\"/\" + this.doc.route);\n\t\t\t}\n\t\t}\n\t}\n\n\tadd_web_link(path, label) {\n\t\tlabel = __(label) || __(\"See on Website\");\n\t\tthis.web_link = this.sidebar\n\t\t\t.add_user_action(__(label), function () {})\n\t\t\t.attr(\"href\", path || this.doc.route)\n\t\t\t.attr(\"target\", \"_blank\");\n\t}\n\n\tfetch_permissions() {\n\t\tlet dt = this.parent_doctype ? this.parent_doctype : this.doctype;\n\t\tthis.perm = frappe.perm.get_perm(dt, this.doc);\n\t}\n\n\thas_read_permission() {\n\t\tif (!this.perm[0].read) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn 1;\n\t}\n\n\tcheck_doctype_conflict(docname) {\n\t\tif (this.doctype == \"DocType\" && docname == \"DocType\") {\n\t\t\tfrappe.msgprint(__(\"Allowing DocType, DocType. Be careful!\"));\n\t\t} else if (this.doctype == \"DocType\") {\n\t\t\tif (frappe.views.formview[docname] || frappe.pages[\"List/\" + docname]) {\n\t\t\t\twindow.location.reload();\n\t\t\t\t//\tfrappe.msgprint(__(\"Cannot open {0} when its instance is open\", ['DocType']))\n\t\t\t\t// throw 'doctype open conflict'\n\t\t\t}\n\t\t} else {\n\t\t\tif (\n\t\t\t\tfrappe.views.formview.DocType &&\n\t\t\t\tfrappe.views.formview.DocType.frm.opendocs[this.doctype]\n\t\t\t) {\n\t\t\t\twindow.location.reload();\n\t\t\t\t//\tfrappe.msgprint(__(\"Cannot open instance when its {0} is open\", ['DocType']))\n\t\t\t\t// throw 'doctype open conflict'\n\t\t\t}\n\t\t}\n\t}\n\n\t// rename the form\n\t// notify this form of renamed records\n\trename_notify(dt, old, name) {\n\t\t// from form\n\t\tif (this.meta.istable) return;\n\n\t\tif (this.docname == old) this.docname = name;\n\t\telse return;\n\n\t\t// cleanup\n\t\tif (this && this.opendocs[old] && frappe.meta.docfield_copy[dt]) {\n\t\t\t// delete docfield copy\n\t\t\tfrappe.meta.docfield_copy[dt][name] = frappe.meta.docfield_copy[dt][old];\n\t\t\tdelete frappe.meta.docfield_copy[dt][old];\n\t\t}\n\n\t\tdelete this.opendocs[old];\n\t\tthis.opendocs[name] = true;\n\n\t\tif (this.meta.in_dialog || !this.in_form) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.re_route[frappe.router.get_sub_path()] = `${encodeURIComponent(\n\t\t\tfrappe.router.slug(this.doctype)\n\t\t)}/${encodeURIComponent(name)}`;\n\t\t!frappe._from_link && frappe.set_route(\"Form\", this.doctype, name);\n\t}\n\n\t// ACTIONS\n\n\tprint_doc() {\n\t\tfrappe.route_options = {\n\t\t\tfrm: this,\n\t\t};\n\t\tfrappe.set_route(\"print\", this.doctype, this.doc.name);\n\t}\n\n\tnavigate_records(prev) {\n\t\tlet filters, sort_field, sort_order;\n\t\tlet list_view = frappe.get_list_view(this.doctype);\n\t\tif (list_view) {\n\t\t\tfilters = list_view.get_filters_for_args();\n\t\t\tsort_field = list_view.sort_by;\n\t\t\tsort_order = list_view.sort_order;\n\t\t} else {\n\t\t\tlet list_settings = frappe.get_user_settings(this.doctype)[\"List\"];\n\t\t\tif (list_settings) {\n\t\t\t\tfilters = list_settings.filters;\n\t\t\t\tsort_field = list_settings.sort_by;\n\t\t\t\tsort_order = list_settings.sort_order;\n\t\t\t}\n\t\t}\n\n\t\tlet args = {\n\t\t\tdoctype: this.doctype,\n\t\t\tvalue: this.docname,\n\t\t\tfilters,\n\t\t\tsort_order,\n\t\t\tsort_field,\n\t\t\tprev,\n\t\t};\n\n\t\tfrappe.call(\"frappe.desk.form.utils.get_next\", args).then((r) => {\n\t\t\tif (r.message) {\n\t\t\t\tfrappe.set_route(\"Form\", this.doctype, r.message);\n\t\t\t\tthis.focus_on_first_input();\n\t\t\t}\n\t\t});\n\t}\n\n\trename_doc() {\n\t\tfrappe.model.rename_doc(this.doctype, this.docname, () => this.refresh_header());\n\t}\n\n\tshare_doc() {\n\t\tthis.shared.show();\n\t}\n\n\temail_doc(message) {\n\t\tnew frappe.views.CommunicationComposer({\n\t\t\tdoc: this.doc,\n\t\t\tfrm: this,\n\t\t\tsubject: __(this.meta.name) + \": \" + this.docname,\n\t\t\trecipients: this.doc.email || this.doc.email_id || this.doc.contact_email,\n\t\t\tattach_document_print: true,\n\t\t\tmessage: message,\n\t\t});\n\t}\n\n\tcopy_doc(onload, from_amend) {\n\t\tthis.validate_form_action(\"Create\");\n\t\tvar newdoc = frappe.model.copy_doc(this.doc, from_amend);\n\n\t\tnewdoc.idx = null;\n\t\tnewdoc.__run_link_triggers = false;\n\t\tif (onload) {\n\t\t\tonload(newdoc);\n\t\t}\n\t\tfrappe.set_route(\"Form\", newdoc.doctype, newdoc.name);\n\t}\n\n\treload_doc() {\n\t\tthis.check_doctype_conflict(this.docname);\n\n\t\tif (!this.doc.__islocal) {\n\t\t\tfrappe.model.remove_from_locals(this.doctype, this.docname);\n\t\t\treturn frappe.model.with_doc(this.doctype, this.docname, () => {\n\t\t\t\tthis.refresh();\n\t\t\t});\n\t\t}\n\t}\n\n\trefresh_field(fname) {\n\t\tif (this.fields_dict[fname] && this.fields_dict[fname].refresh) {\n\t\t\tthis.fields_dict[fname].refresh();\n\t\t\tthis.layout.refresh_dependency();\n\t\t\tthis.layout.refresh_sections();\n\t\t}\n\t}\n\n\t// UTILITIES\n\tadd_fetch(link_field, source_field, target_field, target_doctype) {\n\t\t/*\n\t\tExample fetch dict to get sender_email from email_id field in sender:\n\t\t\t{\n\t\t\t\t\"Notification\": {\n\t\t\t\t\t\"sender\": {\n\t\t\t\t\t\t\"sender_email\": \"email_id\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t*/\n\n\t\tif (!target_doctype) target_doctype = \"*\";\n\n\t\t// Target field kept as key because source field could be non-unique\n\t\tthis.fetch_dict.setDefault(target_doctype, {}).setDefault(link_field, {})[target_field] =\n\t\t\tsource_field;\n\t}\n\n\thas_perm(ptype) {\n\t\treturn frappe.perm.has_perm(this.doctype, 0, ptype, this.doc);\n\t}\n\n\tdirty() {\n\t\tthis.doc.__unsaved = 1;\n\t\tthis.$wrapper.trigger(\"dirty\");\n\t\tif (!frappe.boot.developer_mode) {\n\t\t\taddEventListener(\"beforeunload\", this.beforeUnloadListener, { capture: true });\n\t\t}\n\t}\n\n\tget_docinfo() {\n\t\treturn frappe.model.docinfo[this.doctype][this.docname];\n\t}\n\n\tis_dirty() {\n\t\treturn !!this.doc.__unsaved;\n\t}\n\n\tis_new() {\n\t\treturn this.doc.__islocal;\n\t}\n\n\tis_form_builder() {\n\t\treturn (\n\t\t\t[\"DocType\", \"Customize Form\"].includes(this.doctype) &&\n\t\t\tthis.get_active_tab().label == \"Form\"\n\t\t);\n\t}\n\n\tget_perm(permlevel, access_type) {\n\t\treturn this.perm[permlevel] ? this.perm[permlevel][access_type] : null;\n\t}\n\n\tset_intro(txt, color) {\n\t\tthis.dashboard.set_headline_alert(txt, color);\n\t}\n\n\tset_footnote(txt) {\n\t\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.body, txt);\n\t}\n\n\tadd_custom_button(label, fn, group) {\n\t\t// temp! old parameter used to be icon\n\t\tif (group && group.indexOf(\"fa fa-\") !== -1) group = null;\n\n\t\tlet btn = this.page.add_inner_button(label, fn, group);\n\n\t\tif (btn) {\n\t\t\t// Add actions as menu item in Mobile View\n\t\t\tlet menu_item_label = group ? `${group} > ${label}` : label;\n\t\t\tlet menu_item = this.page.add_menu_item(menu_item_label, fn, false);\n\t\t\tmenu_item.parent().addClass(\"hidden-xl\");\n\n\t\t\tthis.custom_buttons[label] = btn;\n\t\t}\n\t\treturn btn;\n\t}\n\n\tchange_custom_button_type(label, group, type) {\n\t\tthis.page.change_inner_button_type(label, group, type);\n\t}\n\n\tclear_custom_buttons() {\n\t\tthis.page.clear_inner_toolbar();\n\t\tthis.page.clear_user_actions();\n\t\tthis.custom_buttons = {};\n\t}\n\n\t//Remove specific custom button by button Label\n\tremove_custom_button(label, group) {\n\t\tthis.page.remove_inner_button(label, group);\n\t}\n\n\tscroll_to_element() {\n\t\tif (frappe.route_options && frappe.route_options.scroll_to) {\n\t\t\tvar scroll_to = frappe.route_options.scroll_to;\n\t\t\tdelete frappe.route_options.scroll_to;\n\n\t\t\tvar selector = [];\n\t\t\tfor (var key in scroll_to) {\n\t\t\t\tvar value = scroll_to[key];\n\t\t\t\tselector.push(repl('[data-%(key)s=\"%(value)s\"]', { key: key, value: value }));\n\t\t\t}\n\n\t\t\tselector = $(selector.join(\" \"));\n\t\t\tif (selector.length) {\n\t\t\t\tfrappe.utils.scroll_to(selector);\n\t\t\t}\n\t\t} else if (window.location.hash) {\n\t\t\tif ($(window.location.hash).length) {\n\t\t\t\tfrappe.utils.scroll_to(window.location.hash, true, 200, null, null, true);\n\t\t\t} else {\n\t\t\t\tthis.scroll_to_field(window.location.hash.replace(\"#\", \"\")) &&\n\t\t\t\t\thistory.replaceState(null, null, \" \");\n\t\t\t}\n\t\t}\n\t}\n\n\tshow_success_action() {\n\t\tconst route = frappe.get_route();\n\t\tif (route[0] !== \"Form\") return;\n\t\tif (this.meta.is_submittable && this.doc.docstatus !== 1) return;\n\n\t\tconst success_action = new frappe.ui.form.SuccessAction(this);\n\t\tsuccess_action.show();\n\t}\n\n\tget_doc() {\n\t\treturn locals[this.doctype][this.docname];\n\t}\n\n\tset_currency_labels(fields_list, currency, parentfield) {\n\t\t// To set the currency in the label\n\t\t// For example Total Cost(INR), Total Cost(USD)\n\t\tif (!currency) return;\n\t\tvar me = this;\n\t\tvar doctype = parentfield ? this.fields_dict[parentfield].grid.doctype : this.doc.doctype;\n\t\tvar field_label_map = {};\n\t\tvar grid_field_label_map = {};\n\n\t\t$.each(fields_list, function (i, fname) {\n\t\t\tvar docfield = frappe.meta.docfield_map[doctype][fname];\n\t\t\tif (docfield) {\n\t\t\t\tvar label = __(docfield.label || \"\").replace(/\\([^\\)]*\\)/g, \"\"); // eslint-disable-line\n\t\t\t\tif (parentfield) {\n\t\t\t\t\tgrid_field_label_map[doctype + \"-\" + fname] =\n\t\t\t\t\t\tlabel.trim() + \" (\" + __(currency) + \")\";\n\t\t\t\t} else {\n\t\t\t\t\tfield_label_map[fname] = label.trim() + \" (\" + currency + \")\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$.each(field_label_map, function (fname, label) {\n\t\t\tme.fields_dict[fname].set_label(label);\n\t\t});\n\n\t\t$.each(grid_field_label_map, function (fname, label) {\n\t\t\tfname = fname.split(\"-\");\n\t\t\tme.fields_dict[parentfield].grid.update_docfield_property(fname[1], \"label\", label);\n\t\t});\n\t}\n\n\tfield_map(fnames, fn) {\n\t\tif (typeof fnames === \"string\") {\n\t\t\tif (fnames == \"*\") {\n\t\t\t\tfnames = Object.keys(this.fields_dict);\n\t\t\t} else {\n\t\t\t\tfnames = [fnames];\n\t\t\t}\n\t\t}\n\t\tfor (var i = 0, l = fnames.length; i < l; i++) {\n\t\t\tvar fieldname = fnames[i];\n\t\t\tvar field = frappe.meta.get_docfield(this.doctype, fieldname, this.docname);\n\t\t\tif (field) {\n\t\t\t\tfn(field);\n\t\t\t\tthis.refresh_field(fieldname);\n\t\t\t}\n\t\t}\n\t}\n\n\tget_docfield(fieldname1, fieldname2) {\n\t\tif (fieldname2) {\n\t\t\t// for child\n\t\t\tvar doctype = this.get_docfield(fieldname1).options;\n\t\t\treturn frappe.meta.get_docfield(doctype, fieldname2, this.docname);\n\t\t} else {\n\t\t\t// for parent\n\t\t\treturn frappe.meta.get_docfield(this.doctype, fieldname1, this.docname);\n\t\t}\n\t}\n\n\tset_df_property(fieldname, property, value, docname, table_field, table_row_name = null) {\n\t\tlet df;\n\n\t\tif (!docname || !table_field) {\n\t\t\tdf = this.get_docfield(fieldname);\n\t\t} else {\n\t\t\tconst grid = this.fields_dict[fieldname].grid;\n\t\t\tconst filtered_fields = frappe.utils.filter_dict(grid.docfields, {\n\t\t\t\tfieldname: table_field,\n\t\t\t});\n\t\t\tif (filtered_fields.length) {\n\t\t\t\tdf = frappe.meta.get_docfield(\n\t\t\t\t\tfiltered_fields[0].parent,\n\t\t\t\t\ttable_field,\n\t\t\t\t\ttable_row_name\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (df && df[property] != value) {\n\t\t\tdf[property] = value;\n\n\t\t\tif (table_field && table_row_name) {\n\t\t\t\tif (this.fields_dict[fieldname].grid.grid_rows_by_docname[table_row_name]) {\n\t\t\t\t\tthis.fields_dict[fieldname].grid.grid_rows_by_docname[\n\t\t\t\t\t\ttable_row_name\n\t\t\t\t\t].refresh_field(table_field);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.refresh_field(fieldname);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggle_enable(fnames, enable) {\n\t\tthis.field_map(fnames, function (field) {\n\t\t\tfield.read_only = enable ? 0 : 1;\n\t\t});\n\t}\n\n\ttoggle_reqd(fnames, mandatory) {\n\t\tthis.field_map(fnames, function (field) {\n\t\t\tfield.reqd = mandatory ? true : false;\n\t\t});\n\t}\n\n\ttoggle_display(fnames, show) {\n\t\tthis.field_map(fnames, function (field) {\n\t\t\tfield.hidden = show ? 0 : 1;\n\t\t});\n\t}\n\n\tget_files() {\n\t\treturn this.attachments\n\t\t\t? frappe.utils.sort(this.attachments.get_attachments(), \"file_name\", \"string\")\n\t\t\t: [];\n\t}\n\n\tset_query(fieldname, opt1, opt2) {\n\t\tif (opt2) {\n\t\t\t// on child table\n\t\t\t// set_query(fieldname, parent fieldname, query)\n\t\t\tthis.fields_dict[opt1].grid.get_field(fieldname).get_query = opt2;\n\t\t} else {\n\t\t\t// on parent table\n\t\t\t// set_query(fieldname, query)\n\t\t\tif (this.fields_dict[fieldname]) {\n\t\t\t\tthis.fields_dict[fieldname].get_query = opt1;\n\t\t\t}\n\t\t}\n\t}\n\n\tclear_table(fieldname) {\n\t\tfrappe.model.clear_table(this.doc, fieldname);\n\t}\n\n\tadd_child(fieldname, values) {\n\t\tvar doc = frappe.model.add_child(\n\t\t\tthis.doc,\n\t\t\tfrappe.meta.get_docfield(this.doctype, fieldname).options,\n\t\t\tfieldname\n\t\t);\n\t\tif (values) {\n\t\t\t// Values of unique keys should not be overridden\n\t\t\tvar d = {};\n\t\t\tvar unique_keys = [\"idx\", \"name\"];\n\n\t\t\tObject.keys(values).map((key) => {\n\t\t\t\tif (!unique_keys.includes(key)) {\n\t\t\t\t\td[key] = values[key];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.extend(doc, d);\n\t\t}\n\t\treturn doc;\n\t}\n\n\tset_value(field, value, if_missing, skip_dirty_trigger = false) {\n\t\tvar me = this;\n\t\tvar _set = function (f, v) {\n\t\t\tvar fieldobj = me.fields_dict[f];\n\t\t\tif (fieldobj) {\n\t\t\t\tif (!if_missing || !frappe.model.has_value(me.doctype, me.doc.name, f)) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tfrappe.model.table_fields.includes(fieldobj.df.fieldtype) &&\n\t\t\t\t\t\t$.isArray(v)\n\t\t\t\t\t) {\n\t\t\t\t\t\t// set entire child table from specified array as value\n\t\t\t\t\t\tfrappe.model.clear_table(me.doc, fieldobj.df.fieldname);\n\n\t\t\t\t\t\tconst standard_fields = [\n\t\t\t\t\t\t\t...frappe.model.std_fields_list,\n\t\t\t\t\t\t\t...frappe.model.child_table_field_list,\n\t\t\t\t\t\t];\n\t\t\t\t\t\tv.forEach((d, idx) => {\n\t\t\t\t\t\t\tlet child = frappe.model.add_child(\n\t\t\t\t\t\t\t\tme.doc,\n\t\t\t\t\t\t\t\tfieldobj.df.options,\n\t\t\t\t\t\t\t\tfieldobj.df.fieldname,\n\t\t\t\t\t\t\t\tidx + 1\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Don't set standard field, avoid mutating input too.\n\t\t\t\t\t\t\tlet doc_copy = { ...d };\n\t\t\t\t\t\t\tstandard_fields.forEach((field) => {\n\t\t\t\t\t\t\t\tdelete doc_copy[field];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$.extend(child, doc_copy);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tme.refresh_field(f);\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn frappe.model.set_value(\n\t\t\t\t\t\t\tme.doctype,\n\t\t\t\t\t\t\tme.doc.name,\n\t\t\t\t\t\t\tf,\n\t\t\t\t\t\t\tv,\n\t\t\t\t\t\t\tme.fieldtype,\n\t\t\t\t\t\t\tskip_dirty_trigger\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfrappe.msgprint(__(\"Field {0} not found.\", [f]));\n\t\t\t\tthrow \"frm.set_value\";\n\t\t\t}\n\t\t};\n\n\t\tif (typeof field == \"string\") {\n\t\t\treturn _set(field, value);\n\t\t} else if ($.isPlainObject(field)) {\n\t\t\tlet tasks = [];\n\t\t\tfor (let f in field) {\n\t\t\t\tlet v = field[f];\n\t\t\t\tif (me.get_field(f)) {\n\t\t\t\t\ttasks.push(() => _set(f, v));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn frappe.run_serially(tasks);\n\t\t}\n\t}\n\n\tcall(opts, args, callback) {\n\t\tvar me = this;\n\t\tif (typeof opts === \"string\") {\n\t\t\t// called as frm.call('do_this', {with_arg: 'arg'});\n\t\t\topts = {\n\t\t\t\tmethod: opts,\n\t\t\t\tdoc: this.doc,\n\t\t\t\targs: args,\n\t\t\t\tcallback: callback,\n\t\t\t};\n\t\t}\n\t\tif (!opts.doc) {\n\t\t\tif (opts.method.indexOf(\".\") === -1)\n\t\t\t\topts.method = frappe.model.get_server_module_name(me.doctype) + \".\" + opts.method;\n\t\t\topts.original_callback = opts.callback;\n\t\t\topts.callback = function (r) {\n\t\t\t\tif ($.isPlainObject(r.message)) {\n\t\t\t\t\tif (opts.child) {\n\t\t\t\t\t\t// update child doc\n\t\t\t\t\t\topts.child = locals[opts.child.doctype][opts.child.name];\n\n\t\t\t\t\t\tvar std_field_list = [\"doctype\"]\n\t\t\t\t\t\t\t.concat(frappe.model.std_fields_list)\n\t\t\t\t\t\t\t.concat(frappe.model.child_table_field_list);\n\t\t\t\t\t\tfor (var key in r.message) {\n\t\t\t\t\t\t\tif (std_field_list.indexOf(key) === -1) {\n\t\t\t\t\t\t\t\topts.child[key] = r.message[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.fields_dict[opts.child.parentfield].refresh();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// update parent doc\n\t\t\t\t\t\tme.set_value(r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\topts.original_callback && opts.original_callback(r);\n\t\t\t};\n\t\t} else {\n\t\t\topts.original_callback = opts.callback;\n\t\t\topts.callback = function (r) {\n\t\t\t\tif (!r.exc) me.refresh_fields();\n\n\t\t\t\topts.original_callback && opts.original_callback(r);\n\t\t\t};\n\t\t}\n\t\treturn frappe.call(opts);\n\t}\n\n\tget_field(field) {\n\t\treturn this.fields_dict[field];\n\t}\n\n\tset_read_only() {\n\t\tconst docperms = frappe.perm.get_perm(this.doc.doctype);\n\t\tthis.perm = docperms.map((p) => {\n\t\t\treturn {\n\t\t\t\tread: p.read,\n\t\t\t\tcancel: p.cancel,\n\t\t\t\tshare: p.share,\n\t\t\t\tprint: p.print,\n\t\t\t\temail: p.email,\n\t\t\t};\n\t\t});\n\t}\n\n\ttrigger(event, doctype, docname) {\n\t\treturn this.script_manager.trigger(event, doctype, docname);\n\t}\n\n\tget_formatted(fieldname) {\n\t\treturn frappe.format(\n\t\t\tthis.doc[fieldname],\n\t\t\tfrappe.meta.get_docfield(this.doctype, fieldname, this.docname),\n\t\t\t{ no_icon: true },\n\t\t\tthis.doc\n\t\t);\n\t}\n\n\topen_grid_row() {\n\t\treturn frappe.ui.form.get_open_grid_form();\n\t}\n\n\tget_title() {\n\t\tif (this.meta.title_field) {\n\t\t\treturn this.doc[this.meta.title_field];\n\t\t} else {\n\t\t\treturn String(this.doc.name);\n\t\t}\n\t}\n\n\tget_selected() {\n\t\t// returns list of children that are selected. returns [parentfield, name] for each\n\t\tvar selected = {},\n\t\t\tme = this;\n\t\tfrappe.meta.get_table_fields(this.doctype).forEach(function (df) {\n\t\t\t// handle TableMultiselect child fields\n\t\t\tlet _selected = [];\n\n\t\t\tif (me.fields_dict[df.fieldname].grid) {\n\t\t\t\t_selected = me.fields_dict[df.fieldname].grid.get_selected();\n\t\t\t}\n\n\t\t\tif (_selected.length) {\n\t\t\t\tselected[df.fieldname] = _selected;\n\t\t\t}\n\t\t});\n\t\treturn selected;\n\t}\n\n\tset_indicator_formatter(fieldname, get_color, get_text) {\n\t\t// get doctype from parent\n\t\tvar doctype;\n\t\tif (frappe.meta.docfield_map[this.doctype][fieldname]) {\n\t\t\tdoctype = this.doctype;\n\t\t} else {\n\t\t\tfrappe.meta.get_table_fields(this.doctype).every(function (df) {\n\t\t\t\tif (frappe.meta.docfield_map[df.options][fieldname]) {\n\t\t\t\t\tdoctype = df.options;\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfrappe.meta.docfield_map[doctype][fieldname].formatter = function (\n\t\t\tvalue,\n\t\t\tdf,\n\t\t\toptions,\n\t\t\tdoc\n\t\t) {\n\t\t\tif (value) {\n\t\t\t\tvar label;\n\t\t\t\tif (get_text) {\n\t\t\t\t\tlabel = get_text(doc);\n\t\t\t\t} else if (frappe.form.link_formatters[df.options]) {\n\t\t\t\t\tlabel = frappe.form.link_formatters[df.options](value, doc);\n\t\t\t\t} else {\n\t\t\t\t\tlabel = value;\n\t\t\t\t}\n\n\t\t\t\tconst escaped_name = encodeURIComponent(value);\n\n\t\t\t\treturn `\n\t\t\t\t\t\t<a class=\"indicator ${get_color(doc || {})}\"\n\t\t\t\t\t\t\thref=\"/app/${frappe.router.slug(df.options)}/${escaped_name}\"\n\t\t\t\t\t\t\tdata-doctype=\"${df.options}\"\n\t\t\t\t\t\t\tdata-name=\"${frappe.utils.escape_html(value)}\">\n\t\t\t\t\t\t\t${label}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t`;\n\t\t\t} else {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t};\n\t}\n\n\tcan_create(doctype) {\n\t\t// return true or false if the user can make a particlar doctype\n\t\t// will check permission, `can_make_methods` if exists, or will decided on\n\t\t// basis of whether the document is submittable\n\t\tif (!frappe.model.can_create(doctype)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t\t// custom buttons are translated and so are the keys\n\t\t\tconst key = __(this.custom_make_buttons[doctype]);\n\t\t\t// if the button is present, then show make\n\t\t\treturn !!this.custom_buttons[key];\n\t\t}\n\n\t\tif (this.can_make_methods && this.can_make_methods[doctype]) {\n\t\t\treturn this.can_make_methods[doctype](this);\n\t\t} else {\n\t\t\tif (this.meta.is_submittable && !this.doc.docstatus == 1) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\tmake_new(doctype) {\n\t\t// make new doctype from the current form\n\t\t// will handover to `make_methods` if defined\n\t\t// or will create and match link fields\n\t\tlet me = this;\n\t\tif (this.make_methods && this.make_methods[doctype]) {\n\t\t\treturn this.make_methods[doctype](this);\n\t\t} else if (this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t\tthis.custom_buttons[__(this.custom_make_buttons[doctype])].trigger(\"click\");\n\t\t} else {\n\t\t\tfrappe.model.with_doctype(doctype, function () {\n\t\t\t\tlet new_doc = frappe.model.get_new_doc(doctype, null, null, true);\n\n\t\t\t\t// set link fields (if found)\n\t\t\t\tme.set_link_field(doctype, new_doc);\n\n\t\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t\t\t// frappe.set_route('Form', doctype, new_doc.name);\n\t\t\t});\n\t\t}\n\t}\n\n\tset_link_field(doctype, new_doc) {\n\t\tlet me = this;\n\t\tfrappe.get_meta(doctype).fields.forEach(function (df) {\n\t\t\tif (df.fieldtype === \"Link\" && df.options === me.doctype) {\n\t\t\t\tnew_doc[df.fieldname] = me.doc.name;\n\t\t\t} else if ([\"Link\", \"Dynamic Link\"].includes(df.fieldtype) && me.doc[df.fieldname]) {\n\t\t\t\tnew_doc[df.fieldname] = me.doc[df.fieldname];\n\t\t\t} else if (df.fieldtype === \"Table\" && df.options && df.reqd) {\n\t\t\t\tlet row = new_doc[df.fieldname][0];\n\t\t\t\tme.set_link_field(df.options, row);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate_in_all_rows(table_fieldname, fieldname, value) {\n\t\t// Update the `value` of the field named `fieldname` in all rows of the\n\t\t// child table named `table_fieldname`.\n\t\t// Do not overwrite existing values.\n\t\tif (value === undefined) return;\n\n\t\tfrappe.model\n\t\t\t.get_children(this.doc, table_fieldname)\n\t\t\t.filter((child) => !frappe.model.has_value(child.doctype, child.name, fieldname))\n\t\t\t.forEach((child) =>\n\t\t\t\tfrappe.model.set_value(child.doctype, child.name, fieldname, value)\n\t\t\t);\n\t}\n\n\tget_sum(table_fieldname, fieldname) {\n\t\tlet sum = 0;\n\t\tfor (let d of this.doc[table_fieldname] || []) {\n\t\t\tsum += d[fieldname];\n\t\t}\n\t\treturn sum;\n\t}\n\n\tscroll_to_field(fieldname, focus = true) {\n\t\tlet field = this.get_field(fieldname);\n\t\tif (!field) return;\n\n\t\tlet $el = field.$wrapper;\n\n\t\t// set tab as active\n\t\tif (field.tab && !field.tab.is_active()) {\n\t\t\tfield.tab.set_active();\n\t\t}\n\n\t\t// uncollapse section\n\t\tif (field.section?.is_collapsed()) {\n\t\t\tfield.section.collapse(false);\n\t\t}\n\n\t\t// scroll to input\n\t\tfrappe.utils.scroll_to($el, true, 15);\n\n\t\t// focus if text field\n\t\tif (focus) {\n\t\t\tsetTimeout(() => {\n\t\t\t\t$el.find(\"input, select, textarea\").focus();\n\t\t\t}, 500);\n\t\t}\n\n\t\t// highlight control inside field\n\t\tlet control_element = $el.closest(\".frappe-control\");\n\t\tcontrol_element.addClass(\"highlight\");\n\t\tsetTimeout(() => {\n\t\t\tcontrol_element.removeClass(\"highlight\");\n\t\t}, 2000);\n\t\treturn true;\n\t}\n\n\tsetup_docinfo_change_listener() {\n\t\tlet doctype = this.doctype;\n\t\tlet docname = this.docname;\n\n\t\tif (this.doc && !this.is_new()) {\n\t\t\tfrappe.realtime.doc_subscribe(doctype, docname);\n\t\t}\n\t\tfrappe.realtime.off(\"docinfo_update\");\n\t\tfrappe.realtime.on(\"docinfo_update\", ({ doc, key, action = \"update\" }) => {\n\t\t\tif (\n\t\t\t\t!doc.reference_doctype ||\n\t\t\t\t!doc.reference_name ||\n\t\t\t\tdoc.reference_doctype !== doctype ||\n\t\t\t\tdoc.reference_name !== docname\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet doc_list = frappe.model.docinfo[doctype][docname][key] || [];\n\t\t\tlet docindex = doc_list.findIndex((old_doc) => {\n\t\t\t\treturn old_doc.name === doc.name;\n\t\t\t});\n\n\t\t\tif (action === \"add\") {\n\t\t\t\tfrappe.model.docinfo[doctype][docname][key].push(doc);\n\t\t\t}\n\t\t\tif (docindex > -1) {\n\t\t\t\tif (action === \"update\") {\n\t\t\t\t\tfrappe.model.docinfo[doctype][docname][key].splice(docindex, 1, doc);\n\t\t\t\t}\n\t\t\t\tif (action === \"delete\") {\n\t\t\t\t\tfrappe.model.docinfo[doctype][docname][key].splice(docindex, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// no need to update timeline of owner of comment\n\t\t\t// gets handled via comment submit code\n\t\t\tif (\n\t\t\t\t!(\n\t\t\t\t\t[\"add\", \"update\"].includes(action) &&\n\t\t\t\t\tdoc.doctype === \"Comment\" &&\n\t\t\t\t\tdoc.owner === frappe.session.user\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tthis.timeline && this.timeline.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Filters fields from the reference doctype and sets them as options for a Select field\n\tset_fields_as_options(\n\t\tfieldname,\n\t\treference_doctype,\n\t\tfilter_function,\n\t\tdefault_options = [],\n\t\ttable_fieldname\n\t) {\n\t\tif (!reference_doctype) return Promise.resolve();\n\t\tlet options = default_options || [];\n\t\tif (!filter_function) filter_function = (f) => f;\n\t\treturn new Promise((resolve) => {\n\t\t\tfrappe.model.with_doctype(reference_doctype, () => {\n\t\t\t\tfrappe.get_meta(reference_doctype).fields.map((df) => {\n\t\t\t\t\tfilter_function(df) &&\n\t\t\t\t\t\toptions.push({ label: df.label || df.fieldname, value: df.fieldname });\n\t\t\t\t});\n\t\t\t\toptions &&\n\t\t\t\t\tthis.set_df_property(\n\t\t\t\t\t\tfieldname,\n\t\t\t\t\t\t\"options\",\n\t\t\t\t\t\toptions,\n\t\t\t\t\t\tthis.doc.name,\n\t\t\t\t\t\ttable_fieldname\n\t\t\t\t\t);\n\t\t\t\tresolve(options);\n\t\t\t});\n\t\t});\n\t}\n\tset_active_tab(tab) {\n\t\tif (!this.active_tab_map) {\n\t\t\tthis.active_tab_map = {};\n\t\t}\n\t\tthis.active_tab_map[this.docname] = tab;\n\n\t\tthis.script_manager.trigger(\"on_tab_change\");\n\t}\n\tget_active_tab() {\n\t\treturn this.active_tab_map && this.active_tab_map[this.docname];\n\t}\n\n\tget_involved_users() {\n\t\tlet user_fields = this.meta.fields\n\t\t\t.filter((d) => d.fieldtype === \"Link\" && d.options === \"User\")\n\t\t\t.map((d) => d.fieldname);\n\n\t\tuser_fields = [...user_fields, \"owner\", \"modified_by\"];\n\t\tlet involved_users = user_fields.map((field) => this.doc[field]);\n\n\t\tconst docinfo = this.get_docinfo();\n\n\t\tinvolved_users = involved_users.concat(\n\t\t\tdocinfo.communications.map((d) => d.sender && d.delivery_status === \"sent\"),\n\t\t\tdocinfo.comments.map((d) => d.owner),\n\t\t\tdocinfo.versions.map((d) => d.owner),\n\t\t\tdocinfo.assignments.map((d) => d.owner)\n\t\t);\n\n\t\treturn involved_users\n\t\t\t.uniqBy((u) => u)\n\t\t\t.filter((user) => ![\"Administrator\", frappe.session.user].includes(user))\n\t\t\t.filter(Boolean);\n\t}\n\n\tshow_submission_queue_banner() {\n\t\tlet wrapper = this.layout.wrapper.find(\".submission-queue-banner\");\n\n\t\tif (\n\t\t\t!(\n\t\t\t\tthis.meta.is_submittable &&\n\t\t\t\tthis.meta.queue_in_background &&\n\t\t\t\t!this.doc.__islocal &&\n\t\t\t\tthis.doc.docstatus === 0\n\t\t\t)\n\t\t) {\n\t\t\twrapper.length && wrapper.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!wrapper.length) {\n\t\t\twrapper = $('<div class=\"submission-queue-banner form-message\">');\n\t\t\tthis.layout.wrapper.prepend(wrapper);\n\t\t}\n\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: \"frappe.core.doctype.submission_queue.submission_queue.get_latest_submissions\",\n\t\t\t\targs: { doctype: this.doctype, docname: this.docname },\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tif (r.message?.latest_submission) {\n\t\t\t\t\t// if we are here that means some submission(s) were queued and are in queued/failed state\n\t\t\t\t\tlet submission_label = __(\"Previous Submission\");\n\t\t\t\t\tlet secondary = \"\";\n\t\t\t\t\tlet div_class = \"col-md-12\";\n\n\t\t\t\t\tif (r.message.exc) {\n\t\t\t\t\t\tsecondary = `: <span>${r.message.exc}</span>`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdiv_class = \"col-md-6\";\n\t\t\t\t\t\tsecondary = `\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"col-md-6\">\n\t\t\t\t\t\t\t<a href='/app/submission-queue?ref_doctype=${encodeURIComponent(\n\t\t\t\t\t\t\t\tthis.doctype\n\t\t\t\t\t\t\t)}&ref_docname=${encodeURIComponent(this.docname)}'>${__(\n\t\t\t\t\t\t\t\"All Submissions\"\n\t\t\t\t\t\t)}</a>\n\t\t\t\t\t\t`;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet html = `\n\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t<div class=\"${div_class}\">\n\t\t\t\t\t\t\t<a href='/app/submission-queue/${r.message.latest_submission}'>${submission_label} (${r.message.status})</a>${secondary}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t`;\n\n\t\t\t\t\twrapper.removeClass(\"red\").removeClass(\"yellow\");\n\t\t\t\t\twrapper.addClass(r.message.status == \"Failed\" ? \"red\" : \"yellow\");\n\t\t\t\t\twrapper.html(html);\n\t\t\t\t} else {\n\t\t\t\t\twrapper.remove();\n\t\t\t\t}\n\t\t\t});\n\t}\n};\n\nfrappe.validated = 0;\n", "frappe.provide(\"frappe.model\");\nfrappe.provide(\"frappe.utils\");\n\n/**\n * Opens the Website Meta Tag form if it exists for {route}\n * or creates a new doc and opens the form\n */\nfrappe.utils.set_meta_tag = function (route) {\n\tfrappe.db.exists(\"Website Route Meta\", route).then((exists) => {\n\t\tif (exists) {\n\t\t\tfrappe.set_route(\"Form\", \"Website Route Meta\", route);\n\t\t} else {\n\t\t\t// new doc\n\t\t\tconst doc = frappe.model.get_new_doc(\"Website Route Meta\");\n\t\t\tdoc.__newname = route;\n\t\t\tfrappe.set_route(\"Form\", doc.doctype, doc.name);\n\t\t}\n\t});\n};\n", "frappe.provide(\"frappe.model\");\n\n/*\n\tCommon class for handling client side interactions that\n\tapply to both DocType form and customize form.\n*/\nfrappe.model.DocTypeController = class DocTypeController extends frappe.ui.form.Controller {\n\tsetup() {\n\t\t// setup formatters for fieldtype\n\t\tfrappe.meta.docfield_map[\n\t\t\tthis.frm.doctype === \"DocType\" ? \"DocField\" : \"Customize Form Field\"\n\t\t].fieldtype.formatter = (value) => {\n\t\t\tconst prefix = {\n\t\t\t\t\"Tab Break\": \"--red-600\",\n\t\t\t\t\"Section Break\": \"--blue-600\",\n\t\t\t\t\"Column Break\": \"--yellow-600\",\n\t\t\t};\n\t\t\tif (prefix[value]) {\n\t\t\t\tvalue = `<span class=\"bold\" style=\"color: var(${prefix[value]})\">${value}</span>`;\n\t\t\t}\n\t\t\treturn value;\n\t\t};\n\t}\n\n\trefresh() {\n\t\tthis.show_db_utilization();\n\t}\n\n\tshow_db_utilization() {\n\t\tconst doctype = this.frm.doc.doc_type || this.frm.doc.name;\n\t\tfrappe\n\t\t\t.xcall(\"frappe.core.doctype.doctype.doctype.get_row_size_utilization\", {\n\t\t\t\tdoctype,\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tif (r < 50.0) return;\n\t\t\t\tthis.frm.dashboard.show_progress(\n\t\t\t\t\t__(\"Database Row Size Utilization\"),\n\t\t\t\t\tr,\n\t\t\t\t\t__(\n\t\t\t\t\t\t\"Database Table Row Size Utilization: {0}%, this limits number of fields you can add.\",\n\t\t\t\t\t\t[r]\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t});\n\t}\n\n\tmax_attachments() {\n\t\tif (!this.frm.doc.max_attachments) {\n\t\t\treturn;\n\t\t}\n\t\tconst is_attach_field = (f) => [\"Attach\", \"Attach Image\"].includes(f.fieldtype);\n\t\tconst no_of_attach_fields = this.frm.doc.fields.filter(is_attach_field).length;\n\n\t\tif (no_of_attach_fields > this.frm.doc.max_attachments) {\n\t\t\tthis.frm.set_value(\"max_attachments\", no_of_attach_fields);\n\t\t\tconst label = this.frm.get_docfield(\"max_attachments\").label;\n\t\t\tfrappe.show_alert(\n\t\t\t\t__(\"Number of attachment fields are more than {}, limit updated to {}.\", [\n\t\t\t\t\tlabel,\n\t\t\t\t\tno_of_attach_fields,\n\t\t\t\t])\n\t\t\t);\n\t\t}\n\t}\n\n\tnaming_rule() {\n\t\t// set the \"autoname\" property based on naming_rule\n\t\tif (this.frm.doc.naming_rule && !this.frm.__from_autoname) {\n\t\t\t// flag to avoid recursion\n\t\t\tthis.frm.__from_naming_rule = true;\n\n\t\t\tconst naming_rule_default_autoname_map = {\n\t\t\t\tAutoincrement: \"autoincrement\",\n\t\t\t\t\"Set by user\": \"prompt\",\n\t\t\t\t\"By fieldname\": \"field:\",\n\t\t\t\t'By \"Naming Series\" field': \"naming_series:\",\n\t\t\t\tExpression: \"format:\",\n\t\t\t\t\"Expression (sld style)\": \"\",\n\t\t\t\tRandom: \"hash\",\n\t\t\t\t\"By script\": \"\",\n\t\t\t};\n\t\t\tthis.frm.set_value(\n\t\t\t\t\"autoname\",\n\t\t\t\tnaming_rule_default_autoname_map[this.frm.doc.naming_rule] || \"\"\n\t\t\t);\n\t\t\tsetTimeout(() => (this.frm.__from_naming_rule = false), 500);\n\n\t\t\tthis.set_naming_rule_description();\n\t\t}\n\t}\n\n\tset_naming_rule_description() {\n\t\tlet naming_rule_description = {\n\t\t\t\"Set by user\": \"\",\n\t\t\tAutoincrement:\n\t\t\t\t\"Uses Auto Increment feature of database.<br><b>WARNING: After using this option, any other naming option will not be accessible.</b>\",\n\t\t\t\"By fieldname\": \"Format: <code>field:[fieldname]</code>. Valid fieldname must exist\",\n\t\t\t'By \"Naming Series\" field':\n\t\t\t\t\"Format: <code>naming_series:[fieldname]</code>. Default fieldname is <code>naming_series</code>\",\n\t\t\tExpression:\n\t\t\t\t\"Format: <code>format:EXAMPLE-{MM}morewords{fieldname1}-{fieldname2}-{#####}</code> - Replace all braced words (fieldnames, date words (DD, MM, YY), series) with their value. Outside braces, any characters can be used.\",\n\t\t\t\"Expression (old style)\":\n\t\t\t\t\"Format: <code>EXAMPLE-.#####</code> Series by prefix (separated by a dot)\",\n\t\t\tRandom: \"\",\n\t\t\t\"By script\": \"\",\n\t\t};\n\n\t\tif (this.frm.doc.naming_rule) {\n\t\t\tthis.frm\n\t\t\t\t.get_field(\"autoname\")\n\t\t\t\t.set_description(naming_rule_description[this.frm.doc.naming_rule]);\n\t\t}\n\t}\n\n\tautoname() {\n\t\t// set naming_rule based on autoname (for old doctypes where its not been set)\n\t\tif (this.frm.doc.autoname && !this.frm.doc.naming_rule && !this.frm.__from_naming_rule) {\n\t\t\t// flag to avoid recursion\n\t\t\tthis.frm.__from_autoname = true;\n\t\t\tconst autoname = this.frm.doc.autoname.toLowerCase();\n\n\t\t\tif (autoname === \"prompt\") this.frm.set_value(\"naming_rule\", \"Set by user\");\n\t\t\telse if (autoname === \"autoincrement\")\n\t\t\t\tthis.frm.set_value(\"naming_rule\", \"Autoincrement\");\n\t\t\telse if (autoname.startsWith(\"field:\"))\n\t\t\t\tthis.frm.set_value(\"naming_rule\", \"By fieldname\");\n\t\t\telse if (autoname.startsWith(\"naming_series:\"))\n\t\t\t\tthis.frm.set_value(\"naming_rule\", 'By \"Naming Series\" field');\n\t\t\telse if (autoname.startsWith(\"format:\"))\n\t\t\t\tthis.frm.set_value(\"naming_rule\", \"Expression\");\n\t\t\telse if (autoname === \"hash\") this.frm.set_value(\"naming_rule\", \"Random\");\n\t\t\telse this.frm.set_value(\"naming_rule\", \"Expression (old style)\");\n\n\t\t\tsetTimeout(() => (this.frm.__from_autoname = false), 500);\n\t\t}\n\t}\n\n\tsetup_fetch_from_fields(doc, doctype, docname) {\n\t\tlet frm = this.frm;\n\t\t// Render two select fields for Fetch From instead of Small Text for better UX\n\t\tlet field = frm.cur_grid.grid_form.fields_dict.fetch_from;\n\t\t$(field.input_area).hide();\n\n\t\tlet $doctype_select = $(`<select class=\"form-control\">`);\n\t\tlet $field_select = $(`<select class=\"form-control\">`);\n\t\tlet $wrapper = $('<div class=\"fetch-from-select row\"><div>');\n\t\t$wrapper.append($doctype_select, $field_select);\n\t\tfield.$input_wrapper.append($wrapper);\n\t\t$doctype_select.wrap('<div class=\"col\"></div>');\n\t\t$field_select.wrap('<div class=\"col\"></div>');\n\n\t\tlet row = frappe.get_doc(doctype, docname);\n\t\tlet curr_value = { doctype: null, fieldname: null };\n\t\tif (row.fetch_from) {\n\t\t\tlet [doctype, fieldname] = row.fetch_from.split(\".\");\n\t\t\tcurr_value.doctype = doctype;\n\t\t\tcurr_value.fieldname = fieldname;\n\t\t}\n\n\t\tlet doctypes = frm.doc.fields\n\t\t\t.filter((df) => df.fieldtype == \"Link\")\n\t\t\t.filter((df) => df.options && df.fieldname != row.fieldname)\n\t\t\t.sort((a, b) => a.options.localeCompare(b.options))\n\t\t\t.map((df) => ({\n\t\t\t\tlabel: `${df.options} (${df.fieldname})`,\n\t\t\t\tvalue: df.fieldname,\n\t\t\t}));\n\t\t$doctype_select.add_options([\n\t\t\t{ label: __(\"Select DocType\"), value: \"\", selected: true },\n\t\t\t...doctypes,\n\t\t]);\n\n\t\t$doctype_select.on(\"change\", () => {\n\t\t\trow.fetch_from = \"\";\n\t\t\tfrm.dirty();\n\t\t\tupdate_fieldname_options();\n\t\t});\n\n\t\tfunction update_fieldname_options() {\n\t\t\t$field_select.find(\"option\").remove();\n\n\t\t\tlet link_fieldname = $doctype_select.val();\n\t\t\tif (!link_fieldname) return;\n\t\t\tlet link_field = frm.doc.fields.find((df) => df.fieldname === link_fieldname);\n\t\t\tlet link_doctype = link_field.options;\n\t\t\tfrappe.model.with_doctype(link_doctype, () => {\n\t\t\t\tlet fields = frappe.meta\n\t\t\t\t\t.get_docfields(link_doctype, null, {\n\t\t\t\t\t\tfieldtype: [\"not in\", frappe.model.no_value_type],\n\t\t\t\t\t})\n\t\t\t\t\t.sort((a, b) => a.label.localeCompare(b.label))\n\t\t\t\t\t.map((df) => ({\n\t\t\t\t\t\tlabel: `${df.label} (${df.fieldtype})`,\n\t\t\t\t\t\tvalue: df.fieldname,\n\t\t\t\t\t}));\n\t\t\t\t$field_select.add_options([\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: __(\"Select Field\"),\n\t\t\t\t\t\tvalue: \"\",\n\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\tdisabled: true,\n\t\t\t\t\t},\n\t\t\t\t\t...fields,\n\t\t\t\t]);\n\n\t\t\t\tif (curr_value.fieldname) {\n\t\t\t\t\t$field_select.val(curr_value.fieldname);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t$field_select.on(\"change\", () => {\n\t\t\tlet fetch_from = `${$doctype_select.val()}.${$field_select.val()}`;\n\t\t\trow.fetch_from = fetch_from;\n\t\t\tfrm.dirty();\n\t\t});\n\n\t\tif (curr_value.doctype) {\n\t\t\t$doctype_select.val(curr_value.doctype);\n\t\t\tupdate_fieldname_options();\n\t\t}\n\t}\n};\n"],
  "mappings": "mbACC,OAAO,UAAU,aAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAnC,OAAO,UAAU,aAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAnC,OAAO,UAAU,eAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;QCArC,OAAO,UAAU,YAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAlC,OAAO,UAAU,WAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAjC,OAAO,UAAU,aAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAnC,OAAO,UAAU,aAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAnC,OAAO,UAAU,aAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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",
  "names": ["route", "doctype", "doctype_layout", "name", "doc", "r", "new_name", "doctype", "name", "doc", "after_insert", "init_callback", "force", "trimmed_doctype", "controller_name", "resolve", "fields", "df", "d", "me", "e", "data", "r", "route", "key", "value", "set_hooks", "frm", "fieldname", "field", "opts", "r", "html", "linked_docs", "linked_doctypes", "doctype", "docs", "doc", "heading", "frm", "parent", "_a", "_b", "users", "docname", "avatar_group", "me", "data", "doctype", "_c", "_d", "u", "added_users", "user", "removed_users", "unknown_users", "ReminderManager", "frm", "me", "_a", "period", "now_time", "magnitude", "unit", "time_to_set", "_b", "reminder", "opts", "title", "title_field", "event", "me", "doc_field", "input_name", "input_title", "merge", "confirm_message", "docname", "doctype", "queue", "warning", "rename_document", "new_docname", "reload_form", "data", "resolve", "reject", "fields", "title_field_label", "label", "fieldname", "d", "values", "indicator", "p", "docstatus", "is_submittable", "print_settings", "allow_print_for_draft", "allow_print_for_cancelled", "ReminderManager", "is_doctype_form", "is_doctype_custom", "dirty", "status", "doc", "is_amended", "perm_to_check", "add_cancel_button", "can_cancel", "click", "icon", "visible_fields_filter", "f", "dialog", "Section", "parent", "df", "card_layout", "layout", "make_card", "fieldname", "fieldobj", "_a", "olfldobj", "idx", "e", "hide", "f", "indicator_icon", "missing_mandatory", "j", "l", "section_df", "show", "parent", "frm", "df", "Section", "body_html", "label", "css_class", "hidden", "options", "title", "percent", "message", "progress_chart", "progress", "i", "opts", "progress_bar", "progress_class", "width", "percentage", "show", "el", "me", "element", "entries", "observer", "entry", "group_added", "group", "d", "transactions", "items", "doctype", "transactions_area_body", "e", "$link", "report", "fieldname", "show_open", "names", "filter", "dynamic_fieldname", "item", "method", "r", "count", "open_count", "data", "heatmap_message", "color", "indicators", "n_indicators", "colspan", "args", "html", "text", "alert_class", "permanent", "opts", "me", "state", "d", "transitions", "next_actions", "document_editable_by", "role", "added", "has_approval_access", "transition", "approval_access", "user", "doc", "action_added", "default_state", "frm", "action", "callback", "btn", "working_label", "freeze_message", "save", "remove_empty_rows", "check_mandatory", "_call", "r", "tables", "d", "modified_table_fields", "doc", "in_list_view_cells", "df", "cells", "i", "field", "cancel", "args", "workflow_state_fieldname", "has_errors", "error_fields", "folded", "docfield", "is_docfield_mandatory", "scroll_to", "meta", "message", "table_field", "table_label", "out", "expression", "parent", "e", "value", "fieldname", "opts", "current_route", "route", "newdoc", "index", "pdf", "callback", "letter_head", "pick_columns", "print_settings", "default_letter_head", "columns", "df", "data", "resolve", "reject", "err", "qz_required_assets", "resolver", "e", "form", "setting", "result", "count", "message", "$buttons", "action", "$btn", "next_action_container", "html", "actions", "frm", "modified", "creation", "cscript", "controller_object", "doctype", "fieldname", "handler", "add_handler", "handler_list", "_handler", "args", "error", "key", "fn", "opts", "ControllerClass", "event_name", "name", "me", "tasks", "handlers", "runner", "_function", "is_old_style", "_promise", "i", "_a", "client_script", "e", "setup_add_fetch", "df", "parts", "field", "caller", "parentfield", "current_row", "fieldnames", "data", "flist", "dn", "table_field", "n", "docname", "grid", "field", "grid_row", "meta", "txt", "hidden", "df", "i", "opts", "assignments", "assignments_wrapper", "assigned_users", "d", "avatar_group", "me", "r", "owner", "args", "assign_to", "txt", "value", "assignment", "row", "btn_group", "opts", "me", "_a", "raise_exception", "attachment_count", "attachment_limit", "max_reached", "attachments", "is_slicable", "show", "show_all_btn", "attachments_to_render", "start", "exists", "attachment", "file_name", "file_url", "fileid", "file_label", "remove_action", "target_id", "target_attachment", "icon", "fid", "filename", "callback", "r", "rt", "fieldname", "restrictions", "file_doc", "form_attachments", "new_attachments", "i", "opts", "shared_users", "avatar_group", "me", "d", "r", "shared", "everyone", "i", "s", "user", "value", "property", "found", "parent", "frm", "data", "review_button", "user_options", "review_dialog", "values", "review", "review_logs", "log", "review_pill", "el", "subject", "fullname", "timestamp", "message_parts", "opts", "docinfo", "document_follow_enabled", "document_can_be_followed", "r", "user", "html", "resolve", "d", "frm", "image_section", "image_field", "image", "title_image", "image_actions", "title", "_a", "_b", "$target", "field", "opts", "type", "docinfo", "data_updated", "users", "show_alert", "sidebar_users", "new_users", "current_users", "message", "username", "user_info", "alert_users", "get_version_timeline_content", "version_doc", "frm", "data", "get_version_comment", "out", "updater_reference_link", "updater_reference", "label", "doctype", "docname", "parts", "p", "message", "get_user_message", "get_user_link", "df", "field_display_status", "format_content_for_timeline", "row", "key", "version_comment", "user_link", "text", "unlinked_content", "element", "e", "content", "user", "user_display_text", "message_self", "message_other", "opts", "sidebar_content", "me", "assignment_link", "route", "res", "get_user_message", "get_user_link", "tags_parent", "user_tags", "label", "click", "is_followed", "follow", "liked", "count", "review_wrapper", "callback", "r", "BaseTimeline", "opts", "label", "action", "icon", "btn_class", "icon_element", "action_btn", "response", "item1", "item2", "item", "append_at_the_end", "timeline_item", "items", "el", "creation", "more_items", "timeline_content", "base_timeline_default", "FormTimeline", "base_timeline_default", "create_event", "args", "doc_info", "has_communications", "communications", "comments", "me", "e", "link", "message", "text", "res", "get_user_message", "get_user_link", "view_timeline_contents", "view", "more_communications", "more_automated_messages", "email_communications", "automated_messages", "all_communications", "load_more_button", "more_items", "communication_timeline_contents", "icon_set", "communication", "medium", "start", "response", "doc", "allow_reply", "communication_content", "indicator_color", "auto_messages_timeline_contents", "comment_timeline_contents", "comment", "comment_content", "version_timeline_contents", "version", "get_version_timeline_content", "content", "share_timeline_contents", "share_log", "assignment_timeline_contents", "assignment_log", "info_timeline_contents", "info_log", "attachment_timeline_contents", "attachment_log", "is_file_upload", "user_link", "filename", "timeline_content", "milestone_timeline_contents", "milestone_log", "field", "value", "like_timeline_contents", "like_log", "workflow_timeline_contents", "workflow_log", "custom_timeline_contents", "custom_item", "energy_point_timeline_contents", "log", "timeline_badge", "communication_box", "communication_doc", "actions", "reply", "reply_all", "email_accounts", "account", "recipients", "r", "comment_value", "comment_wrapper", "edit_wrapper", "edit_box", "content_wrapper", "more_actions_wrapper", "delete_option", "dismiss_button", "edit_button", "current_user", "actions_wrapper", "container", "name", "from_recipient", "recipient", "record", "b", "comment_name", "ev", "doc_link", "element_id", "form_timeline_default", "opts", "comment", "comment_item", "form_timeline_default", "frm", "step", "$input", "section", "tour_name", "on_finish", "name_step", "on_next", "_a", "field", "on_prev", "driver_step", "step_info", "name", "fieldname", "title", "description", "position", "is_table_field", "element", "steps", "idx", "current_step", "curr_step", "rows", "curr_driver_step", "s", "$add_row", "add_row_step", "start_from", "$close_row", "next_step", "next_element", "close_row_step", "save_step", "modal_element", "attach_dialog_step", "UndoManager", "frm", "fieldname", "old_value", "new_value", "doctype", "docname", "is_child", "change", "stack", "__spreadProps", "__spreadValues", "msg", "opts", "doctype", "parent", "in_form", "doctype_layout_name", "UndoManager", "event", "is_single_column", "row", "dashboard_parent", "dashboard_added", "tab", "me", "fieldname", "value", "doc", "skip_dirty_trigger", "field", "table_fields", "df", "ev", "dt", "old_name", "new_name", "e", "dataTransfer", "file_doc", "file", "docname", "switched", "table", "action", "_action", "grid_obj", "layout_wrapper", "route_callback", "fn", "save_action", "callback", "btn", "on_error", "resolve", "reject", "after_save", "r", "fail", "links_text", "links", "doctypes", "link", "docnames", "confirm_message", "can_cancel", "d", "resp", "skip_confirm", "cancel_doc", "after_cancel", "is_amended", "newdoc", "perm_to_check", "allowed_for_workflow", "perms", "set_dirty", "path", "label", "old", "name", "prev", "filters", "sort_field", "sort_order", "list_view", "list_settings", "args", "message", "onload", "from_amend", "fname", "link_field", "source_field", "target_field", "target_doctype", "ptype", "permlevel", "access_type", "txt", "color", "group", "menu_item_label", "type", "scroll_to", "selector", "key", "fields_list", "currency", "parentfield", "field_label_map", "grid_field_label_map", "i", "docfield", "fnames", "l", "fieldname1", "fieldname2", "property", "table_field", "table_row_name", "grid", "filtered_fields", "enable", "mandatory", "show", "opt1", "opt2", "values", "unique_keys", "if_missing", "_set", "f", "v", "fieldobj", "standard_fields", "idx", "child", "doc_copy", "__spreadValues", "tasks", "std_field_list", "docperms", "p", "selected", "_selected", "get_color", "get_text", "options", "escaped_name", "new_doc", "table_fieldname", "sum", "focus", "_a", "$el", "control_element", "docindex", "old_doc", "reference_doctype", "filter_function", "default_options", "user_fields", "involved_users", "docinfo", "u", "user", "wrapper", "submission_label", "secondary", "div_class", "html", "route", "exists", "doc", "value", "prefix", "doctype", "r", "is_attach_field", "f", "no_of_attach_fields", "label", "naming_rule_default_autoname_map", "naming_rule_description", "autoname", "doc", "docname", "frm", "field", "$doctype_select", "$field_select", "$wrapper", "row", "curr_value", "fieldname", "doctypes", "df", "a", "b", "update_fieldname_options", "link_fieldname", "link_doctype", "fields", "fetch_from"]
}
