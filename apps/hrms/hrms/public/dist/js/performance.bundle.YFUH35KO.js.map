{
  "version": 3,
  "sources": ["../../../../../apps/hrms/hrms/public/js/performance/performance_feedback.js", "frappe-html:/home/kiranmai/Hilltop/frappe-bench/apps/hrms/hrms/public/js/templates/performance_feedback.html"],
  "sourcesContent": ["\nfrappe.provide(\"hrms\");\n\nhrms.PerformanceFeedback = class PerformanceFeedback {\n\tconstructor({ frm, wrapper }) {\n\t\tthis.frm = frm;\n\t\tthis.wrapper = wrapper;\n\t}\n\n\trefresh() {\n\t\tthis.prepare_dom();\n\t\tthis.setup_feedback_view();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.find(\".feedback-section\").remove();\n\t}\n\n\tsetup_feedback_view() {\n\t\tfrappe.run_serially([\n\t\t\t() => this.get_feedback_history(),\n\t\t\t(data) => this.render_feedback_history(data),\n\t\t\t() => this.setup_actions(),\n\t\t])\n\t}\n\n\tget_feedback_history() {\n\t\tlet me = this;\n\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"hrms.hr.doctype.appraisal.appraisal.get_feedback_history\",\n\t\t\t\targs: {\n\t\t\t\t\temployee: me.frm.doc.employee,\n\t\t\t\t\tappraisal: me.frm.doc.name\n\t\t\t\t}\n\t\t\t}).then(r => resolve(r.message));\n\t\t});\n\t}\n\n\tasync render_feedback_history(data) {\n\t\tconst { feedback_history, reviews_per_rating, avg_feedback_score } = data || {};\n\t\tconst can_create = await this.can_create();\n\n\t\tconst feedback_html = frappe.render_template(\"performance_feedback\", {\n\t\t\tfeedback_history: feedback_history,\n\t\t\taverage_feedback_score: avg_feedback_score,\n\t\t\treviews_per_rating: reviews_per_rating,\n\t\t\tcan_create: can_create\n\t\t});\n\n\t\t$(this.wrapper).empty();\n\t\t$(feedback_html).appendTo(this.wrapper);\n\t}\n\n\tsetup_actions() {\n\t\tlet me = this;\n\n\t\t$(\".new-feedback-btn\").click(() => {\n\t\t\tme.add_feedback();\n\t\t});\n\t}\n\n\tadd_feedback() {\n\t\tfrappe.run_serially([\n\t\t\t() => this.get_feedback_criteria_data(),\n\t\t\t(criteria_data) => this.show_add_feedback_dialog(criteria_data),\n\t\t]);\n\t}\n\n\tget_feedback_criteria_data() {\n\t\tlet me = this;\n\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.db.get_doc(\"Appraisal Template\", me.frm.doc.appraisal_template)\n\t\t\t\t.then(({ rating_criteria }) => {\n\t\t\t\t\tconst criteria_list = [];\n\t\t\t\t\trating_criteria.forEach((entry) => {\n\t\t\t\t\t\tcriteria_list.push({\n\t\t\t\t\t\t\t\"criteria\": entry.criteria,\n\t\t\t\t\t\t\t\"per_weightage\": entry.per_weightage,\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t\tresolve(criteria_list);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tshow_add_feedback_dialog(criteria_data) {\n\t\tlet me = this;\n\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Add Feedback\"),\n\t\t\tfields: me.get_feedback_dialog_fields(criteria_data),\n\t\t\tsize: \"large\",\n\t\t\tminimizable: true,\n\t\t\tprimary_action_label: __(\"Submit\"),\n\t\t\tprimary_action: function() {\n\t\t\t\tconst data = dialog.get_values();\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"add_feedback\",\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfeedback: data.feedback,\n\t\t\t\t\t\tfeedback_ratings: data.feedback_ratings\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => me.frm.refresh_fields(),\n\t\t\t\t\t\t\t\t() => me.refresh()\n\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Feedback {0} added successfully\", [r.message?.name?.bold()]),\n\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tdialog.show();\n\t};\n\n\tget_feedback_dialog_fields(criteria_data) {\n\t\treturn [\n\t\t\t{\n\t\t\t\tlabel: \"Feedback\",\n\t\t\t\tfieldname: \"feedback\",\n\t\t\t\tfieldtype: \"Text Editor\",\n\t\t\t\treqd: 1,\n\t\t\t\tenable_mentions: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: \"Feedback Rating\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tfieldname: \"feedback_ratings\",\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tdata: criteria_data,\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"criteria\",\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: \"Criteria\",\n\t\t\t\t\t\toptions: \"Employee Feedback Criteria\",\n\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"per_weightage\",\n\t\t\t\t\t\tfieldtype: \"Percent\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: \"Weightage\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: \"rating\",\n\t\t\t\t\t\tfieldtype: \"Rating\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: \"Rating\",\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t];\n\t}\n\n\tasync can_create() {\n\t\tconst is_employee = (\n\t\t\tawait frappe.db.get_value(\"Employee\", {\"user_id\": frappe.session.user}, \"name\")\n\t\t)?.message?.name || false;\n\n\t\treturn (is_employee && frappe.model.can_create(\"Employee Performance Feedback\"));\n\t}\n};\n", "\n\tfrappe.templates['performance_feedback'] = `<div class=\"feedback-section col-xs-12\">\n\t{% if (feedback_history.length) { %}\n\t\t<div class=\"feedback-summary mb-5 pb-2\">\n\t\t\t{%=\n\t\t\t\tfrappe.render_template(\n\t\t\t\t\t\"feedback_summary\",\n\t\t\t\t\t{\n\t\t\t\t\t\tnumber_of_stars: 5,\n\t\t\t\t\t\taverage_rating: average_feedback_score,\n\t\t\t\t\t\tfeedback_count: feedback_history.length,\n\t\t\t\t\t\treviews_per_rating: reviews_per_rating\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t%}\n\t\t</div>\n\t{% } %}\n\n\t{% if (can_create) { %}\n\t\t<div class=\"new-btn pb-3 text-right\">\n\t\t\t<button\n\t\t\t\tclass=\"new-feedback-btn btn btn-sm d-inline-flex align-items-center justify-content-center px-3 py-2 border\"\n\t\t\t>\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-add\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Feedback\") }}\n\t\t\t</button>\n\t\t</div>\n\t{% } %}\n\n\t{%=\n\t\tfrappe.render_template(\n\t\t\t\"feedback_history\",\n\t\t\t{ feedback_history: feedback_history, feedback_doctype: \"Employee Performance Feedback\" }\n\t\t)\n\t%}\n</div>\n`;\n"],
  "mappings": "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",
  "names": ["frm", "wrapper", "data", "me", "resolve", "feedback_history", "reviews_per_rating", "avg_feedback_score", "can_create", "feedback_html", "criteria_data", "rating_criteria", "criteria_list", "entry", "dialog", "r", "_a", "_b"]
}
